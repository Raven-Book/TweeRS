window.storyFormat({"name":"Harlowe","version":"4.0.0-unstable","author":"Leon Arnott","description":"⚠ This is an unstable in-progress build of Harlowe 4.0.0. Use this <em>only</em> for testing newly-developed features. The built-in version of Harlowe is recommended for serious story-writing.","image":"icon.svg","url":"http://twinery.org/","license":"Zlib","proofing":false,"source":"<!DOCTYPE html>\n<html>\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n<title>{{STORY_NAME}}</title>\n<style title=\"Twine CSS\">@keyframes appear{0%{opacity:0}to{opacity:1}}@keyframes fade-in-out{0%,to{opacity:0}50%{opacity:1}}@keyframes rumble{25%{top:-0.1em}75%{top:.1em}0%,to{top:0px}}@keyframes shudder{25%{left:.1em}75%{left:-0.1em}0%,to{left:0px}}@keyframes buoy{25%{top:.25em}75%{top:-0.25em}0%,to{top:0px}}@keyframes sway{25%{left:.25em}75%{left:-0.25em}0%,to{left:0px}}@keyframes pulse{0%{transform:scale(0, 0)}20%{transform:scale(1.2, 1.2)}40%{transform:scale(0.9, 0.9)}60%{transform:scale(1.05, 1.05)}80%{transform:scale(0.925, 0.925)}to{transform:scale(1, 1)}}@keyframes zoom-in{0%{transform:scale(0, 0)}to{transform:scale(1, 1)}}@keyframes shudder-in{0%,to{transform:translateX(0em)}5%,25%,45%{transform:translateX(-1em)}15%,35%,55%{transform:translateX(1em)}65%{transform:translateX(-0.6em)}75%{transform:translateX(0.6em)}85%{transform:translateX(-0.2em)}95%{transform:translateX(0.2em)}}@keyframes rumble-in{0%,to{transform:translateY(0em)}5%,25%,45%{transform:translateY(-1em)}15%,35%,55%{transform:translateY(1em)}65%{transform:translateY(-0.6em)}75%{transform:translateY(0.6em)}85%{transform:translateY(-0.2em)}95%{transform:translateY(0.2em)}}@keyframes fidget{0%,8.1%,82.1%,31.1%,38.1%,44.1%,40.1%,47.1%,74.1%,16.1%,27.1%,72.1%,24.1%,95.1%,6.1%,36.1%,20.1%,4.1%,91.1%,14.1%,87.1%,to{left:0px;top:0px}8%,82%,31%,38%,44%{left:-1px}40%,47%,74%,16%,27%{left:1px}72%,24%,95%,6%,36%{top:-1px}20%,4%,91%,14%,87%{top:1px}}@keyframes slide-right{0%{transform:translateX(-100vw)}}@keyframes slide-left{0%{transform:translateX(100vw)}}@keyframes slide-up{0%{transform:translateY(100vh)}}@keyframes slide-down{0%{transform:translateY(-100vh)}}@keyframes fade-right{0%{opacity:0;transform:translateX(-1em)}to{opacity:1}}@keyframes fade-left{0%{opacity:0;transform:translateX(1em)}to{opacity:1}}@keyframes fade-up{0%{opacity:0;transform:translateY(1em)}to{opacity:1}}@keyframes fade-down{0%{opacity:0;transform:translateY(-1em)}to{opacity:1}}@keyframes flicker{0%,29%,31%,63%,65%,77%,79%,86%,88%,91%,93%{opacity:0}30%{opacity:.2}64%{opacity:.4}78%{opacity:.6}87%{opacity:.8}92%,to{opacity:1}}@keyframes blur{0%{filter:blur(2rem);opacity:0}25%{opacity:1}to{filter:blur(0rem);opacity:1}}.dom-debug-mode tw-story,.dom-debug-mode tw-passage,.dom-debug-mode tw-sidebar,.dom-debug-mode tw-include,.dom-debug-mode tw-hook,.dom-debug-mode tw-expression,.dom-debug-mode tw-link,.dom-debug-mode tw-dialog,.dom-debug-mode tw-columns,.dom-debug-mode tw-column,.dom-debug-mode tw-align{outline:1px solid #f5a3da;min-height:32px;display:block !important}.dom-debug-mode tw-story::before,.dom-debug-mode tw-passage::before,.dom-debug-mode tw-sidebar::before,.dom-debug-mode tw-include::before,.dom-debug-mode tw-hook::before,.dom-debug-mode tw-expression::before,.dom-debug-mode tw-link::before,.dom-debug-mode tw-dialog::before,.dom-debug-mode tw-columns::before,.dom-debug-mode tw-column::before,.dom-debug-mode tw-align::before{position:absolute;top:0;left:0;height:16px;background-color:#f5a3da;color:#000;font-size:16px;font-weight:normal;font-style:normal;font-family:monospace;display:inline-block;line-height:100%;white-space:pre;z-index:999997}.dom-debug-mode tw-story:hover,.dom-debug-mode tw-passage:hover,.dom-debug-mode tw-sidebar:hover,.dom-debug-mode tw-include:hover,.dom-debug-mode tw-hook:hover,.dom-debug-mode tw-expression:hover,.dom-debug-mode tw-link:hover,.dom-debug-mode tw-dialog:hover,.dom-debug-mode tw-columns:hover,.dom-debug-mode tw-column:hover,.dom-debug-mode tw-align:hover{outline:1px solid #fc9}.dom-debug-mode tw-story:hover::before,.dom-debug-mode tw-passage:hover::before,.dom-debug-mode tw-sidebar:hover::before,.dom-debug-mode tw-include:hover::before,.dom-debug-mode tw-hook:hover::before,.dom-debug-mode tw-expression:hover::before,.dom-debug-mode tw-link:hover::before,.dom-debug-mode tw-dialog:hover::before,.dom-debug-mode tw-columns:hover::before,.dom-debug-mode tw-column:hover::before,.dom-debug-mode tw-align:hover::before{background-color:#fc9;transition:background-color 1s}.dom-debug-mode tw-passage,.dom-debug-mode tw-include,.dom-debug-mode tw-hook,.dom-debug-mode tw-expression,.dom-debug-mode tw-link,.dom-debug-mode tw-dialog,.dom-debug-mode tw-columns,.dom-debug-mode tw-column,.dom-debug-mode tw-align{padding:1em;margin:0}.dom-debug-mode tw-story::before{content:'<tw-story tags=\"' attr(tags) '\">'}.dom-debug-mode tw-passage::before{top:-16px;content:'<tw-passage tags=\"' attr(tags) '\">'}.dom-debug-mode tw-sidebar::before{top:-16px;content:\"<tw-sidebar>\"}.dom-debug-mode tw-hook::before{content:'<tw-hook name=\"' attr(name) '\">'}.dom-debug-mode tw-expression::before{content:'<tw-expression name=\"' attr(name) '\">'}.dom-debug-mode tw-link::before{content:'<tw-link name=\"' attr(name) '\">'}.dom-debug-mode tw-dialog::before{content:\"<tw-dialog>\"}.dom-debug-mode tw-columns::before{content:\"<tw-columns>\"}.dom-debug-mode tw-column::before{content:\"<tw-column>\"}.dom-debug-mode tw-align::before{content:\"<tw-align>\"}.dom-debug-mode tw-include::before{content:'<tw-include type=\"' attr(type) '\" name=\"' attr(name) '\">'}tw-open-button[goto]{display:none}.debug-mode tw-open-button[replay],.debug-mode tw-open-button[goto]{display:inline}.debug-mode tw-expression{display:inline-block !important}.debug-mode tw-expression[type=variable]::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:\"$\" attr(name)}.debug-mode tw-expression[type=tempVariable]::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:\"_\" attr(name)}.debug-mode tw-expression[return=boolean]{background-color:rgba(179,179,179,.2)}.debug-mode tw-expression[return=array]{background-color:rgba(255,102,102,.2)}.debug-mode tw-expression[return=dataset]{background-color:rgba(255,128,0,.2)}.debug-mode tw-expression[return=number]{background-color:rgba(255,179,102,.2)}.debug-mode tw-expression[return=datamap]{background-color:rgba(255,255,102,.2)}.debug-mode tw-expression[return=changer]{background-color:rgba(179,255,102,.2)}.debug-mode tw-expression[return=lambda]{background-color:rgba(102,255,102,.2)}.debug-mode tw-expression[return=hookname]{background-color:rgba(102,255,204,.2)}.debug-mode tw-expression[return=string]{background-color:rgba(102,255,255,.2)}.debug-mode tw-expression[return=datatype]{background-color:rgba(102,153,255,.2)}.debug-mode tw-expression[return=gradient],.debug-mode tw-expression[return=colour]{background-color:rgba(204,102,255,.2)}.debug-mode tw-expression[return=instant],.debug-mode tw-expression[return=macro]{background-color:rgba(240,117,199,.2)}.debug-mode tw-expression[return=command]{background-color:rgba(153,153,255,.2)}.debug-mode tw-expression.false{background-color:rgba(255,0,0,.2) !important}.debug-mode tw-expression[type=macro]::before{content:\"(\" attr(name) \":)\";padding:0 .5rem;font-size:1rem;vertical-align:middle;line-height:normal;background-color:inherit;border:1px solid rgba(255,255,255,.5)}.debug-mode tw-expression[title]:not([title=\"\"]){cursor:help}.debug-mode tw-hook{background-color:rgba(0,85,255,.1) !important}.debug-mode tw-hook::before{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:\"[\"}.debug-mode tw-hook::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:\"]\"}.debug-mode tw-hook[name]::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:\"]<\" attr(name) \"|\"}.debug-mode tw-pseudo-hook{background-color:rgba(255,170,0,.1) !important}.debug-mode tw-collapsed::before{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:\"{\"}.debug-mode tw-collapsed::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:\"}\"}.debug-mode tw-verbatim::before,.debug-mode tw-verbatim::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:\"`\"}.debug-mode tw-align[style*=\"text-align: center\"]{background:linear-gradient(to right, hsla(14, 100%, 87%, 0) 0%, hsla(14, 100%, 87%, 0.25) 50%, hsla(14, 100%, 87%, 0) 100%)}.debug-mode tw-align[style*=\"text-align: left\"]{background:linear-gradient(to right, hsla(14, 100%, 87%, 0.25) 0%, hsla(14, 100%, 87%, 0) 100%)}.debug-mode tw-align[style*=\"text-align: right\"]{background:linear-gradient(to right, hsla(14, 100%, 87%, 0) 0%, hsla(14, 100%, 87%, 0.25) 100%)}.debug-mode tw-column{background-color:rgba(189,228,255,.2)}.debug-mode tw-enchantment{animation:enchantment .5s infinite;border:1px solid}.debug-mode tw-link::after,.debug-mode tw-broken-link::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:attr(passage-name)}.debug-mode tw-include{background-color:rgba(204,128,51,.1)}.debug-mode tw-include::before{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:attr(type) ' \"' attr(name) '\"'}.debug-dialogs tw-backdrop:not(.eval-replay):not(.harlowe-crash){pointer-events:none;opacity:.1}tw-eval-replay tw-eval-code,tw-eval-replay tw-eval-explanation{max-height:20vh;overflow:auto;margin:10px auto}tw-eval-replay tw-eval-code{display:block;font-family:monospace;padding-bottom:1ex;border-bottom:2px solid gray}tw-eval-replay tw-eval-explanation{display:block;text-align:center}tw-eval-replay tw-eval-explanation>code{white-space:pre-wrap}tw-eval-replay tw-eval-explanation>code.from-block{width:40%;display:inline-block;text-align:left;max-height:4em;overflow-wrap:anywhere;overflow-y:scroll}tw-eval-replay tw-eval-explanation>code.from-block~.to-desc{width:calc(40% - 2em);margin-left:2em;display:inline-block}tw-eval-replay tw-eval-explanation>code.from-block+span::after{content:\"...\"}tw-eval-replay tw-eval-explanation>code.from-inline{text-align:right}tw-eval-replay tw-eval-explanation>:nth-child(2){white-space:pre}tw-eval-replay tw-eval-explanation>.to-desc{text-align:left}tw-eval-replay tw-eval-explanation>table{width:100%;margin-top:1em}tw-eval-replay tw-eval-explanation>table td{white-space:pre-wrap !important;word-wrap:anywhere}tw-eval-replay tw-eval-reason{text-align:center;font-size:80%;font-style:italic;display:block}tw-eval-replay tw-eval-it{text-align:center;font-size:80%;display:block}tw-eval-replay tw-dialog-links{display:flex;justify-content:space-around}@keyframes enchantment{0%,to{border-color:#ffb366}50%{border-color:#6fc}}tw-debugger{position:fixed;box-sizing:border-box;bottom:0;right:0;z-index:999999;min-width:14em;min-height:1em;padding:0em .5em .5em 1em;font-size:1.25em;font-family:sans-serif;color:#262626;background-color:#fff;border-left:solid #262626 2px;border-top:solid #262626 2px;border-top-left-radius:.5em;opacity:1}tw-debugger.fade-panel:not(:hover){opacity:.33}tw-debugger.theme-dark{color:#d9d9d9;background-color:#000}tw-debugger.theme-dark{border-color:#d9d9d9 rgba(0,0,0,0) rgba(0,0,0,0) #d9d9d9}tw-debugger select{margin-right:1em;width:12em}tw-debugger button,tw-debugger tw-link{border-radius:3px;border:solid #999 1px;margin:auto 4px;color:#262626;background-color:#fff;cursor:pointer}tw-debugger button.enabled,tw-debugger tw-link.enabled{color:#000;background-color:#d9d9d9;box-shadow:inset #999 3px 5px .5em}tw-debugger.theme-dark button,tw-debugger.theme-dark tw-link{color:#d9d9d9;background-color:#000;border-color:#666}tw-debugger.theme-dark button.enabled,tw-debugger.theme-dark tw-link.enabled{color:#e6e6e6;background-color:#424242;box-shadow:inset #666 3px 5px .5em}tw-debugger button{font-size:1em;overflow-x:hidden;text-overflow:ellipsis;white-space:pre}tw-debugger tw-link{font-size:1.25em;border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0px 8px;display:block}tw-debugger tw-link:hover{border-color:#262626;color:#262626}tw-debugger.theme-dark tw-link:hover{border-color:#d9d9d9;color:#d9d9d9}tw-debugger tw-dialog{background-color:#fff;color:#000;font-size:1.25em}tw-debugger.theme-dark tw-dialog{background-color:#000;color:#e6e6e6}tw-debugger .panel{display:flex;flex-direction:column;position:absolute;bottom:100%;left:-2px;right:0;padding:1em;overflow-y:scroll;overflow-x:hidden;border:inherit;box-sizing:content-box;background-color:#fff;border-bottom:solid #999 2px;border-top-left-radius:.5em;border-bottom-left-radius:.5em;font-size:.8em}tw-debugger .panel:empty,tw-debugger .panel[hidden]{display:none}tw-debugger.theme-dark .panel{background-color:#000;border-bottom-color:#666}tw-debugger .panel-source .panel-row-buttons{width:2rem}tw-debugger .panel-source .source-tags{width:20%;font-style:italic}tw-debugger .panel-row-source td{font-family:monospace;font-size:1rem;white-space:pre-wrap;overflow-wrap:anywhere;max-height:8rem;padding:1rem}tw-debugger .panel-rows{width:100%;overflow-x:scroll}tw-debugger .panel-rows>*{display:table-row}tw-debugger .panel-rows>div:nth-of-type(2n){background-color:#e6e6e6}tw-debugger .panel-tools .panel-rows>*,tw-debugger .panel-options .panel-rows>*{margin-top:.4rem;display:block}tw-debugger.theme-dark .panel-rows>div:nth-of-type(2n){background-color:#212121}tw-debugger .panel-row-buttons{text-align:right}tw-debugger .panel-variables .panel-rows:empty::before{content:\"~ No variables ~\";font-style:italic;color:#575757;text-align:center}tw-debugger .panel-enchantments .panel-rows:empty::before{content:\"~ No enchantments ~\";font-style:italic;color:#575757;text-align:center}tw-debugger .panel-errors .panel-rows:empty::before{content:\"~ No errors... for now. ~\";font-style:italic;color:#575757;text-align:center}tw-debugger .panel-errors .panel-rows:empty+.panel-errors-bottom{display:none}tw-debugger.theme-dark .panel-variables .panel-rows:empty::before,tw-debugger.theme-dark .panel-enchantments .panel-rows:empty::before,tw-debugger.theme-dark .panel-errors .panel-rows:empty::before{color:#a8a8a8}tw-debugger .panel-rows:empty+.panel-variables-bottom{display:none}tw-debugger th[data-col]{text-decoration:underline;cursor:pointer}tw-debugger th[data-col][data-order=asc]::after{content:\"↓\"}tw-debugger th[data-col][data-order=desc]::after{content:\"↑\"}tw-debugger .panel-storylets:not(.panel-exclusive) .storylet-exclusive,tw-debugger .panel-storylets:not(.panel-urgent) .storylet-urgent{display:none}tw-debugger .storylet-exclusive,tw-debugger .storylet-urgent,tw-debugger .storylet-open{text-align:center}tw-debugger .panel-variables-bottom{padding-top:5px}tw-debugger .enchantment-row{min-height:1.5em}tw-debugger .variable-path{opacity:.4}tw-debugger .temporary-variable-scope,tw-debugger .enchantment-local{font-family:sans-serif;font-weight:normal;opacity:.8;font-size:.75em}tw-debugger .temporary-variable-scope:not(:empty)::before,tw-debugger .enchantment-local:not(:empty)::before{content:\" in \"}tw-debugger .variable-name,tw-debugger .enchantment-name{font-family:monospace;font-weight:bold}tw-debugger .variable-type{color:#575757;font-weight:normal;text-overflow:ellipsis;overflow:hidden;max-width:10em}tw-debugger.theme-dark .variable-type{color:#a8a8a8}tw-debugger .error-row{display:table-row;background-color:rgba(230,101,204,.3)}tw-debugger .error-row:nth-of-type(2n){background-color:rgba(237,145,219,.3)}tw-debugger .error-row>*{display:table-cell;padding:.25em .5em}tw-debugger .error-row .error-message[title]:not([title=\"\"]){cursor:help}tw-debugger .error-row .error-passage{color:#575757}tw-debugger.theme-dark .error-row .error-passage{color:#a8a8a8}tw-debugger .storylet-row{background-color:rgba(193,240,225,.3)}tw-debugger .storylet-row:nth-child(2n){background-color:rgba(152,231,204,.3)}tw-debugger .storylet-row.storylet-closed{font-style:italic;background-color:#fff}tw-debugger .storylet-row.storylet-closed:nth-child(2n){background-color:#e6e6e6}tw-debugger .storylet-row.storylet-closed>:not(.storylet-lambda){opacity:.6}.storylet-error tw-debugger .storylet-row{background-color:rgba(230,101,204,.3)}.storylet-error tw-debugger .storylet-row:nth-child(2n){background-color:rgba(237,145,219,.3)}tw-debugger .storylet-row .storylet-name,tw-debugger .storylet-row .storylet-value{display:inline-block;width:50%}tw-debugger .storylet-row .storylet-lambda{font-family:monospace;font-size:1rem;white-space:pre-wrap;overflow-wrap:anywhere}tw-debugger.theme-dark .storylet-row.storylet-closed{background-color:#000}tw-debugger.theme-dark .storylet-row.storylet-closed:nth-child(2n){background-color:#212121}tw-debugger .tabs{padding-bottom:.5em}tw-debugger .tab{border-radius:0px 0px .5em .5em;border-top:none;top:-2px}tw-debugger .resizer-h{position:absolute;height:14em;border-left:2px solid #999;border-right:2px solid #999;top:10px;left:4px;width:8px;cursor:ew-resize}tw-debugger.theme-dark .resizer-h{border-color:rgba(0,0,0,0) #666}tw-debugger .resizer-v{position:absolute;height:8px;border-top:2px solid #999;border-bottom:2px solid #999;margin-bottom:4px;top:4px;left:10px;width:95%;cursor:ns-resize;box-sizing:border-box}tw-debugger.theme-dark .resizer-v{border-color:#666 rgba(0,0,0,0)}tw-debugger mark{color:inherit;background-color:rgba(101,230,230,.3) !important}tw-dialog{z-index:999997;border:#fff solid 2px;padding:2em;color:#fff;background-color:#000;display:block}@media(min-width: 576px){tw-dialog{max-width:50vw}}tw-dialog input[type=text]{font-size:inherit;width:100%;border:solid #fff !important}tw-dialog-links{text-align:right;display:flex;justify-content:flex-end}tw-backdrop{z-index:999996;position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center}tw-backdrop~tw-backdrop{display:none}tw-link,.enchantment-link{cursor:pointer;color:#4169e1;font-weight:bold;text-decoration:none;transition:color .2s ease-in-out}tw-passage [style^=color] tw-link:not(:hover),tw-passage [style*=\" color\"] tw-link:not(:hover),tw-passage [style^=color][hover=true] tw-link:hover,tw-passage [style*=\" color\"][hover=true] tw-link:hover,tw-passage [style^=color] .enchantment-link:not(:hover),tw-passage [style*=\" color\"] .enchantment-link:not(:hover),tw-passage [style^=color][hover=true] .enchantment-link:hover,tw-passage [style*=\" color\"][hover=true] .enchantment-link:hover{color:inherit}tw-link:hover,.enchantment-link:hover{color:#00bfff}tw-link:active,.enchantment-link:active{color:#dd4b39}.visited{color:#6941e1}tw-passage [style^=color] .visited:not(:hover),tw-passage [style*=\" color\"] .visited:not(:hover),tw-passage [style^=color][hover=true] .visited:hover,tw-passage [style*=\" color\"][hover=true] .visited:hover{color:inherit}.visited:hover{color:#e3e}tw-broken-link{color:#933;border-bottom:2px solid #933;cursor:not-allowed}tw-passage [style^=color] tw-broken-link:not(:hover),tw-passage [style*=\" color\"] tw-broken-link:not(:hover),tw-passage [style^=color][hover=true] tw-broken-link:hover,tw-passage [style*=\" color\"][hover=true] tw-broken-link:hover{color:inherit}tw-link.enchantment-mouseover,.link.enchantment-mouseover,tw-expression.enchantment-mouseover>tw-link{color:inherit;font-weight:inherit;transition:none;cursor:inherit;border-bottom:2px dashed #999}tw-link.enchantment-mouseover:hover,tw-link.enchantment-mouseover:active,.link.enchantment-mouseover:hover,.link.enchantment-mouseover:active,tw-expression.enchantment-mouseover>tw-link:hover,tw-expression.enchantment-mouseover>tw-link:active{color:inherit}tw-link.enchantment-mouseover.enchantment-button,.link.enchantment-mouseover.enchantment-button,tw-expression.enchantment-mouseover>tw-link.enchantment-button{border-style:dashed}tw-link.enchantment-mouseout,.link.enchantment-mouseout,tw-expression.enchantment-mouseout>tw-link{color:inherit;font-weight:inherit;transition:none;cursor:inherit;border:rgba(64,149,191,.6) 1px solid;border-radius:.2em}tw-link.enchantment-mouseout:hover,tw-link.enchantment-mouseout:active,.link.enchantment-mouseout:hover,.link.enchantment-mouseout:active,tw-expression.enchantment-mouseout>tw-link:hover,tw-expression.enchantment-mouseout>tw-link:active{color:inherit}tw-link.enchantment-mouseout:hover,.link.enchantment-mouseout:hover,tw-expression.enchantment-mouseout>tw-link:hover{background-color:rgba(175,197,207,.75);border:rgba(0,0,0,0) 1px solid}tw-link.enchantment-dblclick,.link.enchantment-dblclick,tw-expression.enchantment-dblclick>tw-link{color:inherit;font-weight:inherit;transition:none;cursor:inherit;cursor:pointer;border:2px solid #999;border-radius:0}tw-link.enchantment-dblclick:hover,tw-link.enchantment-dblclick:active,.link.enchantment-dblclick:hover,.link.enchantment-dblclick:active,tw-expression.enchantment-dblclick>tw-link:hover,tw-expression.enchantment-dblclick>tw-link:active{color:inherit}tw-link.enchantment-dblclick:active,.link.enchantment-dblclick:active,tw-expression.enchantment-dblclick>tw-link:active{background-color:#999}tw-link.enchantment-button,.link.enchantment-button,.enchantment-button:not(.link) tw-link,.enchantment-button:not(.link) .link{border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0px 8px;display:block}.enchantment-button{display:block}.enchantment-clickblock{cursor:pointer;width:100%;height:100%;display:block}.enchantment-clickblock>:not(tw-enchantment)::after{content:\"\";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;color:rgba(65,105,225,.5);transition:color .2s ease-in-out}.enchantment-clickblock>:not(tw-enchantment):hover::after{color:rgba(0,191,255,.5)}.enchantment-clickblock>:not(tw-enchantment):active::after{color:rgba(222,78,59,.5)}.enchantment-clickblock>:not(tw-enchantment)::after{box-shadow:inset 0 0 0 .5vmax}.enchantment-clickblock>tw-passage::after,.enchantment-clickblock>tw-sidebar::after{box-shadow:0 0 0 .5vmax}.enchantment-mouseoverblock>:not(tw-enchantment)::after{content:\"\";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;border:2px dashed #999}.enchantment-mouseoutblock>:not(tw-enchantment)::after{content:\"\";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;border:rgba(64,149,191,.6) 2px solid}.enchantment-mouseoutblock:hover>:not(tw-enchantment)::after{content:\"\";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;background-color:rgba(175,197,207,.75);border:rgba(0,0,0,0) 2px solid;border-radius:.2em}.enchantment-dblclickblock>:not(tw-enchantment)::after{content:\"\";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;cursor:pointer;border:2px solid #999}tw-dialog-links{padding-top:1.5em}tw-dialog-links tw-link{border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0px 8px;display:block;display:inline-block}html{margin:0;height:100%;overflow-x:hidden}*,:before,:after{position:relative;box-sizing:inherit}body{margin:0;height:100%}tw-storydata{display:none}tw-story{display:flex;flex-direction:column;font:100% Georgia,serif;box-sizing:border-box;width:100%;min-height:100%;font-size:1.5em;line-height:1.5em;padding:5% 5%;overflow:hidden;background-color:#000;color:#fff}tw-story [style*=content-box] *{box-sizing:border-box}@media(min-width: 576px){tw-story{padding:5% 20%}}tw-story tw-consecutive-br{display:block;height:1.6ex;visibility:hidden}tw-story select{background-color:rgba(0,0,0,0);font:inherit;border-style:solid;padding:2px}tw-story select:not([disabled]){color:inherit}tw-story textarea{resize:none;background-color:rgba(0,0,0,0);font:inherit;color:inherit;border-style:none;padding:2px}tw-story input[type=text]{background-color:rgba(0,0,0,0);font:inherit;color:inherit;border-style:none}tw-story input[type=checkbox]{transform:scale(1.5);margin:0 .5em .5em .5em;vertical-align:middle}tw-story tw-noscript{animation:appear .8s}tw-passage{display:block}tw-sidebar{text-align:center;display:flex;justify-content:space-between}@media(min-width: 576px){tw-sidebar{left:-5em;width:3em;position:absolute;flex-direction:column}tw-enchantment[style*=width]>tw-sidebar{width:inherit}}tw-icon{display:inline-block;margin:.5em 0;font-size:66px;font-family:\"Verdana\",sans-serif}tw-icon[alt]{opacity:.2;cursor:pointer}tw-icon[alt]:hover{opacity:.4}tw-icon[data-label]::after{font-weight:bold;content:attr(data-label);font-size:20px;bottom:-20px;left:-50%;white-space:nowrap}tw-meter{display:block}tw-hook:empty,tw-expression:empty{display:none}tw-error{display:inline-block;border-radius:.2em;padding:.2em;font-size:1rem;cursor:help;white-space:pre-wrap}tw-error.error{background-color:rgba(223,58,190,.6);color:#fff}tw-error.warning{background-color:rgba(223,140,58,.6);color:#fff;display:none}.debug-mode tw-error.warning{display:inline}tw-error-explanation{display:block;font-size:.8rem;line-height:1rem}tw-open-button,tw-folddown{cursor:pointer;line-height:0em;border-radius:4px;border:1px solid rgba(255,255,255,.5);font-size:.8rem;margin:0 .2rem;padding:3px;white-space:pre}tw-folddown::after{content:\"▶\"}tw-folddown.open::after{content:\"▼\"}tw-open-button[replay]{display:none}tw-error tw-open-button,tw-eval-replay tw-open-button{display:inline !important}tw-open-button::after{content:attr(label)}tw-notifier{border-radius:.2em;padding:.2em;font-size:1rem;background-color:rgba(223,182,58,.4);display:none}.debug-mode tw-notifier{display:inline}tw-notifier::before{content:attr(message)}tw-colour{border:1px solid #000;display:inline-block;width:1em;height:1em}tw-enchantment:empty{display:none}h1{font-size:3em}h2{font-size:2.25em}h3{font-size:1.75em}h1,h2,h3,h4,h5,h6{line-height:1em;margin:.3em 0 .6em 0}pre{font-size:1rem;line-height:initial}small{font-size:70%}big{font-size:120%}mark{color:rgba(0,0,0,.6);background-color:#ff9}ins{color:rgba(0,0,0,.6);background-color:rgba(255,242,204,.5);border-radius:.5em;box-shadow:0em 0em .2em #ffe699;text-decoration:none}center{text-align:center;margin:0 auto;width:60%}blink{text-decoration:none;animation:fade-in-out 1s steps(1, end) infinite alternate}tw-align{display:block}tw-columns{display:flex;flex-direction:row;justify-content:space-between}.transition-in{animation:appear 0ms step-start}.transition-out{animation:appear 0ms step-end}[data-t8n^=dissolve].transition-in,[data-t8n=fade].transition-in{animation:appear .8s}[data-t8n^=dissolve].transition-out,[data-t8n=fade].transition-out{animation:appear .8s reverse}[data-t8n^=shudder].transition-in{display:inline-block !important;animation:shudder-in .8s}[data-t8n^=shudder].transition-out{display:inline-block !important;animation:shudder-in .8s reverse}[data-t8n^=rumble].transition-in{display:inline-block !important;animation:rumble-in .8s}[data-t8n^=rumble].transition-out{display:inline-block !important;animation:rumble-in .8s reverse}[data-t8n^=pulse].transition-in{animation:pulse .8s;display:inline-block !important}[data-t8n^=pulse].transition-out{animation:pulse .8s reverse;display:inline-block !important}[data-t8n^=zoom].transition-in{animation:zoom-in .8s;display:inline-block !important}[data-t8n^=zoom].transition-out{animation:zoom-in .8s reverse;display:inline-block !important}[data-t8n^=blur].transition-in{animation:blur .8s;display:inline-block !important}[data-t8n^=blur].transition-out{animation:blur .8s reverse;display:inline-block !important}[data-t8n^=slideleft].transition-in{animation:slide-left .8s;display:inline-block !important}[data-t8n^=slideleft].transition-out{animation:slide-right .8s reverse;display:inline-block !important}[data-t8n^=slideright].transition-in{animation:slide-right .8s;display:inline-block !important}[data-t8n^=slideright].transition-out{animation:slide-left .8s reverse;display:inline-block !important}[data-t8n^=slideup].transition-in{animation:slide-up .8s;display:inline-block !important}[data-t8n^=slideup].transition-out{animation:slide-down .8s reverse;display:inline-block !important}[data-t8n^=slidedown].transition-in{animation:slide-down .8s;display:inline-block !important}[data-t8n^=slidedown].transition-out{animation:slide-up .8s reverse;display:inline-block !important}[data-t8n^=fadeleft].transition-in{animation:fade-left .8s;display:inline-block !important}[data-t8n^=fadeleft].transition-out{animation:fade-right .8s reverse;display:inline-block !important}[data-t8n^=faderight].transition-in{animation:fade-right .8s;display:inline-block !important}[data-t8n^=faderight].transition-out{animation:fade-left .8s reverse;display:inline-block !important}[data-t8n^=fadeup].transition-in{animation:fade-up .8s;display:inline-block !important}[data-t8n^=fadeup].transition-out{animation:fade-down .8s reverse;display:inline-block !important}[data-t8n^=fadedown].transition-in{animation:fade-down .8s;display:inline-block !important}[data-t8n^=fadedown].transition-out{animation:fade-up .8s reverse;display:inline-block !important}[data-t8n^=flicker].transition-in{animation:flicker .8s}[data-t8n^=flicker].transition-out{animation:flicker .8s reverse}\n</style>\n</head>\n<body>\n<tw-story><noscript><tw-noscript>JavaScript needs to be enabled to play {{STORY_NAME}}.</tw-noscript></noscript></tw-story>\n{{STORY_DATA}}\n<script title=\"Twine engine code\" data-main=\"harlowe\">!function(){\"use strict\";var e=\"undefined\"!=typeof globalThis?globalThis:\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,\"default\")?e.default:e}var n,r={exports:{}};\n/*!\n * jQuery JavaScript Library v3.7.1\n * https://jquery.com/\n *\n * Copyright OpenJS Foundation and other contributors\n * Released under the MIT license\n * https://jquery.org/license\n *\n * Date: 2023-08-28T13:37Z\n */n=r,function(e,t){n.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error(\"jQuery requires a window with a document\");return t(e)}}(\"undefined\"!=typeof window?window:e,(function(e,t){var n=[],r=Object.getPrototypeOf,a=n.slice,o=n.flat?function(e){return n.flat.call(e)}:function(e){return n.concat.apply([],e)},i=n.push,s=n.indexOf,c={},l=c.toString,u=c.hasOwnProperty,d=u.toString,p=d.call(Object),h={},f=function(e){return\"function\"==typeof e&&\"number\"!=typeof e.nodeType&&\"function\"!=typeof e.item},g=function(e){return null!=e&&e===e.window},m=e.document,y={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,n){var r,a,o=(n=n||m).createElement(\"script\");if(o.text=e,t)for(r in y)(a=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,a);n.head.appendChild(o).parentNode.removeChild(o)}function v(e){return null==e?e+\"\":\"object\"==typeof e||\"function\"==typeof e?c[l.call(e)]||\"object\":typeof e}var w=\"3.7.1\",$=/HTML$/i,k=function(e,t){return new k.fn.init(e,t)};function x(e){var t=!!e&&\"length\"in e&&e.length,n=v(e);return!f(e)&&!g(e)&&(\"array\"===n||0===t||\"number\"==typeof t&&t>0&&t-1 in e)}function S(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}k.fn=k.prototype={jquery:w,constructor:k,length:0,toArray:function(){return a.call(this)},get:function(e){return null==e?a.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=k.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return k.each(this,e)},map:function(e){return this.pushStack(k.map(this,(function(t,n){return e.call(t,n,t)})))},slice:function(){return this.pushStack(a.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(k.grep(this,(function(e,t){return(t+1)%2})))},odd:function(){return this.pushStack(k.grep(this,(function(e,t){return t%2})))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:i,sort:n.sort,splice:n.splice},k.extend=k.fn.extend=function(){var e,t,n,r,a,o,i=arguments[0]||{},s=1,c=arguments.length,l=!1;for(\"boolean\"==typeof i&&(l=i,i=arguments[s]||{},s++),\"object\"==typeof i||f(i)||(i={}),s===c&&(i=this,s--);s<c;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],\"__proto__\"!==t&&i!==r&&(l&&r&&(k.isPlainObject(r)||(a=Array.isArray(r)))?(n=i[t],o=a&&!Array.isArray(n)?[]:a||k.isPlainObject(n)?n:{},a=!1,i[t]=k.extend(l,o,r)):void 0!==r&&(i[t]=r));return i},k.extend({expando:\"jQuery\"+(w+Math.random()).replace(/\\D/g,\"\"),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||\"[object Object]\"!==l.call(e)||(t=r(e))&&(\"function\"!=typeof(n=u.call(t,\"constructor\")&&t.constructor)||d.call(n)!==p))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){b(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(x(e))for(n=e.length;r<n&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},text:function(e){var t,n=\"\",r=0,a=e.nodeType;if(!a)for(;t=e[r++];)n+=k.text(t);return 1===a||11===a?e.textContent:9===a?e.documentElement.textContent:3===a||4===a?e.nodeValue:n},makeArray:function(e,t){var n=t||[];return null!=e&&(x(Object(e))?k.merge(n,\"string\"==typeof e?[e]:e):i.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:s.call(t,e,n)},isXMLDoc:function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!$.test(t||n&&n.nodeName||\"HTML\")},merge:function(e,t){for(var n=+t.length,r=0,a=e.length;r<n;r++)e[a++]=t[r];return e.length=a,e},grep:function(e,t,n){for(var r=[],a=0,o=e.length,i=!n;a<o;a++)!t(e[a],a)!==i&&r.push(e[a]);return r},map:function(e,t,n){var r,a,i=0,s=[];if(x(e))for(r=e.length;i<r;i++)null!=(a=t(e[i],i,n))&&s.push(a);else for(i in e)null!=(a=t(e[i],i,n))&&s.push(a);return o(s)},guid:1,support:h}),\"function\"==typeof Symbol&&(k.fn[Symbol.iterator]=n[Symbol.iterator]),k.each(\"Boolean Number String Function Array Date RegExp Object Error Symbol\".split(\" \"),(function(e,t){c[\"[object \"+t+\"]\"]=t.toLowerCase()}));var T=n.pop,C=n.sort,N=n.splice,j=\"[\\\\x20\\\\t\\\\r\\\\n\\\\f]\",A=new RegExp(\"^\"+j+\"+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)\"+j+\"+$\",\"g\");k.contains=function(e,t){var n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(e.contains?e.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))};var E=/([\\0-\\x1f\\x7f]|^-?\\d)|^-$|[^\\x80-\\uFFFF\\w-]/g;function O(e,t){return t?\"\\0\"===e?\"�\":e.slice(0,-1)+\"\\\\\"+e.charCodeAt(e.length-1).toString(16)+\" \":\"\\\\\"+e}k.escapeSelector=function(e){return(e+\"\").replace(E,O)};var D=m,I=i;!function(){var t,r,o,i,c,l,d,p,f,g,m=I,y=k.expando,b=0,v=0,w=ee(),$=ee(),x=ee(),E=ee(),O=function(e,t){return e===t&&(c=!0),0},M=\"checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped\",L=\"(?:\\\\\\\\[\\\\da-fA-F]{1,6}\"+j+\"?|\\\\\\\\[^\\\\r\\\\n\\\\f]|[\\\\w-]|[^\\0-\\\\x7f])+\",R=\"\\\\[\"+j+\"*(\"+L+\")(?:\"+j+\"*([*^$|!~]?=)\"+j+\"*(?:'((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\"|(\"+L+\"))|)\"+j+\"*\\\\]\",P=\":(\"+L+\")(?:\\\\((('((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\")|((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|\"+R+\")*)|.*)\\\\)|)\",V=new RegExp(j+\"+\",\"g\"),F=new RegExp(\"^\"+j+\"*,\"+j+\"*\"),H=new RegExp(\"^\"+j+\"*([>+~]|\"+j+\")\"+j+\"*\"),q=new RegExp(j+\"|>\"),z=new RegExp(P),W=new RegExp(\"^\"+L+\"$\"),B={ID:new RegExp(\"^#(\"+L+\")\"),CLASS:new RegExp(\"^\\\\.(\"+L+\")\"),TAG:new RegExp(\"^(\"+L+\"|[*])\"),ATTR:new RegExp(\"^\"+R),PSEUDO:new RegExp(\"^\"+P),CHILD:new RegExp(\"^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\(\"+j+\"*(even|odd|(([+-]|)(\\\\d*)n|)\"+j+\"*(?:([+-]|)\"+j+\"*(\\\\d+)|))\"+j+\"*\\\\)|)\",\"i\"),bool:new RegExp(\"^(?:\"+M+\")$\",\"i\"),needsContext:new RegExp(\"^\"+j+\"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\(\"+j+\"*((?:-\\\\d)?\\\\d*)\"+j+\"*\\\\)|)(?=[^-]|$)\",\"i\")},U=/^(?:input|select|textarea|button)$/i,_=/^h\\d$/i,G=/^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/,X=/[+~]/,Y=new RegExp(\"\\\\\\\\[\\\\da-fA-F]{1,6}\"+j+\"?|\\\\\\\\([^\\\\r\\\\n\\\\f])\",\"g\"),J=function(e,t){var n=\"0x\"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},K=function(){ce()},Q=pe((function(e){return!0===e.disabled&&S(e,\"fieldset\")}),{dir:\"parentNode\",next:\"legend\"});try{m.apply(n=a.call(D.childNodes),D.childNodes),n[D.childNodes.length].nodeType}catch(e){m={apply:function(e,t){I.apply(e,a.call(t))},call:function(e){I.apply(e,a.call(arguments,1))}}}function Z(e,t,n,r){var a,o,i,s,c,u,d,g=t&&t.ownerDocument,b=t?t.nodeType:9;if(n=n||[],\"string\"!=typeof e||!e||1!==b&&9!==b&&11!==b)return n;if(!r&&(ce(t),t=t||l,p)){if(11!==b&&(c=G.exec(e)))if(a=c[1]){if(9===b){if(!(i=t.getElementById(a)))return n;if(i.id===a)return m.call(n,i),n}else if(g&&(i=g.getElementById(a))&&Z.contains(t,i)&&i.id===a)return m.call(n,i),n}else{if(c[2])return m.apply(n,t.getElementsByTagName(e)),n;if((a=c[3])&&t.getElementsByClassName)return m.apply(n,t.getElementsByClassName(a)),n}if(!(E[e+\" \"]||f&&f.test(e))){if(d=e,g=t,1===b&&(q.test(e)||H.test(e))){for((g=X.test(e)&&se(t.parentNode)||t)==t&&h.scope||((s=t.getAttribute(\"id\"))?s=k.escapeSelector(s):t.setAttribute(\"id\",s=y)),o=(u=ue(e)).length;o--;)u[o]=(s?\"#\"+s:\":scope\")+\" \"+de(u[o]);d=u.join(\",\")}try{return m.apply(n,g.querySelectorAll(d)),n}catch(t){E(e,!0)}finally{s===y&&t.removeAttribute(\"id\")}}}return be(e.replace(A,\"$1\"),t,n,r)}function ee(){var e=[];return function t(n,a){return e.push(n+\" \")>r.cacheLength&&delete t[e.shift()],t[n+\" \"]=a}}function te(e){return e[y]=!0,e}function ne(e){var t=l.createElement(\"fieldset\");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function re(e){return function(t){return S(t,\"input\")&&t.type===e}}function ae(e){return function(t){return(S(t,\"input\")||S(t,\"button\"))&&t.type===e}}function oe(e){return function(t){return\"form\"in t?t.parentNode&&!1===t.disabled?\"label\"in t?\"label\"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&Q(t)===e:t.disabled===e:\"label\"in t&&t.disabled===e}}function ie(e){return te((function(t){return t=+t,te((function(n,r){for(var a,o=e([],n.length,t),i=o.length;i--;)n[a=o[i]]&&(n[a]=!(r[a]=n[a]))}))}))}function se(e){return e&&void 0!==e.getElementsByTagName&&e}function ce(e){var t,n=e?e.ownerDocument||e:D;return n!=l&&9===n.nodeType&&n.documentElement?(d=(l=n).documentElement,p=!k.isXMLDoc(l),g=d.matches||d.webkitMatchesSelector||d.msMatchesSelector,d.msMatchesSelector&&D!=l&&(t=l.defaultView)&&t.top!==t&&t.addEventListener(\"unload\",K),h.getById=ne((function(e){return d.appendChild(e).id=k.expando,!l.getElementsByName||!l.getElementsByName(k.expando).length})),h.disconnectedMatch=ne((function(e){return g.call(e,\"*\")})),h.scope=ne((function(){return l.querySelectorAll(\":scope\")})),h.cssHas=ne((function(){try{return l.querySelector(\":has(*,:jqfake)\"),!1}catch(e){return!0}})),h.getById?(r.filter.ID=function(e){var t=e.replace(Y,J);return function(e){return e.getAttribute(\"id\")===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&p){var n=t.getElementById(e);return n?[n]:[]}}):(r.filter.ID=function(e){var t=e.replace(Y,J);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode(\"id\");return n&&n.value===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&p){var n,r,a,o=t.getElementById(e);if(o){if((n=o.getAttributeNode(\"id\"))&&n.value===e)return[o];for(a=t.getElementsByName(e),r=0;o=a[r++];)if((n=o.getAttributeNode(\"id\"))&&n.value===e)return[o]}return[]}}),r.find.TAG=function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):t.querySelectorAll(e)},r.find.CLASS=function(e,t){if(void 0!==t.getElementsByClassName&&p)return t.getElementsByClassName(e)},f=[],ne((function(e){var t;d.appendChild(e).innerHTML=\"<a id='\"+y+\"' href='' disabled='disabled'></a><select id='\"+y+\"-\\r\\\\' disabled='disabled'><option selected=''></option></select>\",e.querySelectorAll(\"[selected]\").length||f.push(\"\\\\[\"+j+\"*(?:value|\"+M+\")\"),e.querySelectorAll(\"[id~=\"+y+\"-]\").length||f.push(\"~=\"),e.querySelectorAll(\"a#\"+y+\"+*\").length||f.push(\".#.+[+~]\"),e.querySelectorAll(\":checked\").length||f.push(\":checked\"),(t=l.createElement(\"input\")).setAttribute(\"type\",\"hidden\"),e.appendChild(t).setAttribute(\"name\",\"D\"),d.appendChild(e).disabled=!0,2!==e.querySelectorAll(\":disabled\").length&&f.push(\":enabled\",\":disabled\"),(t=l.createElement(\"input\")).setAttribute(\"name\",\"\"),e.appendChild(t),e.querySelectorAll(\"[name='']\").length||f.push(\"\\\\[\"+j+\"*name\"+j+\"*=\"+j+\"*(?:''|\\\"\\\")\")})),h.cssHas||f.push(\":has\"),f=f.length&&new RegExp(f.join(\"|\")),O=function(e,t){if(e===t)return c=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!h.sortDetached&&t.compareDocumentPosition(e)===n?e===l||e.ownerDocument==D&&Z.contains(D,e)?-1:t===l||t.ownerDocument==D&&Z.contains(D,t)?1:i?s.call(i,e)-s.call(i,t):0:4&n?-1:1)},l):l}for(t in Z.matches=function(e,t){return Z(e,null,null,t)},Z.matchesSelector=function(e,t){if(ce(e),p&&!E[t+\" \"]&&(!f||!f.test(t)))try{var n=g.call(e,t);if(n||h.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){E(t,!0)}return Z(t,l,null,[e]).length>0},Z.contains=function(e,t){return(e.ownerDocument||e)!=l&&ce(e),k.contains(e,t)},Z.attr=function(e,t){(e.ownerDocument||e)!=l&&ce(e);var n=r.attrHandle[t.toLowerCase()],a=n&&u.call(r.attrHandle,t.toLowerCase())?n(e,t,!p):void 0;return void 0!==a?a:e.getAttribute(t)},Z.error=function(e){throw new Error(\"Syntax error, unrecognized expression: \"+e)},k.uniqueSort=function(e){var t,n=[],r=0,o=0;if(c=!h.sortStable,i=!h.sortStable&&a.call(e,0),C.call(e,O),c){for(;t=e[o++];)t===e[o]&&(r=n.push(o));for(;r--;)N.call(e,n[r],1)}return i=null,e},k.fn.uniqueSort=function(){return this.pushStack(k.uniqueSort(a.apply(this)))},r=k.expr={cacheLength:50,createPseudo:te,match:B,attrHandle:{},find:{},relative:{\">\":{dir:\"parentNode\",first:!0},\" \":{dir:\"parentNode\"},\"+\":{dir:\"previousSibling\",first:!0},\"~\":{dir:\"previousSibling\"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(Y,J),e[3]=(e[3]||e[4]||e[5]||\"\").replace(Y,J),\"~=\"===e[2]&&(e[3]=\" \"+e[3]+\" \"),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),\"nth\"===e[1].slice(0,3)?(e[3]||Z.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*(\"even\"===e[3]||\"odd\"===e[3])),e[5]=+(e[7]+e[8]||\"odd\"===e[3])):e[3]&&Z.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return B.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||\"\":n&&z.test(n)&&(t=ue(n,!0))&&(t=n.indexOf(\")\",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(Y,J).toLowerCase();return\"*\"===e?function(){return!0}:function(e){return S(e,t)}},CLASS:function(e){var t=w[e+\" \"];return t||(t=new RegExp(\"(^|\"+j+\")\"+e+\"(\"+j+\"|$)\"))&&w(e,(function(e){return t.test(\"string\"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute(\"class\")||\"\")}))},ATTR:function(e,t,n){return function(r){var a=Z.attr(r,e);return null==a?\"!=\"===t:!t||(a+=\"\",\"=\"===t?a===n:\"!=\"===t?a!==n:\"^=\"===t?n&&0===a.indexOf(n):\"*=\"===t?n&&a.indexOf(n)>-1:\"$=\"===t?n&&a.slice(-n.length)===n:\"~=\"===t?(\" \"+a.replace(V,\" \")+\" \").indexOf(n)>-1:\"|=\"===t&&(a===n||a.slice(0,n.length+1)===n+\"-\"))}},CHILD:function(e,t,n,r,a){var o=\"nth\"!==e.slice(0,3),i=\"last\"!==e.slice(-4),s=\"of-type\"===t;return 1===r&&0===a?function(e){return!!e.parentNode}:function(t,n,c){var l,u,d,p,h,f=o!==i?\"nextSibling\":\"previousSibling\",g=t.parentNode,m=s&&t.nodeName.toLowerCase(),v=!c&&!s,w=!1;if(g){if(o){for(;f;){for(d=t;d=d[f];)if(s?S(d,m):1===d.nodeType)return!1;h=f=\"only\"===e&&!h&&\"nextSibling\"}return!0}if(h=[i?g.firstChild:g.lastChild],i&&v){for(w=(p=(l=(u=g[y]||(g[y]={}))[e]||[])[0]===b&&l[1])&&l[2],d=p&&g.childNodes[p];d=++p&&d&&d[f]||(w=p=0)||h.pop();)if(1===d.nodeType&&++w&&d===t){u[e]=[b,p,w];break}}else if(v&&(w=p=(l=(u=t[y]||(t[y]={}))[e]||[])[0]===b&&l[1]),!1===w)for(;(d=++p&&d&&d[f]||(w=p=0)||h.pop())&&(!(s?S(d,m):1===d.nodeType)||!++w||(v&&((u=d[y]||(d[y]={}))[e]=[b,w]),d!==t)););return(w-=a)===r||w%r==0&&w/r>=0}}},PSEUDO:function(e,t){var n,a=r.pseudos[e]||r.setFilters[e.toLowerCase()]||Z.error(\"unsupported pseudo: \"+e);return a[y]?a(t):a.length>1?(n=[e,e,\"\",t],r.setFilters.hasOwnProperty(e.toLowerCase())?te((function(e,n){for(var r,o=a(e,t),i=o.length;i--;)e[r=s.call(e,o[i])]=!(n[r]=o[i])})):function(e){return a(e,0,n)}):a}},pseudos:{not:te((function(e){var t=[],n=[],r=ye(e.replace(A,\"$1\"));return r[y]?te((function(e,t,n,a){for(var o,i=r(e,null,a,[]),s=e.length;s--;)(o=i[s])&&(e[s]=!(t[s]=o))})):function(e,a,o){return t[0]=e,r(t,null,o,n),t[0]=null,!n.pop()}})),has:te((function(e){return function(t){return Z(e,t).length>0}})),contains:te((function(e){return e=e.replace(Y,J),function(t){return(t.textContent||k.text(t)).indexOf(e)>-1}})),lang:te((function(e){return W.test(e||\"\")||Z.error(\"unsupported lang: \"+e),e=e.replace(Y,J).toLowerCase(),function(t){var n;do{if(n=p?t.lang:t.getAttribute(\"xml:lang\")||t.getAttribute(\"lang\"))return(n=n.toLowerCase())===e||0===n.indexOf(e+\"-\")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===d},focus:function(e){return e===function(){try{return l.activeElement}catch(e){}}()&&l.hasFocus()&&!!(e.type||e.href||~e.tabIndex)},enabled:oe(!1),disabled:oe(!0),checked:function(e){return S(e,\"input\")&&!!e.checked||S(e,\"option\")&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return _.test(e.nodeName)},input:function(e){return U.test(e.nodeName)},button:function(e){return S(e,\"input\")&&\"button\"===e.type||S(e,\"button\")},text:function(e){var t;return S(e,\"input\")&&\"text\"===e.type&&(null==(t=e.getAttribute(\"type\"))||\"text\"===t.toLowerCase())},first:ie((function(){return[0]})),last:ie((function(e,t){return[t-1]})),eq:ie((function(e,t,n){return[n<0?n+t:n]})),even:ie((function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e})),odd:ie((function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e})),lt:ie((function(e,t,n){var r;for(r=n<0?n+t:n>t?t:n;--r>=0;)e.push(r);return e})),gt:ie((function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e}))}},r.pseudos.nth=r.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=re(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=ae(t);function le(){}function ue(e,t){var n,a,o,i,s,c,l,u=$[e+\" \"];if(u)return t?0:u.slice(0);for(s=e,c=[],l=r.preFilter;s;){for(i in n&&!(a=F.exec(s))||(a&&(s=s.slice(a[0].length)||s),c.push(o=[])),n=!1,(a=H.exec(s))&&(n=a.shift(),o.push({value:n,type:a[0].replace(A,\" \")}),s=s.slice(n.length)),r.filter)!(a=B[i].exec(s))||l[i]&&!(a=l[i](a))||(n=a.shift(),o.push({value:n,type:i,matches:a}),s=s.slice(n.length));if(!n)break}return t?s.length:s?Z.error(e):$(e,c).slice(0)}function de(e){for(var t=0,n=e.length,r=\"\";t<n;t++)r+=e[t].value;return r}function pe(e,t,n){var r=t.dir,a=t.next,o=a||r,i=n&&\"parentNode\"===o,s=v++;return t.first?function(t,n,a){for(;t=t[r];)if(1===t.nodeType||i)return e(t,n,a);return!1}:function(t,n,c){var l,u,d=[b,s];if(c){for(;t=t[r];)if((1===t.nodeType||i)&&e(t,n,c))return!0}else for(;t=t[r];)if(1===t.nodeType||i)if(u=t[y]||(t[y]={}),a&&S(t,a))t=t[r]||t;else{if((l=u[o])&&l[0]===b&&l[1]===s)return d[2]=l[2];if(u[o]=d,d[2]=e(t,n,c))return!0}return!1}}function he(e){return e.length>1?function(t,n,r){for(var a=e.length;a--;)if(!e[a](t,n,r))return!1;return!0}:e[0]}function fe(e,t,n,r,a){for(var o,i=[],s=0,c=e.length,l=null!=t;s<c;s++)(o=e[s])&&(n&&!n(o,r,a)||(i.push(o),l&&t.push(s)));return i}function ge(e,t,n,r,a,o){return r&&!r[y]&&(r=ge(r)),a&&!a[y]&&(a=ge(a,o)),te((function(o,i,c,l){var u,d,p,h,f=[],g=[],y=i.length,b=o||function(e,t,n){for(var r=0,a=t.length;r<a;r++)Z(e,t[r],n);return n}(t||\"*\",c.nodeType?[c]:c,[]),v=!e||!o&&t?b:fe(b,f,e,c,l);if(n?n(v,h=a||(o?e:y||r)?[]:i,c,l):h=v,r)for(u=fe(h,g),r(u,[],c,l),d=u.length;d--;)(p=u[d])&&(h[g[d]]=!(v[g[d]]=p));if(o){if(a||e){if(a){for(u=[],d=h.length;d--;)(p=h[d])&&u.push(v[d]=p);a(null,h=[],u,l)}for(d=h.length;d--;)(p=h[d])&&(u=a?s.call(o,p):f[d])>-1&&(o[u]=!(i[u]=p))}}else h=fe(h===i?h.splice(y,h.length):h),a?a(null,i,h,l):m.apply(i,h)}))}function me(e){for(var t,n,a,i=e.length,c=r.relative[e[0].type],l=c||r.relative[\" \"],u=c?1:0,d=pe((function(e){return e===t}),l,!0),p=pe((function(e){return s.call(t,e)>-1}),l,!0),h=[function(e,n,r){var a=!c&&(r||n!=o)||((t=n).nodeType?d(e,n,r):p(e,n,r));return t=null,a}];u<i;u++)if(n=r.relative[e[u].type])h=[pe(he(h),n)];else{if((n=r.filter[e[u].type].apply(null,e[u].matches))[y]){for(a=++u;a<i&&!r.relative[e[a].type];a++);return ge(u>1&&he(h),u>1&&de(e.slice(0,u-1).concat({value:\" \"===e[u-2].type?\"*\":\"\"})).replace(A,\"$1\"),n,u<a&&me(e.slice(u,a)),a<i&&me(e=e.slice(a)),a<i&&de(e))}h.push(n)}return he(h)}function ye(e,t){var n,a=[],i=[],s=x[e+\" \"];if(!s){for(t||(t=ue(e)),n=t.length;n--;)(s=me(t[n]))[y]?a.push(s):i.push(s);s=x(e,function(e,t){var n=t.length>0,a=e.length>0,i=function(i,s,c,u,d){var h,f,g,y=0,v=\"0\",w=i&&[],$=[],x=o,S=i||a&&r.find.TAG(\"*\",d),C=b+=null==x?1:Math.random()||.1,N=S.length;for(d&&(o=s==l||s||d);v!==N&&null!=(h=S[v]);v++){if(a&&h){for(f=0,s||h.ownerDocument==l||(ce(h),c=!p);g=e[f++];)if(g(h,s||l,c)){m.call(u,h);break}d&&(b=C)}n&&((h=!g&&h)&&y--,i&&w.push(h))}if(y+=v,n&&v!==y){for(f=0;g=t[f++];)g(w,$,s,c);if(i){if(y>0)for(;v--;)w[v]||$[v]||($[v]=T.call(u));$=fe($)}m.apply(u,$),d&&!i&&$.length>0&&y+t.length>1&&k.uniqueSort(u)}return d&&(b=C,o=x),w};return n?te(i):i}(i,a)),s.selector=e}return s}function be(e,t,n,a){var o,i,s,c,l,u=\"function\"==typeof e&&e,d=!a&&ue(e=u.selector||e);if(n=n||[],1===d.length){if((i=d[0]=d[0].slice(0)).length>2&&\"ID\"===(s=i[0]).type&&9===t.nodeType&&p&&r.relative[i[1].type]){if(!(t=(r.find.ID(s.matches[0].replace(Y,J),t)||[])[0]))return n;u&&(t=t.parentNode),e=e.slice(i.shift().value.length)}for(o=B.needsContext.test(e)?0:i.length;o--&&(s=i[o],!r.relative[c=s.type]);)if((l=r.find[c])&&(a=l(s.matches[0].replace(Y,J),X.test(i[0].type)&&se(t.parentNode)||t))){if(i.splice(o,1),!(e=a.length&&de(i)))return m.apply(n,a),n;break}}return(u||ye(e,d))(a,t,!p,n,!t||X.test(e)&&se(t.parentNode)||t),n}le.prototype=r.filters=r.pseudos,r.setFilters=new le,h.sortStable=y.split(\"\").sort(O).join(\"\")===y,ce(),h.sortDetached=ne((function(e){return 1&e.compareDocumentPosition(l.createElement(\"fieldset\"))})),k.find=Z,k.expr[\":\"]=k.expr.pseudos,k.unique=k.uniqueSort,Z.compile=ye,Z.select=be,Z.setDocument=ce,Z.tokenize=ue,Z.escape=k.escapeSelector,Z.getText=k.text,Z.isXML=k.isXMLDoc,Z.selectors=k.expr,Z.support=k.support,Z.uniqueSort=k.uniqueSort}();var M=function(e,t,n){for(var r=[],a=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(a&&k(e).is(n))break;r.push(e)}return r},L=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},R=k.expr.match.needsContext,P=/^<([a-z][^\\/\\0>:\\x20\\t\\r\\n\\f]*)[\\x20\\t\\r\\n\\f]*\\/?>(?:<\\/\\1>|)$/i;function V(e,t,n){return f(t)?k.grep(e,(function(e,r){return!!t.call(e,r,e)!==n})):t.nodeType?k.grep(e,(function(e){return e===t!==n})):\"string\"!=typeof t?k.grep(e,(function(e){return s.call(t,e)>-1!==n})):k.filter(t,e,n)}k.filter=function(e,t,n){var r=t[0];return n&&(e=\":not(\"+e+\")\"),1===t.length&&1===r.nodeType?k.find.matchesSelector(r,e)?[r]:[]:k.find.matches(e,k.grep(t,(function(e){return 1===e.nodeType})))},k.fn.extend({find:function(e){var t,n,r=this.length,a=this;if(\"string\"!=typeof e)return this.pushStack(k(e).filter((function(){for(t=0;t<r;t++)if(k.contains(a[t],this))return!0})));for(n=this.pushStack([]),t=0;t<r;t++)k.find(e,a[t],n);return r>1?k.uniqueSort(n):n},filter:function(e){return this.pushStack(V(this,e||[],!1))},not:function(e){return this.pushStack(V(this,e||[],!0))},is:function(e){return!!V(this,\"string\"==typeof e&&R.test(e)?k(e):e||[],!1).length}});var F,H=/^(?:\\s*(<[\\w\\W]+>)[^>]*|#([\\w-]+))$/;(k.fn.init=function(e,t,n){var r,a;if(!e)return this;if(n=n||F,\"string\"==typeof e){if(!(r=\"<\"===e[0]&&\">\"===e[e.length-1]&&e.length>=3?[null,e,null]:H.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof k?t[0]:t,k.merge(this,k.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:m,!0)),P.test(r[1])&&k.isPlainObject(t))for(r in t)f(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(a=m.getElementById(r[2]))&&(this[0]=a,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):f(e)?void 0!==n.ready?n.ready(e):e(k):k.makeArray(e,this)}).prototype=k.fn,F=k(m);var q=/^(?:parents|prev(?:Until|All))/,z={children:!0,contents:!0,next:!0,prev:!0};function W(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}k.fn.extend({has:function(e){var t=k(e,this),n=t.length;return this.filter((function(){for(var e=0;e<n;e++)if(k.contains(this,t[e]))return!0}))},closest:function(e,t){var n,r=0,a=this.length,o=[],i=\"string\"!=typeof e&&k(e);if(!R.test(e))for(;r<a;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(i?i.index(n)>-1:1===n.nodeType&&k.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(o.length>1?k.uniqueSort(o):o)},index:function(e){return e?\"string\"==typeof e?s.call(k(e),this[0]):s.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(k.uniqueSort(k.merge(this.get(),k(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),k.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return M(e,\"parentNode\")},parentsUntil:function(e,t,n){return M(e,\"parentNode\",n)},next:function(e){return W(e,\"nextSibling\")},prev:function(e){return W(e,\"previousSibling\")},nextAll:function(e){return M(e,\"nextSibling\")},prevAll:function(e){return M(e,\"previousSibling\")},nextUntil:function(e,t,n){return M(e,\"nextSibling\",n)},prevUntil:function(e,t,n){return M(e,\"previousSibling\",n)},siblings:function(e){return L((e.parentNode||{}).firstChild,e)},children:function(e){return L(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(S(e,\"template\")&&(e=e.content||e),k.merge([],e.childNodes))}},(function(e,t){k.fn[e]=function(n,r){var a=k.map(this,t,n);return\"Until\"!==e.slice(-5)&&(r=n),r&&\"string\"==typeof r&&(a=k.filter(r,a)),this.length>1&&(z[e]||k.uniqueSort(a),q.test(e)&&a.reverse()),this.pushStack(a)}}));var B=/[^\\x20\\t\\r\\n\\f]+/g;function U(e){return e}function _(e){throw e}function G(e,t,n,r){var a;try{e&&f(a=e.promise)?a.call(e).done(t).fail(n):e&&f(a=e.then)?a.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}k.Callbacks=function(e){e=\"string\"==typeof e?function(e){var t={};return k.each(e.match(B)||[],(function(e,n){t[n]=!0})),t}(e):k.extend({},e);var t,n,r,a,o=[],i=[],s=-1,c=function(){for(a=a||e.once,r=t=!0;i.length;s=-1)for(n=i.shift();++s<o.length;)!1===o[s].apply(n[0],n[1])&&e.stopOnFalse&&(s=o.length,n=!1);e.memory||(n=!1),t=!1,a&&(o=n?[]:\"\")},l={add:function(){return o&&(n&&!t&&(s=o.length-1,i.push(n)),function t(n){k.each(n,(function(n,r){f(r)?e.unique&&l.has(r)||o.push(r):r&&r.length&&\"string\"!==v(r)&&t(r)}))}(arguments),n&&!t&&c()),this},remove:function(){return k.each(arguments,(function(e,t){for(var n;(n=k.inArray(t,o,n))>-1;)o.splice(n,1),n<=s&&s--})),this},has:function(e){return e?k.inArray(e,o)>-1:o.length>0},empty:function(){return o&&(o=[]),this},disable:function(){return a=i=[],o=n=\"\",this},disabled:function(){return!o},lock:function(){return a=i=[],n||t||(o=n=\"\"),this},locked:function(){return!!a},fireWith:function(e,n){return a||(n=[e,(n=n||[]).slice?n.slice():n],i.push(n),t||c()),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!r}};return l},k.extend({Deferred:function(t){var n=[[\"notify\",\"progress\",k.Callbacks(\"memory\"),k.Callbacks(\"memory\"),2],[\"resolve\",\"done\",k.Callbacks(\"once memory\"),k.Callbacks(\"once memory\"),0,\"resolved\"],[\"reject\",\"fail\",k.Callbacks(\"once memory\"),k.Callbacks(\"once memory\"),1,\"rejected\"]],r=\"pending\",a={state:function(){return r},always:function(){return o.done(arguments).fail(arguments),this},catch:function(e){return a.then(null,e)},pipe:function(){var e=arguments;return k.Deferred((function(t){k.each(n,(function(n,r){var a=f(e[r[4]])&&e[r[4]];o[r[1]]((function(){var e=a&&a.apply(this,arguments);e&&f(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[r[0]+\"With\"](this,a?[e]:arguments)}))})),e=null})).promise()},then:function(t,r,a){var o=0;function i(t,n,r,a){return function(){var s=this,c=arguments,l=function(){var e,l;if(!(t<o)){if((e=r.apply(s,c))===n.promise())throw new TypeError(\"Thenable self-resolution\");l=e&&(\"object\"==typeof e||\"function\"==typeof e)&&e.then,f(l)?a?l.call(e,i(o,n,U,a),i(o,n,_,a)):(o++,l.call(e,i(o,n,U,a),i(o,n,_,a),i(o,n,U,n.notifyWith))):(r!==U&&(s=void 0,c=[e]),(a||n.resolveWith)(s,c))}},u=a?l:function(){try{l()}catch(e){k.Deferred.exceptionHook&&k.Deferred.exceptionHook(e,u.error),t+1>=o&&(r!==_&&(s=void 0,c=[e]),n.rejectWith(s,c))}};t?u():(k.Deferred.getErrorHook?u.error=k.Deferred.getErrorHook():k.Deferred.getStackHook&&(u.error=k.Deferred.getStackHook()),e.setTimeout(u))}}return k.Deferred((function(e){n[0][3].add(i(0,e,f(a)?a:U,e.notifyWith)),n[1][3].add(i(0,e,f(t)?t:U)),n[2][3].add(i(0,e,f(r)?r:_))})).promise()},promise:function(e){return null!=e?k.extend(e,a):a}},o={};return k.each(n,(function(e,t){var i=t[2],s=t[5];a[t[1]]=i.add,s&&i.add((function(){r=s}),n[3-e][2].disable,n[3-e][3].disable,n[0][2].lock,n[0][3].lock),i.add(t[3].fire),o[t[0]]=function(){return o[t[0]+\"With\"](this===o?void 0:this,arguments),this},o[t[0]+\"With\"]=i.fireWith})),a.promise(o),t&&t.call(o,o),o},when:function(e){var t=arguments.length,n=t,r=Array(n),o=a.call(arguments),i=k.Deferred(),s=function(e){return function(n){r[e]=this,o[e]=arguments.length>1?a.call(arguments):n,--t||i.resolveWith(r,o)}};if(t<=1&&(G(e,i.done(s(n)).resolve,i.reject,!t),\"pending\"===i.state()||f(o[n]&&o[n].then)))return i.then();for(;n--;)G(o[n],s(n),i.reject);return i.promise()}});var X=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;k.Deferred.exceptionHook=function(t,n){e.console&&e.console.warn&&t&&X.test(t.name)&&e.console.warn(\"jQuery.Deferred exception: \"+t.message,t.stack,n)},k.readyException=function(t){e.setTimeout((function(){throw t}))};var Y=k.Deferred();function J(){m.removeEventListener(\"DOMContentLoaded\",J),e.removeEventListener(\"load\",J),k.ready()}k.fn.ready=function(e){return Y.then(e).catch((function(e){k.readyException(e)})),this},k.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--k.readyWait:k.isReady)||(k.isReady=!0,!0!==e&&--k.readyWait>0||Y.resolveWith(m,[k]))}}),k.ready.then=Y.then,\"complete\"===m.readyState||\"loading\"!==m.readyState&&!m.documentElement.doScroll?e.setTimeout(k.ready):(m.addEventListener(\"DOMContentLoaded\",J),e.addEventListener(\"load\",J));var K=function(e,t,n,r,a,o,i){var s=0,c=e.length,l=null==n;if(\"object\"===v(n))for(s in a=!0,n)K(e,t,s,n[s],!0,o,i);else if(void 0!==r&&(a=!0,f(r)||(i=!0),l&&(i?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(k(e),n)})),t))for(;s<c;s++)t(e[s],n,i?r:r.call(e[s],s,t(e[s],n)));return a?e:l?t.call(e):c?t(e[0],n):o},Q=/^-ms-/,Z=/-([a-z])/g;function ee(e,t){return t.toUpperCase()}function te(e){return e.replace(Q,\"ms-\").replace(Z,ee)}var ne=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function re(){this.expando=k.expando+re.uid++}re.uid=1,re.prototype={cache:function(e){var t=e[this.expando];return t||(t={},ne(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,a=this.cache(e);if(\"string\"==typeof t)a[te(t)]=n;else for(r in t)a[te(r)]=t[r];return a},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][te(t)]},access:function(e,t,n){return void 0===t||t&&\"string\"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(te):(t=te(t))in r?[t]:t.match(B)||[]).length;for(;n--;)delete r[t[n]]}(void 0===t||k.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!k.isEmptyObject(t)}};var ae=new re,oe=new re,ie=/^(?:\\{[\\w\\W]*\\}|\\[[\\w\\W]*\\])$/,se=/[A-Z]/g;function ce(e,t,n){var r;if(void 0===n&&1===e.nodeType)if(r=\"data-\"+t.replace(se,\"-$&\").toLowerCase(),\"string\"==typeof(n=e.getAttribute(r))){try{n=function(e){return\"true\"===e||\"false\"!==e&&(\"null\"===e?null:e===+e+\"\"?+e:ie.test(e)?JSON.parse(e):e)}(n)}catch(e){}oe.set(e,t,n)}else n=void 0;return n}k.extend({hasData:function(e){return oe.hasData(e)||ae.hasData(e)},data:function(e,t,n){return oe.access(e,t,n)},removeData:function(e,t){oe.remove(e,t)},_data:function(e,t,n){return ae.access(e,t,n)},_removeData:function(e,t){ae.remove(e,t)}}),k.fn.extend({data:function(e,t){var n,r,a,o=this[0],i=o&&o.attributes;if(void 0===e){if(this.length&&(a=oe.get(o),1===o.nodeType&&!ae.get(o,\"hasDataAttrs\"))){for(n=i.length;n--;)i[n]&&0===(r=i[n].name).indexOf(\"data-\")&&(r=te(r.slice(5)),ce(o,r,a[r]));ae.set(o,\"hasDataAttrs\",!0)}return a}return\"object\"==typeof e?this.each((function(){oe.set(this,e)})):K(this,(function(t){var n;if(o&&void 0===t)return void 0!==(n=oe.get(o,e))||void 0!==(n=ce(o,e))?n:void 0;this.each((function(){oe.set(this,e,t)}))}),null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each((function(){oe.remove(this,e)}))}}),k.extend({queue:function(e,t,n){var r;if(e)return t=(t||\"fx\")+\"queue\",r=ae.get(e,t),n&&(!r||Array.isArray(n)?r=ae.access(e,t,k.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||\"fx\";var n=k.queue(e,t),r=n.length,a=n.shift(),o=k._queueHooks(e,t);\"inprogress\"===a&&(a=n.shift(),r--),a&&(\"fx\"===t&&n.unshift(\"inprogress\"),delete o.stop,a.call(e,(function(){k.dequeue(e,t)}),o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+\"queueHooks\";return ae.get(e,n)||ae.access(e,n,{empty:k.Callbacks(\"once memory\").add((function(){ae.remove(e,[t+\"queue\",n])}))})}}),k.fn.extend({queue:function(e,t){var n=2;return\"string\"!=typeof e&&(t=e,e=\"fx\",n--),arguments.length<n?k.queue(this[0],e):void 0===t?this:this.each((function(){var n=k.queue(this,e,t);k._queueHooks(this,e),\"fx\"===e&&\"inprogress\"!==n[0]&&k.dequeue(this,e)}))},dequeue:function(e){return this.each((function(){k.dequeue(this,e)}))},clearQueue:function(e){return this.queue(e||\"fx\",[])},promise:function(e,t){var n,r=1,a=k.Deferred(),o=this,i=this.length,s=function(){--r||a.resolveWith(o,[o])};for(\"string\"!=typeof e&&(t=e,e=void 0),e=e||\"fx\";i--;)(n=ae.get(o[i],e+\"queueHooks\"))&&n.empty&&(r++,n.empty.add(s));return s(),a.promise(t)}});var le=/[+-]?(?:\\d*\\.|)\\d+(?:[eE][+-]?\\d+|)/.source,ue=new RegExp(\"^(?:([+-])=|)(\"+le+\")([a-z%]*)$\",\"i\"),de=[\"Top\",\"Right\",\"Bottom\",\"Left\"],pe=m.documentElement,he=function(e){return k.contains(e.ownerDocument,e)},fe={composed:!0};pe.getRootNode&&(he=function(e){return k.contains(e.ownerDocument,e)||e.getRootNode(fe)===e.ownerDocument});var ge=function(e,t){return\"none\"===(e=t||e).style.display||\"\"===e.style.display&&he(e)&&\"none\"===k.css(e,\"display\")};function me(e,t,n,r){var a,o,i=20,s=r?function(){return r.cur()}:function(){return k.css(e,t,\"\")},c=s(),l=n&&n[3]||(k.cssNumber[t]?\"\":\"px\"),u=e.nodeType&&(k.cssNumber[t]||\"px\"!==l&&+c)&&ue.exec(k.css(e,t));if(u&&u[3]!==l){for(c/=2,l=l||u[3],u=+c||1;i--;)k.style(e,t,u+l),(1-o)*(1-(o=s()/c||.5))<=0&&(i=0),u/=o;u*=2,k.style(e,t,u+l),n=n||[]}return n&&(u=+u||+c||0,a=n[1]?u+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=u,r.end=a)),a}var ye={};function be(e){var t,n=e.ownerDocument,r=e.nodeName,a=ye[r];return a||(t=n.body.appendChild(n.createElement(r)),a=k.css(t,\"display\"),t.parentNode.removeChild(t),\"none\"===a&&(a=\"block\"),ye[r]=a,a)}function ve(e,t){for(var n,r,a=[],o=0,i=e.length;o<i;o++)(r=e[o]).style&&(n=r.style.display,t?(\"none\"===n&&(a[o]=ae.get(r,\"display\")||null,a[o]||(r.style.display=\"\")),\"\"===r.style.display&&ge(r)&&(a[o]=be(r))):\"none\"!==n&&(a[o]=\"none\",ae.set(r,\"display\",n)));for(o=0;o<i;o++)null!=a[o]&&(e[o].style.display=a[o]);return e}k.fn.extend({show:function(){return ve(this,!0)},hide:function(){return ve(this)},toggle:function(e){return\"boolean\"==typeof e?e?this.show():this.hide():this.each((function(){ge(this)?k(this).show():k(this).hide()}))}});var we,$e,ke=/^(?:checkbox|radio)$/i,xe=/<([a-z][^\\/\\0>\\x20\\t\\r\\n\\f]*)/i,Se=/^$|^module$|\\/(?:java|ecma)script/i;we=m.createDocumentFragment().appendChild(m.createElement(\"div\")),($e=m.createElement(\"input\")).setAttribute(\"type\",\"radio\"),$e.setAttribute(\"checked\",\"checked\"),$e.setAttribute(\"name\",\"t\"),we.appendChild($e),h.checkClone=we.cloneNode(!0).cloneNode(!0).lastChild.checked,we.innerHTML=\"<textarea>x</textarea>\",h.noCloneChecked=!!we.cloneNode(!0).lastChild.defaultValue,we.innerHTML=\"<option></option>\",h.option=!!we.lastChild;var Te={thead:[1,\"<table>\",\"</table>\"],col:[2,\"<table><colgroup>\",\"</colgroup></table>\"],tr:[2,\"<table><tbody>\",\"</tbody></table>\"],td:[3,\"<table><tbody><tr>\",\"</tr></tbody></table>\"],_default:[0,\"\",\"\"]};function Ce(e,t){var n;return n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||\"*\"):void 0!==e.querySelectorAll?e.querySelectorAll(t||\"*\"):[],void 0===t||t&&S(e,t)?k.merge([e],n):n}function Ne(e,t){for(var n=0,r=e.length;n<r;n++)ae.set(e[n],\"globalEval\",!t||ae.get(t[n],\"globalEval\"))}Te.tbody=Te.tfoot=Te.colgroup=Te.caption=Te.thead,Te.th=Te.td,h.option||(Te.optgroup=Te.option=[1,\"<select multiple='multiple'>\",\"</select>\"]);var je=/<|&#?\\w+;/;function Ae(e,t,n,r,a){for(var o,i,s,c,l,u,d=t.createDocumentFragment(),p=[],h=0,f=e.length;h<f;h++)if((o=e[h])||0===o)if(\"object\"===v(o))k.merge(p,o.nodeType?[o]:o);else if(je.test(o)){for(i=i||d.appendChild(t.createElement(\"div\")),s=(xe.exec(o)||[\"\",\"\"])[1].toLowerCase(),c=Te[s]||Te._default,i.innerHTML=c[1]+k.htmlPrefilter(o)+c[2],u=c[0];u--;)i=i.lastChild;k.merge(p,i.childNodes),(i=d.firstChild).textContent=\"\"}else p.push(t.createTextNode(o));for(d.textContent=\"\",h=0;o=p[h++];)if(r&&k.inArray(o,r)>-1)a&&a.push(o);else if(l=he(o),i=Ce(d.appendChild(o),\"script\"),l&&Ne(i),n)for(u=0;o=i[u++];)Se.test(o.type||\"\")&&n.push(o);return d}var Ee=/^([^.]*)(?:\\.(.+)|)/;function Oe(){return!0}function De(){return!1}function Ie(e,t,n,r,a,o){var i,s;if(\"object\"==typeof t){for(s in\"string\"!=typeof n&&(r=r||n,n=void 0),t)Ie(e,s,n,r,t[s],o);return e}if(null==r&&null==a?(a=n,r=n=void 0):null==a&&(\"string\"==typeof n?(a=r,r=void 0):(a=r,r=n,n=void 0)),!1===a)a=De;else if(!a)return e;return 1===o&&(i=a,a=function(e){return k().off(e),i.apply(this,arguments)},a.guid=i.guid||(i.guid=k.guid++)),e.each((function(){k.event.add(this,t,a,r,n)}))}function Me(e,t,n){n?(ae.set(e,t,!1),k.event.add(e,t,{namespace:!1,handler:function(e){var n,r=ae.get(this,t);if(1&e.isTrigger&&this[t]){if(r)(k.event.special[t]||{}).delegateType&&e.stopPropagation();else if(r=a.call(arguments),ae.set(this,t,r),this[t](),n=ae.get(this,t),ae.set(this,t,!1),r!==n)return e.stopImmediatePropagation(),e.preventDefault(),n}else r&&(ae.set(this,t,k.event.trigger(r[0],r.slice(1),this)),e.stopPropagation(),e.isImmediatePropagationStopped=Oe)}})):void 0===ae.get(e,t)&&k.event.add(e,t,Oe)}k.event={global:{},add:function(e,t,n,r,a){var o,i,s,c,l,u,d,p,h,f,g,m=ae.get(e);if(ne(e))for(n.handler&&(n=(o=n).handler,a=o.selector),a&&k.find.matchesSelector(pe,a),n.guid||(n.guid=k.guid++),(c=m.events)||(c=m.events=Object.create(null)),(i=m.handle)||(i=m.handle=function(t){return void 0!==k&&k.event.triggered!==t.type?k.event.dispatch.apply(e,arguments):void 0}),l=(t=(t||\"\").match(B)||[\"\"]).length;l--;)h=g=(s=Ee.exec(t[l])||[])[1],f=(s[2]||\"\").split(\".\").sort(),h&&(d=k.event.special[h]||{},h=(a?d.delegateType:d.bindType)||h,d=k.event.special[h]||{},u=k.extend({type:h,origType:g,data:r,handler:n,guid:n.guid,selector:a,needsContext:a&&k.expr.match.needsContext.test(a),namespace:f.join(\".\")},o),(p=c[h])||((p=c[h]=[]).delegateCount=0,d.setup&&!1!==d.setup.call(e,r,f,i)||e.addEventListener&&e.addEventListener(h,i)),d.add&&(d.add.call(e,u),u.handler.guid||(u.handler.guid=n.guid)),a?p.splice(p.delegateCount++,0,u):p.push(u),k.event.global[h]=!0)},remove:function(e,t,n,r,a){var o,i,s,c,l,u,d,p,h,f,g,m=ae.hasData(e)&&ae.get(e);if(m&&(c=m.events)){for(l=(t=(t||\"\").match(B)||[\"\"]).length;l--;)if(h=g=(s=Ee.exec(t[l])||[])[1],f=(s[2]||\"\").split(\".\").sort(),h){for(d=k.event.special[h]||{},p=c[h=(r?d.delegateType:d.bindType)||h]||[],s=s[2]&&new RegExp(\"(^|\\\\.)\"+f.join(\"\\\\.(?:.*\\\\.|)\")+\"(\\\\.|$)\"),i=o=p.length;o--;)u=p[o],!a&&g!==u.origType||n&&n.guid!==u.guid||s&&!s.test(u.namespace)||r&&r!==u.selector&&(\"**\"!==r||!u.selector)||(p.splice(o,1),u.selector&&p.delegateCount--,d.remove&&d.remove.call(e,u));i&&!p.length&&(d.teardown&&!1!==d.teardown.call(e,f,m.handle)||k.removeEvent(e,h,m.handle),delete c[h])}else for(h in c)k.event.remove(e,h+t[l],n,r,!0);k.isEmptyObject(c)&&ae.remove(e,\"handle events\")}},dispatch:function(e){var t,n,r,a,o,i,s=new Array(arguments.length),c=k.event.fix(e),l=(ae.get(this,\"events\")||Object.create(null))[c.type]||[],u=k.event.special[c.type]||{};for(s[0]=c,t=1;t<arguments.length;t++)s[t]=arguments[t];if(c.delegateTarget=this,!u.preDispatch||!1!==u.preDispatch.call(this,c)){for(i=k.event.handlers.call(this,c,l),t=0;(a=i[t++])&&!c.isPropagationStopped();)for(c.currentTarget=a.elem,n=0;(o=a.handlers[n++])&&!c.isImmediatePropagationStopped();)c.rnamespace&&!1!==o.namespace&&!c.rnamespace.test(o.namespace)||(c.handleObj=o,c.data=o.data,void 0!==(r=((k.event.special[o.origType]||{}).handle||o.handler).apply(a.elem,s))&&!1===(c.result=r)&&(c.preventDefault(),c.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,c),c.result}},handlers:function(e,t){var n,r,a,o,i,s=[],c=t.delegateCount,l=e.target;if(c&&l.nodeType&&!(\"click\"===e.type&&e.button>=1))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&(\"click\"!==e.type||!0!==l.disabled)){for(o=[],i={},n=0;n<c;n++)void 0===i[a=(r=t[n]).selector+\" \"]&&(i[a]=r.needsContext?k(a,this).index(l)>-1:k.find(a,this,null,[l]).length),i[a]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,c<t.length&&s.push({elem:l,handlers:t.slice(c)}),s},addProp:function(e,t){Object.defineProperty(k.Event.prototype,e,{enumerable:!0,configurable:!0,get:f(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[k.expando]?e:new k.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return ke.test(t.type)&&t.click&&S(t,\"input\")&&Me(t,\"click\",!0),!1},trigger:function(e){var t=this||e;return ke.test(t.type)&&t.click&&S(t,\"input\")&&Me(t,\"click\"),!0},_default:function(e){var t=e.target;return ke.test(t.type)&&t.click&&S(t,\"input\")&&ae.get(t,\"click\")||S(t,\"a\")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},k.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},k.Event=function(e,t){if(!(this instanceof k.Event))return new k.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Oe:De,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&k.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[k.expando]=!0},k.Event.prototype={constructor:k.Event,isDefaultPrevented:De,isPropagationStopped:De,isImmediatePropagationStopped:De,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Oe,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Oe,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Oe,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},k.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},k.event.addProp),k.each({focus:\"focusin\",blur:\"focusout\"},(function(e,t){function n(e){if(m.documentMode){var n=ae.get(this,\"handle\"),r=k.event.fix(e);r.type=\"focusin\"===e.type?\"focus\":\"blur\",r.isSimulated=!0,n(e),r.target===r.currentTarget&&n(r)}else k.event.simulate(t,e.target,k.event.fix(e))}k.event.special[e]={setup:function(){var r;if(Me(this,e,!0),!m.documentMode)return!1;(r=ae.get(this,t))||this.addEventListener(t,n),ae.set(this,t,(r||0)+1)},trigger:function(){return Me(this,e),!0},teardown:function(){var e;if(!m.documentMode)return!1;(e=ae.get(this,t)-1)?ae.set(this,t,e):(this.removeEventListener(t,n),ae.remove(this,t))},_default:function(t){return ae.get(t.target,e)},delegateType:t},k.event.special[t]={setup:function(){var r=this.ownerDocument||this.document||this,a=m.documentMode?this:r,o=ae.get(a,t);o||(m.documentMode?this.addEventListener(t,n):r.addEventListener(e,n,!0)),ae.set(a,t,(o||0)+1)},teardown:function(){var r=this.ownerDocument||this.document||this,a=m.documentMode?this:r,o=ae.get(a,t)-1;o?ae.set(a,t,o):(m.documentMode?this.removeEventListener(t,n):r.removeEventListener(e,n,!0),ae.remove(a,t))}}})),k.each({mouseenter:\"mouseover\",mouseleave:\"mouseout\",pointerenter:\"pointerover\",pointerleave:\"pointerout\"},(function(e,t){k.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=e.relatedTarget,a=e.handleObj;return r&&(r===this||k.contains(this,r))||(e.type=a.origType,n=a.handler.apply(this,arguments),e.type=t),n}}})),k.fn.extend({on:function(e,t,n,r){return Ie(this,e,t,n,r)},one:function(e,t,n,r){return Ie(this,e,t,n,r,1)},off:function(e,t,n){var r,a;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,k(e.delegateTarget).off(r.namespace?r.origType+\".\"+r.namespace:r.origType,r.selector,r.handler),this;if(\"object\"==typeof e){for(a in e)this.off(a,t,e[a]);return this}return!1!==t&&\"function\"!=typeof t||(n=t,t=void 0),!1===n&&(n=De),this.each((function(){k.event.remove(this,e,n,t)}))}});var Le=/<script|<style|<link/i,Re=/checked\\s*(?:[^=]|=\\s*.checked.)/i,Pe=/^\\s*<!\\[CDATA\\[|\\]\\]>\\s*$/g;function Ve(e,t){return S(e,\"table\")&&S(11!==t.nodeType?t:t.firstChild,\"tr\")&&k(e).children(\"tbody\")[0]||e}function Fe(e){return e.type=(null!==e.getAttribute(\"type\"))+\"/\"+e.type,e}function He(e){return\"true/\"===(e.type||\"\").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute(\"type\"),e}function qe(e,t){var n,r,a,o,i,s;if(1===t.nodeType){if(ae.hasData(e)&&(s=ae.get(e).events))for(a in ae.remove(t,\"handle events\"),s)for(n=0,r=s[a].length;n<r;n++)k.event.add(t,a,s[a][n]);oe.hasData(e)&&(o=oe.access(e),i=k.extend({},o),oe.set(t,i))}}function ze(e,t){var n=t.nodeName.toLowerCase();\"input\"===n&&ke.test(e.type)?t.checked=e.checked:\"input\"!==n&&\"textarea\"!==n||(t.defaultValue=e.defaultValue)}function We(e,t,n,r){t=o(t);var a,i,s,c,l,u,d=0,p=e.length,g=p-1,m=t[0],y=f(m);if(y||p>1&&\"string\"==typeof m&&!h.checkClone&&Re.test(m))return e.each((function(a){var o=e.eq(a);y&&(t[0]=m.call(this,a,o.html())),We(o,t,n,r)}));if(p&&(i=(a=Ae(t,e[0].ownerDocument,!1,e,r)).firstChild,1===a.childNodes.length&&(a=i),i||r)){for(c=(s=k.map(Ce(a,\"script\"),Fe)).length;d<p;d++)l=a,d!==g&&(l=k.clone(l,!0,!0),c&&k.merge(s,Ce(l,\"script\"))),n.call(e[d],l,d);if(c)for(u=s[s.length-1].ownerDocument,k.map(s,He),d=0;d<c;d++)l=s[d],Se.test(l.type||\"\")&&!ae.access(l,\"globalEval\")&&k.contains(u,l)&&(l.src&&\"module\"!==(l.type||\"\").toLowerCase()?k._evalUrl&&!l.noModule&&k._evalUrl(l.src,{nonce:l.nonce||l.getAttribute(\"nonce\")},u):b(l.textContent.replace(Pe,\"\"),l,u))}return e}function Be(e,t,n){for(var r,a=t?k.filter(t,e):e,o=0;null!=(r=a[o]);o++)n||1!==r.nodeType||k.cleanData(Ce(r)),r.parentNode&&(n&&he(r)&&Ne(Ce(r,\"script\")),r.parentNode.removeChild(r));return e}k.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,a,o,i,s=e.cloneNode(!0),c=he(e);if(!(h.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||k.isXMLDoc(e)))for(i=Ce(s),r=0,a=(o=Ce(e)).length;r<a;r++)ze(o[r],i[r]);if(t)if(n)for(o=o||Ce(e),i=i||Ce(s),r=0,a=o.length;r<a;r++)qe(o[r],i[r]);else qe(e,s);return(i=Ce(s,\"script\")).length>0&&Ne(i,!c&&Ce(e,\"script\")),s},cleanData:function(e){for(var t,n,r,a=k.event.special,o=0;void 0!==(n=e[o]);o++)if(ne(n)){if(t=n[ae.expando]){if(t.events)for(r in t.events)a[r]?k.event.remove(n,r):k.removeEvent(n,r,t.handle);n[ae.expando]=void 0}n[oe.expando]&&(n[oe.expando]=void 0)}}}),k.fn.extend({detach:function(e){return Be(this,e,!0)},remove:function(e){return Be(this,e)},text:function(e){return K(this,(function(e){return void 0===e?k.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)}))}),null,e,arguments.length)},append:function(){return We(this,arguments,(function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Ve(this,e).appendChild(e)}))},prepend:function(){return We(this,arguments,(function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Ve(this,e);t.insertBefore(e,t.firstChild)}}))},before:function(){return We(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this)}))},after:function(){return We(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)}))},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(k.cleanData(Ce(e,!1)),e.textContent=\"\");return this},clone:function(e,t){return e=e??!1,t=t??e,this.map((function(){return k.clone(this,e,t)}))},html:function(e){return K(this,(function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if(\"string\"==typeof e&&!Le.test(e)&&!Te[(xe.exec(e)||[\"\",\"\"])[1].toLowerCase()]){e=k.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(k.cleanData(Ce(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)}),null,e,arguments.length)},replaceWith:function(){var e=[];return We(this,arguments,(function(t){var n=this.parentNode;k.inArray(this,e)<0&&(k.cleanData(Ce(this)),n&&n.replaceChild(t,this))}),e)}}),k.each({appendTo:\"append\",prependTo:\"prepend\",insertBefore:\"before\",insertAfter:\"after\",replaceAll:\"replaceWith\"},(function(e,t){k.fn[e]=function(e){for(var n,r=[],a=k(e),o=a.length-1,s=0;s<=o;s++)n=s===o?this:this.clone(!0),k(a[s])[t](n),i.apply(r,n.get());return this.pushStack(r)}}));var Ue=new RegExp(\"^(\"+le+\")(?!px)[a-z%]+$\",\"i\"),_e=/^--/,Ge=function(t){var n=t.ownerDocument.defaultView;return n&&n.opener||(n=e),n.getComputedStyle(t)},Xe=function(e,t,n){var r,a,o={};for(a in t)o[a]=e.style[a],e.style[a]=t[a];for(a in r=n.call(e),t)e.style[a]=o[a];return r},Ye=new RegExp(de.join(\"|\"),\"i\");function Je(e,t,n){var r,a,o,i,s=_e.test(t),c=e.style;return(n=n||Ge(e))&&(i=n.getPropertyValue(t)||n[t],s&&i&&(i=i.replace(A,\"$1\")||void 0),\"\"!==i||he(e)||(i=k.style(e,t)),!h.pixelBoxStyles()&&Ue.test(i)&&Ye.test(t)&&(r=c.width,a=c.minWidth,o=c.maxWidth,c.minWidth=c.maxWidth=c.width=i,i=n.width,c.width=r,c.minWidth=a,c.maxWidth=o)),void 0!==i?i+\"\":i}function Ke(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function t(){if(u){l.style.cssText=\"position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0\",u.style.cssText=\"position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%\",pe.appendChild(l).appendChild(u);var t=e.getComputedStyle(u);r=\"1%\"!==t.top,c=12===n(t.marginLeft),u.style.right=\"60%\",i=36===n(t.right),a=36===n(t.width),u.style.position=\"absolute\",o=12===n(u.offsetWidth/3),pe.removeChild(l),u=null}}function n(e){return Math.round(parseFloat(e))}var r,a,o,i,s,c,l=m.createElement(\"div\"),u=m.createElement(\"div\");u.style&&(u.style.backgroundClip=\"content-box\",u.cloneNode(!0).style.backgroundClip=\"\",h.clearCloneStyle=\"content-box\"===u.style.backgroundClip,k.extend(h,{boxSizingReliable:function(){return t(),a},pixelBoxStyles:function(){return t(),i},pixelPosition:function(){return t(),r},reliableMarginLeft:function(){return t(),c},scrollboxSize:function(){return t(),o},reliableTrDimensions:function(){var t,n,r,a;return null==s&&(t=m.createElement(\"table\"),n=m.createElement(\"tr\"),r=m.createElement(\"div\"),t.style.cssText=\"position:absolute;left:-11111px;border-collapse:separate\",n.style.cssText=\"box-sizing:content-box;border:1px solid\",n.style.height=\"1px\",r.style.height=\"9px\",r.style.display=\"block\",pe.appendChild(t).appendChild(n).appendChild(r),a=e.getComputedStyle(n),s=parseInt(a.height,10)+parseInt(a.borderTopWidth,10)+parseInt(a.borderBottomWidth,10)===n.offsetHeight,pe.removeChild(t)),s}}))}();var Qe=[\"Webkit\",\"Moz\",\"ms\"],Ze=m.createElement(\"div\").style,et={};function tt(e){var t=k.cssProps[e]||et[e];return t||(e in Ze?e:et[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),n=Qe.length;n--;)if((e=Qe[n]+t)in Ze)return e}(e)||e)}var nt=/^(none|table(?!-c[ea]).+)/,rt={position:\"absolute\",visibility:\"hidden\",display:\"block\"},at={letterSpacing:\"0\",fontWeight:\"400\"};function ot(e,t,n){var r=ue.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||\"px\"):t}function it(e,t,n,r,a,o){var i=\"width\"===t?1:0,s=0,c=0,l=0;if(n===(r?\"border\":\"content\"))return 0;for(;i<4;i+=2)\"margin\"===n&&(l+=k.css(e,n+de[i],!0,a)),r?(\"content\"===n&&(c-=k.css(e,\"padding\"+de[i],!0,a)),\"margin\"!==n&&(c-=k.css(e,\"border\"+de[i]+\"Width\",!0,a))):(c+=k.css(e,\"padding\"+de[i],!0,a),\"padding\"!==n?c+=k.css(e,\"border\"+de[i]+\"Width\",!0,a):s+=k.css(e,\"border\"+de[i]+\"Width\",!0,a));return!r&&o>=0&&(c+=Math.max(0,Math.ceil(e[\"offset\"+t[0].toUpperCase()+t.slice(1)]-o-c-s-.5))||0),c+l}function st(e,t,n){var r=Ge(e),a=(!h.boxSizingReliable()||n)&&\"border-box\"===k.css(e,\"boxSizing\",!1,r),o=a,i=Je(e,t,r),s=\"offset\"+t[0].toUpperCase()+t.slice(1);if(Ue.test(i)){if(!n)return i;i=\"auto\"}return(!h.boxSizingReliable()&&a||!h.reliableTrDimensions()&&S(e,\"tr\")||\"auto\"===i||!parseFloat(i)&&\"inline\"===k.css(e,\"display\",!1,r))&&e.getClientRects().length&&(a=\"border-box\"===k.css(e,\"boxSizing\",!1,r),(o=s in e)&&(i=e[s])),(i=parseFloat(i)||0)+it(e,t,n||(a?\"border\":\"content\"),o,r,i)+\"px\"}function ct(e,t,n,r,a){return new ct.prototype.init(e,t,n,r,a)}k.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Je(e,\"opacity\");return\"\"===n?\"1\":n}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var a,o,i,s=te(t),c=_e.test(t),l=e.style;if(c||(t=tt(s)),i=k.cssHooks[t]||k.cssHooks[s],void 0===n)return i&&\"get\"in i&&void 0!==(a=i.get(e,!1,r))?a:l[t];\"string\"==(o=typeof n)&&(a=ue.exec(n))&&a[1]&&(n=me(e,t,a),o=\"number\"),null!=n&&n==n&&(\"number\"!==o||c||(n+=a&&a[3]||(k.cssNumber[s]?\"\":\"px\")),h.clearCloneStyle||\"\"!==n||0!==t.indexOf(\"background\")||(l[t]=\"inherit\"),i&&\"set\"in i&&void 0===(n=i.set(e,n,r))||(c?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var a,o,i,s=te(t);return _e.test(t)||(t=tt(s)),(i=k.cssHooks[t]||k.cssHooks[s])&&\"get\"in i&&(a=i.get(e,!0,n)),void 0===a&&(a=Je(e,t,r)),\"normal\"===a&&t in at&&(a=at[t]),\"\"===n||n?(o=parseFloat(a),!0===n||isFinite(o)?o||0:a):a}}),k.each([\"height\",\"width\"],(function(e,t){k.cssHooks[t]={get:function(e,n,r){if(n)return!nt.test(k.css(e,\"display\"))||e.getClientRects().length&&e.getBoundingClientRect().width?st(e,t,r):Xe(e,rt,(function(){return st(e,t,r)}))},set:function(e,n,r){var a,o=Ge(e),i=!h.scrollboxSize()&&\"absolute\"===o.position,s=(i||r)&&\"border-box\"===k.css(e,\"boxSizing\",!1,o),c=r?it(e,t,r,s,o):0;return s&&i&&(c-=Math.ceil(e[\"offset\"+t[0].toUpperCase()+t.slice(1)]-parseFloat(o[t])-it(e,t,\"border\",!1,o)-.5)),c&&(a=ue.exec(n))&&\"px\"!==(a[3]||\"px\")&&(e.style[t]=n,n=k.css(e,t)),ot(0,n,c)}}})),k.cssHooks.marginLeft=Ke(h.reliableMarginLeft,(function(e,t){if(t)return(parseFloat(Je(e,\"marginLeft\"))||e.getBoundingClientRect().left-Xe(e,{marginLeft:0},(function(){return e.getBoundingClientRect().left})))+\"px\"})),k.each({margin:\"\",padding:\"\",border:\"Width\"},(function(e,t){k.cssHooks[e+t]={expand:function(n){for(var r=0,a={},o=\"string\"==typeof n?n.split(\" \"):[n];r<4;r++)a[e+de[r]+t]=o[r]||o[r-2]||o[0];return a}},\"margin\"!==e&&(k.cssHooks[e+t].set=ot)})),k.fn.extend({css:function(e,t){return K(this,(function(e,t,n){var r,a,o={},i=0;if(Array.isArray(t)){for(r=Ge(e),a=t.length;i<a;i++)o[t[i]]=k.css(e,t[i],!1,r);return o}return void 0!==n?k.style(e,t,n):k.css(e,t)}),e,t,arguments.length>1)}}),k.Tween=ct,ct.prototype={constructor:ct,init:function(e,t,n,r,a,o){this.elem=e,this.prop=n,this.easing=a||k.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(k.cssNumber[n]?\"\":\"px\")},cur:function(){var e=ct.propHooks[this.prop];return e&&e.get?e.get(this):ct.propHooks._default.get(this)},run:function(e){var t,n=ct.propHooks[this.prop];return this.options.duration?this.pos=t=k.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):ct.propHooks._default.set(this),this}},ct.prototype.init.prototype=ct.prototype,ct.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=k.css(e.elem,e.prop,\"\"))&&\"auto\"!==t?t:0},set:function(e){k.fx.step[e.prop]?k.fx.step[e.prop](e):1!==e.elem.nodeType||!k.cssHooks[e.prop]&&null==e.elem.style[tt(e.prop)]?e.elem[e.prop]=e.now:k.style(e.elem,e.prop,e.now+e.unit)}}},ct.propHooks.scrollTop=ct.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},k.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:\"swing\"},k.fx=ct.prototype.init,k.fx.step={};var lt,ut,dt=/^(?:toggle|show|hide)$/,pt=/queueHooks$/;function ht(){ut&&(!1===m.hidden&&e.requestAnimationFrame?e.requestAnimationFrame(ht):e.setTimeout(ht,k.fx.interval),k.fx.tick())}function ft(){return e.setTimeout((function(){lt=void 0})),lt=Date.now()}function gt(e,t){var n,r=0,a={height:e};for(t=t?1:0;r<4;r+=2-t)a[\"margin\"+(n=de[r])]=a[\"padding\"+n]=e;return t&&(a.opacity=a.width=e),a}function mt(e,t,n){for(var r,a=(yt.tweeners[t]||[]).concat(yt.tweeners[\"*\"]),o=0,i=a.length;o<i;o++)if(r=a[o].call(n,t,e))return r}function yt(e,t,n){var r,a,o=0,i=yt.prefilters.length,s=k.Deferred().always((function(){delete c.elem})),c=function(){if(a)return!1;for(var t=lt||ft(),n=Math.max(0,l.startTime+l.duration-t),r=1-(n/l.duration||0),o=0,i=l.tweens.length;o<i;o++)l.tweens[o].run(r);return s.notifyWith(e,[l,r,n]),r<1&&i?n:(i||s.notifyWith(e,[l,1,0]),s.resolveWith(e,[l]),!1)},l=s.promise({elem:e,props:k.extend({},t),opts:k.extend(!0,{specialEasing:{},easing:k.easing._default},n),originalProperties:t,originalOptions:n,startTime:lt||ft(),duration:n.duration,tweens:[],createTween:function(t,n){var r=k.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},stop:function(t){var n=0,r=t?l.tweens.length:0;if(a)return this;for(a=!0;n<r;n++)l.tweens[n].run(1);return t?(s.notifyWith(e,[l,1,0]),s.resolveWith(e,[l,t])):s.rejectWith(e,[l,t]),this}}),u=l.props;for(function(e,t){var n,r,a,o,i;for(n in e)if(a=t[r=te(n)],o=e[n],Array.isArray(o)&&(a=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(i=k.cssHooks[r])&&\"expand\"in i)for(n in o=i.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=a);else t[r]=a}(u,l.opts.specialEasing);o<i;o++)if(r=yt.prefilters[o].call(l,e,u,l.opts))return f(r.stop)&&(k._queueHooks(l.elem,l.opts.queue).stop=r.stop.bind(r)),r;return k.map(u,mt,l),f(l.opts.start)&&l.opts.start.call(e,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),k.fx.timer(k.extend(c,{elem:e,anim:l,queue:l.opts.queue})),l}k.Animation=k.extend(yt,{tweeners:{\"*\":[function(e,t){var n=this.createTween(e,t);return me(n.elem,e,ue.exec(t),n),n}]},tweener:function(e,t){f(e)?(t=e,e=[\"*\"]):e=e.match(B);for(var n,r=0,a=e.length;r<a;r++)n=e[r],yt.tweeners[n]=yt.tweeners[n]||[],yt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,a,o,i,s,c,l,u,d=\"width\"in t||\"height\"in t,p=this,h={},f=e.style,g=e.nodeType&&ge(e),m=ae.get(e,\"fxshow\");for(r in n.queue||(null==(i=k._queueHooks(e,\"fx\")).unqueued&&(i.unqueued=0,s=i.empty.fire,i.empty.fire=function(){i.unqueued||s()}),i.unqueued++,p.always((function(){p.always((function(){i.unqueued--,k.queue(e,\"fx\").length||i.empty.fire()}))}))),t)if(a=t[r],dt.test(a)){if(delete t[r],o=o||\"toggle\"===a,a===(g?\"hide\":\"show\")){if(\"show\"!==a||!m||void 0===m[r])continue;g=!0}h[r]=m&&m[r]||k.style(e,r)}if((c=!k.isEmptyObject(t))||!k.isEmptyObject(h))for(r in d&&1===e.nodeType&&(n.overflow=[f.overflow,f.overflowX,f.overflowY],null==(l=m&&m.display)&&(l=ae.get(e,\"display\")),\"none\"===(u=k.css(e,\"display\"))&&(l?u=l:(ve([e],!0),l=e.style.display||l,u=k.css(e,\"display\"),ve([e]))),(\"inline\"===u||\"inline-block\"===u&&null!=l)&&\"none\"===k.css(e,\"float\")&&(c||(p.done((function(){f.display=l})),null==l&&(u=f.display,l=\"none\"===u?\"\":u)),f.display=\"inline-block\")),n.overflow&&(f.overflow=\"hidden\",p.always((function(){f.overflow=n.overflow[0],f.overflowX=n.overflow[1],f.overflowY=n.overflow[2]}))),c=!1,h)c||(m?\"hidden\"in m&&(g=m.hidden):m=ae.access(e,\"fxshow\",{display:l}),o&&(m.hidden=!g),g&&ve([e],!0),p.done((function(){for(r in g||ve([e]),ae.remove(e,\"fxshow\"),h)k.style(e,r,h[r])}))),c=mt(g?m[r]:0,r,p),r in m||(m[r]=c.start,g&&(c.end=c.start,c.start=0))}],prefilter:function(e,t){t?yt.prefilters.unshift(e):yt.prefilters.push(e)}}),k.speed=function(e,t,n){var r=e&&\"object\"==typeof e?k.extend({},e):{complete:n||!n&&t||f(e)&&e,duration:e,easing:n&&t||t&&!f(t)&&t};return k.fx.off?r.duration=0:\"number\"!=typeof r.duration&&(r.duration in k.fx.speeds?r.duration=k.fx.speeds[r.duration]:r.duration=k.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue=\"fx\"),r.old=r.complete,r.complete=function(){f(r.old)&&r.old.call(this),r.queue&&k.dequeue(this,r.queue)},r},k.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ge).css(\"opacity\",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var a=k.isEmptyObject(e),o=k.speed(t,n,r),i=function(){var t=yt(this,k.extend({},e),o);(a||ae.get(this,\"finish\"))&&t.stop(!0)};return i.finish=i,a||!1===o.queue?this.each(i):this.queue(o.queue,i)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return\"string\"!=typeof e&&(n=t,t=e,e=void 0),t&&this.queue(e||\"fx\",[]),this.each((function(){var t=!0,a=null!=e&&e+\"queueHooks\",o=k.timers,i=ae.get(this);if(a)i[a]&&i[a].stop&&r(i[a]);else for(a in i)i[a]&&i[a].stop&&pt.test(a)&&r(i[a]);for(a=o.length;a--;)o[a].elem!==this||null!=e&&o[a].queue!==e||(o[a].anim.stop(n),t=!1,o.splice(a,1));!t&&n||k.dequeue(this,e)}))},finish:function(e){return!1!==e&&(e=e||\"fx\"),this.each((function(){var t,n=ae.get(this),r=n[e+\"queue\"],a=n[e+\"queueHooks\"],o=k.timers,i=r?r.length:0;for(n.finish=!0,k.queue(this,e,[]),a&&a.stop&&a.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;t<i;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish}))}}),k.each([\"toggle\",\"show\",\"hide\"],(function(e,t){var n=k.fn[t];k.fn[t]=function(e,r,a){return null==e||\"boolean\"==typeof e?n.apply(this,arguments):this.animate(gt(t,!0),e,r,a)}})),k.each({slideDown:gt(\"show\"),slideUp:gt(\"hide\"),slideToggle:gt(\"toggle\"),fadeIn:{opacity:\"show\"},fadeOut:{opacity:\"hide\"},fadeToggle:{opacity:\"toggle\"}},(function(e,t){k.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}})),k.timers=[],k.fx.tick=function(){var e,t=0,n=k.timers;for(lt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||k.fx.stop(),lt=void 0},k.fx.timer=function(e){k.timers.push(e),k.fx.start()},k.fx.interval=13,k.fx.start=function(){ut||(ut=!0,ht())},k.fx.stop=function(){ut=null},k.fx.speeds={slow:600,fast:200,_default:400},k.fn.delay=function(t,n){return t=k.fx&&k.fx.speeds[t]||t,n=n||\"fx\",this.queue(n,(function(n,r){var a=e.setTimeout(n,t);r.stop=function(){e.clearTimeout(a)}}))},function(){var e=m.createElement(\"input\"),t=m.createElement(\"select\").appendChild(m.createElement(\"option\"));e.type=\"checkbox\",h.checkOn=\"\"!==e.value,h.optSelected=t.selected,(e=m.createElement(\"input\")).value=\"t\",e.type=\"radio\",h.radioValue=\"t\"===e.value}();var bt,vt=k.expr.attrHandle;k.fn.extend({attr:function(e,t){return K(this,k.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each((function(){k.removeAttr(this,e)}))}}),k.extend({attr:function(e,t,n){var r,a,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===e.getAttribute?k.prop(e,t,n):(1===o&&k.isXMLDoc(e)||(a=k.attrHooks[t.toLowerCase()]||(k.expr.match.bool.test(t)?bt:void 0)),void 0!==n?null===n?void k.removeAttr(e,t):a&&\"set\"in a&&void 0!==(r=a.set(e,n,t))?r:(e.setAttribute(t,n+\"\"),n):a&&\"get\"in a&&null!==(r=a.get(e,t))?r:(r=k.find.attr(e,t))??void 0)},attrHooks:{type:{set:function(e,t){if(!h.radioValue&&\"radio\"===t&&S(e,\"input\")){var n=e.value;return e.setAttribute(\"type\",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,a=t&&t.match(B);if(a&&1===e.nodeType)for(;n=a[r++];)e.removeAttribute(n)}}),bt={set:function(e,t,n){return!1===t?k.removeAttr(e,n):e.setAttribute(n,n),n}},k.each(k.expr.match.bool.source.match(/\\w+/g),(function(e,t){var n=vt[t]||k.find.attr;vt[t]=function(e,t,r){var a,o,i=t.toLowerCase();return r||(o=vt[i],vt[i]=a,a=null!=n(e,t,r)?i:null,vt[i]=o),a}}));var wt=/^(?:input|select|textarea|button)$/i,$t=/^(?:a|area)$/i;function kt(e){return(e.match(B)||[]).join(\" \")}function xt(e){return e.getAttribute&&e.getAttribute(\"class\")||\"\"}function St(e){return Array.isArray(e)?e:\"string\"==typeof e&&e.match(B)||[]}k.fn.extend({prop:function(e,t){return K(this,k.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each((function(){delete this[k.propFix[e]||e]}))}}),k.extend({prop:function(e,t,n){var r,a,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&k.isXMLDoc(e)||(t=k.propFix[t]||t,a=k.propHooks[t]),void 0!==n?a&&\"set\"in a&&void 0!==(r=a.set(e,n,t))?r:e[t]=n:a&&\"get\"in a&&null!==(r=a.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=k.find.attr(e,\"tabindex\");return t?parseInt(t,10):wt.test(e.nodeName)||$t.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:\"htmlFor\",class:\"className\"}}),h.optSelected||(k.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),k.each([\"tabIndex\",\"readOnly\",\"maxLength\",\"cellSpacing\",\"cellPadding\",\"rowSpan\",\"colSpan\",\"useMap\",\"frameBorder\",\"contentEditable\"],(function(){k.propFix[this.toLowerCase()]=this})),k.fn.extend({addClass:function(e){var t,n,r,a,o,i;return f(e)?this.each((function(t){k(this).addClass(e.call(this,t,xt(this)))})):(t=St(e)).length?this.each((function(){if(r=xt(this),n=1===this.nodeType&&\" \"+kt(r)+\" \"){for(o=0;o<t.length;o++)a=t[o],n.indexOf(\" \"+a+\" \")<0&&(n+=a+\" \");i=kt(n),r!==i&&this.setAttribute(\"class\",i)}})):this},removeClass:function(e){var t,n,r,a,o,i;return f(e)?this.each((function(t){k(this).removeClass(e.call(this,t,xt(this)))})):arguments.length?(t=St(e)).length?this.each((function(){if(r=xt(this),n=1===this.nodeType&&\" \"+kt(r)+\" \"){for(o=0;o<t.length;o++)for(a=t[o];n.indexOf(\" \"+a+\" \")>-1;)n=n.replace(\" \"+a+\" \",\" \");i=kt(n),r!==i&&this.setAttribute(\"class\",i)}})):this:this.attr(\"class\",\"\")},toggleClass:function(e,t){var n,r,a,o,i=typeof e,s=\"string\"===i||Array.isArray(e);return f(e)?this.each((function(n){k(this).toggleClass(e.call(this,n,xt(this),t),t)})):\"boolean\"==typeof t&&s?t?this.addClass(e):this.removeClass(e):(n=St(e),this.each((function(){if(s)for(o=k(this),a=0;a<n.length;a++)r=n[a],o.hasClass(r)?o.removeClass(r):o.addClass(r);else void 0!==e&&\"boolean\"!==i||((r=xt(this))&&ae.set(this,\"__className__\",r),this.setAttribute&&this.setAttribute(\"class\",r||!1===e?\"\":ae.get(this,\"__className__\")||\"\"))})))},hasClass:function(e){var t,n,r=0;for(t=\" \"+e+\" \";n=this[r++];)if(1===n.nodeType&&(\" \"+kt(xt(n))+\" \").indexOf(t)>-1)return!0;return!1}});var Tt=/\\r/g;k.fn.extend({val:function(e){var t,n,r,a=this[0];return arguments.length?(r=f(e),this.each((function(n){var a;1===this.nodeType&&(null==(a=r?e.call(this,n,k(this).val()):e)?a=\"\":\"number\"==typeof a?a+=\"\":Array.isArray(a)&&(a=k.map(a,(function(e){return null==e?\"\":e+\"\"}))),(t=k.valHooks[this.type]||k.valHooks[this.nodeName.toLowerCase()])&&\"set\"in t&&void 0!==t.set(this,a,\"value\")||(this.value=a))}))):a?(t=k.valHooks[a.type]||k.valHooks[a.nodeName.toLowerCase()])&&\"get\"in t&&void 0!==(n=t.get(a,\"value\"))?n:\"string\"==typeof(n=a.value)?n.replace(Tt,\"\"):n??\"\":void 0}}),k.extend({valHooks:{option:{get:function(e){var t=k.find.attr(e,\"value\");return null!=t?t:kt(k.text(e))}},select:{get:function(e){var t,n,r,a=e.options,o=e.selectedIndex,i=\"select-one\"===e.type,s=i?null:[],c=i?o+1:a.length;for(r=o<0?c:i?o:0;r<c;r++)if(((n=a[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!S(n.parentNode,\"optgroup\"))){if(t=k(n).val(),i)return t;s.push(t)}return s},set:function(e,t){for(var n,r,a=e.options,o=k.makeArray(t),i=a.length;i--;)((r=a[i]).selected=k.inArray(k.valHooks.option.get(r),o)>-1)&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),k.each([\"radio\",\"checkbox\"],(function(){k.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=k.inArray(k(e).val(),t)>-1}},h.checkOn||(k.valHooks[this].get=function(e){return null===e.getAttribute(\"value\")?\"on\":e.value})}));var Ct=e.location,Nt={guid:Date.now()},jt=/\\?/;k.parseXML=function(t){var n,r;if(!t||\"string\"!=typeof t)return null;try{n=(new e.DOMParser).parseFromString(t,\"text/xml\")}catch(e){}return r=n&&n.getElementsByTagName(\"parsererror\")[0],n&&!r||k.error(\"Invalid XML: \"+(r?k.map(r.childNodes,(function(e){return e.textContent})).join(\"\\n\"):t)),n};var At=/^(?:focusinfocus|focusoutblur)$/,Et=function(e){e.stopPropagation()};k.extend(k.event,{trigger:function(t,n,r,a){var o,i,s,c,l,d,p,h,y=[r||m],b=u.call(t,\"type\")?t.type:t,v=u.call(t,\"namespace\")?t.namespace.split(\".\"):[];if(i=h=s=r=r||m,3!==r.nodeType&&8!==r.nodeType&&!At.test(b+k.event.triggered)&&(b.indexOf(\".\")>-1&&(v=b.split(\".\"),b=v.shift(),v.sort()),l=b.indexOf(\":\")<0&&\"on\"+b,(t=t[k.expando]?t:new k.Event(b,\"object\"==typeof t&&t)).isTrigger=a?2:3,t.namespace=v.join(\".\"),t.rnamespace=t.namespace?new RegExp(\"(^|\\\\.)\"+v.join(\"\\\\.(?:.*\\\\.|)\")+\"(\\\\.|$)\"):null,t.result=void 0,t.target||(t.target=r),n=null==n?[t]:k.makeArray(n,[t]),p=k.event.special[b]||{},a||!p.trigger||!1!==p.trigger.apply(r,n))){if(!a&&!p.noBubble&&!g(r)){for(c=p.delegateType||b,At.test(c+b)||(i=i.parentNode);i;i=i.parentNode)y.push(i),s=i;s===(r.ownerDocument||m)&&y.push(s.defaultView||s.parentWindow||e)}for(o=0;(i=y[o++])&&!t.isPropagationStopped();)h=i,t.type=o>1?c:p.bindType||b,(d=(ae.get(i,\"events\")||Object.create(null))[t.type]&&ae.get(i,\"handle\"))&&d.apply(i,n),(d=l&&i[l])&&d.apply&&ne(i)&&(t.result=d.apply(i,n),!1===t.result&&t.preventDefault());return t.type=b,a||t.isDefaultPrevented()||p._default&&!1!==p._default.apply(y.pop(),n)||!ne(r)||l&&f(r[b])&&!g(r)&&((s=r[l])&&(r[l]=null),k.event.triggered=b,t.isPropagationStopped()&&h.addEventListener(b,Et),r[b](),t.isPropagationStopped()&&h.removeEventListener(b,Et),k.event.triggered=void 0,s&&(r[l]=s)),t.result}},simulate:function(e,t,n){var r=k.extend(new k.Event,n,{type:e,isSimulated:!0});k.event.trigger(r,null,t)}}),k.fn.extend({trigger:function(e,t){return this.each((function(){k.event.trigger(e,t,this)}))},triggerHandler:function(e,t){var n=this[0];if(n)return k.event.trigger(e,t,n,!0)}});var Ot=/\\[\\]$/,Dt=/\\r?\\n/g,It=/^(?:submit|button|image|reset|file)$/i,Mt=/^(?:input|select|textarea|keygen)/i;function Lt(e,t,n,r){var a;if(Array.isArray(t))k.each(t,(function(t,a){n||Ot.test(e)?r(e,a):Lt(e+\"[\"+(\"object\"==typeof a&&null!=a?t:\"\")+\"]\",a,n,r)}));else if(n||\"object\"!==v(t))r(e,t);else for(a in t)Lt(e+\"[\"+a+\"]\",t[a],n,r)}k.param=function(e,t){var n,r=[],a=function(e,t){var n=f(t)?t():t;r[r.length]=encodeURIComponent(e)+\"=\"+encodeURIComponent(n??\"\")};if(null==e)return\"\";if(Array.isArray(e)||e.jquery&&!k.isPlainObject(e))k.each(e,(function(){a(this.name,this.value)}));else for(n in e)Lt(n,e[n],t,a);return r.join(\"&\")},k.fn.extend({serialize:function(){return k.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var e=k.prop(this,\"elements\");return e?k.makeArray(e):this})).filter((function(){var e=this.type;return this.name&&!k(this).is(\":disabled\")&&Mt.test(this.nodeName)&&!It.test(e)&&(this.checked||!ke.test(e))})).map((function(e,t){var n=k(this).val();return null==n?null:Array.isArray(n)?k.map(n,(function(e){return{name:t.name,value:e.replace(Dt,\"\\r\\n\")}})):{name:t.name,value:n.replace(Dt,\"\\r\\n\")}})).get()}});var Rt=/%20/g,Pt=/#.*$/,Vt=/([?&])_=[^&]*/,Ft=/^(.*?):[ \\t]*([^\\r\\n]*)$/gm,Ht=/^(?:GET|HEAD)$/,qt=/^\\/\\//,zt={},Wt={},Bt=\"*/\".concat(\"*\"),Ut=m.createElement(\"a\");function _t(e){return function(t,n){\"string\"!=typeof t&&(n=t,t=\"*\");var r,a=0,o=t.toLowerCase().match(B)||[];if(f(n))for(;r=o[a++];)\"+\"===r[0]?(r=r.slice(1)||\"*\",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function Gt(e,t,n,r){var a={},o=e===Wt;function i(s){var c;return a[s]=!0,k.each(e[s]||[],(function(e,s){var l=s(t,n,r);return\"string\"!=typeof l||o||a[l]?o?!(c=l):void 0:(t.dataTypes.unshift(l),i(l),!1)})),c}return i(t.dataTypes[0])||!a[\"*\"]&&i(\"*\")}function Xt(e,t){var n,r,a=k.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((a[n]?e:r||(r={}))[n]=t[n]);return r&&k.extend(!0,e,r),e}Ut.href=Ct.href,k.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ct.href,type:\"GET\",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Ct.protocol),global:!0,processData:!0,async:!0,contentType:\"application/x-www-form-urlencoded; charset=UTF-8\",accepts:{\"*\":Bt,text:\"text/plain\",html:\"text/html\",xml:\"application/xml, text/xml\",json:\"application/json, text/javascript\"},contents:{xml:/\\bxml\\b/,html:/\\bhtml/,json:/\\bjson\\b/},responseFields:{xml:\"responseXML\",text:\"responseText\",json:\"responseJSON\"},converters:{\"* text\":String,\"text html\":!0,\"text json\":JSON.parse,\"text xml\":k.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Xt(Xt(e,k.ajaxSettings),t):Xt(k.ajaxSettings,e)},ajaxPrefilter:_t(zt),ajaxTransport:_t(Wt),ajax:function(t,n){\"object\"==typeof t&&(n=t,t=void 0),n=n||{};var r,a,o,i,s,c,l,u,d,p,h=k.ajaxSetup({},n),f=h.context||h,g=h.context&&(f.nodeType||f.jquery)?k(f):k.event,y=k.Deferred(),b=k.Callbacks(\"once memory\"),v=h.statusCode||{},w={},$={},x=\"canceled\",S={readyState:0,getResponseHeader:function(e){var t;if(l){if(!i)for(i={};t=Ft.exec(o);)i[t[1].toLowerCase()+\" \"]=(i[t[1].toLowerCase()+\" \"]||[]).concat(t[2]);t=i[e.toLowerCase()+\" \"]}return null==t?null:t.join(\", \")},getAllResponseHeaders:function(){return l?o:null},setRequestHeader:function(e,t){return null==l&&(e=$[e.toLowerCase()]=$[e.toLowerCase()]||e,w[e]=t),this},overrideMimeType:function(e){return null==l&&(h.mimeType=e),this},statusCode:function(e){var t;if(e)if(l)S.always(e[S.status]);else for(t in e)v[t]=[v[t],e[t]];return this},abort:function(e){var t=e||x;return r&&r.abort(t),T(0,t),this}};if(y.promise(S),h.url=((t||h.url||Ct.href)+\"\").replace(qt,Ct.protocol+\"//\"),h.type=n.method||n.type||h.method||h.type,h.dataTypes=(h.dataType||\"*\").toLowerCase().match(B)||[\"\"],null==h.crossDomain){c=m.createElement(\"a\");try{c.href=h.url,c.href=c.href,h.crossDomain=Ut.protocol+\"//\"+Ut.host!=c.protocol+\"//\"+c.host}catch(e){h.crossDomain=!0}}if(h.data&&h.processData&&\"string\"!=typeof h.data&&(h.data=k.param(h.data,h.traditional)),Gt(zt,h,n,S),l)return S;for(d in(u=k.event&&h.global)&&0==k.active++&&k.event.trigger(\"ajaxStart\"),h.type=h.type.toUpperCase(),h.hasContent=!Ht.test(h.type),a=h.url.replace(Pt,\"\"),h.hasContent?h.data&&h.processData&&0===(h.contentType||\"\").indexOf(\"application/x-www-form-urlencoded\")&&(h.data=h.data.replace(Rt,\"+\")):(p=h.url.slice(a.length),h.data&&(h.processData||\"string\"==typeof h.data)&&(a+=(jt.test(a)?\"&\":\"?\")+h.data,delete h.data),!1===h.cache&&(a=a.replace(Vt,\"$1\"),p=(jt.test(a)?\"&\":\"?\")+\"_=\"+Nt.guid+++p),h.url=a+p),h.ifModified&&(k.lastModified[a]&&S.setRequestHeader(\"If-Modified-Since\",k.lastModified[a]),k.etag[a]&&S.setRequestHeader(\"If-None-Match\",k.etag[a])),(h.data&&h.hasContent&&!1!==h.contentType||n.contentType)&&S.setRequestHeader(\"Content-Type\",h.contentType),S.setRequestHeader(\"Accept\",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+(\"*\"!==h.dataTypes[0]?\", \"+Bt+\"; q=0.01\":\"\"):h.accepts[\"*\"]),h.headers)S.setRequestHeader(d,h.headers[d]);if(h.beforeSend&&(!1===h.beforeSend.call(f,S,h)||l))return S.abort();if(x=\"abort\",b.add(h.complete),S.done(h.success),S.fail(h.error),r=Gt(Wt,h,n,S)){if(S.readyState=1,u&&g.trigger(\"ajaxSend\",[S,h]),l)return S;h.async&&h.timeout>0&&(s=e.setTimeout((function(){S.abort(\"timeout\")}),h.timeout));try{l=!1,r.send(w,T)}catch(e){if(l)throw e;T(-1,e)}}else T(-1,\"No Transport\");function T(t,n,i,c){var d,p,m,w,$,x=n;l||(l=!0,s&&e.clearTimeout(s),r=void 0,o=c||\"\",S.readyState=t>0?4:0,d=t>=200&&t<300||304===t,i&&(w=function(e,t,n){for(var r,a,o,i,s=e.contents,c=e.dataTypes;\"*\"===c[0];)c.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader(\"Content-Type\"));if(r)for(a in s)if(s[a]&&s[a].test(r)){c.unshift(a);break}if(c[0]in n)o=c[0];else{for(a in n){if(!c[0]||e.converters[a+\" \"+c[0]]){o=a;break}i||(i=a)}o=o||i}if(o)return o!==c[0]&&c.unshift(o),n[o]}(h,S,i)),!d&&k.inArray(\"script\",h.dataTypes)>-1&&k.inArray(\"json\",h.dataTypes)<0&&(h.converters[\"text script\"]=function(){}),w=function(e,t,n,r){var a,o,i,s,c,l={},u=e.dataTypes.slice();if(u[1])for(i in e.converters)l[i.toLowerCase()]=e.converters[i];for(o=u.shift();o;)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!c&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),c=o,o=u.shift())if(\"*\"===o)o=c;else if(\"*\"!==c&&c!==o){if(!(i=l[c+\" \"+o]||l[\"* \"+o]))for(a in l)if((s=a.split(\" \"))[1]===o&&(i=l[c+\" \"+s[0]]||l[\"* \"+s[0]])){!0===i?i=l[a]:!0!==l[a]&&(o=s[0],u.unshift(s[1]));break}if(!0!==i)if(i&&e.throws)t=i(t);else try{t=i(t)}catch(e){return{state:\"parsererror\",error:i?e:\"No conversion from \"+c+\" to \"+o}}}return{state:\"success\",data:t}}(h,w,S,d),d?(h.ifModified&&(($=S.getResponseHeader(\"Last-Modified\"))&&(k.lastModified[a]=$),($=S.getResponseHeader(\"etag\"))&&(k.etag[a]=$)),204===t||\"HEAD\"===h.type?x=\"nocontent\":304===t?x=\"notmodified\":(x=w.state,p=w.data,d=!(m=w.error))):(m=x,!t&&x||(x=\"error\",t<0&&(t=0))),S.status=t,S.statusText=(n||x)+\"\",d?y.resolveWith(f,[p,x,S]):y.rejectWith(f,[S,x,m]),S.statusCode(v),v=void 0,u&&g.trigger(d?\"ajaxSuccess\":\"ajaxError\",[S,h,d?p:m]),b.fireWith(f,[S,x]),u&&(g.trigger(\"ajaxComplete\",[S,h]),--k.active||k.event.trigger(\"ajaxStop\")))}return S},getJSON:function(e,t,n){return k.get(e,t,n,\"json\")},getScript:function(e,t){return k.get(e,void 0,t,\"script\")}}),k.each([\"get\",\"post\"],(function(e,t){k[t]=function(e,n,r,a){return f(n)&&(a=a||r,r=n,n=void 0),k.ajax(k.extend({url:e,type:t,dataType:a,data:n,success:r},k.isPlainObject(e)&&e))}})),k.ajaxPrefilter((function(e){var t;for(t in e.headers)\"content-type\"===t.toLowerCase()&&(e.contentType=e.headers[t]||\"\")})),k._evalUrl=function(e,t,n){return k.ajax({url:e,type:\"GET\",dataType:\"script\",cache:!0,async:!1,global:!1,converters:{\"text script\":function(){}},dataFilter:function(e){k.globalEval(e,t,n)}})},k.fn.extend({wrapAll:function(e){var t;return this[0]&&(f(e)&&(e=e.call(this[0])),t=k(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map((function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e})).append(this)),this},wrapInner:function(e){return f(e)?this.each((function(t){k(this).wrapInner(e.call(this,t))})):this.each((function(){var t=k(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)}))},wrap:function(e){var t=f(e);return this.each((function(n){k(this).wrapAll(t?e.call(this,n):e)}))},unwrap:function(e){return this.parent(e).not(\"body\").each((function(){k(this).replaceWith(this.childNodes)})),this}}),k.expr.pseudos.hidden=function(e){return!k.expr.pseudos.visible(e)},k.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},k.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(e){}};var Yt={0:200,1223:204},Jt=k.ajaxSettings.xhr();h.cors=!!Jt&&\"withCredentials\"in Jt,h.ajax=Jt=!!Jt,k.ajaxTransport((function(t){var n,r;if(h.cors||Jt&&!t.crossDomain)return{send:function(a,o){var i,s=t.xhr();if(s.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(i in t.xhrFields)s[i]=t.xhrFields[i];for(i in t.mimeType&&s.overrideMimeType&&s.overrideMimeType(t.mimeType),t.crossDomain||a[\"X-Requested-With\"]||(a[\"X-Requested-With\"]=\"XMLHttpRequest\"),a)s.setRequestHeader(i,a[i]);n=function(e){return function(){n&&(n=r=s.onload=s.onerror=s.onabort=s.ontimeout=s.onreadystatechange=null,\"abort\"===e?s.abort():\"error\"===e?\"number\"!=typeof s.status?o(0,\"error\"):o(s.status,s.statusText):o(Yt[s.status]||s.status,s.statusText,\"text\"!==(s.responseType||\"text\")||\"string\"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=n(),r=s.onerror=s.ontimeout=n(\"error\"),void 0!==s.onabort?s.onabort=r:s.onreadystatechange=function(){4===s.readyState&&e.setTimeout((function(){n&&r()}))},n=n(\"abort\");try{s.send(t.hasContent&&t.data||null)}catch(e){if(n)throw e}},abort:function(){n&&n()}}})),k.ajaxPrefilter((function(e){e.crossDomain&&(e.contents.script=!1)})),k.ajaxSetup({accepts:{script:\"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript\"},contents:{script:/\\b(?:java|ecma)script\\b/},converters:{\"text script\":function(e){return k.globalEval(e),e}}}),k.ajaxPrefilter(\"script\",(function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type=\"GET\")})),k.ajaxTransport(\"script\",(function(e){var t,n;if(e.crossDomain||e.scriptAttrs)return{send:function(r,a){t=k(\"<script>\").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on(\"load error\",n=function(e){t.remove(),n=null,e&&a(\"error\"===e.type?404:200,e.type)}),m.head.appendChild(t[0])},abort:function(){n&&n()}}}));var Kt,Qt=[],Zt=/(=)\\?(?=&|$)|\\?\\?/;k.ajaxSetup({jsonp:\"callback\",jsonpCallback:function(){var e=Qt.pop()||k.expando+\"_\"+Nt.guid++;return this[e]=!0,e}}),k.ajaxPrefilter(\"json jsonp\",(function(t,n,r){var a,o,i,s=!1!==t.jsonp&&(Zt.test(t.url)?\"url\":\"string\"==typeof t.data&&0===(t.contentType||\"\").indexOf(\"application/x-www-form-urlencoded\")&&Zt.test(t.data)&&\"data\");if(s||\"jsonp\"===t.dataTypes[0])return a=t.jsonpCallback=f(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s?t[s]=t[s].replace(Zt,\"$1\"+a):!1!==t.jsonp&&(t.url+=(jt.test(t.url)?\"&\":\"?\")+t.jsonp+\"=\"+a),t.converters[\"script json\"]=function(){return i||k.error(a+\" was not called\"),i[0]},t.dataTypes[0]=\"json\",o=e[a],e[a]=function(){i=arguments},r.always((function(){void 0===o?k(e).removeProp(a):e[a]=o,t[a]&&(t.jsonpCallback=n.jsonpCallback,Qt.push(a)),i&&f(o)&&o(i[0]),i=o=void 0})),\"script\"})),h.createHTMLDocument=((Kt=m.implementation.createHTMLDocument(\"\").body).innerHTML=\"<form></form><form></form>\",2===Kt.childNodes.length),k.parseHTML=function(e,t,n){return\"string\"!=typeof e?[]:(\"boolean\"==typeof t&&(n=t,t=!1),t||(h.createHTMLDocument?((r=(t=m.implementation.createHTMLDocument(\"\")).createElement(\"base\")).href=m.location.href,t.head.appendChild(r)):t=m),o=!n&&[],(a=P.exec(e))?[t.createElement(a[1])]:(a=Ae([e],t,o),o&&o.length&&k(o).remove(),k.merge([],a.childNodes)));var r,a,o},k.fn.load=function(e,t,n){var r,a,o,i=this,s=e.indexOf(\" \");return s>-1&&(r=kt(e.slice(s)),e=e.slice(0,s)),f(t)?(n=t,t=void 0):t&&\"object\"==typeof t&&(a=\"POST\"),i.length>0&&k.ajax({url:e,type:a||\"GET\",dataType:\"html\",data:t}).done((function(e){o=arguments,i.html(r?k(\"<div>\").append(k.parseHTML(e)).find(r):e)})).always(n&&function(e,t){i.each((function(){n.apply(this,o||[e.responseText,t,e])}))}),this},k.expr.pseudos.animated=function(e){return k.grep(k.timers,(function(t){return e===t.elem})).length},k.offset={setOffset:function(e,t,n){var r,a,o,i,s,c,l=k.css(e,\"position\"),u=k(e),d={};\"static\"===l&&(e.style.position=\"relative\"),s=u.offset(),o=k.css(e,\"top\"),c=k.css(e,\"left\"),(\"absolute\"===l||\"fixed\"===l)&&(o+c).indexOf(\"auto\")>-1?(i=(r=u.position()).top,a=r.left):(i=parseFloat(o)||0,a=parseFloat(c)||0),f(t)&&(t=t.call(e,n,k.extend({},s))),null!=t.top&&(d.top=t.top-s.top+i),null!=t.left&&(d.left=t.left-s.left+a),\"using\"in t?t.using.call(e,d):u.css(d)}},k.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each((function(t){k.offset.setOffset(this,e,t)}));var t,n,r=this[0];return r?r.getClientRects().length?(t=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:t.top+n.pageYOffset,left:t.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],a={top:0,left:0};if(\"fixed\"===k.css(r,\"position\"))t=r.getBoundingClientRect();else{for(t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&\"static\"===k.css(e,\"position\");)e=e.parentNode;e&&e!==r&&1===e.nodeType&&((a=k(e).offset()).top+=k.css(e,\"borderTopWidth\",!0),a.left+=k.css(e,\"borderLeftWidth\",!0))}return{top:t.top-a.top-k.css(r,\"marginTop\",!0),left:t.left-a.left-k.css(r,\"marginLeft\",!0)}}},offsetParent:function(){return this.map((function(){for(var e=this.offsetParent;e&&\"static\"===k.css(e,\"position\");)e=e.offsetParent;return e||pe}))}}),k.each({scrollLeft:\"pageXOffset\",scrollTop:\"pageYOffset\"},(function(e,t){var n=\"pageYOffset\"===t;k.fn[e]=function(r){return K(this,(function(e,r,a){var o;if(g(e)?o=e:9===e.nodeType&&(o=e.defaultView),void 0===a)return o?o[t]:e[r];o?o.scrollTo(n?o.pageXOffset:a,n?a:o.pageYOffset):e[r]=a}),e,r,arguments.length)}})),k.each([\"top\",\"left\"],(function(e,t){k.cssHooks[t]=Ke(h.pixelPosition,(function(e,n){if(n)return n=Je(e,t),Ue.test(n)?k(e).position()[t]+\"px\":n}))})),k.each({Height:\"height\",Width:\"width\"},(function(e,t){k.each({padding:\"inner\"+e,content:t,\"\":\"outer\"+e},(function(n,r){k.fn[r]=function(a,o){var i=arguments.length&&(n||\"boolean\"!=typeof a),s=n||(!0===a||!0===o?\"margin\":\"border\");return K(this,(function(t,n,a){var o;return g(t)?0===r.indexOf(\"outer\")?t[\"inner\"+e]:t.document.documentElement[\"client\"+e]:9===t.nodeType?(o=t.documentElement,Math.max(t.body[\"scroll\"+e],o[\"scroll\"+e],t.body[\"offset\"+e],o[\"offset\"+e],o[\"client\"+e])):void 0===a?k.css(t,n,s):k.style(t,n,a,s)}),t,i?a:void 0,i)}}))})),k.each([\"ajaxStart\",\"ajaxStop\",\"ajaxComplete\",\"ajaxError\",\"ajaxSuccess\",\"ajaxSend\"],(function(e,t){k.fn[t]=function(e){return this.on(t,e)}})),k.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,\"**\"):this.off(t,e||\"**\",n)},hover:function(e,t){return this.on(\"mouseenter\",e).on(\"mouseleave\",t||e)}}),k.each(\"blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu\".split(\" \"),(function(e,t){k.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}));var en=/^[\\s\\uFEFF\\xA0]+|([^\\s\\uFEFF\\xA0])[\\s\\uFEFF\\xA0]+$/g;k.proxy=function(e,t){var n,r,o;if(\"string\"==typeof t&&(n=e[t],t=e,e=n),f(e))return r=a.call(arguments,2),o=function(){return e.apply(t||this,r.concat(a.call(arguments)))},o.guid=e.guid=e.guid||k.guid++,o},k.holdReady=function(e){e?k.readyWait++:k.ready(!0)},k.isArray=Array.isArray,k.parseJSON=JSON.parse,k.nodeName=S,k.isFunction=f,k.isWindow=g,k.camelCase=te,k.type=v,k.now=Date.now,k.isNumeric=function(e){var t=k.type(e);return(\"number\"===t||\"string\"===t)&&!isNaN(e-parseFloat(e))},k.trim=function(e){return null==e?\"\":(e+\"\").replace(en,\"$1\")};var tn=e.jQuery,nn=e.$;return k.noConflict=function(t){return e.$===k&&(e.$=nn),t&&e.jQuery===k&&(e.jQuery=tn),k},void 0===t&&(e.jQuery=e.$=k),k}));var a=t(r.exports);const{fromCharCode:o}=String,i=\"audio,blockquote,canvas,div,h1,h2,h3,h4,h5,hr,ol,p,pre,table,ul,video,tw-align,tw-story,tw-passage,tw-sidebar,tw-columns,tw-column,tw-meter\".split(\",\"),s=\"a,b,i,em,strong,sup,sub,abbr,acronym,s,strike,del,big,small,script,img,button,input,tw-link,tw-broken-link,tw-verbatim,tw-collapsed,tw-error,tw-colour,tw-icon\".split(\",\"),c=[\"audio\"],[l,u,d]=[e=>o(e)!==o(e).toLowerCase(),e=>o(e)!==o(e).toUpperCase(),e=>o(e).toLowerCase()!==o(e).toUpperCase()].map((e=>`[${Array.from(Array(57343)).map(((e,t)=>t)).filter(e).map(((e,t,n)=>e===n[t-1]+1&&e===n[t+1]-1?\"-\":o(e))).join(\"\").replace(/-+/g,\"-\")}]`));function p(e){return\"instant\"===e?0:800}let h,f,g={speedMultiplier:1},m=[],y={},b=0,v={},w=0,k={x:0,y:0};function x(e,t,n,r,a){let o=0,i=0,s=t+n;function c(n=0){let l;1&e[0].compareDocumentPosition(document)&&(s=0),o&&(l=n-o,s-=l),o=n,r>0&&b+w>0&&e.data(\"expediteAnim\")(r),s<=t&&(i+=l||0,\"paused\"===e.css(\"animation-play-state\")&&e.css({visibility:\"\",\"animation-play-state\":\"running\"})),s<=0?(e.removeData(\"expediteAnim\"),a()):requestAnimationFrame(c)}e.data(\"expediteAnim\",(t=>{var n;void 0===t&&(t=i),s-=t,\"running\"===e.css(\"animation-play-state\")&&e.css(\"animation-delay\",(((n=(n=e.css(\"animation-delay\")).toLowerCase()).endsWith(\"ms\")?+n.slice(0,-2)||0:n.endsWith(\"s\")&&1e3*+n.slice(0,-1)||0)||0)-t+\"ms\")})),s?requestAnimationFrame(c):c()}const S=/-|_/g,T=e=>{let t=9;for(let n=e.length;n>0;)n-=1,t=Math.imul(t^e.charCodeAt(n),9**9);return(t^t>>>9)>>>0},C=(...e)=>{const{length:t}=e,n=[[...e]],r=Array(t).fill(0);let a,o,i=1;for(;i<t;)r[i]<i?(a=i%2&&r[i],o=e[i],e[i]=e[a],e[a]=o,++r[i],i=1,n.push([...e])):(r[i]=0,++i);return n},N=e=>{const t=\"\"+ +e;return e+(!t.endsWith(\"1\")||1!==t.length&&\"1\"===t[t.length-2]?!t.endsWith(\"2\")||1!==t.length&&\"1\"===t[t.length-2]?!t.endsWith(\"3\")||1!==t.length&&\"1\"===t[t.length-2]?\"th\":\"rd\":\"nd\":\"st\")},j=(e,t,n=\"\")=>`${e} ${1!==Math.abs(e)?n||`${t}s`:t}`,A=e=>e.length<=1?e[0]:`${e.slice(0,-1).join(\", \")} and ${e.at(-1)}`,E=\"[ \\\\n\\\\r\\\\f\\\\t\\\\v\\\\u00a0\\\\u2000-\\\\u200a\\\\u2028\\\\u2029\\\\u202f\\\\u205f\\\\u3000]\",O=\"[\\\\dA-Za-z\\\\u00c0-\\\\u00de\\\\u00df-\\\\u00ff\\\\u0150\\\\u0170\\\\u0151\\\\u0171\\\\uD800-\\\\uDFFF]\",D=e=>e.replace(/[&><\"']/g,(e=>({\"&\":\"&amp;\",\">\":\"&gt;\",\"<\":\"&lt;\",'\"':\"&quot;\",\"'\":\"&#39;\"}[e]||\"\"))),I=e=>`${e}`.toLowerCase().replace(S,\"\"),M=e=>{const t={colour:null,backgroundColour:null},n=/^\\w+a\\(.+?,\\s*0\\s*\\)$|^transparent$/;for(;e.length&&e[0]!==document;e=e.parent()){if(!t.backgroundColour){const r=e.css(\"background-color\");r.match(n)||(t.backgroundColour=r)}if(!t.colour){const r=e.css(\"color\");r.match(n)||(t.colour=r)}if(t.colour&&t.backgroundColour)return t}return{colour:\"#fff\",backgroundColour:\"#000\"}},L=e=>{const t=[];for(const n of e.findAndFilter(\"*\"))if(!(n.hidden||/none|inline/.test(n.style.display)||/display: (none|inline)/.test(n.getAttribute(\"style\")||\"\"))){if(i.includes(n.tagName.toLowerCase())||/display: (?!none|inline|inherit|unset)/.test(n.getAttribute(\"style\")||\"\"))return!1;s.includes(n.tagName.toLowerCase())||t.push(n)}return t.every((e=>/inline|none/.test(window.getComputedStyle(e).display)))},R=(e,t,n,r=0,o=0,i=0,s)=>{if(0===e.length)return;n||=p(t);const l=e.length>1||!L(e)||![\"tw-hook\",\"tw-passage\",\"tw-sidebar\",\"tw-expression\"].includes(e.tag());l&&(e=e.wrapAll(\"<tw-transition-container>\").parent()),s&&(\"string\"==typeof s||s instanceof Function?e.css(\"transform-origin\",s):e.css(s)),e.attr(\"data-t8n\",t).addClass(\"transition-in\").css({\"animation-duration\":`${n}ms`,\"animation-delay\":-i+\"ms\",...r-i?{visibility:\"hidden\",\"animation-play-state\":\"paused\"}:{}}),requestAnimationFrame((()=>{L(e)?e.css(\"display\",\"inline\"):e.parent().is(\"tw-backdrop,tw-story\")||e[0].setAttribute(\"style\",`${e[0].getAttribute(\"style\")}display:block !important;width:100%`)})),x(e,n,r-i,o,(()=>{const t=0===e.filter(c.join(\",\")).length;if(l&&t){e.find(\"tw-transition-container, .transition-in, .transition-out\").each(((e,t)=>{(a(t).data(\"expediteAnim\")||Object)()}));const t=[],n=e.find(\"*\");for(let e=0;e<n.length;e+=1){const r=n[e];0===r.scrollTop&&0===r.scrollLeft||t.push([r,r.scrollLeft,r.scrollTop])}const r=document.activeElement&&e.find(document.activeElement);e.contents().unwrap();for(let[e,n,r]of t)e.scrollLeft=n,e.scrollTop=r;r?.length&&r[0].focus()}else e.removeClass(\"transition-in\").removeAttr(\"data-t8n\")}))},P=(e,{batch:t=!1,recur:n=!1,maxWait:r=1/0}={})=>{let a,o=[],i=0,s=0,c=!1;const l=()=>{Date.now()-i>300||s>=r?(a=0,s=0,c=!n,t?(e(o),o=[]):e(...o),c=!1):a=requestAnimationFrame(l)};return(...e)=>{if(c)return;const n=Date.now();s+=n-i,i=n,t?o.push(e):o=e,a&&cancelAnimationFrame(a),a=requestAnimationFrame(l)}},V=e=>{m?m.push(e):e()},F=()=>{document.documentElement.contains(h[0])||(f||a(document.body)).append(h.parents().length?h.parents().last():h)};function H(e,t){if(!e){const e=Error(`Assertion failed: ${t}`);throw console.error(e),e}}a(document.documentElement).on(\"keydown keyup mousedown mouseup\",(({key:e,button:t,type:n})=>{const r=n.includes(\"down\"),a=e?y:v,o=e&&I(e)||`${t}`||\"\";a[o]&&!r?e?b=Math.max(b-1,0):w=Math.max(w-1,0):!a[o]&&r&&(e?b+=1:w+=1),a[o]=r})).on(\"mousemove\",(({pageX:e,pageY:t})=>{k.x=e,k.y=t})),a((()=>{h=a(\"tw-story\"),m?.forEach((e=>e())),m=null}));const q=class extends Error{},{isNaN:z}=Number;\n/*!\n* Natural Sort algorithm for Javascript - Version 0.7 - Released under MIT license\n* Author: Jim Palmer (based on chunking idea from Dave Koelle)\n* http://www.overset.com/2008/09/01/javascript-natural-sort-algorithm-with-unicode-support/\n* Expanded by Leon Arnott to use Intl.Collator, 2015.\n* Expanded by Leon Arnott to take a string-obtaining helper function, 2019.\n*/var W=(e,t=String)=>function(n,r){let a,o,i,s,c=/(^-?[0-9]+(\\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,l=/(^([\\w ]+,?[\\w ]+)?[\\w ]+,?[\\w ]+\\d+:\\d+(:\\d+)?[\\w ]?|^\\d{1,4}[/-]\\d{1,4}[/-]\\d{1,4}|^\\w+, \\w+ \\d+, \\d{4})/,u=/^0x[0-9a-f]+$/i,d=/^0/,p=t(n).trim(),h=t(r).trim(),f=p.replace(c,\"\\0$1\\0\").replace(/\\0$/,\"\").replace(/^\\0/,\"\").split(\"\\0\"),g=h.replace(c,\"\\0$1\\0\").replace(/\\0$/,\"\").replace(/^\\0/,\"\").split(\"\\0\"),m=parseInt(`${p.match(u)}`)||1!==f.length&&p.match(l)&&Date.parse(p),y=parseInt(`${h.match(u)}`)||m&&h.match(l)&&Date.parse(h)||null;if(e&&window.Intl?.Collator&&(i=window.Intl.Collator(e)),y&&null!==y){if(Number(m)<+y)return-1;if(Number(m)>+y)return 1}for(let e=0,t=Math.max(f.length,g.length);e<t;e++){if(a=!(f[e]||\"\").match(d)&&parseFloat(f[e])||f[e]||0,o=!(g[e]||\"\").match(d)&&parseFloat(g[e])||g[e]||0,z(a)!==z(o))return z(a)?1:-1;if(typeof a!=typeof o)a+=\"\",o+=\"\";else if(\"string\"==typeof a&&i&&(s=i.compare(a,o),0!==s))return s;if(a<o)return-1;if(a>o)return 1}return 0};function B(e){return e&&\"object\"==typeof e?(Object.keys(e).forEach((t=>{e[t]=B(e[t])})),e):`${e}`.replace(/[-[\\]/{}()*+?.\\\\^$|]/g,\"\\\\$&\")}function U(e){return(...t)=>`(${e}${t.join(\"|\")})`}const _=U(\"?:\"),G=U(\"?!\"),X=U(\"?=\"),Y=\"[ \\\\f\\\\t\\\\v\\\\u00a0\\\\u2000-\\\\u200a\\\\u2028\\\\u2029\\\\u202f\\\\u205f\\\\u3000]*\",J=Y.replace(\"*\",\"+\"),K=\"\\\\b\",Q=\"[\\\\w\\\\-\\\\u00c0-\\\\u00de\\\\u00df-\\\\u00ff\\\\u0150\\\\u0170\\\\u0151\\\\u0171\\\\uD800-\\\\uDFFF]\",Z=Q.replace(\"\\\\-\",\"\"),ee=_(\"\\\\n\",\"$\"),te=`${Y}(\\\\*+)${J}`,ne=`${Y}((?:0\\\\.)+)${J}`,re=`${Y}-{3,}${Y}${ee}`,ae=`${Y}(#{1,6})${Y}`,oe=`${Y}(==+>|<=+|=+><=+|<==+>)${Y}${ee}`,ie=`${Y}(=+\\\\|+|\\\\|+=+|=+\\\\|+=+|\\\\|=+\\\\|)${Y}${ee}`,se={opener:\"\\\\[\\\\[(?!\\\\[)\",main:void 0,text:`(${function(...e){return`[^${e.map(B).join(\"\")}]*`}(\"]\")})`,rightSeparator:_(\"\\\\->\",\"\\\\|\"),leftSeparator:\"<\\\\-\",closer:\"\\\\]\\\\]\",legacySeparator:\"\\\\|\",legacyText:`(${_(\"[^\\\\|\\\\]]\",`\\\\]${G(\"\\\\]\")}`)}+)`},ce=`${Z}*${Z.replace(\"\\\\w\",\"a-zA-Z\")}${Z}*`,le=`\\\\$(${ce})`,ue=`_(${ce})`,de=`${Y}'s${J}${G(\"_\")}(${ce})`,pe=`(${ce})${J}of${K}${G(`it${K}`)}`,he=`'s${J}`,fe=`of${K}`,ge=_(\"it\",\"time\",\"turns?\",\"visits?\",\"exits?\",\"user\",\"pos\")+K,me=`its${J}(${ce})`,ye=`its${K}`,be=`(${ce})${J}of${J}it${K}`,ve=`of${J}it${K}`,we={opener:\"\\\\(\",name:`(${_(\"\\\\$\",\"_\")}?${Q}+):${G(\"\\\\/\")}`,closer:\"\\\\)\"},$e=_(\"=<\",\"=>\",`[gl]te?${K}`,`n?eq${K}`,`isnot${K}`,`are${K}`,`x${K}`,`isa${K}`,`or${J}a${K}`),ke=\"[a-zA-Z][\\\\w\\\\-]*\",xe=\"(?:\\\"[^\\\"]*\\\"|'[^']*'|[^'\\\">])*?\",Se=`\\\\|(${Q}+)(>|\\\\))`,Te=`(<|\\\\()(${Q}+)\\\\|`,Ce=`((?:\\\\b\\\\d+(?:\\\\.\\\\d+)?|\\\\.\\\\d+)(?:[eE][+\\\\-]?\\\\d+)?)${G(\"m?s\")}${K}`;se.main=se.opener+_(se.text+se.rightSeparator,se.text.replace(\"*\",\"*?\")+se.leftSeparator)+se.text;const Ne={upperLetter:\"[A-Z\\\\u00c0-\\\\u00de\\\\u0150\\\\u0170]\",lowerLetter:\"[a-z0-9_\\\\-\\\\u00df-\\\\u00ff\\\\u0151\\\\u0171]\",anyLetter:Q,anyLetterStrict:Z,whitespace:J.replace(\"[\",\"[\\\\n\\\\r\"),comment:\"\\\\-\\\\-\",escapedLine:\"\\\\\\\\\\\\n\\\\\\\\?|\\\\n\\\\\\\\\",br:\"\\\\n(?!\\\\\\\\)\",tag:`<\\\\/?${ke}${xe}>`,scriptStyleTag:`<(${_(\"script\",\"style\",\"textarea\")})${xe}>[^]*?<\\\\/\\\\1>`,scriptStyleTagOpener:\"<\",url:`(${_(\"https?\",\"mailto\",\"javascript\",\"ftp\",\"data\")}:\\\\/\\\\/[^\\\\s<]+[^<.,:;\"')\\\\]\\\\s])`,bullet:\"\\\\*\",hr:re,heading:ae,align:oe,column:ie,bulleted:te,numbered:ne,verbatimOpener:\"`+\",hookAppendedFront:`\\\\[${G(\"=+\")}`,hookPrependedFront:`${Se}\\\\[${G(\"=+\")}`,hookFront:`\\\\[${G(\"=+\")}`,hookBack:`\\\\]${G(Te)}`,hookAppendedBack:`\\\\]${Te}`,unclosedHook:\"\\\\[=+\",unclosedHookPrepended:`${Se}\\\\[=+`,unclosedCollapsed:\"\\\\{=+\",passageLink:se.main+se.closer,legacyLink:se.opener+se.legacyText+se.legacySeparator+se.legacyText+se.closer,simpleLink:se.opener+se.legacyText+se.closer,macroFront:we.opener+X(we.name),macroName:we.name,groupingFront:`\\\\(${G(we.name)}`,twine1Macro:\"<<[^>\\\\s]+\\\\s*(?:\\\\\\\\.|'(?:[^'\\\\\\\\]*\\\\\\\\.)*[^'\\\\\\\\]*'|\\\"(?:[^\\\"\\\\\\\\]*\\\\\\\\.)*[^\\\"\\\\\\\\]*\\\"|[^'\\\"\\\\\\\\>]|>(?!>))*>>\",validPropertyName:ce,property:de,belongingProperty:pe,possessiveOperator:he,belongingOperator:fe,itsOperator:ye,belongingItOperator:ve,variable:le,tempVariable:ue,hookName:`\\\\?(${Q}+)\\\\b`,cssMeasure:`(\\\\-?\\\\d+\\\\.?\\\\d*|\\\\d*\\\\.?\\\\d+)(m?s|px|r?em|w|l?h)${K}`,colour:_(_(\"Red\",\"Orange\",\"Yellow\",\"Lime\",\"Green\",\"Cyan\",\"Aqua\",\"Blue\",\"Navy\",\"Purple\",\"Fuchsia\",\"Magenta\",\"White\",\"Gray\",\"Grey\",\"Black\",\"Transparent\"),\"#[\\\\dA-Fa-f]{3}(?:[\\\\dA-Fa-f]{3})?\"),datatype:_(\"alnum\",\"alphanumeric\",\"any(?:case)?\",\"array\",\"bool(?:ean)?\",\"changer\",\"codehook\",\"colou?r\",\"const\",\"command\",\"dm\",`data${_(\"map\",\"type\",\"set\")}`,\"ds\",\"digit\",\"gradient\",\"empty\",\"even\",\"image\",`int${G(\"o\")}(?:eger)?`,\"lambda\",\"lowercase\",\"macro\",\"measure\",\"linebreak\",\"newline\",\"num(?:ber)?\",\"odd\",\"str(?:ing)?\",\"uppercase\",\"whitespace\")+K,number:Ce,boolean:_(\"true\",\"false\")+K,identifier:ge,itsProperty:me,belongingItProperty:be,escapedStringChar:\"\\\\\\\\[^\\\\n]\",singleStringOpener:\"'\",doubleStringOpener:'\"',singleStringCloser:\"'\",doubleStringCloser:'\"',is:`is${G(`${J}not${K}`,`${J}an?${K}`,`${J}in${K}`,`${J}<`,`${J}>`)}${K}`,isNot:`is${J}not${G(J+_(\"an?\",\"in\")+K)}${K}`,isA:`is${J}an?${K}`,isNotA:`is${J}not${J}an?${K}`,matches:`matches${K}`,doesNotMatch:`does${J}not${J}match${K}`,and:`and${K}`,or:`or${K}`,not:`not${K}`,inequality:`((?:is(?:${J}not)?${Y})*)(${_(\"<(?!=)\",\"<=\",\">(?!=)\",\">=\")})`,isIn:`is${J}in${K}`,contains:`contains${K}`,doesNotContain:`does${J}not${J}contain${K}`,isNotIn:`is${J}not${J}in${K}`,addition:B(\"+\")+G(\"=\"),subtraction:B(\"-\")+G(\"=\",\"type\"),multiplication:B(\"*\")+G(\"=\"),division:_(\"/\",\"%\")+G(\"=\"),spread:`\\\\.\\\\.\\\\.${G(\"\\\\.\")}`,to:_(`to${K}`,\"=\"),into:`into${K}`,making:`making${K}`,where:`where${K}`,when:`when${K}`,via:`via${K}`,each:`each${K}`,bind:`2?bind${K}`,typeSignature:B(\"-type\")+K,incorrectOperator:$e,PlainCompare:{comma:\",\",htmlCommentFront:\"\\x3c!--\",htmlCommentBack:\"--\\x3e\",strikeOpener:\"~~\",italicOpener:\"//\",boldOpener:\"''\",supOpener:\"^^\",strongFront:\"**\",strongBack:\"**\",emFront:\"*\",emBack:\"*\",collapsedFront:\"{\",collapsedBack:\"}\",groupingBack:\")\"}},{assign:je}=Object,Ae={};class Ee{start=0;end=0;children=[];innerText=\"\";constructor(e){je(this,e)}addChild(e){const t=this.lastChildEnd()||0,n=new Ee(e);return n.start=t,n.end=t+e.text?.length||0,n.place=this.place,n.children=[],n.innerText&&Oe(n),this.children.push(n),n}lastChildEnd(){const e=this.children&&this.children[this.children.length-1]||null;return e?e.end:this.start+Math.max(0,this.text.indexOf(this.innerText))}tokenAt(e){if(e<this.start||e>=this.end)return null;if(this.children.length)for(let t=0;t<this.children.length;t+=1)if(e>=this.children[t].start&&e<this.children[t].end){const n=this.children[t].tokenAt(e);if(n)return n}return this}pathAt(e){if(e<this.start||e>=this.end)return[];let t=[];if(this.children.length)for(let n=0;n<this.children.length;n+=1)if(e>=this.children[n].start&&e<this.children[n].end){const r=this.children[n].pathAt(e);if(r.length){t=t.concat(r);break}}return t.concat(this)}nearestTokenAt(e){return e<this.start||e>=this.end?null:this.children?this.children.reduce(((t,n)=>t||(e>=n.start&&e<n.end?n:null)),null):this}everyLeaf(e){return this.children&&0!==this.children.length?this.children.reduce(((t,n)=>t&&n.everyLeaf(e)),!0):!!e(this)}demote(){this.type=\"text\"}debugRender(e=0){return`${\"\\t\".repeat(e)}• ${this.type}\\n${this.children.map((t=>t.debugRender(e+1))).join(\"\")}`}error(e){this.type=\"error\",this.message=e}toString(){let e=`${this.type}(${this.start}→${this.end})`;return this.children&&this.children.length>0&&(e+=`[${this.children}]`),e}copy(){const e=new Ee(this);return e.children=e.children.slice(),e}foldChildren(){let e=[];const t=this.children.slice();for(let n=0;n<t.length;n+=1){const r=t[n];let a=!1;if(r.matches)for(let t=0;t<e.length;t+=1){let{type:n}=e[t];n in r.matches&&(De(this,r,e[t]),e=e.slice(t+1),a=!0)}!a&&r.isFront&&e.unshift(r)}}}function Oe(e,t){const n=e.innerText;let r=null,a=0,o=a,i=n.length,s=null;for(;a<i;){const i=n.slice(a);let c=(r?.length?r[0]:e).innerMode,l=0,u=c.length;for(;l<u;l+=1){const u=Ae[c[l]];if(u.constraint&&!u.constraint(s)||u.cannotFollowText&&(\"text\"===s?.type||o<a)||(u.plainCompare?!i.startsWith(u.pattern):!u.pattern.test(i)))continue;const d=u.fn(u.plainCompare?u.pattern:u.pattern.exec(i)||\"\");let p=!1,h=0;if(d.matches){for(;r&&h<r.length;h+=1){let{type:e,aka:t}=r[h];if(e in d.matches){p=!0;break}t&&(e=t),d.cannotCross?.includes(e)&&(h=r.length-1)}if((!r||h>=r.length)&&!d.isFront)continue}o<a&&e.addChild({type:\"text\",text:n.slice(o,a),innerMode:c}),s=e.addChild(d),a+=s.text.length,o=a;let f=!1;p&&r&&(t&&De(e,s,r[h]),r=r.slice(h+1),f=!0),!f&&s.isFront&&(r?r.unshift(s):r=[s]);break}l===u&&(a+=1,null===s&&(s=new Ee({type:\"text\",text:\"\",innerMode:c})))}for(o<a&&e.addChild({type:\"text\",text:n.slice(o,a),innerMode:(r?.length?r[0]:e).innerMode});r?.length;)r.shift()?.demote();return e}function De(e,t,n){const r=e.children.indexOf(t),a=e.children.indexOf(n);if(t.children=e.children.splice(a+1,r-(a+1)),!t.matches?.[n.type])throw Error(`Couldn't fold backToken ${t.type} to match frontToken ${n.type}`);t.type=t.matches[n.type]||\"\",t.innerText=\"\";for(let e=0,n=t.children.length;e<n;e++)t.innerText+=t.children[e].text;t.start=n.start,t.text=n.text+t.innerText+t.text;for(let e in n)e in n&&!(e in t)&&(t[e]=n[e]);e.children.splice(a,1)}const Ie={lex:(e,t=\"\",n=\"start\",r=!1)=>Oe(new Ee({type:\"root\",place:t,start:0,end:e.length,text:e,innerText:e,children:[],innerMode:Ie.modes[n]}),!r),rules:Ae,modes:{}},Me=[\"boolean\",\"is\",\"to\",\"into\",\"where\",\"when\",\"via\",\"making\",\"each\",\"and\",\"or\",\"not\",\"isNot\",\"contains\",\"doesNotContain\",\"isIn\",\"isA\",\"isNotA\",\"isNotIn\",\"matches\",\"doesNotMatch\",\"typifies\",\"untypifies\",\"bind\"],Le=[\"comma\",\"spread\",\"typeSignature\",\"addition\",\"subtraction\",\"multiplication\",\"division\"],{keys:Re,assign:Pe}=Object;let Ve=Object.freeze({lex:function(e){function t(e){return e||=\"innerText\",t=>({[e]:\"string\"==typeof t?t:t.reduceRight(((e,t,n)=>e||(n?t:\"\")),\"\")})}function n(e,t){const n={};return n[e]=t,()=>({isFront:!0,matches:n,cannotCross:[\"verbatimOpener\"]})}const r=Object.bind(0,null);function a(e,t){for(let n of Re(t)){let r=t[n];if(!r)continue;const a=r.fn;r.fn=t=>{const r=a(t);return r.text||(r.text=\"string\"==typeof t?t:t[0]),r.type||(r.type=n),r.innerMode||(r.innerMode=e),r}}return t}const o=[],i=[],s=[],c=a(o,{hr:{fn:r},bulleted:{fn:e=>({depth:e[1].length})},numbered:{fn:e=>({depth:e[1].length/2})},heading:{fn:e=>({depth:e[1].length})},align:{fn(e){let t;const n=e[1],r=n.indexOf(\"><\");return~r?(t=Math.round(r/(n.length-2)*50),25===t&&(t=\"center\")):n.startsWith(\"<\")&&n.endsWith(\">\")?t=\"justify\":n.indexOf(\">\")>-1?t=\"right\":n.indexOf(\"<\")>-1&&(t=\"left\"),{align:t}}},column:{fn(e){let t;const n=e[1],r=n.indexOf(\"|\");return t=r&&r<n.length-1?\"center\":n.startsWith(\"|\")&&n.endsWith(\"|\")?\"none\":r===n.length-1?\"right\":\"left\",{column:t,width:/\\|+/.exec(n)?.[0].length,marginLeft:/^=*/.exec(n)?.[0].length,marginRight:/=*$/.exec(n)?.[0].length}}}}),l=e=>{switch(e?e.type:e){case null:case\"br\":case\"hr\":case\"bulleted\":case\"numbered\":case\"heading\":case\"align\":case\"column\":case\"escapedLine\":return!0}return!1};for(const e in c){const t=c[e];t&&(t.constraint=l),t&&(t.cannotFollowText=!0)}const u=a(o,{twine1Macro:{fn:()=>({type:\"error\",message:\"Harlowe macros use a different syntax to Twine 1, SugarCube, and Yarn macros.\"})},emBack:{fn:()=>({matches:{emFront:\"em\"},cannotCross:[\"verbatimOpener\"]})},strongBack:{fn:()=>({matches:{strongFront:\"strong\"},cannotCross:[\"verbatimOpener\"]})},strongFront:{fn:()=>({isFront:!0})},emFront:{fn:()=>({isFront:!0})},boldOpener:{fn:n(\"boldOpener\",\"bold\")},italicOpener:{fn:n(\"italicOpener\",\"italic\")},strikeOpener:{fn:n(\"strikeOpener\",\"strike\")},supOpener:{fn:n(\"supOpener\",\"sup\")},comment:{fn:r},htmlCommentFront:{fn:()=>({isFront:!0})},htmlCommentBack:{fn:()=>({matches:{htmlCommentFront:\"htmlComment\"}})},scriptStyleTag:{fn:r},tag:{fn:r},url:{fn:r},hookPrependedFront:{fn:e=>({name:e[1],hidden:\")\"===e[2],isFront:!0,tagPosition:\"prepended\"})},hookFront:{fn:()=>({isFront:!0})},hookBack:{fn:()=>({matches:{hookPrependedFront:\"hook\",hookFront:\"hook\"},cannotCross:[\"verbatimOpener\"]})},hookAppendedBack:{fn:e=>({name:e[2],hidden:\"(\"===e[1],tagPosition:\"appended\",matches:{hookFront:\"hook\"},cannotCross:[\"verbatimOpener\"]})},unclosedHook:{fn:r},unclosedHookPrepended:{fn:e=>({type:\"unclosedHook\",name:e[1],hidden:\")\"===e[2]})},verbatimOpener:{fn(e){let t=e[0].length,n={};return n[`verbatim${t}`]=\"verbatim\",{type:`verbatim${t}`,isFront:!0,matches:n,aka:\"verbatimOpener\"}}},unclosedCollapsed:{fn:r},collapsedFront:{fn:()=>({isFront:!0})},collapsedBack:{fn:()=>({matches:{collapsedFront:\"collapsed\"},cannotCross:[\"verbatimOpener\"]})},escapedLine:{fn:r},legacyLink:{fn:e=>({type:\"twineLink\",innerText:e[1],passage:e[2],innerMode:o})},br:{fn:r}}),d=Pe(a(i,{macroFront:{fn:e=>({isFront:!0,name:e[1]})},groupingBack:{fn:()=>({matches:{groupingFront:\"grouping\",macroFront:\"macro\"},cannotCross:[\"singleStringOpener\",\"doubleStringOpener\",\"hookFront\"]})},passageLink:{fn(e){const t=e[1]||\"\",n=e[2]||\"\",r=e[3]||\"\";return{type:\"twineLink\",innerText:n?r:t,passage:t?r:n,innerMode:o}}},simpleLink:{fn:e=>({type:\"twineLink\",innerText:e[1]||\"\",passage:e[1]||\"\",innerMode:o})},variable:{constraint:e=>!e||\"macroFront\"!==e.type,fn:t(\"name\")},tempVariable:{constraint:e=>!e||\"macroFront\"!==e.type,fn:t(\"name\")}}),{hookFront:u.hookFront,hookBack:u.hookBack}),p=a(i,{htmlCommentBack:{fn:()=>({matches:{htmlCommentFront:\"htmlComment\"}})},comment:{fn:r},macroName:{constraint:e=>!!e&&\"macroFront\"===e.type,fn:t(\"name\")},groupingFront:{fn:()=>({isFront:!0})},property:{fn:t(\"name\"),constraint(e){if(e)switch(e.type){case\"variable\":case\"hookName\":case\"property\":case\"tempVariable\":case\"colour\":case\"itsProperty\":case\"belongingItProperty\":case\"macro\":case\"grouping\":case\"string\":case\"datatype\":case\"hook\":case\"boolean\":case\"number\":return!0;case\"identifier\":{let t=e.text?.toLowerCase();return\"user\"===t||\"it\"===t}}return!1}},possessiveOperator:{fn:r},itsProperty:{cannotFollowText:!0,fn:t(\"name\")},itsOperator:{cannotFollowText:!0,fn:r},belongingItProperty:{cannotFollowText:!0,fn:t(\"name\")},belongingItOperator:{cannotFollowText:!0,fn:r},belongingProperty:{cannotFollowText:!0,fn:t(\"name\")},belongingOperator:{cannotFollowText:!0,fn:r},escapedStringChar:{fn:()=>({type:\"text\"})},singleStringOpener:{fn:()=>({isFront:!0,matches:{singleStringOpener:\"string\"},innerMode:s})},doubleStringOpener:{fn:()=>({isFront:!0,matches:{doubleStringOpener:\"string\"},innerMode:s})},hookName:{fn:t(\"name\")},cssMeasure:{fn(e){let t=e[2].toLowerCase();return\"ms\"===t||\"s\"===t?{unit:t,value:+e[1]*(\"s\"===t?1e3:1)}:{unit:t,value:+e[1]}}},datatype:{cannotFollowText:!0,fn:e=>({name:e[0].toLowerCase()})},colour:{cannotFollowText:!0,fn(e){let t,n=e[0].toLowerCase();const r={red:\"e61919\",orange:\"e68019\",yellow:\"e5e619\",lime:\"80e619\",green:\"19e619\",cyan:\"19e5e6\",aqua:\"19e5e6\",blue:\"197fe6\",navy:\"1919e6\",purple:\"7f19e6\",fuchsia:\"e619e5\",magenta:\"e619e5\",white:\"fff\",black:\"000\",gray:\"888\",grey:\"888\"};return t=n in r?`#${r[n]}`:n,{colour:t}}},number:{fn:e=>({value:parseFloat(e[0])})},inequality:{fn:e=>({operator:e[2],negate:e[1].indexOf(\"not\")>-1})},identifier:{fn:t(\"name\"),cannotFollowText:!0},whitespace:{fn:r,cannotFollowText:!0},incorrectOperator:{fn:e=>{const t={\"=>\":\">=\",\"=<\":\"<=\",gte:\">=\",lte:\"<=\",gt:\">\",lt:\"<\",eq:\"is\",isnot:\"is not\",neq:\"is not\",isa:\"is a\",are:\"is\",x:\"*\",\"or a\":\"or\"}[e[0].toLowerCase().replace(/\\s+/g,\" \")];return{type:\"error\",message:`Please say ${t?`'${t}'`:\"something else\"} instead of '${e[0]}'.`,explanation:\"In the interests of readability, I want certain operators to be in a specific form.\"}},cannotFollowText:!0},...Me.reduce(((e,t)=>(e[t]={fn:r,cannotFollowText:!0},e)),{}),...Le.reduce(((e,t)=>(e[t]={fn:r},e)),{})}),h=a(s,{singleStringCloser:p.singleStringOpener,doubleStringCloser:p.doubleStringOpener,escapedStringChar:p.escapedStringChar});o.push(...Re(c),...Re(d),...Re(u)),i.push(...Re(d),...Re(p)),s.push(...Re(h));const f={...c,...u,...d,...p,...h};for(const e in f){const t=f[e];t&&(e in Ne.PlainCompare?(t.pattern=Ne.PlainCompare[e],t.plainCompare=!0):t.pattern=RegExp(`^(?:${Ne[e]})`,\"i\"))}Pe(e.rules,f);const{modes:g}=e;return g.start=g.markup=o,g.macro=i,g.string=s,e}(Ie).lex,Patterns:Ne});a(document.documentElement).on(\"click\",\"tw-folddown\",(({target:e})=>{(e=a(e)).toggleClass(\"open\");const t=e.popData(\"folddown\");for(\"function\"==typeof t&&t(e);e&&!e.next().length;)e=e.parent();e?.next().toggle()}));const Fe={syntax:\"The markup seems to contain a mistake.\",saving:\"I tried to save or load the game, but I couldn't do it.\",operation:\"I tried to perform an operation on some data, but the data's type was incorrect.\",macrocall:\"I tried to run a macro, but its call wasn't written correctly.\",datatype:\"I tried to run a macro, but was given the wrong type of data to it.\",custommacro:\"I tried to run a custom macro, but its code hook had a mistake in it.\",infinite:\"I almost ended up doing the same thing over and over, forever.\",property:\"I tried to access a value in a string/array/datamap, but I couldn't find it.\",unimplemented:\"I currently don't have this particular feature. I'm sorry.\",propagated:\"Click the 'Open' button to see the code hook as it was executed.\",user:\"This is a custom error created by (error:). It usually means you used a custom macro incorrectly.\",assertion:\"This command exists to provide a helpful error if a certain important condition wasn't true.\",debugonly:\"This macro is not meant to be used outside of debugging your story.\"},He=[];class qe{constructor(e,t,n,r){\"user\"!==e&&(t=t[0].toUpperCase()+t.slice(1)),Object.assign(this,{type:e,message:t,explanation:n,source:void 0,innerDOM:r,appendTitleText:!1})}static containsError(...e){for(let t=0;t<e.length;t+=1){const n=e[t];if(n instanceof qe)return n;if(Array.isArray(n))for(let e=0;e<n.length;e+=1){const t=n[e];if(t instanceof qe)return t;if(Array.isArray(t)){const e=qe.containsError(...t);if(e)return e}}}return!1}static createWarning(e,t){return Object.assign(new qe(e,t),{warning:!0})}render(e=\"\",t=!1){e=\"string\"==typeof e?e:this.source||\"\";const n=a(`<tw-error class='${this.warning?\"warning\":\"error\"}' title='${D(e)}'>${D(this.message+(this.appendTitleText?` ${e}`:\"\"))}</tw-error>`),r=a(\"<tw-error-explanation>\").text(this.explanation||Fe[this.type]).hide(),o=a(\"<tw-folddown tabindex=0>\"),{innerDOM:i}=this;return i&&a(\"<tw-open-button label='Open'>\").on(\"click\",(()=>{const e=a(\"<tw-backdrop><tw-dialog></tw-backdrop>\");e.find(\"tw-dialog\").prepend(i,a(\"<tw-link tabindex=0>OK</tw-link>\").on(\"click\",(()=>{i.detach(),e.remove()})).wrap(\"<tw-dialog-links>\").parent()),h.prepend(e)})).appendTo(n),n.append(o).append(r),n.data(\"TwineError\",this),t||He.forEach((t=>t(this,e))),n}static on(e){return\"function\"!=typeof e||He.includes(e)||He.push(e),qe}}Object.preventExtensions(qe),Object.preventExtensions(qe.prototype);const{assign:ze}=Object,We=RegExp(Ve.Patterns.macroFront+Ve.Patterns.macroName,\"ig\");class Be extends Map{constructor(e){super();const t=e.attr(\"name\")||\"\",n=e.html().replace(/&(?:amp|lt|gt|quot|nbsp|zwnj|#39|#96);/g,(e=>({\"&amp;\":\"&\",\"&gt;\":\">\",\"&lt;\":\"<\",\"&quot;\":'\"',\"&#39;\":\"'\",\"&nbsp;\":String.fromCharCode(160),\"&zwnj;\":String.fromCharCode(8204)}[e]||\"\")));this.metadata=function(e,t){const n=[\"metadata\",\"storylet\",\"exclusivity\",\"urgency\",\"define\"];if(!(e.match(We)||[]).some((e=>n.some((t=>I(e.slice(1,-1))===t)))))return{};let r=!1;const a={};return Ve.lex(e,t).children.forEach((function e(t,o,i){if(\"comment\"!==i[o-1]?.type)if(\"macro\"===t.type){const e=I(t.name);if(n.some((t=>e===t))){if(a[e]instanceof qe)return;if(r)return void(a[e]=new qe(\"syntax\",`The (${t.name}:) macro can't appear after non-metadata macros.`));if(a[e]&&\"define\"!==e)return void(a[e]=new qe(\"syntax\",`There is more than one (${t.name}:) macro in this passage.`));(a[e]||=[]).push(t)}else r=!0;t.children.forEach((function e(t){const r=\"name\"in t&&\"string\"==typeof t.name&&I(t.name);r&&\"macro\"===t.type&&n.some((e=>r===e))?a[r]=new qe(\"syntax\",`The (${t.name}:) macro can't be inside another macro.`):t.children.forEach(e)}))}else t.children.forEach(e)})),a}(n,t),this.set(\"source\",n).set(\"tags\",(e.attr(\"tags\")||\"\").split(/\\s/)||[]).set(\"name\",t)}static{Object.assign(this.prototype,{typeID:\"datamap\",typeName:\"a passage datamap\"})}get objectName(){return`the \"\\`${this.get(\"name\")}\\`\" passage's datamap`}toSource(){return this.get(\"source\")}}let Ue,_e=Object.create(null),Ge=[];const Xe=ze(new Map,{typeID:\"datamap\",typeName:\"the Passages datamap\",objectName:\"the Passages datamap\",getTagged(e){if(_e[e])return _e[e];const t=W(\"en\",(e=>e.get(\"name\"))),n=[];return this.forEach((t=>{const r=t instanceof Map&&t.get(\"tags\");Array.isArray(r)&&r.includes(e)&&n.push(t)})),n.sort(t),_e[e]=n,n},clearTagCache(){_e=Object.create(null)},clear(){Map.prototype.clear.call(this),this.clearTagCache(),this.clearTreeCache(),this.clearStoryletCache()},delete(e){Map.prototype.delete.call(this,e),this.clearTagCache(),this.clearTreeCache(),this.clearStoryletCache()},getTree(e){H(this.has(e),\"No passage name!\");const t=this.get(e);H(t,`No passage named '${t}'`);const n=t.get(\"tags\");if(n.includes(\"header\")||n.includes(\"footer\")||n.includes(\"debug-header\")||n.includes(\"debug-footer\"))return t.tree||(t.tree=Ve.lex(t.get(\"source\"),e)),t.tree;for(let t=0;t<Ge.length;t+=1)if(Ge[t]&&Ge[t].place===e){const e=Ge.splice(t,1)[0];return Ge.unshift(e),e}const r=Ve.lex(t.get(\"source\"),e);return Ge.unshift(r),Ge.length>16&&Ge.pop(),r},clearTreeCache(){Ge=[]},getStorylets(e,t){const n=t?t.filter(e,[...Xe.values()]):[...Xe.values()];if(n instanceof qe)return n;const r=[];let a=-1/0;const o=n.reduce(((t,n)=>{if(t)return t;const o=n.get(\"storylet\");if(o){const t=e.speculate(o,n.get(\"name\"),\"a (storylet:) macro\");if(t instanceof qe)return t.message=`There's an error in the storylet passage \"${n.get(\"name\")}\":\\n${t.message}`,t.source=o.toSource(),t;if(t){const e=n.get(\"exclusivity\");a=Math.max(a,\"number\"==typeof e?e:0),r.push(n)}}}),void 0);if(o)return o;const i=W(\"en\");return r.filter((e=>{let t=e.get(\"exclusivity\");return t=\"number\"==typeof t?t:0,t===a})).sort(((e,t)=>{let n=e.get(\"urgency\"),r=t.get(\"urgency\");return n=\"number\"==typeof n?n:0,r=\"number\"==typeof r?r:0,n!==r?r-n:i(e.get(\"name\"),t.get(\"name\"))}))},allStorylets:()=>(Ue||(Ue=[...Xe.values()].filter((e=>e.get(\"storylet\")))),Ue),clearStoryletCache(){Ue=void 0},loadMetadata(e){const t=[];for(const n of Array.from(Xe.values()).sort(W(\"en\",(e=>e.get(\"name\")))))if(n.metadata){for(let[r,a]of Object.entries(n.metadata))if(a instanceof qe)t.push(a);else for(let o of a){const a=e.speculate(o,n.get(\"name\"),`a (${r}:) macro`),i=`In \"${n.get(\"name\")}\":\\n`;if(a instanceof qe){a.message=i+a.message,a.source=o.text,t.push(a);break}if(\"define\"===r){io.addDefinitions();continue}const s=(e,r)=>{n.has(e)?t.push(new qe(\"syntax\",`This passage's datamap already has a '${JSON.stringify(e)}' data name.`)):n.set(e,r)};a instanceof Map?a.forEach(((e,t)=>s(t,e))):s(r,a)}n.metadata=void 0}return t},hasValid(e){const t=this.get(e);return!!t&&t instanceof Map&&t.has(\"source\")},create:e=>new Be(e)});V((()=>{a(\"tw-storydata > tw-passagedata\").get().forEach((e=>{let t=a(e);Xe.set(t.attr(\"name\")||\"\",new Be(t))}))}));const{validPropertyName:Ye}=Ne;function Je(e){return!!e&&(\"object\"==typeof e||\"function\"==typeof e)}const{isArray:Ke}=Array;function Qe(e){return!!e&&\"object\"==typeof e&&Object.getPrototypeOf(e)===Object.prototype}function Ze(e){return Ke(e)?\"array\":e instanceof Map?\"datamap\":e instanceof Set?\"dataset\":\"string\"==typeof e?\"string\":e&&\"object\"==typeof e?\"object\":\"\"}function et(e){return Je(e)&&\"unstorable\"in e&&e?.unstorable&&e||Ke(e)&&e.find(et)||e instanceof Map&&[...e.values()].find(et)||e instanceof Set&&[...e].find(et)}function tt(e,t){if(t instanceof qe)return t;if(\"string\"!=typeof t&&\"number\"!=typeof t)return new qe(\"property\",`Only strings and numbers can be used as data names for ${it(e)}, not ${it(t)}.`);const n=\"string\"==typeof t?+t:`${t}`;return!(!Number.isNaN(n)&&e.has(n))||new qe(\"property\",`You mustn't use both ${it(t)} and ${it(n)} as data names in the same datamap.`)}function nt(e,t){return!!e&&\"object\"==typeof e&&t in e&&\"function\"==typeof e[t]}function rt(e){return\"string\"==typeof e||Ke(e)||e instanceof ka}function at(e){if(!Je(e))return e;if(\"clone\"in e&&\"function\"==typeof e.clone)return e.clone();if(Ke(e))return[...e];if(e instanceof Map)return new Map(e);if(e instanceof Set)return new Set(e);throw Error(`The value ${e} cannot be cloned!`)}function ot(e,t,n,r){let a=\"\",o=0;for(;a.length<=t&&o<e.length;){const i=r(e[o]);if(!(i.length+a.length<=t)){a+=(o>0?\" and \":\"\")+j(e.length-o,(o>0?\"other \":\"\")+n);break}a+=(o>0&&o===e.length-1?\" and \":\"\")+i+(o<e.length-1?\", \":\"\"),o+=1}return a}function it(e){if(e instanceof qe)throw Error(\"a TwineError wasn't propagated!\");if(Je(e)&&\"objectName\"in e)return e.objectName;if(Ke(e))return 0===e.length?\"an empty array\":`an array (with ${ot(e,48,\"item\",it)})`;if(e instanceof Map)return 0===e.size?\"an empty datamap\":`a datamap (with ${ot([...e.keys()],48,\"dataname\",ut)})`;if(e instanceof Set)return 0===e.size?\"an empty dataset\":`a dataset (with ${ot([...e.values()],48,\"item\",it)})`;if(\"string\"==typeof e){if(0===e.length)return\"an empty string\";let t=[...e];return t.length>48?`a ${t.length}-character string starting with ${JSON.stringify(t.slice(0,48).join(\"\"))}`:`the string ${JSON.stringify(e)}`}return\"boolean\"==typeof e?`the boolean value '${e}'`:\"number\"==typeof e?`the number ${JSON.stringify(e)}`:void 0===e?\"an empty variable\":`...whatever this is (${\"object\"==typeof e?\"object\":e})`}function st(e){const t=Qe(e);if(t&&\"innerType\"in e)return\"lambda\"===e.pattern?e.typeName:\"insensitive set\"===e.pattern?\"a case-insensitive string name\":\"either\"===e.pattern?(H(Ke(e.innerType),'\"either\" pattern had non-array inner type'),e.innerType.map(st).join(\" or \")):\"optional\"===e.pattern?`(optional) ${st(e.innerType)}`:st(e.innerType);if(t&&\"pattern\"in e&&\"range\"===e.pattern&&\"number\"==typeof e.min&&\"number\"==typeof e.max){const{min:t,max:n}=e;return`a${t>0?\" positive\":\"\"}${\"integer\"in e?\" whole\":\"\"} number${0===t?` between 0 and ${n}`:n<1/0?` up to ${n}`:\"\"}`}return e===String||e===Number||e===Boolean?\"a \"+typeof e():e===parseInt?\"a whole number\":e===Map?\"a datamap\":e===Set?\"a dataset\":e===Array?\"an array\":Je(e)&&\"typeName\"in e?e.typeName:\"function\"==typeof e&&\"prototype\"in e&&\"typeName\"in e.prototype?e.prototype.typeName:it(e)}function ct(e){return\"boolean\"==typeof e||\"string\"==typeof e||\"number\"==typeof e?typeof e:Ke(e)?\"array\":e instanceof Map?\"datamap\":e instanceof Set?\"dataset\":\"typeID\"in e&&e.typeID||\"\"}const lt=(e,t)=>[e[0],t[0]].sort(W(\"en\"))[0]===e[0]?-1:1;function ut(e,t){if(H(!(e instanceof qe||qe.containsError(e)),`received a TwineError: ${e.message}`),e&&\"object\"==typeof e&&\"toSource\"in e&&\"function\"==typeof e.toSource)return e.toSource();if(Qe(e)&&\"first\"in e&&\"last\"in e&&\"number\"==typeof e.first&&\"number\"==typeof e.last)return`${e.first<0?`${-1!==e.first?N(-e.first):\"\"}last`:N(e.first+1)}to${e.last<0?`${-1!==e.last?N(-e.last):\"\"}last`:N(e.last+1)}`;if(Ke(e)){let n=\"\";for(let r of e)n+=n?\",\":\"(a:\",n+=\"property\"===t?r+(r>0):ut(r);return n+(n?\")\":\"(a:)\")}if(e instanceof Map){const t=Array.from(e.entries()).sort(lt);let n=\"\";for(let[e,r]of t)n+=`${(n?\",\":\"(dm:\")+ut(e)},${ut(r)}`;return n+(n?\")\":\"(dm:)\")}return e instanceof Set?`(ds:${Array.from(e).sort(W(\"en\")).map(ut)})`:\"number\"==typeof e&&\"property\"===t?e<0?-1===e?\"last\":`${N(-e)}last`:N(e+1):\"string\"==typeof e&&\"property\"===t?RegExp(Ye).test(e)?e:`(${JSON.stringify(e)})`:JSON.stringify(e)}function dt(e,t){if(\"object\"!=typeof e&&\"object\"!=typeof t)return e===t;if(Ke(e)&&Ke(t))return e.length===t.length&&e.every(((e,n)=>dt(t[n],e)));if(e instanceof Map&&t instanceof Map)return dt(Array.from(e.entries()).sort(),Array.from(t.entries()).sort());if(e instanceof Set&&t instanceof Set){let n=[...e],r=[...t];return n.length===r.length&&n.every((e=>r.some((t=>dt(e,t)))))}return e&&\"object\"==typeof e&&\"is\"in e&&\"function\"==typeof e.is?e.is(t):e&&\"object\"==typeof e&&t&&\"object\"==typeof t&&Qe(e)&&Qe(t)?dt(Object.getOwnPropertyNames(e).map((t=>[t,e[t]])),Object.getOwnPropertyNames(t).map((e=>[e,t[e]]))):Object.is(e,t)}function pt(e,t){if(e||\"\"===e){if(\"string\"==typeof e)return\"string\"!=typeof t?new qe(\"operation\",`${it(e)} can only contain strings, not ${it(t)}.`):e.includes(t);if(Ke(e))return e.some((e=>dt(e,t)));if(e instanceof Set||e instanceof Map)return Array.from(e.keys()).some((e=>dt(e,t)))}return new qe(\"operation\",`${it(e)} cannot contain any values, let alone ${it(t)}`)}function ht(e,t){return t&&\"object\"==typeof t&&\"isTypeOf\"in t&&\"function\"==typeof t.isTypeOf?t.isTypeOf(e):new qe(\"operation\",`\"is a\" should only be used to compare type names, not ${it(t)}.`)}function ft(e,t){let n=!1;if(e&&\"object\"==typeof e&&\"isTypeOf\"in e&&\"function\"==typeof e.isTypeOf){const r=e.isTypeOf(t);if(r instanceof qe)return r;n||=r}if(t&&\"object\"==typeof t&&\"isTypeOf\"in t&&\"function\"==typeof t.isTypeOf){const r=t.isTypeOf(e);if(r instanceof qe)return r;n||=r}if(n)return!0;if(Ke(e)&&Ke(t)){let n=0,r=0,a=!0;for(;a&&n<e.length&&r<t.length;){let o=e[n],i=t[r];if(o.rest){for(;r<t.length&&ft(o,i);)r+=1,i=t[r];n+=1}else if(i.rest){for(;n<e.length&&ft(o,i);)n+=1,o=e[n];r+=1}else ft(o,i)?(n+=1,r+=1):a=!1}return a&&n>=e.length&&r>=t.length}return e instanceof Map&&t instanceof Map?ft(Array.from(e.entries()).sort(),Array.from(t.entries()).sort()):e instanceof Set&&t instanceof Set?(e=[...e],C(...t).some((t=>ft(e,t)))):dt(e,t)}function gt(e,t,n){if(!t||!n)return new qe(\"macrocall\",`The sub${Ze(e)} index value must not be ${t&&n}.`);let r=!1;if(\"string\"==typeof e&&(r=!0,e=Array.from(e)),t<0&&(t=Math.max(0,e.length+t+1)),n<0&&(n=Math.max(0,e.length+n+1)),t>n)return gt(arguments[0],n,t);const a=e.slice(t>0?t-1:t,n).map(at);return r?a.join(\"\"):a}function mt(e){return Array.from(e).sort(W(\"en\"))}function yt(e){let t;if(t=qe.containsError(e))return t;if(e&&\"object\"==typeof e&&\"print\"in e&&\"function\"==typeof e.print)return e.print();if(e instanceof Map){let n=Array.from(e.entries());return(t=qe.containsError(n))?t:`${n.reduce(((e,[t,n])=>`${e}<tr><td>\\`${yt(t)}\\`</td><td>\\`${yt(n)}\\`</td></tr>`),\"<table class=datamap>\")}</table>`}return e instanceof Set?`${Array.from(e.values()).map(yt)}`:Ke(e)?`${e.map(yt)}`:e&&\"object\"==typeof e&&\"jquery\"in e?e.html():Je(e)?new qe(\"unimplemented\",\"I don't know how to print this value yet.\"):`${e}`}function bt(e,t){if(e>t)return bt(t,e);const n=[e];for(t-=e;t-- >0;)n.push(++e);return n}function vt(e){return\"string\"==typeof e||\"boolean\"==typeof e||\"number\"==typeof e&&!Number.isNaN(e)&&Math.abs(e)!==1/0||Array.isArray(e)&&e.every(vt)||e instanceof Set&&[...e].every(vt)||e instanceof Map&&[...e.values()].every(vt)&&[...e.keys()].every((e=>\"string\"==typeof e))}const wt=(e,t,n)=>n.findIndex((t=>dt(e,t)))===t,{isArray:$t}=Array,{hasOwn:kt}=Object,xt={},St=(e=0,t=1/0)=>({pattern:\"range\",min:e,max:t,range:n=>\"number\"==typeof n&&!Number.isNaN(n)&&n>=e&&n<=t}),Tt={optional:e=>({pattern:\"optional\",innerType:e}),zeroOrMore:e=>({pattern:\"zero or more\",innerType:e}),either:(...e)=>({pattern:\"either\",innerType:e}),rest:e=>({pattern:\"rest\",innerType:e}),insensitiveSet:(...e)=>({pattern:\"insensitive set\",innerType:e}),numberRange:St,nonNegativeInteger:{pattern:\"range\",integer:!0,min:0,max:1/0,range:e=>\"number\"==typeof e&&!Number.isNaN(e)&&e>=0&&!`${e}`.includes(\".\")},positiveInteger:{pattern:\"range\",integer:!0,min:1,max:1/0,range:e=>\"number\"==typeof e&&!Number.isNaN(e)&&e>=1&&!`${e}`.includes(\".\")},positiveNumber:St(Number.EPSILON,1/0),nonNegativeNumber:St(0,1/0),percent:St(0,1),wrapped:(e,t)=>({pattern:\"wrapped\",innerType:e,message:t}),Any:{typeName:\"anything\"},Everything:{typeName:\"everything\"}};function Ct(e,t){if(!t)return void 0===e;const n=typeof e;if(\"function\"!=typeof t&&\"pattern\"in t){if(\"optional\"===t.pattern||\"zero or more\"===t.pattern)return void 0===e||Ct(e,t.innerType);if(\"either\"===t.pattern){for(let n=0;n<t.innerType.length;n+=1)if(Ct(e,t.innerType[n]))return!0;return!1}if(\"lambda\"===t.pattern&&\"object\"==typeof e&&Ct(e,t.innerType))return t.clauses.includes(\"where\")===(\"where\"in e||\"each\"in e)&&t.clauses.includes(\"making\")===\"making\"in e&&t.clauses.includes(\"via\")===\"via\"in e&&t.clauses.includes(\"with\")===\"with\"in e;if(\"insensitive set\"===t.pattern)return\"string\"==typeof e&&t.innerType.includes(I(e));if(\"range\"===t.pattern)return t.range(e);if(\"wrapped\"===t.pattern)return Ct(e,t.innerType)}if(void 0!==t&&void 0===e)return!1;if(\"typeName\"in t){if(\"anything\"===t.typeName&&void 0!==e&&!(e&&\"object\"==typeof e&&\"unstorable\"in e&&e.unstorable))return!0;if(\"everything\"===t.typeName&&void 0!==e)return!0}return t===String?\"string\"===n:t===Boolean?\"boolean\"===n:t===parseInt?\"number\"===n&&!Number.isNaN(e)&&!`${e}`.includes(\".\"):t===Number?\"number\"===n&&!Number.isNaN(e):t===Array?$t(e):!(\"function\"!=typeof t||!Object.hasOwn(t,\"prototype\"))&&e instanceof t}function Nt(e){return e===Tt.Any||!!e&&\"object\"==typeof e&&\"innerType\"in e&&($t(e.innerType)?e.innerType.some(Nt):!!e.innerType&&Nt(e.innerType))}function jt(e,{fn:t,typeSignature:n,returnType:r=\"\"},a,o){let i,s=function(e){const t=[];for(let n=0;n<e.length;n+=1){if(!(n in e))continue;let r=e[n];if(r instanceof Wa){const e=\"value\"in r&&r.value,n=qe.containsError(e);if(n)return n;if($t(e)||\"string\"==typeof e)t.push(...e);else{if(!(e instanceof Set))throw Error(`${e} is not a string, dataset or array`);t.push(...mt(e))}}else t.push(r)}return t}(o);if(s instanceof qe)return s;\"string\"!=typeof e&&(i=e,e=\"\");const c=i?\"\":`(${$t(e)&&e.length>1?e[0]:e}:)`;let l,u;e=i?\"knownName\"in i?`the custom macro, ${i.knownName}`:\"an unnamed custom macro\":`the ${c} macro`,l=n.length>0?1===n.length&&Nt(n[0])?1===s.length?\"That value can't be given to macros as-is.\":\"Give only a single value to this macro.\":`${e} must only be given ${A(n.map(st))}${n.length>1?\", in that order\":\".\"}`:`${e} must not be given any data.${i?\"\":` Just write ${c}`}`;for(let t=0,a=Math.max(s.length,n.length);t<a;t+=1){let a=n[t],o=s[t];if(qe.containsError(o))return o;if(!a&&!u)return new qe(\"datatype\",`${s.length-n.length} too many values were given to ${e}.`,l);if(a||=u,a&&\"innerType\"in a&&a.innerType&&(\"rest\"===a.pattern||\"zero or more\"===a.pattern)&&(u=a.innerType,\"rest\"===a.pattern&&(a=a.innerType)),!Ct(o,a)){if(void 0===o){let r=n.filter((e=>!(\"pattern\"in e&&(\"optional\"===e.pattern||\"zero or more\"===e.pattern)))).length;return new qe(\"datatype\",`${e} was given ${s.length?A(s.map(it)):\"nothing\"}, but needs ${r-t} more value${r-t>1?\"s\":\"\"}.`,l)}if(\"object\"==typeof o&&\"unstorable\"in o&&o.unstorable&&Nt(a))return new qe(\"datatype\",`${e}'s ${N(t+1)} value, ${it(o)}, is not valid data for this macro.`,l);if(o instanceof ir&&\"Changer\"===r)return new qe(\"syntax\",`Please put this hook outside the parentheses of ${e}, not inside it.`,\"Hooks should appear after a macro\"+(i?\".\":`: ${c}[Some text]`));if(o&&o instanceof ja&&a&&\"pattern\"in a&&\"lambda\"===a.pattern){let n=a;return new qe(\"datatype\",`${e}'s ${N(t+1)} value (a lambda) should have ${A([\"where\",\"when\",\"making\",\"via\",\"with\"].filter((e=>n.clauses.includes(e))).map((e=>`a '${e}' clause`)))}, not ${A([\"where\",\"when\",\"making\",\"via\",\"with\"].filter((e=>\"object\"==typeof o&&e in o)).map((e=>`a '${e}' clause`)))}.`)}return a&&\"pattern\"in a&&\"insensitive set\"===a.pattern?new qe(\"datatype\",`${it(o)} is not a valid name string for ${e}.`,`Only the following names are recognised (capitalisation and hyphens ignored): ${A(a.innerType)}.`):new qe(\"datatype\",`${e}'s ${N(t+1)} value is ${it(o)}, but should be ${st(a)}.`,l)}}return t(a,...s)}function At(e,t,n,r){const a={fn:n,typeSignature:r?[].concat(r):[],returnType:t};Object.freeze(a),[].concat(e).forEach((e=>Object.defineProperty(xt,I(e),{value:a})))}const Et={has:e=>(e=I(e),kt(xt,e)),get:e=>(H((e=I(e))in xt,`No macro named ${e} registered!`),xt[e]),add:function e(t,n,r,a){return At(t,n,r,a),e},addChanger:function e(t,n,r,a){return At(t,\"Changer\",n,a),or.register($t(t)?t[0]:t,r),e},addCommand:function e(t,n,r,a,o){const i=[].concat(t)[0];return At(t,\"Command\",((e,...t)=>{const a=n(...t);return a||Zr.create({...o??{},runFn:(e,n)=>!1!==o?.attachable?r(e,n,...t):r(n,...t),name:i,source:`(${i}:${t.map(ut)})`})}),a),e},TypeSignature:Tt,run:(e,t,n)=>Et.has(e)?jt(e,Et.get(e),t,n):new qe(\"macrocall\",`I can't run the macro '${e}' because it doesn't exist.`,\"Did you mean to run a macro? If you have a word written like (this:), it is regarded as a macro name.\"),runCustom:(e,t,n)=>e instanceof ca?jt(e,e,t,n):e instanceof qe?e:new qe(\"macrocall\",`I can't call ${it(e)} because it isn't a custom macro.`)};function Ot(e,t,n,r){return n||=\"do this to\",(a,o)=>{let i;return 1===t.length&&(o=a),(i=qe.containsError(a,o))?i:typeof a!==e||typeof o!==e?new qe(\"operation\",`I can only ${n} ${e}s, not ${it(typeof a!==e?a:o)}.`,r):t(a,o)}}function Dt(e){return(t,n)=>{let r;if(r=qe.containsError(t,n))return r;if(typeof t!=typeof n||Je(t)&&\"typeName\"in t&&Je(n)&&\"typeName\"in n&&t.typeName!==n.typeName||Ze(t)!==Ze(n)){const e=`${it(t)} isn't the same type of data as ${it(n)}`;let r;return typeof t+typeof n!=\"stringnumber\"&&typeof t+typeof n!=\"numberstring\"||(r=\"You might want to convert one side to a number using (num:), or to a string using (str:).\"),new qe(\"operation\",e[0].toUpperCase()+e.slice(1),r)}return e(t,n)}}function It(e,t,n=!1){const r=(a,o)=>{let i;if(i=qe.containsError(a,o))return i;let[s,c]=a instanceof Pn?[a,o]:o instanceof Pn?[o,a]:[];if(s){const{determiner:e,determined:i}=s;if(\"start\"===e||\"end\"===e){if(t)return new qe(\"operation\",`I can't use '${t}' with the 'start' or 'end' of ${it(i)}.`);if(c instanceof Pn){if(\"start\"===c.determiner||\"end\"===c.determiner)return new qe(\"operation\",\"I can't compare one value's 'start' or 'end' with another value's 'start' or 'end'.\",\"Please change one of them to use an exact range, such as '1stto4th' or '2ndlasttolast'.\");[s,c]=[c,s]}const l=s.string||s.array;for(let t=0;t<l.length+1;t+=1){const i=t?\"end\"===e?l.slice(-t):l.slice(0,t):l.constructor(),c=s===a?r(i,o):r(a,i);if(c instanceof qe)return c;if(c!==n)return c}return n}const l=\"all\"===e;return s.array.reduce(((e,t)=>{if(e instanceof qe)return e;let n=s===a?r(t,o):r(a,t);return n instanceof qe?n:!!(l?e&&n:e||n)}),l)}return e(a,o)};return r}function Mt(e,t){return It(((t,n)=>{const r=e(t,n);return r instanceof qe?r:!r}),t,!0)}Object.freeze(Et);const Lt=\"If one of these values is a number, you may want to write a check that it 'is not 0'. Also, if one is a string, you may want to write a check that it 'is not \\\"\\\" '.\";let Rt,Pt,Vt={and:Ot(\"boolean\",Dt(((e,t)=>e&&t)),\"use 'and' to join\",Lt),or:Ot(\"boolean\",Dt(((e,t)=>e||t)),\"use 'or' to join\",Lt),not:Ot(\"boolean\",(e=>!e),\"use 'not' to invert\",Lt),\"+\":Dt(((e,t)=>{if(Array.isArray(e))return[...e,...t];if(e instanceof Map){let n=new Map(e);return t.forEach(((e,t)=>n.set(t,e))),n}return e instanceof Set?new Set([...e,...t].filter(wt).map(at)):\"object\"==typeof e&&\"+\"in e&&\"function\"==typeof e[\"+\"]?e[\"+\"](t):\"string\"==typeof e||\"number\"==typeof e?e+t:\"boolean\"==typeof e?e||t:new qe(\"operation\",`I can't use + on ${it(e)}.`)})),\"-\":Dt(((e,t)=>{if(Array.isArray(e))return e.filter((e=>!t.some((t=>dt(e,t)))));if(e instanceof Set){const n=[...t];return new Set([...e].filter((e=>!n.some((t=>dt(e,t))))))}return\"object\"==typeof e&&\"-\"in e&&\"function\"==typeof e[\"-\"]?e[\"-\"](t):\"string\"==typeof e?e.split(t).join(\"\"):\"number\"==typeof e?e-t:new qe(\"operation\",`I can't use - on ${it(e)}.`)})),\"*\":(e,t)=>{let n;if(n=qe.containsError(e,t))return n;const r=\"number\"==typeof e,a=\"number\"==typeof t;return\"object\"==typeof e&&a&&e&&\"*\"in e&&\"function\"==typeof e[\"*\"]?e[\"*\"](t):\"object\"==typeof t&&r&&t&&\"*\"in t&&\"function\"==typeof t[\"*\"]?t[\"*\"](e):a&&r?t*e:new qe(\"operation\",`I can't use * on ${it(e)} and ${it(t)}.`)},\"/\":(e,t)=>{let n;if(n=qe.containsError(e,t))return n;const r=\"number\"==typeof e,a=\"number\"==typeof t;return\"object\"==typeof e&&a&&e&&\"/\"in e&&\"function\"==typeof e[\"/\"]?e[\"/\"](t):\"object\"==typeof t&&r&&t&&\"/\"in t&&\"function\"==typeof t[\"/\"]?t[\"/\"](e):a&&r?0===t?new qe(\"operation\",`I can't divide ${it(e)} by zero.`):e/t:new qe(\"operation\",`I can't use / on ${it(e)} and ${it(t)}.`)},\"%\":Ot(\"number\",Dt(((e,t)=>0===t?new qe(\"operation\",`I can't modulo ${it(e)} by zero.`):e%t)),\"modulus\"),\"<\":It(Ot(\"number\",Dt(((e,t)=>e<t)),\"do < to\"),\"<\"),\">\":It(Ot(\"number\",Dt(((e,t)=>e>t)),\"do > to\"),\">\"),\"<=\":It(Ot(\"number\",Dt(((e,t)=>e<=t)),\"do <= to\"),\"<=\"),\">=\":It(Ot(\"number\",Dt(((e,t)=>e>=t)),\"do >= to\"),\">=\"),is:It(dt),isNot:Mt(dt),contains:It(pt,\"contains\"),doesNotContain:Mt(pt,\"does not contain\"),isIn:It(((e,t)=>pt(t,e)),\"is in\"),isNotIn:Mt(((e,t)=>pt(t,e)),\"is not in\"),isA:It(ht,\"is a\"),isNotA:Mt(ht,\"is not a\"),typifies:It(((e,t)=>ht(t,e))),untypifies:Mt(((e,t)=>ht(t,e))),matches:It(ft),doesNotMatch:Mt(ft)};Object.freeze(Vt);const{imul:Ft}=Math;function Ht(e=String.fromCodePoint(Date.now()%1114112),t=0){Rt=t,Pt=e;let n,r=0,a=2166136261;for(;r<e.length;r+=1)n=Ft(e.charCodeAt(r),3432918353),n=n<<15|n>>>17,a^=Ft(n,461845907),a=a<<13|a>>>19,a=Ft(a,5)+3864292196|0;return a^=e.length,a^=a>>>16,a=Ft(a,2246822507),a^=a>>>13,a=Ft(a,3266489909),a^=a>>>16,a=(a>>>0)+1831565813*t,()=>{Rt+=1;let e=a+=1831565813;return e=Ft(e^e>>>15,1|e),e^=e+Ft(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}}let qt=Ht();function zt(e,t){qt=Ht(e,t)}const{lex:Wt}=Ve,{isArray:Bt}=Array;function Ut(e,t,n){const r=\"it\"===n?\"its\":`${n}'s`;let a=\"\";if(Bt(t)&&Bt(e)&&t.length){let o=t.length===e.length;a=\"(a:\";for(let n=0;n<t.length;n+=1){const i=t[n];if(dt(i,e[n])){const e=ut(i),t=`${r} ${n+1}th`;a+=`${e.length<t.length?e:t},`;continue}o=!1;const s=e.indexOf(i);if(s>-1){const e=ut(i),t=`${r} ${s+1}th`;a+=`${e.length<t.length?e:t},`}else a+=`${Ut(e[n],i,`${r} ${n+1}th`)},`}a=o?n:`${a.slice(0,-1)})`}else if(t instanceof Map&&e instanceof Map&&t.size){let o=t.size===e.size;a=\"(dm:\";for(let[n,i]of t.entries())if(a+=`${ut(n)},`,dt(i,e.get(n))){const e=ut(i),t=`${r} (${ut(n)})`;a+=`${e.length<t.length?e:t},`}else o=!1,a+=`${Ut(e.get(n),i,`${r} (${ut(n)})`)},`;a=o?n:`${a.slice(0,-1)})`}else if(t instanceof Set&&e instanceof Set&&t.size){const r=new Set,o=new Set;for(let n of e)t.has(n)||r.add(n);for(let n of t)e.has(n)||o.add(n);r.size||o.size||(a=n),a=r.size+o.size>t.size?ut(t):n+(o.size?`+${ut(o)}`:\"\")+(r.size?`-${ut(r)}`:\"\")}else\"string\"==typeof t&&\"string\"==typeof e&&t&&(t.startsWith(e)?a=`${n}+${ut(t.slice(e.length))}`:t.endsWith(e)&&(a=`${ut(t.slice(0,t.length-e.length))}+${n}`));return a||ut(t)}class _t{at;from;to;hash;seed;seedIter;via;constructor(e){Object.assign(this,e)}static modifierRef(e,t,n=\"it\"){let r=Ut(e,t,n);return r?new _t({via:r}):void 0}isValueRefJSON(e){return\"object\"==typeof e&&e&&(\"at\"in e||\"via\"in e||\"changer\"in e)}static dereference(e,t,n,r){if(\"at\"in t){const{at:n,from:a,to:o,hash:i,seed:s,seedIter:c}=t;if(!Xe.has(n))throw new q(`The data refers to a passage named \\`\"${n}\"\\`, but it isn't in this story.`);const l=Xe.get(n).get(\"source\");let u=l.slice(a,o);if(void 0!==i){let t=0,r=o-a;for(;T(u).toString(16)!==i;){if(t+r>=l.length)throw new q(`The value (or type) of the variable \\`$${e}\\` couldn't be found in the passage \\`\"${n}\"\\`.`);t+=1,t===a&&(t+=1),u=l.slice(t,t+r)}}const d=Wt(u,\"\",\"macro\");void 0!==s&&void 0!==c&&zt(s,c);const p=r.eval(d);let h;if(h=et(p))throw new q(`The data refers to a value that can't be stored in variables (${it(h)})`);return p}if(\"via\"in t){for(let t=n.length-1;t>=0;t-=1)if(e in n[t].variableStore){r.Identifiers.it=n[t].variableStore[e]??void 0;break}let a,o=r.eval(Wt(t.via,\"\",\"macro\"));if(a=et(o))throw new q(`The variable data refers to a value that can't be stored in variables (${it(a)})`);return r.Identifiers.it=void 0,o}throw new q(`The value (or type) of the variable \\`$${e}\\` was malformed (no \"at\" or \"via\" property).`)}}function Gt(e){return\"whitespace\"===e.type}const Xt=[[\"comment\"],[\"error\",\"text\"],[\"comma\"],[\"to\",\"into\"],[\"where\",\"when\",\"via\",\"making\",\"each\"],[\"typeSignature\"],[\"and\",\"or\"],[\"is\",\"isNot\"],[\"contains\",\"doesNotContain\",\"isIn\",\"isNotIn\"],[\"isA\",\"isNotA\",\"matches\",\"doesNotMatch\"],[\"inequality\"],[\"addition\",\"subtraction\"],[\"multiplication\",\"division\"],{rightAssociative:[\"spread\",\"bind\"]},{rightAssociative:[\"not\",\"positive\",\"negative\"]},{rightAssociative:[\"belongingProperty\",\"belongingItProperty\",\"belongingOperator\",\"belongingItOperator\"]},[\"property\",\"itsProperty\",\"possessiveOperator\",\"itsOperator\"],[\"twineLink\",\"macro\",\"identifier\",\"variable\",\"tempVariable\",\"hookName\",\"number\",\"cssMeasure\",\"boolean\",\"string\",\"hook\",\"colour\",\"datatype\",\"root\"],[\"grouping\"]];function Yt(e,t){let n,r,a;for(\"most\"===t?(n=Xt.length-1,r=a=-1):(n=0,r=Xt.length,a=1);n!==r;n+=a){let t=Xt[n],r=NaN;if(Array.isArray(t)){for(let n=e.length-1;n>=0;n-=1)if(t.includes(e[n].type)){r=n;break}}else for(let n=0;n<e.length;n+=1)if(t.rightAssociative.includes(e[n].type)){r=n;break}if(!Number.isNaN(r)&&r>-1)return[e[r],r]}throw Error(\"No precedent token found!\")}const Jt=[\"inequality\",\"is\",\"isNot\",\"isIn\",\"contains\",\"doesNotContain\",\"isNotIn\",\"isA\",\"typifies\",\"isNotA\",\"untypifies\",\"matches\",\"doesNotMatch\"],Kt={\">\":\"<=\",\"<\":\">=\",\">=\":\"<\",\"<=\":\">\"};function Qt(e){return\"inequality\"===e.type?e.negate?Kt[e.operator]:e.operator:e.type}const Zt={\">\":\"<\",\"<\":\">\",\">=\":\"<=\",\"<=\":\">=\",contains:\"isIn\",doesNotContain:\"isNotIn\",isIn:\"contains\",isA:\"typifies\",typifies:\"isA\",isNotA:\"untypifies\",untypifies:\"isNotA\"};function en(e){const t=Qt(e);return Zt[t]||t}const tn={error:\"neither\",identifier:\"neither\",variable:\"neither\",tempVariable:\"neither\",hookName:\"neither\",number:\"neither\",boolean:\"neither\",string:\"neither\",hook:\"neither\",colour:\"neither\",datatype:\"neither\",root:\"neither\",twineLink:\"neither\",macro:\"neither\",grouping:\"neither\",itsProperty:\"neither\",belongingItProperty:\"neither\",to:\"both\",into:\"both\",typeSignature:\"both\",and:\"both\",or:\"both\",belongingOperator:\"both\",possessiveOperator:\"both\",multiplication:\"both\",division:\"both\",spread:\"after\",bind:\"after\",not:\"after\",belongingProperty:\"after\",each:\"after\",itsOperator:\"after\",positive:\"after\",negative:\"after\",belongingItOperator:\"before\",property:\"before\"};function nn(e,t,n){return new qe(\"syntax\",`I need usable code to be ${e?\"left \":\"\"}${e&&t?\"and \":\"\"}${t?\"right \":\"\"}of ${n.text}.`)}function rn(e,t,n){return H(e||t,\"wrongSideError called with no tokens!\"),e?.length||(e=null),t?.length||(t=null),\"macro\"===e?.[0]?.type&&\"hook\"===n.type?new qe(\"syntax\",\"Macros can only be attached to hooks like this in passage prose, not nested in a macro call.\",\"You can place the hook and the attached macro outside of this macro call.\"):new qe(\"syntax\",`There can't be a ${e&&t?`${e.map((e=>e.text)).join(\"\")} or ${t.map((e=>e.text)).join(\"\")}`:(e||t).map((e=>e.text)).join(\"\")} to the ${e?\"left \":\"\"}${e&&t?\"or \":\"\"}${t?\"right \":\"\"}of ${n.text}.`,\"If you are trying to provide both values to a macro call, place a comma between them.\")}function an(e,{val:t,fromCode:n,toCode:r,toDesc:a,reason:o,it:i,tokens:s,i:c}){if(e.length>=200)return;let l=s[c],u=s.slice(0,c),d=s.slice(c+1);if(1===s.length&&(u=d=void 0,l=s[0]),e[e.length-1].error)return;const p=qe.containsError(t)||void 0,h=e[e.length-1].code,{basis:f=0}=e[0];u?.length&&d?.length&&u[0].start>d[0].start&&([u,d]=[d,u]);let g=r||`${u?.length&&Gt(u[u.length-1])?\" \":\"\"}${p?\" 🐞 \":ut(t)}${d?.length&&(Gt(d[0])||\"addition\"===l.type||\"subtraction\"===l.type)?\" \":\"\"}`,m=(u?.length?Gt(u[0])?u[0].end:u[0].start:l.start)-f,y=(d?.length?Gt(d[d.length-1])?d[d.length-1].start:d[d.length-1].end:l.end)-f;for(let t of e)t.start<m?(m+=t.diff,y+=t.diff):t.start<y&&(y+=t.diff);if(!n&&(n=h.slice(m,y),r&&r.trim()===n.trim()))return;const b=g.length-(y-m);e.push({code:h.slice(0,m)+g+h.slice(y),fromCode:n,toCode:p?void 0:r,toDesc:!p&&!r&&(a||it(t))||void 0,start:m,end:y,diff:b,reason:o,itIdentifier:void 0!==i?it(i):i,error:p?.render(h.slice(m,y),!0)})}function on(e,t){return t instanceof Un||t instanceof Da?(e.Identifiers.it=t.get(),t):t}function sn(e,t,n=!1,r=!1){const{evalReplay:a}=e,o=!!a?.length;let i,s,c=!1;const l=Vt;let u,d,p,h,f;H(!(Array.isArray(t)&&!t.length),\"No tokens to run!\"),Array.isArray(t)||(t=[t]),1===t.length?(u=t[0],h=f=[],p=0):([u,p]=Yt(t,\"least\"),h=t.slice(0,p),f=t.slice(p+1),h.every(Gt)&&(h.length=0),f.every(Gt)&&(f.length=0));const m=!h?.length,y=!f?.length,{type:b}=u,v=tn[b]||\"\";\"both\"===v&&(m||y)?d=nn(m,y,u):\"neither\"!==v||m&&y?\"before\"===v?m?d=nn(!0,!1,u):y||(d=rn(null,f,u)):\"after\"===v&&(y?d=nn(!1,!0,u):m||(d=rn(h,null,u))):d=rn(h,f,u),e.freeVariables&&\"object\"==typeof e.freeVariables&&function(e,t){const n=e.freeVariables;if(n&&\"object\"==typeof n)if(\"macro\"===t.type){const r=I(t.name);\"current-time\"===r||\"current-date\"===r||\"monthday\"===r||\"weekday\"===r||\"history\"===r||\"visited\"===r||\"passage\"===r?e.freeVariables=!0:!t.blockedValue||\"object\"==typeof n&&n?.blockedValues?\"random\"!==r&&\"either\"!==r&&\"shuffled\"!==r||n.seed||(n.seed=Pt,n.seedIter=Rt):n.blockedValues=e.stackTop.blockedValues?.concat()||[]}else if(\"identifier\"===t.type){const n=I(t.text);\"time\"!==n&&\"exits\"!==n&&\"user\"!==n&&\"it\"!==n&&\"visits\"!==n&&\"turns\"!==n||(e.freeVariables=!0)}else\"property\"===t.type||\"belongingProperty\"===t.type?\"random\"!==I(t.name)||n.seed||(n.seed=Pt,n.seedIter=Rt):\"variable\"!==t.type&&\"tempVariable\"!==t.type||(e.freeVariables=!0)}(e,u);const w=!0;if(H(\"comma\"!==b,\"a comma token was run() somehow.\"),d);else if(\"root\"===b)d=sn(e,u.children);else if(\"identifier\"===b)d=n?Un.create(e.Identifiers,u.text.toLowerCase()):e.Identifiers.getProperty(u.text.toLowerCase());else if(\"variable\"===b||\"tempVariable\"===b)if(d=Un.create(\"tempVariable\"===b?e.stackTop.tempVariables:io.variables,u.name),r){let e=new fa(\"any\");d=Da.create(e,d),i=o&&\"Variables in 'to' or 'into' expressions with no -type to their left are considered to be 'any-type' variables that can store any storable value.\"}else if(n||d instanceof qe)c=!0;else{const e=d.get();d=e}else if(\"hookName\"===b)d=new ka({type:\"name\",data:u.name}),c=!0;else if(\"number\"===b)d=u.value;else if(\"cssMeasure\"===b)\"ms\"===u.unit||\"s\"===u.unit?(d=u.value,i=o&&\"cssMeasure\"===b&&(\"ms\"===u.unit?\"The letters 'ms' at the end of numbers are ignored, so you can use them to indicate that a number represents milliseconds.\":\"s\"===u.unit&&\"The letter 's' at the end of numbers represents 'seconds'. Harlowe converts them to milliseconds (multiplies them by 1000).\"),c=!i):(d=new Ia(u.value,u.unit),c=!0);else if(\"boolean\"===b)d=\"true\"===u.text.toLowerCase(),c=!0;else if(\"string\"===b){const e=u.text.replace(/(.?)\\n/g,((e,t)=>`${\"\\\\\"===t?\"\\\\\\\\\":\"\\n\"===t?\"\\\\n\":t}\\\\n`)).replace(/(\\\\*)\\\\0/g,((e,t)=>`${t?\"\\\\\".repeat(2*t.length):\"\"}0`));d=window.eval(e),c=!0}else if(\"hook\"===b)d=new ir(u.children,u.text),c=!0;else if(\"colour\"===b)d=new Kr(u.colour),c=!0;else if(\"datatype\"===b)d=new fa(u.name),c=!0;else if(\"spread\"===b)d=Wa.create(sn(e,f,!1,r));else if(\"bind\"===b){const t=sn(e,f,w);if(t instanceof qe)d=t;else{if(!(t instanceof Un))throw Error(\"bind wasn't followed by a VarRef!\");d=La.create(t,u.text.startsWith(\"2\")?\"two way\":\"\")}c=!0}else if(\"to\"===b||\"into\"===b){const t=\"to\"===b?on(e,sn(e,h,w,true)):sn(e,f,w,true);if(qe.containsError(t))d=t;else{(t instanceof Un&&t.propertyChain.length<=1||t instanceof Da&&t.varRef.propertyChain.length<=1)&&(e.freeVariables=Object.create(null));const n=\"to\"===b?sn(e,f,w):on(e,sn(e,h,w));if(qe.containsError(n))d=n;else{const r=e.freeVariables;let a;e.freeVariables=null,u.place&&r&&\"object\"==typeof r&&\"boolean\"!=typeof n&&\"number\"!=typeof n&&!g.uncompressedPureValues&&(a=new _t({at:u.place,from:f[0].start,to:f[f.length-1].end,hash:T(f.reduce(((e,t)=>e+t.text),\"\")).toString(16),seed:r.seed,seedIter:r.seedIter}),JSON.stringify(a).length>=ut(n).length&&(a=void 0)),d=t instanceof qe?t:n instanceof qe?n:new Gn(t,n,b,a),c=!0,s=e.Identifiers.it}}}else if(\"typeSignature\"===b){const t=sn(e,h),n=e.freeVariables;e.freeVariables=null;const r=sn(e,f,w);e.freeVariables=n,d=t instanceof qe?d:r instanceof qe?r:Da.create(t,r),c=!0}else if(\"where\"===b||\"when\"===b||\"via\"===b)if(y)d=nn(!1,!0,u);else{const n=m?void 0:sn(e,h,w),r=t.map((e=>e.text)).join(\"\");d=ja.create(n,b,f,r),c=!0}else if(\"making\"===b||\"each\"===b)if(y)d=nn(!1,!0,u);else{const n=t.map((e=>e.text)).join(\"\");if(\"each\"===b){const t=sn(e,f,w);d=t instanceof qe?t:ja.create(t,\"each\",void 0,n)}else{const t=m?void 0:sn(e,h,w),r=sn(e,f,w);d=t instanceof qe?t:r instanceof qe?r:ja.create(t,b,r,n)}c=!0}else if(\"and\"===b||\"or\"===b){const n=e=>{const[t,r]=Yt(e,\"least\");if(t&&!Gt(t))return Jt.includes(t.type)?t:t.type===b?n(e.slice(0,r))||n(e.slice(r+1)):void 0},r=n(h),i=n(f),s=new qe(\"operation\",`This use of \"is not\" and \"${b}\" is grammatically ambiguous.`,`Maybe try rewriting this as \"__ is not __ ${b} __ is not __\"`);let c;const g=t=>{const[n,r]=Yt(t,\"least\");if(!n||Gt(n))return[];if(n.type===b)return[...g(t.slice(0,r)),...g(t.slice(r+1))];const i=sn(e,t);if(o&&\"boolean\"!=typeof i){const n=c.replace(/[A-Z]/g,(e=>` ${e.toLowerCase()}`));an(a,{toCode:` it ${n} ${ut(i)} `,reason:`A missing 'it ${n}' was inferred to correct the '${b}' operation.`,tokens:t,i:r}),an(a,{toCode:` ${ut(e.Identifiers.it)} ${n} ${ut(i)} `,tokens:t,i:r})}return[{val:i,tokens:t,i:r}]},m=(...t)=>t.reduce(((t,{val:n,tokens:r,i})=>{if(\"boolean\"==typeof n||n instanceof qe)return n;if(t instanceof qe)return t;const s=Vt[c](e.Identifiers.it,n),l=s instanceof qe?s:Vt[u.type](t,s);return o&&an(a,{val:l,tokens:r,i}),l}),\"and\"===u.type);if(r&&!i){const t=r;if(c=Qt(t),\"isNot\"===t.type||\"isNotA\"===t.type||\"untypifies\"===t.type)d=s;else{const t=sn(e,h),n=m(...g(f));d=t instanceof qe?t:n instanceof qe?n:l[b](t,n)}}else if(!r&&i){const n=i,r=t.indexOf(n);if(c=en(n),\"isNot\"===n.type||\"isNotA\"===n.type||\"untypifies\"===n.type)d=s;else{const a=[...t.slice(r+1),Object.setPrototypeOf({[\"inequality\"===n.type?\"operator\":\"type\"]:en(n)},n),...t.slice(p+1,r)],o=sn(e,a),i=m(...g(h));d=o instanceof qe?o:i instanceof qe?i:l[b](o,i)}}else{const t=sn(e,h),n=sn(e,f);d=t instanceof qe?t:n instanceof qe?n:l[b](t,n)}}else if(Jt.includes(b))if(y)d=nn(!1,!0,u);else{const t=m?e.Identifiers.it??nn(!0,!1,u):sn(e,h);if(t instanceof qe)d=t;else{const n=sn(e,f);d=n instanceof qe?n:l[Qt(u)](t,n),e.Identifiers.it=s=t,i=o&&m&&\"A missing 'it' was inferred to complete the operation.\"}}else if(\"addition\"===b||\"subtraction\"===b)if(y)d=nn(!1,!0,u);else{let n=m;if(!m){const[e,t]=Yt(h,\"least\"),r=tn[e.type],a=e.type;n=(\"both\"===r||\"after\"===r||\"addition\"===a||\"subtraction\"===a)&&(t===h.length-1||t===h.length-2&&Gt(h[h.length-1]))}if(n)u.type=\"addition\"===b?\"positive\":\"negative\",d=sn(e,t),u.type=b,c=!0;else{const t=sn(e,h),n=sn(e,f);d=t instanceof qe?t:n instanceof qe?n:l[u.text](t,n)}}else if(\"multiplication\"===b||\"division\"===b){const t=sn(e,h),n=sn(e,f);d=t instanceof qe?t:n instanceof qe?n:l[u.text](t,n)}else if(\"positive\"===b||\"negative\"===b){let t=sn(e,f);d=t instanceof qe?t:l[\"*\"](\"negative\"===b?-1:1,t),c=!0}else if(\"not\"===b){let t=sn(e,f);d=t instanceof qe?t:l.not(t,!0)}else if(\"belongingProperty\"===b){const r=sn(e,f,n);d=Un.create(r,u.name),d=n||d instanceof qe?d:d.get();n||d instanceof qe||(o&&r instanceof Un?an(a,{toCode:` ${u.name} of ${ut(r instanceof Un?r.get():r)} `,tokens:t,i:p}):r instanceof qe||(i=`The value to the right of 'of', ${st(r)}, had a \"${u.name}\" data name corresponding to that data value.`))}else if(\"belongingOperator\"===b||\"belongingItOperator\"===b){const r=sn(e,h);if(\"random\"===r&&e.freeVariables&&\"object\"==typeof e.freeVariables&&!e.freeVariables.seed&&(e.freeVariables.seed=Pt,e.freeVariables.seedIter=Rt),r instanceof qe)d=r;else{const i=\"belongingItOperator\"===b?e.Identifiers.it:sn(e,f,n);d=i instanceof qe?i:Un.create(i,{computed:!0,value:r}),d=n||d instanceof qe?d:d.get(),\"belongingItOperator\"===b&&o&&an(a,{toCode:` ${ut(r)} of ${ut(e.Identifiers.it)} `,tokens:t,i:p})}}else if(\"property\"===b){const r=sn(e,h,w);d=r instanceof qe?r:Un.create(r,u.name),d=n||d instanceof qe?d:d.get();n||d instanceof qe||(o&&r instanceof Un?an(a,{toCode:` ${ut(r.get())}'s ${u.name} `,tokens:t,i:p}):r instanceof qe||(i=`The value to the left of 's, ${st(r)}, had a \"${u.name}\" data name corresponding to that data value.`))}else if(\"itsProperty\"===b||\"belongingItProperty\"===b)d=Un.create(e.Identifiers.it,u.name),d=n||d instanceof qe?d:d.get(),o&&an(a,{toCode:\"itsProperty\"===b?` ${ut(e.Identifiers.it)}'s ${u.name} `:` ${u.name} of ${ut(e.Identifiers.it)} `,tokens:t,i:p});else if(\"possessiveOperator\"===b||\"itsOperator\"===b)if(y||m&&\"itsOperator\"!==u.type)d=nn(m,y,u);else{const r=sn(e,f);if(r instanceof qe)d=r;else{\"random\"===r&&e.freeVariables&&\"object\"==typeof e.freeVariables&&!e.freeVariables.seed&&(e.freeVariables.seed=Pt,e.freeVariables.seedIter=Rt);const i=\"itsOperator\"===u.type?e.Identifiers.it:sn(e,h,n);d=i instanceof qe?i:Un.create(i,{computed:!0,value:r}),d=n||d instanceof qe?d:d.get(),\"itsOperator\"===b&&o&&an(a,{toCode:` ${ut(e.Identifiers.it)}'s ${ut(r)} `,tokens:t,i:p})}}else if(\"twineLink\"===b)d=Et.run(\"link-goto\",e,[u.innerText,u.passage]),i=o&&\"Passage links are the same as (link-goto:) macro calls.\";else if(\"macro\"===b)if(u.blockedValue&&!e.blocked)d=e.blockedValue();else{const t=u.children[0],n=t.text.startsWith(\"$\")||t.text.startsWith(\"_\");let a;H(\"macroName\"===t.type||n,\"macro token had no macroName child token\"),n?(a=Un.create(t.text.startsWith(\"_\")?e.stackTop.tempVariables:io.variables,t.text.trim().slice(1,-1)),a instanceof qe||(a=a.get())):a=u.name;let s=a instanceof qe?[]:u.children.slice(1).reduce(((e,t)=>(\"comma\"===t.type?e.push([]):e[e.length-1].push(t),e)),[[]]).filter((e=>e.length&&(e.length>1||!Gt(e[0])))).reduce(((t,n)=>{if(t instanceof qe)return t;let a=sn(e,n,!1,r);return a instanceof qe?a:(t.push(a),t)}),[]);d=a instanceof qe?a:s instanceof qe?s:(n?Et.runCustom:Et.run)(a,e,s),i=o&&n&&(a instanceof qe?\"The macro was actually an error.\":`I called ${it(a)}.`)}else if(\"grouping\"===b)d=sn(e,u.children,n),c=!0;else if(\"comment\"===b)d=sn(e,h.concat(f.slice(1)),n),c=!0;else if(\"error\"===b)d=new qe(\"syntax\",u.message,u.explanation||\"\");else{if(\"text\"!==b)throw Error(`unknown syntax token type: ${b}!!`);{let e=\"\";u.text.trim().match(/^\\d+(?:th|nd|st|rd)(?:last)?(?:to\\d+(?:nth|nd|st|rd)(?:last)?)?$/g)&&(e=`Position data names like \"${u.text}\" need to be either left of \"of\" or right of \"'s\".`),d=new qe(\"syntax\",e||`\"${u.text}\" isn't valid Harlowe syntax for the inside of a macro call.`,\"Maybe you misspelled something? Also, as of 3.3.0, Javascript syntax is not allowed inside macro calls.\")}}return H(void 0!==d,`token ${b}${\"name\"in u?` (${u.name}:)`:\"\"} produced undefined`),o&&!c&&an(a,{val:d,reason:i,it:s,tokens:t,i:p}),d}function cn(e,t,n=\"\"){return`<${t}${n?` ${n}`:\"\"}>${e}</${t}>`}const ln=\"text-align: center; max-width:50%; \";function un(e,t){function n(e,n,r){const a=un(e.children,t);return a&&cn(a,n,r)}let r=\"\",a=[];if(!e)return r;Array.isArray(e)||(e=[e]);const o=e.length;for(let i=0;i<o;i+=1){let s=e[i];switch(s.type){case\"include\":r+=n(s,`tw-${s.type}`,`type=\"${s.tag}\" name=\"${s.name}\"`);break;case\"error\":r+=new qe(\"syntax\",s.message||\"\",s.explanation).render(D(s.text))[0].outerHTML;break;case\"comment\":i+=1;break;case\"numbered\":case\"bulleted\":{let n=\"numbered\"===s.type?\"ol\":\"ul\";r+=`<${n}>`;let a=1;for(;i<o&&e[i];){let o=e[i];if(\"br\"===o.type){if(r+=\"</li>\",!e[i+1]||e[i+1].type!==s.type)break}else if(o.type===s.type){let e=\"depth\"in o?o.depth:0;r+=`<${n}>`.repeat(Math.max(0,e-a)),r+=`</${n}>`.repeat(Math.max(0,a-e)),r+=\"<li>\",a=e}else r+=un([o],t);i+=1}r+=`</${n}>`.repeat(a+1);break}case\"align\":for(;s&&\"align\"===s.type;){const{align:n}=s,a=i+=1;if(\"left\"===n){i-=1;break}for(;i<o&&e[i]&&\"align\"!==e[i].type;)i+=1;const c=un(e.slice(a,i),t);let l=\"\";switch(n){case\"center\":l+=`${ln}margin-left: auto; margin-right: auto;`;break;case\"justify\":case\"right\":l+=`text-align: ${n};`;break;default:+n&&(l+=`${ln}margin-left: ${n}%;`)}r+=`<tw-align ${l?`style=\"${l}\"`:\"\"}>${c}</tw-align>\\n`,s=e[i]}break;case\"column\":{const n=[];for(;s&&\"column\"===s.type;){const{column:r}=s,a=i+=1;if(\"none\"===r){i-=1;break}for(;i<o&&e[i]&&\"column\"!==e[i].type;)i+=1;n.push({text:s.text,type:r,body:un(e.slice(a,i),t),width:s.width,marginLeft:s.marginLeft,marginRight:s.marginRight}),s=e[i]}if(n.length){const e=n.reduce(((e,t)=>e+t.width),0);r+=`<tw-columns>${n.map((t=>`<tw-column type=${t.type}  style=\"width:${t.width/e*100}%; margin-left: ${t.marginLeft}em; margin-right: ${t.marginRight}em;\">${t.body}</tw-column>\\n`)).join(\"\")}</tw-columns>`}break}case\"heading\":for(r+=`<h${s.depth}>`;++i<o&&e[i];){if(\"br\"===e[i].type){r+=`</h${s.depth}>`;break}r+=un([e[i]],t)}break;case\"br\":if(!a.length||/td|th/.test(a[0])){r+=\"<br>\";let t=e[i+1];for(;t&&(\"br\"===t.type||\"tag\"===t.type&&/^<br\\b/i.test(t.text));)r+=`<tw-consecutive-br${\"tag\"===t.type?\" data-raw\":\"\"}></tw-consecutive-br>`,i+=1,t=e[i+1]}break;case\"hr\":r+=\"<hr>\";break;case\"escapedLine\":case\"htmlComment\":break;case\"inlineUrl\":r+=`<a class=\"link\" href=\"${D(s.text)}\">${s.text}</a>`;break;case\"scriptStyleTag\":case\"tag\":{const e=s.text.toLowerCase();/^<\\/?(?:table|thead|tbody|tr|tfoot|td|th|svg)\\b/.test(e)&&!s.text.endsWith(\"/>\")&&a[s.text.startsWith(\"</\")?\"shift\":\"unshift\"](e),r+=s.text.startsWith(\"</\")?s.text:s.text.replace(/(\\/)?>$/,((e,t)=>` data-raw${t?`></${s.text.match(/[\\w-]+/)}`:\"\"}>`));break}case\"sub\":case\"sup\":case\"strong\":case\"em\":r+=n(s,s.type);break;case\"strike\":r+=n(s,\"s\");break;case\"bold\":r+=n(s,\"b\");break;case\"italic\":r+=n(s,\"i\");break;case\"twineLink\":{const[e]=Ve.lex(`(link-goto:${JSON.stringify(s.innerText)},${JSON.stringify(s.passage)})`).children;r+=`<tw-expression type=\"macro\" name=\"link-goto\"${g.debug?` title=\"${D(s.text)}\"`:\"\"} code=\"${t.code.length}\"></tw-expression>`,t.code.push(e);break}case\"hook\":r+=`<tw-hook ${s.hidden?\"hidden \":\"\"}${s.name?`name=\"${I(s.name)}\"`:\"\"}${g.debug&&s.name?` title=\"Hook: ?${s.name}\"`:\"\"} source=\"${t.source.length}\"></tw-hook>`,t.source.push(s.children||[]);break;case\"unclosedHook\":return r+=`<tw-hook ${s.hidden?\"hidden \":\"\"}${s.name?`name=\"${I(s.name)}\"`:\"\"}source=\"${t.source.length}\"></tw-hook>`,t.source.push(e.slice(i+1,o)),r;case\"verbatim\":r+=cn(D(s.innerText).replace(/\\n/g,\"<br>\"),\"tw-verbatim\");break;case\"collapsed\":r+=n(s,\"tw-collapsed\");break;case\"unclosedCollapsed\":return r+=`<tw-collapsed>${un(e.slice(i+1,o),t)}</tw-collapsed>`,r;case\"variable\":case\"tempVariable\":case\"macro\":{const e=[],n=[];if(\"macro\"===s.type&&function t(r){\"string\"!==r.type&&\"hook\"!==r.type&&r.children?.every(t);const a=\"name\"in r&&\"string\"==typeof r.name&&I(r.name);if(\"macro\"!==r.type||\"prompt\"!==a&&\"confirm\"!==a){if(\"hook\"===r.type&&!r.everyLeaf((e=>\"error\"!==e.type||(n.push(e),!1))))return!1}else e.push(r);return!0}(s),n.length)return new qe(\"syntax\",`This code hook's markup contained ${n.length} error${n.length?\"s\":\"\"}:<br>—${n.map((e=>e.message)).join(\"<br>—\")}`).render(D(s.text))[0].outerHTML;const a=e.map((e=>(e.blockerTree=t.blockers.length,t.blockers.push(e),e.blockerTree)));r+=`<tw-expression type=\"${s.type}\" name=\"${D(s.name||s.text)}\"${g.debug?` title=\"${D(s.text)}\"`:\"\"}${a.length?` blockers=\"${a}\"`:\"\"} code=\"${t.code.length}\"></tw-expression>`,t.code.push(s)}break;default:r+=s.children&&s.children.length?un(s.children,t):s.text}}return r}const dn={exec(e){const t={code:[],blockers:[],source:[]};const n=un(\"string\"==typeof e?Ve.lex(e).children:e,t),r=a(a.parseHTML(n,document,!0));return r.findAndFilter(\"script:not([src])\").each(((e,t)=>{const n=t.getAttribute(\"type\");n&&\"text/javascript\"!==n.toLowerCase()||t.setAttribute(\"type\",\"application/x-harlowe\")})),t.blockers=t.blockers.map((e=>{e.blockedValue=!0;const t=Object.create(e);return t.blockedValue=!1,t})),r.findAndFilter(\"tw-expression[code]:not([data-raw]), tw-expression[blockers]:not([data-raw]), tw-hook[source]:not([data-raw])\").each(((e,n)=>{let r=a(n);if(r.attr(\"blockers\")){const e=r.popAttr(\"blockers\").split(\",\").map((e=>t.blockers[+e]));r.data(\"blockers\",e)}r.attr(\"source\")&&r.data(\"source\",t.source[+r.popAttr(\"source\")]),r.attr(\"code\")&&r.data(\"code\",t.code[+r.popAttr(\"code\")])})),r}};Object.freeze(dn);const pn=RegExp(`${E}+`);function hn(e,t,n){const r=e.length;if(t>=r)return[];let a;const o=[a=0===t?e:e.splitText(t)];return n&&(n<=0&&(n=r-n),n<r&&o.push(a.splitText(n-t))),o}const fn=(()=>{let e;return()=>{if(void 0!==e)return e;const t=a(\"<p>\");return t[0].normalize?(t.append(document.createTextNode(\"0-\"),document.createTextNode(\"2\"),document.createTextNode(\"\"))[0].normalize(),e=1===t.contents().length):e=!1}})();function gn(e){const t=e[0],n=e.parent();if(!n.length||e.findAndFilter(\"tw-story\").length)return null;let r=n.textNodes().filter((e=>{const n=e.compareDocumentPosition(t);return 4&n&&!(8&n)}));const a=r[r.length-1];return a||gn(n)}function mn(e){const t=e[0],n=e.parent();if(!n.length||e.findAndFilter(\"tw-story\").length)return null;const r=n.textNodes().filter((e=>{const n=e.compareDocumentPosition(t);return 2&n&&!(8&n)}))[0];return r||mn(n)}const yn=\"tw-collapsed,[collapsing=true]\";const bn=/^(=*)([^=]+)=*$/;var vn=Object.freeze({dialog:function({section:e,parent:t=h,cd:n,message:r=\"\",defaultValue:o,buttons:i=[{name:\"OK\",confirm:!0,callback:Object}]}={}){let s=r instanceof ir?r.code:r;const c=a(`<tw-backdrop><tw-dialog>${o||\"\"===o?\"<input type=text style='display:block;margin:0 auto'></input>\\n\":\"\"}<tw-dialog-links>${i.length?i.reduce(((e,{name:t},n)=>`${e}<tw-link style='margin:0 ${n===i.length-1?\"0 0 0.5em\":0===n?\"0.5em 0 0\":\"0.5em\"}' tabindex=0>${t}</tw-link>`),\"\"):`<tw-link tabindex=0>${i[0].name}</tw-link>`}</tw-dialog-links></tw-dialog></tw-backdrop>`),l=c.find(\"tw-dialog\");if(t.append(c),e){e.renderInto(s,l,{...n,append:\"prepend\"});const t=n?.transition&&c.find(\"tw-dialog > tw-transition-container\");t&&t?.length&&t.appendTo(c).append(l.prepend(t.contents().detach()))}else l.prepend(dn.exec(s));if(o){const e=c.find(\"input\").last();e.val(`${o}`).on(\"keypress\",(({which:e})=>{13===e&&(c.remove(),i.filter((e=>e.confirm)).forEach((e=>e.callback())))})),setTimeout((()=>e.focus()),100)}return i.reverse().forEach(((e,t)=>{a(c.find(\"tw-link\").get(-t-1)).on(\"click\",(()=>{g.debug&&g.ignoreClickEvents&&!a(c).is(\".eval-replay, .harlowe-crash\")||(c.remove(),e.callback())}))})),c},realWhitespace:pn,textNodeToChars:function(e){const t=[...e.data];return 1===t.length?[e]:t.reduce(((e,t)=>(t.match(pn)&&e.length&&e[e.length-1].match(pn)?e[e.length-1]+=t:e.push(t),e)),[]).reduce(((t,n)=>{const r=e;return n.length<e.length&&(e=e.splitText(n.length)),t.concat(r)}),[])},findTextInNodes:function e(t,n){let r=[],a=\"\",o=[];if(!t.length||!n)return o;for(;t.length>0;){r.push(t[0]),a+=t[0].data,t.shift();let e=a.indexOf(n);if(e>-1){const i=a.length-(e+n.length);for(;e>=r[0].length;)e-=r[0].length,r.shift();if(1===r.length){const a=hn(r[0],e,e+n.length);o.push(a[0]),a[1]&&t.unshift(a[1]);break}o.push(hn(r[0],e,r[0].length)[0]),o.push(...r.slice(1,-1));const s=hn(r[r.length-1],0,r[r.length-1].length-i);o.push(s[0]),s[1]&&t.unshift(s[1]),o=o.filter(Boolean);break}}return[o,...e(t,n)]},collapse:function(e){function t(e){let t=void 0!==this?this:e;return\"number\"==typeof t||!t||0===a(t).parentsUntil(yn).filter(\"tw-verbatim, tw-expression, [collapsing=false]\").length}let n=gn(e);n&&!a(n).parents(yn).length&&(n=null);let r=mn(e);r&&!a(r).parents(yn).length&&(r=null);const o=\"br:not([data-raw]),tw-consecutive-br:not([data-raw])\";e.find(o).filter(t).replaceWith(document.createTextNode(\" \"));const i=(e=a(e.get().map((e=>a(e).filter(t).is(o)?a(document.createTextNode(\" \")).replaceAll(e)[0]:e)))).textNodes();let s=0;i.reduce(((e,n)=>t(n)?(n.data=n.data.replace(RegExp(`${E}+`,\"g\"),\" \"),n.data.startsWith(\" \")&&(!e?.data||e.data.search(/\\s$/)>-1)&&(n.data=n.data.slice(1)),n):document.createTextNode(\"A\")),n),[...i].reverse().every((e=>{if(!t(e))return!1;let n=e.data;return n.match(/^\\s*$/)?(s+=n.length,e.data=\"\",!0):(e.data=n.replace(/\\s+$/,(e=>(s+=e.length,\"\"))),!1)})),s>0&&r&&(i[i.length-1].data+=\" \"),e[0]&&fn()&&e[0].normalize()},geomStringRegExp:bn,geomParse:function(e){if(!e)return{marginLeft:0,size:0};const t=e.length,[n,r,a]=bn.exec(e)||[];return!n||a===e&&a.length>1?{marginLeft:0,size:0}:{marginLeft:r.length/t*100,size:a.length/t*100}}});const{collapse:wn}=vn,{assign:$n,keys:kn}=Object;class xn{desc;tempVariables;finalIter;evaluateOnly;collapses;speculativePassage;blocked;dom;blockedValues;lambdaPos;lastHookShown;constructor({desc:e,tempVariables:t,finalIter:n=!1,evaluateOnly:r,collapses:a=!1,speculativePassage:o}){this.desc=e,this.finalIter=n,this.tempVariables=t,this.collapses=a,this.evaluateOnly=r,this.speculativePassage=o}}function Sn(e){const{nextSibling:t}=\"jquery\"in e?e[0]:e;if(t&&(t instanceof Text&&!t.data.trim()||[\"br\",\"tw-consecutive-br\"].includes((t.tagName||\"\").toLowerCase()))){const{whitespace:e,nextElem:n}=Sn(t);return{whitespace:a(t).add(e),nextElem:n}}return{whitespace:a(),nextElem:a(t)}}const Tn=e=>e?.length?a(\"<tw-open-button replay label='🔍'>\").data(\"evalReplay\",e):a(),Cn={add:[],remove:[]};class Nn{static{Object.assign(this.prototype,{typeID:\"keywords\",typeName:\"the keywords\",objectName:\"the keywords\",properties:[\"it\",\"time\",\"turn\",\"turns\",\"visit\",\"visits\",\"exits\",\"exit\",\"pos\",\"user\"]})}getProperty(e){return H(e in this&&\"function\"!=typeof this[e],`No Section.Identifiers value named ${e}!`),this[e]}#e;constructor(e){this.#e=e}it;get time(){return this.#e.stackTop?.evaluateOnly?new qe(\"operation\",`'time' can't be used in ${this.#e.stackTop.evaluateOnly}.`):(Date.now()-this.#e.timestamp)*(g.debug&&void 0!==g.speedMultiplier?g.speedMultiplier:1)}get turns(){return io.turns}get turn(){return io.turns}get visits(){const{stackTop:{speculativePassage:e}}=this.#e;return io.history().filter((t=>t===(e||io.passage))).length+ +(!e||e===io.passage)}get visit(){return this.visits}get exits(){return this.#e.stackTop?.evaluateOnly?new qe(\"operation\",`'exit' and 'exits' can't be used in ${this.#e.stackTop.evaluateOnly}.`):this.#e.dom.find(\"tw-enchantment, tw-link\").filter(((e,t)=>{let n=a(t);return n.data(\"enchantmentEvent\")||n.parent().data(\"linkPassageName\")||n.parent().data(\"clickEvent\")})).length}get exit(){return this.exits}get pos(){return this.#e.stackTop&&!this.#e.stackTop.evaluateOnly&&this.#e.stackTop.lambdaPos?+this.#e.stackTop.lambdaPos||1:new qe(\"operation\",\"'pos' can only be used in lambdas that aren't 'when' lambdas.\")}get user(){return new Map([[\"width\",window.innerWidth],[\"height\",window.innerHeight],[\"orientation\",window.innerWidth>window.innerHeight?\"landscape\":\"portrait\"],[\"hover\",matchMedia(\"(any-hover: hover)\")?.matches??!1],[\"motion\",matchMedia(\"(prefers-reduced-motion: true)\")?.matches?\"reduced\":\"any\"],[\"contrast\",matchMedia(\"(prefers-contrast: more)\")?.matches?\"more\":matchMedia(\"(prefers-contrast: less)\")?.matches?\"less\":\"any\"]])}}class jn{stack=[];enchantments=[];unblockCallbacks=[];freeVariables=null;evalReplay;loadedGame=!1;constructor(e=h){$n(this,{timestamp:Date.now(),dom:e,Identifiers:new Nn(this)})}#t(e,t){let n=this.eval(t);e.append(Tn(this.evalReplay)),e.append(((e,t)=>t instanceof Zr&&/a \\((go-to|undo|redirect|restart):\\) command/.exec(t.typeName)?a(\"<tw-open-button goto label='GO'>\").data(\"goto\",{section:e,command:t}):a())(this,n)),this.stackTop.evaluateOnly&&n&&(n instanceof or||\"object\"==typeof n&&\"runCommand\"in n&&\"function\"==typeof n.runCommand)&&(n=new qe(\"syntax\",`I can't work out what ${this.stackTop.evaluateOnly} should evaluate to, because it contains a ${n instanceof or?\"changer.\":\"command.\"}`,\"Please rewrite this without putting changers or commands here.\"));let r,o,i=e,s=a();for(;n instanceof or;){let t;if(({whitespace:t,nextElem:i}=Sn(i)),i[0]instanceof Text&&\"+\"===i[0].data.trim()){let e,r=i;if(({whitespace:e,nextElem:i}=Sn(r)),i.is(\"tw-expression\")){const o=i.popData(\"code\")||i[0]?.cachedData?.code;i[0]?.cachedData&&(i[0].cachedData.code=void 0);const s=this.eval(o);if(s instanceof qe){n=s;break}const c=Vt[\"+\"](n,s);a(t).add(r).add(e).remove(),n=c instanceof qe?new qe(\"operation\",`I can't combine ${it(n)} with ${it(s)}.`,\"object\"==typeof s&&\"run\"in s&&\"function\"==typeof s.run?`If you want to attach this changer to ${it(s)}, remove the + between them.`:\"Changers can only be added to other changers.\"):c;continue}}if(i.is(\"tw-expression\")){const t=i.popData(\"code\")||i[0]?.cachedData?.code;i[0]?.cachedData&&(i[0].cachedData.code=void 0);const a=this.eval(t);if(i.append(Tn(this.evalReplay)),a instanceof qe){n=a;break}if(a&&\"object\"==typeof a&&a instanceof Zr){r||=new nr,r.section=this,n=n.run(r)||a;break}return a instanceof or?void e.replaceWith(new qe(\"operation\",`Changers like (${n.macroName}:) need to be combined using + between them.`,\"Place the + between the changer macros, or the variables holding them. The + is absent only between a changer and its attached hook or command.\").render(e.attr(\"title\"))):void e.replaceWith(new qe(\"operation\",`${it(a)} can't have changers like (${n.macroName}:) attached.`,\"Changers placed just before hooks, links and commands will attempt to attach, but in this case it didn't work.\").render(e.attr(\"title\")))}if(i.is(\"tw-hook\")){t.remove(),s=i;break}const o=e.attr(\"title\")||`(${n.macroName}: ...)`;return void e.replaceWith(new qe(\"syntax\",`The (${n.macroName}:) changer should be stored in a variable or attached to a hook.`,`Macros like this should appear before a hook: ${o}[Some text]`).render(e.attr(\"title\")))}if(s=s.length?s:Sn(e).nextElem.filter(\"tw-hook\"),o=qe.containsError(n))e.replaceWith(o.render(e.attr(\"title\")).append(Tn(this.evalReplay)));else if(e.attr(\"return\",ct(n)),n instanceof na)e.append(n.render());else if(\"object\"==typeof n&&\"runCommand\"in n&&\"function\"==typeof n.runCommand){r||=new nr,r.section=this;let t=n.runCommand(this,r);if(t instanceof qe)e.replaceWith(t.render(e.attr(\"title\")));else if(t instanceof na)g.debug&&e.replaceWith(t.render());else if(t instanceof nr){if(t.data?.live)return void e.replaceWith(new qe(\"unimplemented\",\"I currently can't attach (live:) or (event:) macros to commands - only hooks.\").render(e.attr(\"title\")));t.section=this,t.target=i,this.renderInto(\"\",i,t)}else{if(Je(t)&&\"blocked\"in t&&t.blocked)return this.stackTop.blocked=t.blocked,void e.data(\"code\",{type:\"macro\",blockedValue:!0,text:e.attr(\"title\")||\"\",start:0,end:(e.attr(\"title\")||\"\").length});H(void 0===t,`runCommand() of ${it(n)} returned ${typeof t}: ${t}`)}}else{if(s.length&&this.#n(e,n,s))return;if(\"string\"==typeof n||\"number\"==typeof n||n instanceof Map||n instanceof Set||Array.isArray(n)||\"object\"==typeof n&&\"print\"in n&&\"function\"==typeof n.print&&!(n instanceof or)){let t=yt(n);t instanceof qe?e.replaceWith(t.render(e.attr(\"title\"))):(H(\"string\"==typeof t||Array.isArray(t),\"printBuiltinValue() produced a non-string non-array \"+typeof t),this.renderInto(t,e))}else H(n instanceof or||\"boolean\"==typeof n,`The expression evaluated to an unknown value: ${n}`)}}#r(e,t,n){const{delay:r,event:a}=n.data(\"live\");(t=Object.setPrototypeOf({...t,append:\"replace\",transitionDeferred:!1,enabled:!0},nr.prototype)).data={...t.data,live:void 0};const o=n.data(\"originalSource\")||\"\",{tempVariables:i}=this.stackTop;let s,c,l=r;const u=e=>{s&&(l-=(e-s)*(g.debug&&void 0!==g.speedMultiplier?g.speedMultiplier:1)),s=e,l>0?requestAnimationFrame(u):(l=r,c())};c=this.whenUnblocked.bind(this,(()=>{if(!this.inDOM())return;const r=a?.filter(this,[!0],i);qe.containsError(r)?r.render(this,e.attr(\"title\")).replaceAll(e):!a||r[0]?(this.renderInto(o,n,t,i),r||n.find(\"tw-expression[name='stop']\").length||this.inDOM()&&requestAnimationFrame(u)):requestAnimationFrame(u)})),requestAnimationFrame(u)}#n(e,t,n){if(t&&\"object\"==typeof t&&t instanceof or){const r=n.popData(\"source\")||n[0].cachedData?.source;n[0]?.cachedData&&(n[0].cachedData.source=void 0),n.data(\"originalSource\",r);const a=new nr({target:n,source:r,section:this,append:\"append\"}),o=t.run(a);o instanceof qe&&e.replaceWith(o.render(e.attr(\"title\")));if(!this.renderInto(r,void 0,a)){const t=I(e.attr(\"name\"));return[\"if\",\"elseif\",\"unless\",\"else\",\"testfalse\"].includes(t)&&(e.addClass(\"false\"),\"elseif\"!==t&&(this.stackTop.lastHookShown=!1)),n.data(\"live\")&&this.#r(e,a,n),!0}}else{if(!1===t){const t=n.popData(\"source\")||n[0].cachedData?.source;return n[0]?.cachedData&&(n[0].cachedData.source=void 0),t&&(n.data(\"originalSource\",t),n.data(\"hidden\",!0)),e.addClass(\"false\"),this.stackTop.lastHookShown=!1,!0}if(!0!==t)return!1}return this.stackTop.lastHookShown=!0,!0}eval(e){if(g.debug&&g.evalReplay){const t=Array.isArray(e)?e.reduce(((e,t)=>e+t.text),\"\"):e.text||\"\";this.evalReplay=[{code:t,fromCode:t,basis:(Array.isArray(e)?e[0]:e).start,start:0,end:t.length,diff:0}]}let t;try{t=sn(this,e)}catch(t){return window.console?.error(t),this.evalReplay=void 0,new qe(\"other\",`An internal error occurred while trying to run ${[].concat(e).map((e=>e.text)).join(\"\")}.`,`The error was \"${t.message}\".\\nIf this is the latest version of Harlowe, please consider reporting a bug (see the documentation).`)}return this.evalReplay&&2===this.evalReplay.length&&this.evalReplay.shift(),t}get stackTop(){return this.stack[0]}inDOM(){return h.find(this.dom).length>0}evaluateTwineMarkup(e,t){const n=a(\"<p>\");let r;return this.stack.unshift(new xn({desc:new nr({target:n,source:e,section:this,append:\"append\"}),tempVariables:this.stackTop.tempVariables||void 0,evaluateOnly:t,finalIter:!0})),this.execute(),(r=n.find(\"tw-error\")).length>0?r:n}speculate(e,t,n){this.stack.unshift(new xn({tempVariables:new za(n),finalIter:!0,evaluateOnly:n,speculativePassage:t}));const{evalReplay:r}=this;let a;return this.evalReplay=void 0,e instanceof ja?a=e.apply(this,{loop:void 0,pos:1}):e&&(a=sn(this,e)),this.stack.shift(),this.evalReplay=r,a}renderInto(e,t,n,r=null){const a=new nr({target:t,source:e,section:this,append:\"append\"});if(n)if(n instanceof or){const e=n.run(a);if(e instanceof qe&&t)return e.render(t.attr(\"title\")).replaceAll(t),!1}else $n(a,n);const o=\"function\"==typeof a.target?a.target():a.target;if(H(o,\"No target!\"),this.stack.length>=50){if(this.stack.reduce(((e,{finalIter:t})=>e+ +!!t),0)>=50)return new qe(\"infinite\",\"Printing this expression may have trapped me in an infinite loop.\").render(o.attr(\"title\")).replaceAll(o),!1}if(!r){const e=o?.tag();r=new za(\"tw-hook\"===e?o.attr(\"name\")?`?${o.attr(\"name\")}`:\"an unnamed hook\":\"tw-expression\"===e?`a ${o.attr(\"type\")} expression`:\"tw-passage\"===e?\"this passage\":\"an unknown scope\",\"temp\",this.stack.length?this.stackTop.tempVariables:null)}const i=this.stackTop?.blocked;if(a.loopVars&&kn(a.loopVars).length){let e=Math.min(...Object.values(a.loopVars).map((e=>e.length)));if(new na(`${e} loop${1!==e?\"s\":\"\"}`).render().prependTo(o),e){for(let t=e-1;t>=0;t-=1){const n=new za(\"a (for:) loop's variables\",\"temp\",r);for(let e in a.loopVars)n.variableStore[e]=a.loopVars[e][t];this.stack.unshift(new xn({desc:a,tempVariables:n,finalIter:t===e-1,evaluateOnly:this.stackTop?.evaluateOnly,collapses:\"jquery\"in o&&o.is(\"tw-hook\")&&o.parents(\"tw-collapsed,[collapsing=true]\").length>0}))}for(let t=e-1;t>=0&&!this.stackTop.blocked;t-=1)this.execute()}}else this.stack.unshift(new xn({desc:a,tempVariables:r,finalIter:!0,evaluateOnly:this.stackTop?.evaluateOnly,collapses:\"jquery\"in o&&o.is(\"tw-hook\")&&o.parents(\"tw-collapsed,[collapsing=true]\").length>0})),this.execute();return(0===this.stack.length||!i&&this.stackTop?.blocked)&&this.updateEnchantments(),a.enabled}execute(){let{desc:e,dom:t,collapses:n,evaluateOnly:r}=this.stackTop;t||(H(e,\"No dom or desc!\"),t=e.render(),this.stackTop.dom=t,this.stackTop.desc=void 0),t.findAndFilter('tw-hook,tw-expression,script[type=\"application/x-harlowe\"]').each(((e,t)=>{let n=a(t).data();t.cachedData={blockers:n.blockers,code:n.code,source:n.source}})).each(((e,t)=>{if(this.stackTop.blocked)return!1;let{cachedData:n}=t;n&&(t.cachedData=void 0);const o=a(t);switch(o.tag()){case\"tw-hook\":{let e=o.popData(\"source\")||n?.source;if(e&&o.data(\"originalSource\",e),o.data(\"tempVariables\",this.stackTop.tempVariables),o.popAttr(\"hidden\")){o.data(\"hidden\",!0);break}e&&this.renderInto(e,o);break}case\"tw-expression\":{const e=o.data(\"blockers\")||n?.blockers;if(e){if(r)return void o.removeData(\"blockers\").removeData(\"code\").replaceWith(new qe(\"syntax\",`I can't use a macro like (prompt:) or (confirm:) in ${r}.`,\"Please rewrite this without putting such macros here.\").render(o.attr(\"title\")));if(e.length){this.stackTop.blocked=!0;let t=this.eval(e.shift());return t instanceof qe&&(this.stackTop.blocked=!1,o.removeData(\"blockers\").replaceWith(t.render(o.attr(\"title\")))),!1}o.removeData(\"blockers\")}const t=o.popData(\"code\")||n?.code;t&&this.#t(o,t);break}case\"script\":if(F(),!o.text())break;try{i=o.text(),s=this.stackTop.tempVariables,Function(\"script\",\"$\",\"scope\",\"with(scope){var scope=void 0,arguments=void 0;eval([script,script=void 0][0]);}\")(i,a,Object.create(null,Object.keys(io.variables.variableStore).map((e=>`$${e}`)).concat(Object.keys(s.variableStore).map((e=>`_${e}`))).reduce(((e,t)=>(t&&(e[t]={get(){const e=(t.startsWith(\"$\")?io.variables.variableStore:s.variableStore)[t.slice(1)];if(!vt(e))throw new qe(\"datatype\",`The contents of the variable ${t}, ${it(e)}, couldn't be converted to a Javascript value.`,\"Only booleans, strings, numbers, datamaps, datasets and arrays can be converted to Javascript values.\");return at(e)},set(e){const n=t.startsWith(\"$\")?io.variables:s;if(!vt(e))throw new qe(\"datatype\",`The Javascript value, ${e}, couldn't be converted to a Harlowe value and assigned to the variable ${t}.`,\"Only booleans, strings, numbers (except NaN and Infinity), Maps, Sets and Arrays can be converted to Harlowe values.\");e=at(e);let r=Un.create(n,t.slice(1));if(r instanceof qe)throw r;let a=r.set(e);if(a instanceof qe)throw a}}),e)),{})))}catch(e){e instanceof qe?o.replaceWith(e.render(o.text())):(window.console?.error(e),o.replaceWith(new qe(\"other\",\"A Javascript error occurred while running this <script> element.\",`The error was \"${e}\". Check the browser console for more details.`).render(o.text())))}}var i,s})),this.stackTop.blocked||(t.length&&n&&wn(t),t.findAndFilter(\"tw-collapsed,[collapsing=true]\").each(((e,t)=>{wn(a(t))})),setTimeout((()=>t.find(\"input, textarea\").first().focus()),100),this.stack.shift())}updateEnchantments(){this.enchantments.forEach((e=>{e.disenchant(),e.enchantScope()}))}static on(e,t){return Cn[e].push(t),this}addEnchantment(e){this.enchantments.push(e),Cn.add.forEach((t=>t(this,e)))}removeEnchantment(e){const t=this.enchantments.indexOf(e);this.enchantments.splice(t,1),e.disenchant(),Cn.remove.forEach((t=>t(this,e)))}unblock(e){for(H(this.stack.length,\"stack is empty\"),this.stackTop.blocked=!1,void 0!==e&&(this.stackTop.blockedValues=(this.stackTop.blockedValues||[]).concat(e));this.stack.length&&!this.stackTop.blocked;)this.execute();if(!this.stack.length)for(;this.unblockCallbacks.length>0;){const e=this.unblockCallbacks.shift();if(e?.(),this.stackTop?.blocked)return}}whenUnblocked(e,t=e){this.stack.length&&this.stackTop.blocked?this.unblockCallbacks=this.unblockCallbacks.concat(e):t()}blockedValue(){const{stackTop:e}=this;return H(e,\"stack is empty\"),H(e.blockedValues?.length,\"blockedValues is missing or empty\"),e.blockedValues.shift()}}Object.preventExtensions(jn),Object.preventExtensions(jn.prototype);const{isArray:An}=Array,{hasOwn:En}=Object;function On(e){return!!e&&\"object\"==typeof e&&\"computed\"in e}const Dn={set:[],delete:[]},In=\"You can only access position strings/numbers ('4th', 'last', '2ndlast', (2), etc.), slices ('1stTo2ndlast', '3rdTo5th'), \",Mn=\"You can't access the '0th' or '0thlast' position of \";function Ln(e,t){if(e instanceof Map){let n=tt(e,t);return n instanceof qe?n:t}if(rt(e)){let n;if(\"number\"==typeof t){if(0===t)return new qe(\"property\",`You can't access elements at position 0 of ${it(e)}.`,\"Only positive and negative position values exist.\");if(t>0)return t-1}else{if(\"string\"==typeof t&&(n=/^(\\d+)(?:st|[nr]d|th)last$/i.exec(t)))return\"0\"===n[1]?new qe(\"property\",`${Mn+it(e)}.`):-n[1];if(\"string\"==typeof t&&(n=/^(\\d+)(?:st|[nr]d|th)$/i.exec(t)))return\"0\"===n[1]?new qe(\"property\",`${Mn+it(e)}.`):+n[1]-1;if(\"string\"==typeof t&&(n=/^(?:(\\d+)(?:st|[nr]d|th)(last)?|last)to(?:(\\d+)(?:st|[nr]d|th)(last)?|last)$/i.exec(t))){let[,e=0,t,r=0,a]=n;return e=t?-e:+e-1,r=a?-r:+r-1,{last:r,first:e}}if(\"last\"===t)return-1;if(\"random\"===t)return e instanceof ka||!e.length?new qe(\"property\",`I can't get a random value from ${it(e)}, because it's empty.`):io.random()*Array.from(e).length|0;if(e instanceof ka)return\"string\"==typeof t&&e.properties.includes(t)?t:new qe(\"property\",`${In+A(e.properties.map((e=>`'${e}'`)))} of ${it(e)}, not ${\"string\"==typeof t?ut(t):it(t)}.`);if(\"string\"!=typeof t||![\"length\",\"some\",\"all\",\"start\",\"end\",\"random\"].includes(t))return new qe(\"property\",`${In}'length', 'some', 'any', 'all', 'start', 'end', and 'random' of ${it(e)}, not ${\"string\"==typeof t?ut(t):it(t)}.`)}}else if(e instanceof Set){if(![\"length\",\"some\",\"all\"].includes(`${t}`))return new qe(\"property\",`${In}'length', 'some', 'any', and 'all' of ${it(e)}.`,\"You can't access specific individual data values from datasets.\");if(\"length\"===t)return\"size\"}else if(e&&\"object\"==typeof e&&\"properties\"in e&&An(e.properties)){if(!e.properties.includes(`${t}`))return new qe(\"property\",`${In+A(e.properties.map((e=>`'${e}'`)))} of ${it(e)}, not ${\"string\"==typeof t?ut(t):it(t)}.`)}else if(!(e instanceof za||e instanceof Nn))return new qe(\"property\",`You can't get any data values, let alone ${it(t)}, from ${it(e)}`);return t}function Rn(e,t){return t-0<0&&Math.abs(t)<=e.length?e.length+(t-0):t}class Pn{#a;determiner;determined;array;string;static{Object.assign(this.prototype,{typeID:\"determiner\",unstorable:!0})}get objectName(){return this.#a+it(this.determined)}toSource(){return`${this.determiner} of ${ut(this.determined)}`}get typeName(){return`${this.#a}a data structure`}print(){return`\\`[${this.typeName}]\\``}constructor(e,t){this.#a=`\"${t} value${\"some\"===t?\"\":\"s\"}\" of `,this.string=\"string\"==typeof e?e:void 0,this.determiner=t,this.determined=e,this.array=[...e]}}const Vn=/[^\\uD801-\\uDFFF]/,Fn=new Map;function Hn(e){if(On(e)){let{value:t}=e;return t instanceof Un&&(t=t.get()),\"string\"==typeof t?`('${t}')`:`(${t})`}return\"object\"==typeof e&&\"last\"in e?ut(e):\"number\"==typeof e?N(e):`'${e}'`}function qn(e,t,n){if(e instanceof za){if(e.typeDefs&&t in e.typeDefs){const r=e.typeDefs[t];if(e===io.variables&&void 0!==io.definitions.getProperty(t))return new qe(\"operation\",`I can't alter $${t}, because it was created using (define:).`,\"This variable can't be changed for the rest of the story.\");if(r instanceof fa&&\"const\"===r.name){if(void 0!==e.variableStore[t])return new qe(\"operation\",`I can't alter ${e===io.variables?\"$\":\"_\"}${t} because it's been restricted to a constant value.`,\"This variable can't be changed for the rest of the story.\")}else if(void 0!==n&&!ft(r,n))return new qe(\"operation\",`I can't set ${e===io.variables?\"$\":\"_\"}${t} to ${st(n)} because it's been restricted to ${ut(r)}-type data.`,\"You can restrict a variable or data name by giving a typed variable to (set:) or (put:).\")}return!0}if(An(t)){for(let n of t){let t=qn(e,n);if(t instanceof qe)return t}return!0}return e instanceof Map?\"string\"==typeof t||new qe(\"operation\",`${it(e)} can only have string data names, not ${it(t)}.`):rt(e)?[\"length\",\"random\",\"some\",\"all\",\"start\",\"end\"].includes(t)?new qe(\"operation\",`I can't forcibly alter the '${Hn(t)}' of ${it(e)}.`,\"start\"===t||\"end\"===t?`Alter the values at actual positions, like 1st or 2ndlast, rather than just the '${t}'.`:void 0):\"object\"==typeof t?new qe(\"operation\",`I can't alter a range of positions, like ${Hn(t)}.`,\"Specify each position individually using (a:), such as (a:2,3,4) instead of 2ndto4th.\"):+t==(0|+t)||new qe(\"property\",`${it(e)} can only have position data names ('3rd', '1st', (5), etc.), not ${Hn(t)}.`):new qe(\"operation\",`I can't modify ${it(e)}`,e instanceof Set?\"You should use an (array:) if you need to modify the data inside this dataset.\":e instanceof ka?\"You should alter hooks indirectly using macros like (replace:) or (enchant:).\":void 0)}function zn(e,t,n,r){const a=t;if(e instanceof Map)e.set(t,n);else if(!rt(e)||e instanceof ka||(t=Rn(e,t)),nt(e,\"set\"))e.set(t,n,r);else{if(!Array.isArray(e))throw Error(`Tried to set ${t} on an invalid ${typeof e}!`);e[t]=n}Dn.set.forEach((t=>t(e,a,n)))}function Wn(e,t){const n=t;if(!rt(e)||e instanceof ka||(t=Rn(e,t)),An(e)&&/^(?:[1-9]\\d*|0)$/.exec(`${t}`))e.splice(+t,1);else if(e instanceof Map||e instanceof Set)e.delete(t);else{if(!nt(e,\"delete\"))throw Error(`Tried to delete ${t} from an invalid ${typeof e}!`);e.delete(t)}Dn.delete.forEach((t=>t(e,n)))}function Bn(e,t,n=t,r=!1){if(t&&\"object\"==typeof t&&\"last\"in t){if(e instanceof ka)return e.getProperty(t);const{first:n,last:r}=t;if(rt(e))return gt(e,n+ +(n>=0),r+ +(r>=0));throw Error(`Tried to get a slice (${n} to ${r}) from a non-sequential!`)}if(An(t)){if(e instanceof ka)return e.getProperty(t);let n;for(let r of t){const t=Bn(e,r,r);if(t instanceof qe)return t;n=void 0===n?t:\"string\"==typeof e?n+t:(Array.isArray(n)?n:[n]).concat(t)}return n}const a=function(e,t){if(void 0===e)return e;if(e instanceof Map)return e.get(t);if(!(\"some\"!==t&&\"all\"!==t&&\"start\"!==t&&\"end\"!==t||e instanceof za))return new Pn(e,t);if(\"string\"==typeof e)if(Fn.has(e))e=Fn.get(e);else if(Vn.test(e)){const t=[...e];Fn.set(e,t),e=t}else Fn.set(e,e);if(rt(e)&&Number.isFinite(t)&&(t=Rn(e,t)),nt(e,\"getProperty\"))return e.getProperty(t);if((Array.isArray(e)||\"string\"==typeof e)&&(\"number\"==typeof t||\"length\"===t)||e instanceof Set&&\"size\"===t)return e[t];throw Error(`Tried to get ${t} from an invalid ${typeof e}!`)}(e,t);if(void 0===a){if(r)return a;if(e instanceof za){if(e instanceof za&&\"temp\"===e.type){const t=\"temp\"===e.type;return new qe(\"property\",`There isn't a ${t?\"temp \":\"\"}variable named ${t?\"_\":\"$\"}${n} in this place yet.`,\"Temp variables only exist inside the same passage, hook, or lambda in which they're created.\")}return new qe(\"property\",`There isn't a story-wide variable named $${n} yet.`,\"Story-wide variables need to be created with (set:), (put:), or (unpack:) before being used.\")}if(An(e)&&\"number\"==typeof t)return new qe(\"property\",`This array of ${e.length} elements doesn't have a ${Hn(\"number\"==typeof n?n+1:n)} element.`,e.length?`It contains: ${A(e.map(it))}.`:\"The array is empty.\");if(e instanceof Map){const t=Array.from(e.keys());return new qe(\"property\",`I can't find a ${Hn(n)} data name in ${it(e)}`,e instanceof Map&&t.length?`Its names include: ${A(t)}.`:void 0)}if(\"string\"==typeof e)return new qe(\"property\",`I can't get the ${n} character in ${it(e)}, because it is only ${e.length} characters long.`);throw Error(`Getting ${t} from ${it(e)} produced undefined!`)}return a}class Un{#o(e,t){let n=this.compiledPropertyChain.reduce(((e,t)=>{if(e instanceof qe)return e;let n;if(0===e.length)n=this.object;else if(n=Bn(...e[e.length-1]),n instanceof qe)return n;return e.push([n,t]),e}),[]);if(n instanceof qe)return n;let r=n.reduceRight(e,t);return r instanceof qe?r:void 0}get(){let e=this.object;for(let t=0;t<this.compiledPropertyChain.length-1;t+=1){let n=Bn(e,this.compiledPropertyChain[t]);if(H(void 0!==n,\"get() returned undefined!\"),n instanceof qe)return n;e=n}const t=Bn(e,this.compiledPropertyChain.slice(-1)[0],this.propertyChain.slice(-1)[0]);return H(void 0!==t,\"get() returned undefined!\"),t}has(){let e=this.object;for(let t=0;t<this.compiledPropertyChain.length-1;t+=1){let n=Bn(e,this.compiledPropertyChain[t],this.propertyChain[t],!0);if(void 0===n)return!1;e=n}return void 0!==Bn(e,this.compiledPropertyChain.slice(-1)[0],this.propertyChain.slice(-1)[0],!0)}set(e,t){return e instanceof qe?e:this.object instanceof Nn?new qe(\"operation\",`I can't alter the value of the '${this.getName()}' identifier.`,\"You can only alter data in variables, not fixed identifiers.\"):!this.object||this.object instanceof za?this.#o(((e,[n,r],a)=>{if(e instanceof qe)return e;let o;if(H(!(e instanceof za),\"a VarScope is being set as a value!\"),o=et(e))return new qe(\"operation\",`${it(e)} can't be stored${o===e?\"\":Ze(e)?` because it holds ${it(o)}`:\"\"}.`);let i=qn(n,r,e);if(i instanceof qe)return i;if(a>0)n=at(n);else if(n instanceof za&&\"temp\"===n.type&&\"string\"==typeof r){let e=n;for(;e instanceof za&&\"temp\"===e.type;){if(En(e.variableStore,r)){n=e;break}e=e.parent}}if(\"string\"==typeof n){if(\"string\"!=typeof e)return new qe(\"datatype\",`I can't put this non-string value, ${it(e)}, in a string.`);if(e.length!==(An(r)?r.length:1))return new qe(\"datatype\",`${it(e)}is not the right length to fit into this string location.`);let t=[...n];const a=[...e];[].concat(r).forEach((e=>{+e<0&&(e=t.length+ +e),t=[...t.slice(0,+e),a.shift(),...t.slice(+e+1)]})),n=t.join(\"\")}else Je(n)&&(e instanceof ca&&void 0!==e.knownName&&(\"\"!==e.knownName&&(e=at(e)),e.knownName=ut(this)),An(r)&&rt(e)?(\"string\"==typeof e&&(e=[...e]),r.map(((t,n)=>[t,e[n]])).forEach((([e,r])=>zn(n,e,r,t)))):zn(n,r,e,t));return n}),e):new qe(\"macrocall\",`I can't (set:) ${it(this)}, if the ${(it(this.object).match(/ (.+$)/)||[\"\",\"value\"])[1]} isn't stored in a variable.`,\"Modifying data structures that aren't in variables won't change the game state at all.\")}delete(){return this.#o(((e,[t,n],r)=>{if(e instanceof qe)return e;H(!(e instanceof za),\"a VarScope is being deleted!\");let a=qn(t,n,e??void 0);if(a instanceof qe)return a;if(r>0&&(t=at(t)),null===e){const e=\"string\"==typeof t;e&&(t=[...t]),An(n)?(rt(t)&&(n=[...new Set(n)]).sort(((e,n)=>Rn(t,+n)-Rn(t,+e))),n.forEach((e=>Wn(t,e)))):Wn(t,n),e&&(t=t.join(\"\"))}else zn(t,n,e);return t}),null)}defineType(e){const{object:t,compiledPropertyChain:n}=this;if(!(t instanceof za))throw Error(\"Tried to defineType() on a non-variable VarRef!\");const r=n[0],a=t.typeDefs,o=a[r];if(o&&!dt(o,e))return new qe(\"operation\",`I can't redefine the type of ${it(this)} to ${it(e)}, as it is already ${it(o)}.`);nt(t,\"defineType\")?t.defineType(r,e):a[r]=e,e instanceof fa&&\"const\"===e.name&&delete t.variableStore[r]}matches(e,t){return this.object===e&&this.compiledPropertyChain[0]===t}getName(){if(!(this.object instanceof za||this.object instanceof Nn))throw Error(`This VarRef's base is ${it(this.object)}, not a VarScope!`);return this.compiledPropertyChain[0]}static create(e,t){if(!Array.isArray(t)&&(t=[].concat(t)),e instanceof Un&&(t=e.propertyChain.concat(t),e=e.object),!(\"string\"==typeof(n=e)||n instanceof Map||n instanceof Set||Array.isArray(n)||n instanceof za||nt(n,\"getProperty\")))return new qe(\"operation\",`${it(e)} doesn't have data names, let alone ${Hn(t[0])}`);var n;const r=function(e,t){let n=[];for(let r=0;r<t.length;r+=1){const a=t[r];let o,i=On(a)?a.value:a;if(i instanceof Un){let e=i.get();if(e instanceof qe)return e;i=e}if(An(i)){let t=[];for(let n=0;n<i.length;n+=1)if(t[n]=Ln(e,i[n]),t[n]instanceof qe)return t[n];o=t}else o=Ln(e,i);if(o instanceof qe)return o;if(r<t.length-1){const t=Bn(e,o);if(t instanceof qe)return t;e=t}n.push(o)}return n}(e,t);return r instanceof qe?r:new Un(e,t,r)}constructor(e,t,n){this.object=e,this.propertyChain=t,this.compiledPropertyChain=n}toSource(){const e=(e,t)=>!t&&this.object instanceof za?e:Hn(e);return(this.object===io.variables?\"$\":this.object instanceof za&&\"temp\"===this.object.type?\"_\":this.object instanceof Nn?\"\":`${ut(this.object)}'s `)+(this.object instanceof Nn?this.propertyChain[0]:1===this.propertyChain.length?e(this.propertyChain[0]):this.propertyChain.reduce(((t,n,r)=>`${t}'s ${e(n,r)}`)))}static{Object.assign(this.prototype,{typeID:\"varref\",typeName:\"a variable reference\"})}get objectName(){return this.object instanceof za?`the ${\"temp\"===this.object.type?\"temp \":\"\"}variable ${this.toSource()}`:this.object instanceof Nn?`the '${this.propertyChain[0]}' keyword`:`${it(this.object)}'s ${1===this.propertyChain.length?Hn(this.propertyChain[0]):this.propertyChain.reduce(((e,t)=>`${e}'s ${Hn(t)}`))}`}static on(e,t){return\"function\"!=typeof t||Dn[e].includes(t)||Dn[e].push(t),Un}}function _n(e,t,n=!0){let r,a=[];if(t instanceof qe)return t;if(r=t instanceof Un?t.get():t,r instanceof qe)return r;if(Array.isArray(r)&&Array.isArray(e)){let o=0,i=0;for(;o<e.length&&i<r.length;){let n=e[o],s=r[i];if(n instanceof Da&&n.datatype instanceof fa&&n.datatype.rest||n instanceof fa&&n.rest){const e=i;for(;i<r.length&&ft(n,s);)i+=1,s=r[i];n instanceof Da?n.datatype=[n.datatype]:n instanceof fa&&(n=new fa(\"array\"));let o=_n(n,t instanceof Un?Un.create(t,{first:e+1,last:i+1}):r.slice(e,i));if(o instanceof qe)return o;a=a.concat(o)}else{let e=_n(n,t instanceof Un?Un.create(t,i+1):s);if(e instanceof qe)return e;a=a.concat(e),i+=1}o+=1}return o<e.length?n?new qe(\"operation\",`I can't unpack this array because it needs ${e.length-o} more value${e.length-o>0?\"s\":\"\"}.`):[]:a}if(e instanceof Map&&r instanceof Map){for(const[o,i]of e.entries()){if(!r.has(o))return n?new qe(\"operation\",`I can't unpack this datamap because it needs a '${o}' data name.`):[];const e=_n(i,t instanceof Un?Un.create(t,o):r.get(o));if(e instanceof qe)return e;a=a.concat(e)}return a}if(e instanceof Da){if(e.datatype instanceof ma){let n=e.datatype.destructure(r);return n instanceof qe?n:[{dest:e,value:r,src:t}].concat(n)}if(!ft(r,e.datatype))return n?new qe(\"operation\",`I can't put ${it(r)} into ${e.varRef.toSource()} because it doesn't match ${e.varRef.toSource()}'s datatype, ${it(e.datatype)}.`):[];let o=_n(e.datatype,r);if(o instanceof qe)return o;a=a.concat(o)}if(e instanceof Un||e instanceof Da)return a.concat({dest:e,value:r,src:t});if(e instanceof ma){const t=e.destructure(r);return t instanceof qe?t:a.concat(t)}return ft(r,e)?a:n?new qe(\"operation\",`I tried to unpack, but ${it(e)} in the pattern didn't match ${it(r)}.`):[]}Object.freeze(Un),Object.freeze(Un.prototype);class Gn{static{Object.assign(this.prototype,{typeID:\"variabletovalue\",typeName:\"a VariableToValue (a 'to' or 'into' expression)\",objectName:\"a VariableToValue (a 'to' or 'into' expression)\",unstorable:!0})}toSource(){return\"into\"===this.operator?`${ut(this.src)} ${this.operator} ${ut(this.dest)}`:`${ut(this.dest)} ${this.operator} ${ut(this.src)}`}set(e=!1){let t,n=[];const r=_n(this.dest,this.src);if(t=qe.containsError(r))return t;if(!Array.isArray(r)||!r.length)return new qe(\"operation\",`I can't store a new value inside ${it(this.dest)} that isn't in a variable.`,\"You need a variable, or a data structure containing variables at certain positions, to store the value.\");for(let{dest:a,value:o,src:i}of r.reverse()){if(a instanceof Da){let e=a.defineType();if(e instanceof qe)return e;a=a.varRef}if(t=a.set(o,this.srcRef),t instanceof qe)return t;e&&i&&i.delete(),n.unshift(`${it(a)} is now ${it(o)}`)}return n.join(\"; \")}constructor(e,t,n,r){Object.assign(this,{dest:e,src:t,operator:n,srcRef:r})}}Object.freeze(Gn),Object.freeze(Gn.prototype);const{exec:Xn}=dn,{assign:Yn,keys:Jn,seal:Kn,hasOwn:Qn}=Object,{isArray:Zn}=Array,er=e=>(\"string\"==typeof e?e:e.map((e=>e.text)).join(\"\")).split(/\\n/g).reduce(((e,t,n,{length:r})=>e.concat(document.createTextNode(t),n!==r-1?document.createElement(t.length?\"br\":\"tw-consecutive-br\"):[])),[]);class tr{loopVars=Object.create(null);styles=[];attr=[];data={};summary(){return[\"source\",\"appendSource\",\"enabled\",\"verbatim\",\"target\",\"append\",\"newTargets\",\"transition\",\"transitionTime\",\"transitionDeferred\",\"transitionDelay\",\"transitionSkip\",\"transitionOrigin\",\"innerEnchantments\",\"enablers\",\"output\"].filter((e=>Qn(this,e))).concat([this.attr.length&&\"attr\",this.styles?.length&&\"styles\",this.loopVars&&Jn(this.loopVars).length&&\"loopVars\",Jn(this.data).length&&\"data\"].filter(Boolean))}constructor(e){e&&Yn(this,e)}update(){const{newTargets:e,transition:t,transitionDeferred:n,append:r}=this;let{target:a}=this;if(\"function\"==typeof a&&(a=a()),!a)return;const o=e=>{if(Zn(this.styles)&&this.styles.length>0){const[t,n]=this.styles.reduce(((e,t)=>(Jn(t).forEach((n=>{const r=t[n];e[+(\"function\"==typeof r)].push({[n]:r})})),e)),[[],[]]);t.forEach((t=>e.css(t))),setTimeout((()=>{n.forEach((t=>e.css(t)))}))}this.attr&&this.attr.forEach((t=>e.attr(t))),this.data&&e.data(this.data)};let i=a;if(Zn(e)&&e.length&&(i=e.map((e=>e.target))),Zn(i))for(let e=0;e<i.length;e+=1){let t=i[e];\"jquery\"in t&&o(t)}else o(i);if(t&&!n&&!r){let e,n=a;do{e=n.data(\"timestamp\"),!e&&(n=n.parent())}while(!e&&n.length);R(a,t,this.transitionTime,this.transitionDelay,this.transitionSkip,e?Date.now()-e:0,this.transitionOrigin)}}render(){const{transition:e,transitionTime:t,transitionDeferred:n,enabled:r,enablers:o,data:i,section:s,newTargets:c,innerEnchantments:l,appendSource:u,output:d}=this,p=this.source;let{target:h,append:f}=this;if(\"function\"==typeof h&&(h=h()),!h)return a();let g=h;if(H(f,\"This ChangeDescriptor doesn't have an 'append' method chosen!\"),d)return a();if(o?.length){const{descriptor:e,changer:t}=o[0],n=e.render();if(t){const e=new tr({section:s,target:n});t.run(e),e.update()}return n}if(!r||void 0!==h.attr(\"hidden\"))return new tr({target:h,attr:this.attr.filter((e=>!(\"style\"in e))),data:{...i,originalSource:p,hidden:!0}}).update(),a();let m=h;Zn(c)&&c.length&&(m=c),H(m,\"ChangeDescriptor has source but not a target!\");let y=a();if([].concat(m).filter((e=>!(\"jquery\"in e))).map((({append:e,before:t=!1,target:n})=>({elements:n.hooks(s).filter(((e,n)=>!(t&&1&n.compareDocumentPosition(document)&&2&n.compareDocumentPosition(g[0])))),append:e})),[]).forEach((({elements:e,append:t})=>{e.each(((e,n)=>{let r=a(n);y=y.add(Object.setPrototypeOf({target:r,append:t,newTargets:null},this).render()),r.filter(\"tw-pseudo-hook\").contents().unwrap()}))})),y.length||Zn(m))return y;let b=f;return H(b in m||\"replace\"===b,`The target doesn't have a '${b}' method.`),\"replace\"===b&&(m[0]instanceof Text?b=\"replaceWith\":(m.empty(),b=\"append\")),m[0]instanceof Text&&(\"append\"===b&&(b=\"after\"),\"prepend\"===b&&(b=\"before\")),y=p?this.verbatim?a(er(p)):Xn(p):a(p),Zn(u)&&u.forEach((({source:e,append:t})=>{const n=this.verbatim?a(er(e)):Xn(e);y=\"append\"===t?y.add(n):\"prepend\"===t?n.add(y):n})),m[b](y.length?y:void 0),m.data(\"timestamp\",Date.now()),this.update(),e&&!n&&R(\"replace\"===f?h:y,e,t,this.transitionDelay,this.transitionSkip,this.expedite,this.transitionOrigin),l&&l.map((e=>e(m))).forEach((e=>s.addEnchantment(e))),y}}Yn(tr.prototype,{source:\"\",enabled:!0,verbatim:!1,append:\"replace\",transition:\"\",output:!1,timestamp:0}),Kn(tr);var nr=tr;const rr={};class ar{static{Object.assign(this.prototype,{typeID:\"changer\",typeName:\"a changer\"})}print(){return`\\`[A (${this.macroName}:) changer]\\``}toSource(){return`(${this.macroName}:${\"else\"===this.macroName?\"\":this.params.map(ut)})${this.next?`+${this.next.toSource()}`:\"\"}`}get objectName(){let e;1===this.params.length&&(e=ut(this.params[0]),e.length>36&&(e=void 0));let t=`a (${this.macroName}:${e||\"\"}) changer`,{next:n}=this;n&&(t+=\" combined with \");let r=0;for(;n&&t.length<48;){const e=`(${n.macroName}:)`;t+=(r>0&&!n.next?\" and \":\"\")+e+(n.next?\", \":\"\"),n=n.next,r+=1}let a=0;for(;n&&a<99;)n=n.next,a+=1;return a>0&&(t+=`${r>0?\" and \":\"\"}${j(a,\"other changer\")}`),t}summary(){const e=new nr;return this.run(e),e.summary()}constructor(e,t=[],n,r=!0){Object.assign(this,{macroName:e,params:t,next:n,canEnchant:r})}\"+\"(e){const t=this.clone();let n=t;for(;n.next;)n=n.next;return n.next=e,t.canEnchant=this.canEnchant&&e.canEnchant,t}is(e){if(e instanceof ar)return this.macroName===e.macroName&&dt(this.params,e.params)&&dt(this.next,e.next)}clone(){const e=new ar(this.macroName,this.params,this.next);let t=e;for(;t.next;)t=t.next=t.next.clone();return e.canEnchant=this.canEnchant,e}run(e,t){const n=\"output\"===this.macroName?[t||this]:this.params,r=rr[this.macroName](e,...n);if(r instanceof qe)return r;this.next&&this.next.run(e,t||this)}static register(e,t){rr[e]=t}}Object.freeze(ar),Object.freeze(ar.prototype);var or=ar;class ir{static{Object.assign(this.prototype,{typeID:\"codehook\",typeName:\"a code hook\",objectName:\"a code hook\"})}#i;toSource(){return this.#i}print(){return this.code}is(e){return e instanceof ir&&this.#i===e.#i}clone(){return new ir(this.code,this.#i)}constructor(e,t){this.code=e,this.#i=t}}Object.freeze(ir),Object.freeze(ir.prototype);const{max:sr,min:cr,sin:lr,cos:ur,round:dr,floor:pr,atan2:hr,cbrt:fr,sqrt:gr,PI:mr,abs:yr,sign:br}=Math,{assign:vr,create:wr}=Object,$r=/^([\\da-fA-F])([\\da-fA-F])([\\da-fA-F])$/,kr=/^([\\da-fA-F])([\\da-fA-F])([\\da-fA-F])([\\da-fA-F])([\\da-fA-F])([\\da-fA-F])$/,xr=[\"r\",\"g\",\"b\",\"a\"],Sr=wr(null);function Tr(e,t,...n){if(n.length>0)return Tr(Tr(e,t),...n);if(!t)return e;const r=[];for(let n=0;n<e.length;n++){r[n]=[];for(let a=0;a<t[0].length;a++){let o=0;for(let r=0;r<e[0].length;r++)o+=e[n][r]*t[r][a];r[n][a]=o}}return r}function Cr(e){if(e in Sr)return Sr[e];let t,n=a(\"<p>\").css(\"background-color\",e).css(\"background-color\");return t=\"transparent\"===n?{r:0,g:0,b:0,a:0}:n.startsWith(\"rgb\")?(n.match(/\\d+/g)||[]).reduce(((e,t,n)=>(e[\"rgb\"[n]]=+t,e)),{r:0,g:0,b:0}):{r:192,g:192,b:192},Sr[e]=t,t}function Nr(e){return\"string\"!=typeof e?e:(e=(e=e.replace(\"#\",\"\")).replace($r,\"$1$1$2$2$3$3\"),{r:parseInt(e.slice(0,2),16),g:parseInt(e.slice(2,4),16),b:parseInt(e.slice(4,6),16)})}function jr({r:e,g:t,b:n,a:r}){const a=sr(e/=255,t/=255,n/=255),o=cr(e,t,n);let i=NaN,s=0,c=(o+a)/2,l=a-o;if(0!==l){switch(s=0===c||1===c?0:(a-c)/cr(c,1-c),a){case e:i=(t-n)/l+(t<n?6:0);break;case t:i=(n-e)/l+2;break;case n:i=(e-t)/l+4}i*=60}return s<0&&(i+=180,s=Math.abs(s)),i>=360&&(i-=360),{h:dr(i),s,l:c,a:r}}const Ar=[.9642956764295677,1,.8251046025104602],Er=[[.41239079926595934,.357584339383878,.1804807884018343],[.21263900587151027,.715168678767756,.07219231536073371],[.01933081871559182,.11919477979462598,.9505321522496607]],Or=[[3.2409699419045226,-1.537383177570094,-.4986107602930034],[-.9692436362808796,1.8759675015077202,.04155505740717559],[.05563007969699366,-.20397695888897652,1.0569715142428786]],Dr=[[1.0479298208405488,.022946793341019088,-.05019222954313557],[.029627815688159344,.990434484573249,-.01707382502938514],[-.009243058152591178,.015055144896577895,.7518742899580008]],Ir=[[.9554734527042182,-.023098536874261423,.0632593086610217],[-.028369706963208136,1.0099954580058226,.021041398966943008],[.012314001688319899,-.020507696433477912,1.3303659366080753]],Mr=24389/27,Lr=216/24389,Rr=e=>e.map((e=>[e])),Pr=e=>e.map((e=>e[0])),Vr=e=>e<.04045?e/12.92:((e+.055)/1.055)**2.4,Fr=e=>yr(e)>.0031308?br(e)*(1.055*e**(1/2.4)-.055):12.92*e;function Hr({r:e,g:t,b:n}){return Pr(Tr(Er,Rr([e/255,t/255,n/255].map(Vr))))}function qr(e){const[t,n,r]=Pr(Tr(Or,Rr(e))).map((e=>255*Fr(e)));return{r:t,g:n,b:r}}function zr(e){return Pr(Tr(Dr,Rr(e)))}function Wr(e){return Pr(Tr(Ir,Rr(e)))}function Br(e){const t=e.map(((e,t)=>e/Ar[t])).map((e=>e>Lr?fr(e):(Mr*e+16)/116)),n=[116*t[1]-16,500*(t[0]-t[1]),200*(t[1]-t[2])],r=180*hr(n[2],n[1])/mr;return{l:n[0]/100,c:gr(n[1]**2+n[2]**2),h:r>=0?r:r+360}}function Ur({l:e,c:t,h:n}){const r=[e*=100,t*ur(n*mr/180),t*lr(n*mr/180)],a=[];a[1]=(r[0]+16)/116,a[0]=r[1]/500+a[1],a[2]=a[1]-r[2]/200;return[a[0]**3>Lr?a[0]**3:(116*a[0]-16)/Mr,e>Mr*Lr?((e+16)/116)**3:e/Mr,a[2]**3>Lr?a[2]**3:(116*a[2]-16)/Mr].map(((e,t)=>e*Ar[t]))}function _r(e){const t=Pr(Tr([[.210454268309314,.7936177747023054,-.0040720430116193],[1.9779985324311684,-2.42859224204858,.450593709617411],[.0259040424655478,.7827717124575296,-.8086757549230774]],Rr(Pr(Tr([[.819022437996703,.3619062600528904,-.1288737815209879],[.0329836539323885,.9292868615863434,.0361446663506424],[.0481771893596242,.2642395317527308,.6335478284694309]],Rr(e))).map((e=>fr(e)))))),n=180*hr(t[2],t[1])/mr;return{l:t[0],c:gr(t[1]**2+t[2]**2),h:n>=0?n:n+360}}function Gr({l:e,c:t,h:n}){const r=[e,t*ur(n*mr/180),t*lr(n*mr/180)];return Pr(Tr([[1.2268798758459243,-.5578149944602171,.2813910456659647],[-.0405757452148008,1.112286803280317,-.0717110580655164],[-.0763729366746601,-.4214933324022432,1.5869240198367816]],Rr(Pr(Tr([[1,.3963377773761749,.2158037573099136],[1,-.1055613458156586,-.0638541728258133],[1,-.0894841775298119,-1.2914855480194092]],Rr(r))).map((e=>e**3)))))}function Xr(e,t){const n=qr(Wr(Ur(e)));return n.a=t,n}function Yr(e,t){const n=qr(Gr(e));return n.a=t,n}function Jr(e,t,n=!0){let r=n?Yr(e,t):Xr(e,t);const a=e=>(r[e]||0)>=0&&(r[e]||0)<=255;if(xr.every(a))return r;let o=(e={...e}).c,i=0;for(e.c/=2;o-i>1e-5;)r=n?Yr(e,t):Xr(e,t),xr.every(a)?i=e.c:o=e.c,e.c=(o+i)/2;let s=n?Yr(e,t):Xr(e,t);return s.r=cr(255,sr(0,s.r)),s.g=cr(255,sr(0,s.g)),s.b=cr(255,sr(0,s.b)),s}class Kr{a;get c(){throw Error()}set c(e){throw Error()}static{Object.assign(this.prototype,{typeID:\"colour\",typeName:\"a colour\",objectName:\"a colour\",properties:[\"h\",\"s\",\"l\",\"r\",\"g\",\"b\",\"a\",\"lch\",\"oklch\"]})}debugName(){return`a colour ${this.print()}`}\"+\"(e){const t=this.toRGBA(),n=e.toRGBA();return new Kr({r:cr(dr(.6*(t.r+n.r)),255),g:cr(dr(.6*(t.g+n.g)),255),b:cr(dr(.6*(t.b+n.b)),255),a:(t.a+n.a)/2})}print(){return`<tw-colour style='background-color:${this.toCSSString()}'></tw-colour>`}is(e){if(!(e instanceof Kr))return!1;if(e.oklch&&this.oklch||e.lch&&this.lch){let t=this.oklch??this.lch,n=e.oklch??e.lch;return yr(n.l-t.l)<.001&&yr(n.c-t.c)<.001&&yr(n.h-t.h)<.001&&e.a===this.a}const t=this.toRGBA(),n=e.toRGBA();return yr(n.r-t.r)<.001&&yr(n.g-t.g)<.001&&yr(n.b-t.b)<.001&&n.a===t.a}clone(){return new Kr(this)}toCSSString(){if(this.oklch){const{l:e,c:t,h:n}=this.oklch;return`oklch(${e} ${t} ${n} / ${this.a})`}if(this.lch){const{l:e,c:t,h:n}=this.lch;return`lch(${100*e} ${t} ${n} / ${this.a})`}const{r:e,g:t,b:n,a:r}=this.toRGBA();return`rgba(${e}, ${t}, ${n}, ${r})`}toHSLA(){return jr(this.toRGBA())}toRGBA(){return this.oklch?Jr(this.oklch,this.a,!0):this.lch?Jr(this.lch,this.a,!1):this}toLCHA(){return this.lch?{a:this.a,...this.lch}:this.oklch?function(e,t){const n=Br(zr(Gr(e)));return n.a=t,n}(this.oklch,this.a):function(e,t){const n=Br(zr(Hr(e)));return n.a=t,n}(this,this.a)}toOKLCHA(){return this.oklch?{a:this.a,...this.oklch}:this.lch?function(e,t){const n=_r(Wr(Ur(e)));return n.a=t,n}(this.lch,this.a):function(e,t){const n=_r(Hr(e));return n.a=t,n}(this,this.a)}OKLCHRotate(e){e<0&&(e=360+e);const t=this.toOKLCHA();return t.h=(t.h+e)%360,new Kr({ok:!0,...t})}getProperty(e){if(\"lch\"===e||\"oklch\"===e){const t=\"oklch\"===e?this.toOKLCHA():this.toLCHA();return new Map([[\"l\",t.l],[\"c\",t.c],[\"h\",t.h]])}const t=this.toRGBA();return\"h\"===e||\"s\"===e||\"l\"===e?jr(t)[e]:\"r\"===e||\"g\"===e||\"b\"===e||\"a\"===e?t[e]:void 0}toSource(){if(0===this.a)return\"transparent\";let e;if(this.lch)e=[this.lch.l,this.lch.c,this.lch.h];else if(this.oklch)e=[this.oklch.l,this.oklch.c,this.oklch.h];else{const t=jr(this);if(1===t.l&&!t.h&&!t.s)return\"white\";if(0===t.l&&!t.h&&!t.s)return\"black\";if(t.l>=.5&&t.l<.5334&&0===t.s)return\"gray\";if(.5===t.l&&t.s>=.8&&t.s<.804){const e={0:\"red\",30:\"orange\",60:\"yellow\",90:\"lime\",120:\"green\",180:\"cyan\",210:\"blue\",240:\"navy\",270:\"purple\",300:\"magenta\"}[t.h];if(e)return e}e=[t.h,t.s,t.l]}return`(${this.oklch?\"oklch\":this.lch?\"lch\":\"hsl\"}:${e}${1!==this.a?`,${this.a}`:\"\"})`}constructor(e){\"string\"==typeof e&&(e=(Kr.isHexString(e)?Nr:Cr)(e)),\"h\"in e&&\"s\"in e&&\"l\"in e&&!(\"r\"in e)&&!(\"g\"in e)&&!(\"b\"in e)&&(e=function({h:e,s:t,l:n,a:r}){function a(r){let a=(r+e/30)%12,o=t*cr(n,1-n);return n-o*sr(-1,cr(a-3,9-a,1))}return{r:dr(255*a(0)),g:dr(255*a(8)),b:dr(255*a(4)),a:r}}(e));let t=1;\"a\"in e&&\"number\"==typeof e.a&&(t=e.a),vr(this,\"h\"in e&&\"c\"in e&&!(\"s\"in e)&&\"l\"in e?{[e.ok?\"oklch\":\"lch\"]:{l:e.l,c:e.c,h:e.h}}:e),this.a=t}static isHexString(e){return\"string\"==typeof e&&e.startsWith(\"#\")&&(e.slice(1).match($r)||e.slice(1).match(kr))}static mixLCH(e,t,n,r,a=!0,o=\"shorter\"){let i=1;if(t+r!==1&&(t+r<1&&(i=t+r),[t,r]=[t/(t+r),r/(t+r)]),e.c<(a?.001:2)||e.l<.01||e.l>.99?e.h=n.h:(n.c<(a?.001:2)||n.l<.01||n.l>.99)&&(n.h=e.h),e.l*=e.a,e.c*=e.a,n.l*=n.a,n.c*=n.a,\"shorter\"===o)n.h-e.h>180?e.h+=360:n.h-e.h<-180&&(n.h+=360);else if(\"longer\"===o){const t=n.h-e.h;t<180&&t>0?e.h+=360:t>-180&&t<=0&&(n.h+=360)}else\"increasing\"===o&&n.h<e.h?n.h+=360:\"decreasing\"===o&&n.h>=e.h&&(e.h+=360);let s=e.a*t+n.a*r,c=(e.l*t+n.l*r)/s,l=(e.c*t+n.c*r)/s,u=e.h*t+n.h*r;return new Kr({l:c,c:l,h:u,a:s*i,ok:a})}static mixRGB(e,t,n,r){let a=1;t+r!==1&&(t+r<1&&(a=t+r),[t,r]=[t/(t+r),r/(t+r)]),e.r*=e.a,n.r*=n.a,e.g*=e.a,n.g*=n.a,e.b*=e.a,n.b*=n.a;let o=e.a*t+n.a*r;return new Kr({r:cr(dr((e.r*t+n.r*r)/o),255),g:cr(dr((e.g*t+n.g*r)/o),255),b:cr(dr((e.b*t+n.b*r)/o),255),a:(e.a+n.a)/2*a})}static mixHSL(e,t,n,r,a=\"shorter\"){let o=1;if(t+r!==1&&(t+r<1&&(o=t+r),[t,r]=[t/(t+r),r/(t+r)]),e.s<.02||e.l<.01||e.l>.99?e.h=n.h:(n.s<.02||n.l<.01||n.l>.99)&&(n.h=e.h),e.s*=e.a,n.s*=n.a,e.l*=e.a,n.l*=n.a,\"shorter\"===a)n.h-e.h>180?e.h+=360:n.h-e.h<-180&&(n.h+=360);else if(\"longer\"===a){const t=n.h-e.h;t<180&&t>0?e.h+=360:t>-180&&t<=0&&(n.h+=360)}else\"increasing\"===a&&n.h<e.h?n.h+=360:\"decreasing\"===a&&n.h>=e.h&&(e.h+=360);let i=e.a*t+n.a*r;return new Kr({h:e.h*t+n.h*r,s:(e.s*t+n.s*r)/i,l:(e.l*t+n.l*r)/i,a:(e.a+n.a)/2*o})}}Object.freeze(Kr),Object.freeze(Kr.prototype);class Qr{#a=\"\";#i=\"\";attachable;unstorable;#s;get objectName(){return`a (${this.#a}:) command`}get typeName(){return`a (${this.#a}:) command`}static{this.prototype.typeID=\"command\"}print(){return`\\`[A (${this.#a}:) command]\\``}toSource(){return this.#i}is(e){return ut(this)===ut(e)}clone(){return new Qr({attachable:this.attachable,storable:!this.unstorable,runFn:this.#s,name:this.#a,source:this.#i})}runCommand(e,t){return this.#s(t,e)}static create(e){return new Qr(e)}constructor({attachable:e=!0,storable:t=!0,runFn:n,name:r,source:a}){this.attachable=e,this.unstorable=!1===t,void 0!==r&&(this.#a=r),void 0!==a&&(this.#i=a),this.#s=n}name(e,t){return this.#a=e,this.#i=t,this}}Object.freeze(Qr),Object.freeze(Qr.prototype);var Zr=Qr;class ea extends Zr{get objectName(){return\"a custom command\"}get typeName(){return\"a custom command\"}typeID=\"customcommand\";print(){return\"`[A custom command]`\"}clone(){return new ea(this.#c)}runCommand(e,t){const{variables:n,hook:r,changer:a}=this.#c,o={};for(let e in n.variableStore){const t=n.variableStore[e];null!==t&&(o[e]=[t])}const i={source:r,loopVars:o,section:e},s=t?Object.assign(t,i):new nr(i);if(a){const e=a.run(s);if(e instanceof qe)return e}return s}constructor(e){let t,n=e.changer?.clone(),r=n;for(;r;){if(\"output\"===r.macroName){if(!t){n=r=r.next;continue}t.next=r.next}t=r,r=r.next}e.changer=n,super({attachable:!0,source:e.toSource}),this.#c=e}#c;customCommand(){return this.#c}}Object.freeze(ea),Object.freeze(ea.prototype);class ta{message;constructor(e){this.message=e}render(){return a(\"<tw-notifier>\").attr(\"message\",this.message)}}Object.preventExtensions(ta),Object.preventExtensions(ta.prototype);var na=ta;const{assign:ra,setPrototypeOf:aa}=Object;function oa(e){return e instanceof fa&&e.rest}const ia=e=>(t,...n)=>{e.called+=1;const{varNames:r,params:o,body:i}=e,s=new za(`${e.objectName} call #${e.called}`),c=[];let l,u=0,d=!1,p=\"\";for(let e=0;e<n.length;e+=1){const t=n[e];p=r[u],s.typeDefs[p]=oa(o[u].datatype)?new fa(\"array\"):o[u].datatype;const a=Un.create(s,p);if(a instanceof qe)return a;if(oa(o[u].datatype)){d=!0;const r=(s.variableStore[p]||[]).concat([t]);if(e<n.length-1){s.variableStore[p]=r;continue}a.set(r)}else a.set(t),u+=1;c.push(new na(`${it(a)} is now ${it(s.variableStore[p])}`))}if(!d&&oa(o[u]?.datatype)){const e=Un.create(s,r[u]);if(e instanceof qe)return e;e.set([]),s.typeDefs[p]=new fa(\"array\")}let h=a(\"<p>\").append(dn.exec(i.code)),f=t.stack.length;t.stack.unshift({tempVariables:s,dom:h,output(e){l=e}});const{evalReplay:g}=t;for(t.evalReplay=void 0,t.execute();t.stack.length>f;)t.stack.shift();t.evalReplay=g;const m=h.find(\"tw-error\");return m.length?(h.prepend(c.map((e=>e.render())),\"<br>\"),new qe(\"propagated\",`${m.length} error${m.length>1?\"s\":\"\"} occurred when running ${e.objectName}.`,void 0,h)):void 0===l?new qe(\"custommacro\",`${e.objectName} didn't output any data or hooks using (output:) or (output-data:).`):\"object\"==typeof l&&\"changer\"in l?(l.toSource=`(${e.knownName||\"unnamed\"}:${n.map(ut)})`,new ea(l)):l};class sa{static{Object.assign(this.prototype,{typeID:\"colour\",typeName:\"a custom macro\",properties:[\"params\"]})}getProperty(e){if(\"params\"===e)return[...this.params]}print(){return`\\`[${this.objectName}]\\``}clone(){const e=aa({...this},sa.prototype);return e.fn=ia(e),e}toSource(){return`(macro:${this.params.map((e=>e.toSource())).concat(\"\")}${this.body.toSource()})`}static createFromFn(e,t,n,r){return aa({params:[],fn:e,typeSignature:r,objectName:t,toSource:n,knownName:\"\"},sa.prototype)}constructor(e,t){ra(this,{params:e,called:0,varNames:e.map((e=>e.varRef.propertyChain[0])),typeSignature:e.map((e=>{let t;return t=e.datatype instanceof fa?e.datatype.toTypeSignatureObject():{pattern:\"range\",range:t=>ft(e.datatype,t),name:st(e.datatype)},t})),body:t,knownName:\"\",objectName:`a custom macro (with ${e.length?A(e.map(ut)):\"no params\"})`}),this.fn=ia(this)}}Object.freeze(sa),Object.seal(sa.prototype);var ca=sa;const{floor:la,abs:ua}=Math,da={array:Array.isArray,dm:e=>e instanceof Map,ds:e=>e instanceof Set,datatype:e=>e instanceof ha,changer:e=>e instanceof or,colour:e=>e instanceof Kr,gradient:e=>e instanceof ya,image:e=>e instanceof Ra,lambda:e=>e instanceof ja,macro:e=>e instanceof ca,codehook:e=>e instanceof ir,command:e=>e instanceof Zr,str:e=>\"string\"==typeof e,num:e=>\"number\"==typeof e,bool:e=>\"boolean\"==typeof e},pa={...da,even:e=>!isNaN(e)&&la(ua(e))%2==0,odd:e=>!isNaN(e)&&la(ua(e))%2==1,empty:e=>e instanceof Map||e instanceof Set?!e.size:!(!Array.isArray(e)&&\"string\"!=typeof e)&&!e.length,int:e=>\"number\"==typeof e&&e===(0|e),uppercase:e=>\"string\"==typeof e&&1===[...e].length&&[...e].every((e=>e!==e.toLowerCase())),lowercase:e=>\"string\"==typeof e&&1===[...e].length&&[...e].every((e=>e!==e.toUpperCase())),whitespace:e=>\"string\"==typeof e&&!!e.match(`^${E}$`),digit:e=>\"string\"==typeof e&&!!e.match(\"^\\\\d$\"),alnum:e=>\"string\"==typeof e&&!!e.match(`^${O}$`),anycase:e=>\"string\"==typeof e&&!!e.match(`^${d}$`),linebreak:e=>\"string\"==typeof e&&!!e.match(\"^(?:\\\\n|\\\\r|\\\\r\\\\n)$\"),any:()=>!0,const:()=>!0,definition:()=>!0};class ha{static{Object.assign(this.prototype,{typeID:\"datatype\",typeName:\"a datatype\"})}print(){return`\\`[${this.objectName}]\\``}get objectName(){return`the ${this.rest?\"...\":\"\"}${this.name} datatype`}is(e){return e instanceof ha&&e.name===this.name}clone(){return this.rest?this:Object.create(this)}toSource(){return(this.rest?\"...\":\"\")+this.name}constructor(e,t=!1){this.name=\"datamap\"===e?\"dm\":\"dataset\"===e?\"ds\":\"number\"===e?\"num\":\"string\"===e?\"str\":\"color\"===e?\"colour\":\"boolean\"===e?\"bool\":\"alphanumeric\"===e?\"alnum\":\"integer\"===e?\"int\":\"newline\"===e?\"linebreak\":e,this.rest=t}static from(e){const t=Object.keys(da).find((t=>da[t](e)));return H(void 0!==t,`invalid name '${e}'!`),new ha(t)}isTypeOf(e){const{name:t}=this;return!!pa[t]&&pa[t](e)}toTypeSignatureObject(){const{name:e}=this,t={pattern:\"range\",range:pa[e],name:`a ${\"dm\"===e?\"datamap\":\"ds\"===e?\"dataset\":\"num\"===e?`${e}ber`:\"str\"===e?`${e}ing`:\"color\"===e?\"colour\":\"bool\"===e?`${e}ean`:\"alnum\"===e?\"alphanumeric character\":\"int\"===e?`${e}eger`:\"even\"===e||\"odd\"===e?`${e} number`:e.endsWith(\"case\")||\"whitespace\"===e?`${e} character`:\"empty\"===e?`${e} value`:e}`};return this.rest?{pattern:\"zero or more\",innerType:t}:t}}Object.freeze(ha),Object.seal(ha.prototype);var fa=ha;const{create:ga}=Object;class ma extends fa{regExp;#l;#u;insensitive(){if(this.#l.insensitive)return this;return ma.create({name:this.name,...this.#l,insensitive:!0,args:this.#l.args.map((e=>e instanceof ma&&!e.#l.insensitive?e.insensitive():e))})}typedVars(){return this.#l.args.reduce(((e,t)=>{if(t instanceof Da){let n=ma.create({name:\"p-ins\",args:[t.datatype],insensitive:!0});e=e.concat(this.#l.insensitive?Da.create(n,t.varRef):t),t=t.datatype}return t instanceof ma&&(e=e.concat(t.typedVars())),e}),[])}destructure(e){if(\"string\"!=typeof e)return new qe(\"operation\",`I can't put ${it(e)} into ${this.toSource()} because it isn't a string.`);const t=this.typedVars();if(!t.length)return[];const n=(RegExp(`^${this.rest?\"(?:\":\"\"}${this.regExp}${this.rest?\")*\":\"\"}$`).exec(e)||[]).slice(1);return n.length?n.map(((e,n)=>{let r=t[n];if(r)return r.datatype instanceof fa&&r.datatype.rest&&!(r.datatype instanceof ma)&&(r=r.clone(),r.datatype=ma.create({name:\"p\",args:[r.datatype]})),{dest:r,value:e||\"\",src:void 0}})).filter(Boolean):new qe(\"operation\",`I can't put ${it(e)} because it doesn't match the pattern ${this.toSource()}.`)}isTypeOf(e){return this.#l.canBeUsedAlone?\"string\"==typeof e&&!!e.match(`^${this.rest?\"(?:\":\"\"}${this.regExp}${this.rest?\")*\":\"\"}$`):new qe(\"operation\",`A (${this.name}:) datatype must only be used with a (p:) macro.`)}toTypeSignatureObject(){return{pattern:\"range\",name:this.name,range:e=>this.isTypeOf(e)}}toSource(){return`${this.rest?\"...\":\"\"}(${this.name}:${this.#u})`}clone(){return ma.create({name:this.name,...this.#l})}get objectName(){return`a (${this.name}:) datatype`}constructor(e,t,n,r){super(e),this.regExp=t,this.#l=r,this.#u=n}static create(e){const{name:t,args:n,fullArgs:r=n,makeRegExpString:a=(e=>e.join(\"\")),insensitive:o=!1,canContainTypedVars:i=!0,canBeUsedAlone:s=!0,canContainTypedGlobals:c=!0}=e,p=ga(null),h=n.map((function e(n){if(n instanceof Da){if(!i)return new qe(\"operation\",`Optional string patterns, like (${t}:)${\"p-many\"===t?\" with a minimum of 0 matches\":\"\"}, can't have typed variables inside them.`);if(!(c||n.varRef.object instanceof za))return new qe(\"operation\",`Only typed temp variables can be used in patterns given to (${t}:)`);const r=n.getName();if(r in p)return new qe(\"operation\",`There's already a typed temp variable named _${r} inside this (${t}:) call.`);p[r]=!0;const a=e(n.datatype);return a instanceof qe?a:`(${a})`}if(n instanceof fa){if((!i||!c)&&n instanceof ma){const e=n.typedVars();if(!i&&e.length)return new qe(\"operation\",`(${t}:) can't have typed variables inside its pattern.`);if(!c&&e.some((e=>e.varRef.object instanceof za&&\"global\"===e.varRef.object.type)))return new qe(\"operation\",`Only typed temp variables can be used in patterns given to (${t}:)`)}if(n instanceof ma&&n.regExp)return(n.rest?\"(?:\":\"\")+(o?n.insensitive().regExp:n.regExp)+(n.rest?\")*\":\"\");const e=n.name,r=n.rest?\"*\":\"\";return\"alnum\"===e?O+r:\"whitespace\"===e?E+r:\"uppercase\"===e?(o?d:l)+r:\"lowercase\"===e?(o?d:u)+r:\"anycase\"===e?d+r:\"digit\"===e?`\\\\d${r}`:\"linebreak\"===e?`(?:\\\\r|\\\\n|\\\\r\\\\n)${r}`:\"str\"===e?\".*?\":[\"even\",\"odd\",\"int\",\"num\"].includes(e)?new qe(\"datatype\",`Please use string datatypes like 'digit' in (${t}:) instead of number datatypes.`):new qe(\"datatype\",`The (${t}:) macro must only be given string-related datatypes, not ${it(n)}.`)}if(\"string\"==typeof n)return n=n.replace(/[.*+\\-?^${}()|[\\]\\\\]/g,\"\\\\$&\"),o&&(n=n.replace(RegExp(`(${l}|${u})`,\"g\"),(e=>`[${e.toUpperCase()}${e.toLowerCase()}]`))),n;throw Error(`given a non-string non-datatype pattern: ${n}`)}));for(let e of h)if(e instanceof qe)return e;return new ma(t,a(h),`${r.map(ut)}`,{insensitive:o,canContainTypedVars:i,canBeUsedAlone:s,canContainTypedGlobals:c,makeRegExpString:a,args:n})}}Object.freeze(ma),Object.seal(ma.prototype);class ya{static{Object.assign(this.prototype,{typeID:\"gradient\",typeName:\"a gradient\",objectName:\"a gradient\",properties:[\"angle\",\"stops\"]})}debugName(){return`a gradient ${this.print()}`}getProperty(e){return\"angle\"===e?this.angle:\"stops\"===e?this.stops.map((e=>new Map([[this.repeating?\"pixels\":\"percent\",e.stop],[\"colour\",e.colour.clone()]]))):void 0}toSource(){return`(gradient:${this.angle},${this.stops.map((e=>`${ut(e.stop)},${ut(e.colour)}`))})`}is(e){return e instanceof ya&&e.angle===this.angle&&e.stops.length===this.stops.length&&e.stops.every((({colour:e,stop:t},n)=>this.stops[n].stop===t&&this.stops[n].colour.is(e)))}clone(){return new ya(this.angle,[...this.stops])}print(){return`<tw-colour style='background:${this.toLinearGradientString()}'></tw-colour>`}constructor(e,t,n=!1){Object.assign(this,{angle:e,stops:t,repeating:n})}multiply(e){return new ya(this.angle,this.stops.map((({colour:t,stop:n})=>({colour:t,stop:n instanceof Ia?n[\"*\"](e):n*e}))))}toLinearGradientString(){return`${this.repeating?\"repeating-\":\"\"}linear-gradient(${this.angle}deg, ${this.stops.reduce(((e,{colour:t,stop:n})=>`${e+t.toCSSString()} ${n instanceof Ia?n.toCSSString():n*(this.repeating?1:100)+(this.repeating?\"px\":\"%\")},`),\"\").slice(0,-1)})`}}Object.freeze(ya),Object.freeze(ya.prototype);const{textNodeToChars:ba,realWhitespace:va,findTextInNodes:wa}=vn;function $a(e){if(!e)return[];const{selector:t,property:n,next:r}=e;return[JSON.stringify([\"base\"===t.type?$a(t.data):I(t.data),n]),...$a(r)].sort()}class ka{#d(e){const{dom:t}=e;let n=a();this.next&&(n=n.add(this.next.#d(e)));const r=(e,t)=>{if(Array.isArray(t))return t.reduce(((t,n)=>t.add(e.get(n)||\"\")),a());if(\"object\"==typeof t){let{first:n,last:r}=t;const{length:o}=e;n<0&&(n+=o),r<0&&(r+=o);let i=[e.get(n)];for(;n!==r;)n+=Math.sign(r-n),i.push(e.get(n));return a(i)}if(\"string\"==typeof t){if(\"chars\"===t){let t=[];for(let n of e.textNodes(\":not(tw-error, tw-error *)\"))for(let e of ba(n))e.data.match(va)||t.push(e);return a(t)}if(\"links\"===t)return e.findAndFilter(\"tw-link, .enchantment-link\");if(\"visited\"===t)return e.findAndFilter(\"tw-link.visited\");if(\"lines\"===t){const t=e.findAndFilter(\"br:not(tw-sidebar *),tw-consecutive-br:not(tw-sidebar *)\").get();let n=[[]];e.contents().each((function e(r,o){const i=(\"tagName\"in o&&o.tagName||\"\").toLowerCase();if(\"tw-sidebar\"!==i)if(\"tw-passage\"!==i&&\"tw-transition-container\"!==i){if(t.length){if(o===t[0])return t.shift(),void n.push([]);if(16&o.compareDocumentPosition(t[0]))return n.push([]),a(o).contents().each(e),void n.push([])}n[n.length-1].push(o)}else a(o).contents().each(e)}));return a(n.map((e=>!!e.length&&a(e).wrapAll(\"<tw-pseudo-hook>\").parent()[0])).filter(Boolean))}throw Error(`Invalid HookSet index ${t}!`)}return void 0===t?e:a(e.get(t))};if(this.selector){let o;if(\"string\"===this.selector.type)o=function(e,t){const n=wa(t.textNodes(),e);let r=a();return n.forEach((e=>{r=r.add(a(e).wrapAll(\"<tw-pseudo-hook>\").parent())})),r}(this.selector.data,t);else{if(\"base\"===this.selector.type)return n.add(r(this.selector.data.#d(e),this.property));{const e=function(e){let t=`tw-hook[name=\"${e=I(e).replace(/\"/g,\"&quot;\")}\"],tw-enchantment[name=\"${e}\"]`;return t+={page:\", tw-story\",passage:\", tw-passage\",sidebar:\", tw-sidebar\",link:\", tw-link, .enchantment-link\"}[e]||\"\",t}(this.selector.data);o=t.findAndFilter(e).add(t.parentsUntil(h.parent())).filter(e)}}n=this.property?n.add(r(o,this.property)):n.add(o)}return n=n.get().reduce(((e,t)=>{let n=a(t);return e.add(n.is(\"tw-enchantment\")&&n.contents().length<=1?n.contents():n)}),a()),n}forEach(e,t){const n=this.#d(e).each(((e,n)=>t(a(n),e)));return e.dom.findAndFilter(\"tw-pseudo-hook\").contents().unwrap(),n}hooks(e){return this.#d(e)}static{Object.assign(this.prototype,{typeID:\"hookName\",typeName:\"a hook name (like ?this)\",properties:[\"chars\",\"links\",\"lines\",\"visited\"],unstorable:!0})}get objectName(){return`the hook name ${this.toSource()}`}toSource(){let e=\"\";const{type:t,data:n}=this.selector;return\"name\"===t?n.match(RegExp(`^${O}+$`))?e+=`?${n}`:e+=`(hooks-named:${JSON.stringify(n)})`:\"string\"===t?e+=JSON.stringify(n):\"base\"===t&&(e+=`${n.toSource()}'s ${ut(this.property,\"property\")}`),this.next&&(e+=` + ${this.next.toSource()}`),e}\"+\"(e){const t=this.clone();let n=t;for(;n.next;)n=n.next;return n.next=e,t}is(e){return`${$a(this)}`==`${$a(e)}`}getProperty(e){return new ka({type:\"base\",data:this},e,void 0)}clone(){return new ka(this.selector,this.property,this.next)}constructor(e,t,n){Object.assign(this,{selector:Object.freeze(e),property:t,next:n})}static from(e){return e instanceof ka?e:new ka({type:\"string\",data:e})}}Object.freeze(ka),Object.freeze(ka.prototype);const{setPrototypeOf:xa,assign:Sa,freeze:Ta}=Object;function Ca(e,t,n){if(t)if(t instanceof Da){const r=Un.create(e,t.varRef.propertyChain);if(r instanceof qe)return r;let a=r.defineType(t.datatype);if(a instanceof qe)return a;if(a=r.set(n),a instanceof qe)return a}else e.set(t.getName(),n)}class Na{source;loop;static{Object.assign(this.prototype,{typeID:\"lambda\",typeName:\"a lambda\"})}get objectName(){return`a \"${\"making\"in this?\"making ... \":\"\"}${\"each\"in this?\"each ... \":\"\"}${\"where\"in this?\"where ... \":\"\"}${\"when\"in this?\"when ... \":\"\"}${\"via\"in this?\"via ... \":\"\"}\" lambda`}print(){return\"`[A lambda]`\"}is(e){return e===this}toSource(){return this.source}static TypeSignature(...e){return{pattern:\"lambda\",innerType:Na,clauses:e,typeName:`a \"${e.concat(\"\").join(\" ...\")}\" lambda`}}clone(){return xa({...this},Na.prototype)}static#p(e){const t=e instanceof Da?e.varRef:e;return void 0===t||t&&t instanceof Un&&t.object instanceof za&&\"temp\"===t.object.type&&1===t.propertyChain.length}static create(e,t,n,r){const a=\"temp variable, or typed temp variable\";if(qe.containsError(e))return e;if(\"making\"===t&&!Na.#p(n))return new qe(\"syntax\",`I need a ${a}, to the right of '${t}', not ${it(n)}.`);if(e instanceof Na){if(\"when\"===t||\"when\"in e)return new qe(\"syntax\",`A 'when' lambda cannot have any other clauses, such as '${t}'.`);if(t in e)return new qe(\"syntax\",`This lambda has two '${t}' clauses.`)}else{if(\"when\"===t&&void 0!==e)return new qe(\"syntax\",\"A 'when' lambda shouldn't begin with a temp variable (just use 'when' followed by the condition).\");if(!Na.#p(e))return new qe(\"syntax\",`This lambda needs to start with a single ${a}, not ${it(e)}.`)}const o=e instanceof Na?e.loop?.getName():e?.getName()||\"\";return\"making\"===t&&(n instanceof Un||n instanceof Da)&&n.getName()===o?new qe(\"syntax\",`This lambda has two variables named '${n.getName()}'.`,\"Lambdas should have all-unique parameter names.\"):new Na(e,t,n,r)}constructor(e,t,n,r){e instanceof Na?Sa(this,e):this.loop=e,this.source=r.trim(),this[t]=n}apply(e,{loop:t,pos:n,making:r,ignoreVia:a=!1,tempVariables:o}){if(this.making&&void 0===r||this.loop&&void 0===t){let e=this.loop?\"loop\":\"making\";throw Error(`\"${e}\" lambda was given no ${e}Arg: ${this.toSource()}`)}if(o||=new za(\"this lambda's temp variables\",\"temp\",e.stack.length?e.stackTop.tempVariables:null),this.loop&&et(t))throw Error(`Loop lambda was given an unstorable value ${it(t)}`);let i=this.loop&&Ca(o,this.loop,t);if(i instanceof qe)return i;if(i=this.making&&Ca(o,this.making,r),i instanceof qe)return i;e.stack.unshift(xa({tempVariables:o,lambdaPos:this.when?void 0:n},e.stackTop||null)),void 0===t||this.making||this.when?e.Identifiers.it=new qe(\"operation\",`I can't use 'it', or an implied 'it', in ${this.objectName}`):e.Identifiers.it=t;const s=!a&&this.via,c=\"where\"in this||\"when\"in this,{evalReplay:l}=e;let u,d,p,h;var f,g,m;if(e.evalReplay=l?[]:void 0,c?(d=e.eval(this.where||this.when),p=e.evalReplay,e.evalReplay=p&&s?[]:void 0,!t||this.making||this.when||(e.Identifiers.it=t),f=d,g=!s||e.eval(s),m=null,u=f instanceof qe?f:\"boolean\"!=typeof f?new qe(\"operation\",`This lambda's 'where' clause must evaluate to true or false, not ${it(f)}.`):f?g:m):d=u=!s||e.eval(s),h=s?e.evalReplay:void 0,e.stack.shift(),e.evalReplay=l,l&&(c||s)){let e=l[l.length-1];if(!e.lambda||e.lambda?.obj!==this){const t=l[l.length-1]?.code||\"\";e={lambda:{obj:this,loops:[]},code:t,fromCode:t,start:0,end:t.length,diff:0},l.push(e)}e.lambda.loops.push({it:t,pos:n,...void 0!==r&&{making:r},...s&&{viaReplay:h,viaResult:u},...c&&{whereReplay:p,whereResult:null!==d&&d}})}return u}filter(e,t,n){return t.reduce(((t,r,a)=>{if(t instanceof qe)return t;const o=this.apply(e,{loop:r,pos:a+1,ignoreVia:!0,tempVariables:n});return o instanceof qe?o:t.concat(o?[r]:[])}),[])}}Ta(Na),Ta(Na.prototype);var ja=Na;const{freeze:Aa,assign:Ea}=Object;class Oa{static{Object.assign(this.prototype,{typeID:\"typedvar\",typeName:\"a TypedVar (typed variable name)\",unstorable:!0,properties:[\"datatype\",\"name\"]})}get objectName(){const e=ut(this.datatype);return`the ${e.length<24?`${e}-`:\"\"}typed variable name, ${this.varRef.toSource()}`}print(){return\"`[A typed variable name]`\"}clone(){return new Oa(at(this.datatype),this.varRef)}toSource(){return`${ut(this.datatype)}-type ${this.varRef.toSource()}`}getProperty(e){return\"name\"===e?this.getName():this.datatype}isTypeOf(e){return ft(this.datatype,e)}toTypeSignatureObject(){return this.datatype instanceof fa?this.datatype.toTypeSignatureObject():{pattern:\"matches\",value:this.datatype}}get(){return this.varRef.get()}getName(){return this.varRef.getName()}defineType(){if(this.datatype instanceof fa&&\"any\"!==this.datatype.name)return this.varRef.defineType(this.datatype)}static create(e,t){let n;if(n=qe.containsError(e)||t.error)return n;if(t instanceof qe)return t;if(!(t instanceof Un))return new qe(\"syntax\",\"The -type syntax must have a variable to its right.\");const{object:r,compiledPropertyChain:a}=t;if(!(r&&r instanceof za&&1===a.length&&r.typeDefs))return new qe(\"unimplemented\",\"I can only restrict the datatypes of variables, not data names or anything else.\");const o=et(e);return!o||o instanceof Oa?new Oa(e,t):new qe(\"syntax\",`The -type syntax can't have ${st(o)} to its left.`)}constructor(e,t){Ea(this,{datatype:e,varRef:t})}}Aa(Oa),Aa(Oa.prototype);var Da=Oa;class Ia{static{Object.assign(this.prototype,{typeID:\"measure\",typeName:\"a measurement\"})}get objectName(){return`a ${this.toSource()} measurement`}static Units=[\"em\",\"px\",\"rem\",\"w\",\"h\",\"Lh\"];toSource(){const{left:e,right:t,operator:n,value:r,unit:a,mult:o}=this;return e&&t?void 0!==o?`(${e.toSource()} ${n} ${t.toSource()}) * ${o}`:`${e.toSource()} ${n} ${t.toSource()}`:void 0!==o?`(${r}${a} * ${o})`:`${r}${a}`}print(){return this.toSource()}is(e){return e instanceof Ia&&e.unit===this.unit&&e.value===this.value&&e.operator===this.operator&&e.mult===this.mult&&(e.left?e.left.is(this.left):!this.left)&&(e.right?e.right.is(this.right):!this.right)}#h(){const{left:e,right:t,operator:n,value:r,unit:a,mult:o}=this;return e&&t?void 0!==o?`(${e.toCSSString()} ${n} ${t.toCSSString()}) * ${o}`:`(${e.toCSSString()} ${n} ${t.toCSSString()})`:`${r}${\"w\"===a||\"h\"===a?\"%\":a}`}toCSSString(){return this.left&&this.right?`calc(${this.#h()})`:this.#h()}constructor(e,t,n,r,a,o){this.value=e,this.unit=t.toLowerCase().replace(\"lh\",\"Lh\"),n&&(this.mult=n),r&&(this.left=r),a&&(this.right=a),o&&(this.operator=o)}clone(){return new Ia(this.value,this.unit,this.mult,this.left,this.right,this.operator)}pxLengthInElement(e,t=!1){return this.left&&this.right?this.left.pxLengthInElement(e,t)+this.right.pxLengthInElement(e,t)*(\"-\"===this.operator?-1:1)*(this.mult??1):\"em\"===this.unit?+getComputedStyle(e).fontSize.replace(\"px\",\"\")*this.value:\"rem\"===this.unit?+getComputedStyle(document.documentElement).fontSize.replace(\"px\",\"\")*this.value:\"Lh\"===this.unit?+getComputedStyle(e).lineHeight.replace(\"px\",\"\")*this.value:\"h\"===this.unit?(e.scrollHeight-(t?e.clientHeight:0))*(this.value/100):\"w\"===this.unit?(e.scrollWidth-(t?e.clientWidth:0))*(this.value/100):this.value}\"+\"(e){return this.left||this.right||e.left||e.right||e.unit!==this.unit?new Ia(0,\"px\",void 0,this,e,\"+\"):new Ia(this.value+e.value,this.unit)}\"-\"(e){return this.left||this.right||e.left||e.right||e.unit!==this.unit?new Ia(0,\"px\",void 0,this,e,\"-\"):new Ia(this.value-e.value,this.unit)}\"*\"(e){if(!this.left&&!this.right)return new Ia(this.value*e,this.unit);let t=this.clone();return t.mult=(this.mult??1)*e,t}\"/\"(e){if(!this.left&&!this.right)return new Ia(this.value/e,this.unit);let t=this.clone();return t.mult=(this.mult??1)/e,t}containsUnits(...e){const{left:t,right:n,unit:r}=this;return t?.containsUnits(...e)||n?.containsUnits(...e)||e.includes(r)}}class Ma{left;centre;right;static{Object.assign(this.prototype,{typeID:\"sizing\",typeName:\"a sizing\"})}get objectName(){return`a (${this.left.toSource()}-${this.centre.toSource()}-${this.right.toSource()}) measurement`}constructor(e,t,n){this.left=e,this.centre=t,this.right=n}}Object.freeze(Ia),Object.freeze(Ia.prototype),Un.on(\"set\",((e,t)=>{e instanceof za&&h.find(\"[data-2bind]\").each(((n,r)=>{let o=a(r);const i=o.data(\"twoWayBindEvent\");\"function\"==typeof i&&i(o,e,t)}))}));class La{static{Object.assign(this.prototype,{typeID:\"varbind\",typeName:\"a VarBind (bound variable name)\",unstorable:!0})}get objectName(){return`a ${this.bind} bind to ${this.varRef.toSource()}`}print(){return\"`[A bound variable name]`\"}toSource(){return`${\"two way\"===this.bind?\"2\":\"\"}bind ${this.varRef.toSource()}`}set(e){const t=this.varRef.set(e);if(t instanceof qe)return t}static create(e,t=\"one way\"){if(e instanceof qe)return e;const n=\"Use 'bind' with variables like $this, or temp variables like _this.\";return e instanceof Un?e.error?e.error:e.object instanceof Nn?new qe(\"operation\",\"I can't 'bind' identifiers, only variables.\",n):new La(e,t):new qe(\"operation\",`I can only 'bind' a variable, not ${it(e)}.`,n)}constructor(e,t){Object.assign(this,{varRef:e,bind:t})}}Object.freeze(La),Object.freeze(La.prototype);class Ra{static{Object.assign(this.prototype,{typeID:\"image\",typeName:\"an image\",objectName:\"an image\",properties:[\"loaded\",\"failed\"]})}getProperty(e){return\"loaded\"===e?!!this.loaded:\"failed\"===e?!!this.failed:void 0}urls;fallback;loaded;failed;#f;knownName;toSource(){return this.knownName??`(image:${ut(this.urls)}${this.fallback?`, ${ut(this.fallback)}`:\"\"})`}clone(){return this}print(){return this.loaded?`<img src='${this.loaded}'></img>`:this.fallback?.print()||\"\"}fallbackCSS(){let{fallback:e}=this;return e?e instanceof ya?e.toLinearGradientString():e.toCSSString():\"\"}constructor(e,t){this.urls=e,this.fallback=t,this.failed=!1,this.loaded=!1,this.#f=!1}async#g(){let e=this.urls.slice();for(;e.length>0;){let t=e.shift();try{this.#f=!0;let e=await window.fetch(t);try{let t=await e.blob();return this.loaded=URL.createObjectURL(t),this.failed=!1,h.find(\"[data-img-fallback]\").each(((e,t)=>{const n=$(t),r=n.data(\"imageLoadEvent\");\"function\"==typeof r&&r(n,this)})),!0}catch(e){this.failed=`The image file at \"${t}\" couldn't be decoded.`}}catch(e){this.failed=`The image URL \"${t}\" failed to resolve.`}}return!1}static loadAssets(){for(let e of Object.values(io.definitions.variableStore))e instanceof Ra&&!e.#f&&e.#g()}}const{collapse:Pa}=vn;class Va{enchantments=a();constructor(e){Object.assign(this,{enchantments:a()},e)}enchantScope(){const{data:e,functions:t,section:n}=this;let{scope:r,localHook:o,lambda:i}=this,s=[],c=0;r.forEach(n,((l,u)=>{if(o){o=\"jquery\"in o?o:o.hooks(n);const e=l.find(o);if(e.length)l=e;else if(!o.has(l[0]).length)return}if(l.is(\":empty\")&&!l.data(\"source\")?.length)return;let d;c+=1,i?(d=i.apply(n,{loop:r.getProperty(u),pos:c}),d instanceof qe?(l.replaceWith(d.render()),i=d=void 0):d instanceof or?d.canEnchant||(l.replaceWith(new qe(\"macrocall\",`The lambda \"${ut(i)}\" can't be or include a revision, enchantment, or interaction changer like (replace:), (click:), or (link:).`).render()),i=d=void 0):(l.replaceWith(new qe(\"macrocall\",`The lambda \"${ut(i)}\" must return a changer, not ${it(d)}.`).render()),i=d=void 0)):d=this.changer;const p=!e&&(!d||d.summary().every((e=>e.startsWith(\"transition\")))),f=p?l:l.wrap(\"<tw-enchantment>\").parent();if(e&&f.data(e),t&&t.forEach((e=>e(f))),d){const e=new nr({section:n,target:f});if(d.run(e),e.update(),l.is(h)){const t=Object.keys(Object.assign({},...e.styles??[]));l.css(t.reduce(((e,n)=>(\"background-color\"===n||\"background-image\"===n?(e[\"background-color\"]=\"transparent\",e[\"background-image\"]=\"none\",t.push(\"background-\"+(\"background-color\"===n?\"image\":\"color\"))):e[n]=\"inherit\",e)),{})),f.data({enchantedProperties:t})}else if(l.is(\"tw-passage\")&&e.styles?.some((e=>\"margin-left\"in e||\"margin\"in e||\"margin-right\"in e))){const e=\"padding-left\",t=\"padding-right\";h.css(e,\"0px\").css(t,\"0px\"),f.data({enchantedProperties:[e,t]})}}l.is(h)&&f.css({\"min-width\":\"100%\",\"min-height\":\"100%\"}),\"true\"===f.attr(\"collapsing\")&&(f.find(\"[collapsing=false]\").each((function(){a(this).removeAttr(\"collapsing\")})),Pa(f)),p||s.push(f)})),this.enchantments=a(s)}disenchant(){this.enchantments.each(((e,t)=>{let n=a(t);n.contents().unwrap();const r=n.data(\"enchantedProperties\");r&&h.css(r.reduce(((e,t)=>(e[t]=\"\",e)),{}))}))}}Object.freeze(Va),Object.freeze(Va.prototype);const{lex:Fa}=Ve,{create:Ha}=Object;class qa{get objectName(){return this.name}typeDefs=Object.create(null);name;type;parent;variableStore;valueRefs;delete(e){this.variableStore[e]=null,delete this.typeDefs[e]}set(e,t){this.variableStore[e]=t}getProperty(e){const t=this.variableStore[e];return null===t?void 0:t}defineType(e,t){this.typeDefs[e]=t}constructor(e,t=\"temp\",n=null){this.name=e,this.type=t,this.variableStore=Ha(n instanceof qa?n.variableStore:null),n instanceof qa&&(this.parent=n)}flatten(e){let t={};for(let n of e){for(let e in n.typeDefs)this.typeDefs[e]||=n.typeDefs[e];for(let e in n.variableStore)if(!(e in this.variableStore)&&(null===n.variableStore[e]&&(t[e]=!0),!t[e])){this.variableStore[e]=n.variableStore[e];const t=n.valueRefs?.[e];n.valueRefs&&t&&!(\"via\"in t)&&(n.valueRefs[e]||=t)}}for(let e in this.valueRefs){const t=this.valueRefs[e];t&&\"via\"in t&&delete this.valueRefs[e]}}#m(){const e=this.variableStore,t={};for(const n in e){const r=e[n];if(r instanceof ea){const e=r.customCommand();t[n]={changer:e.changer?ut(e.changer):\"\",toSource:e.toSource,hook:ut(e.hook),variables:e.variables.serialise()}}else this.valueRefs&&n in this.valueRefs?t[n]={...this.valueRefs[n]}:t[n]=null===r?null:ut(r)}return t}serialise(){const e={};for(let t in this.typeDefs)e[t]=ut(this.typeDefs[t]);return{typeDefs:e,values:this.#m()}}static deserialise(e=\"a past turn's variables\",t=\"global\",n,r,a){let o=new qa(e,t),{values:i,typeDefs:s}=n;const c=`The variables on turn ${r.length+1} couldn't be reconstructed. `;for(let e in i){let t=i[e];if(null!==t)if(\"object\"==typeof t&&\"changer\"in t){const n=\"\"===t.changer?void 0:a.eval(Fa(t.changer,\"\",\"macro\"));if(void 0!==n&&!(n instanceof or))throw new q(`${c}This custom command's (output:)-attached changers couldn't be recreated: ${t.toSource}`);const i=a.eval(Fa(t.hook,\"\",\"macro\"));if(i instanceof qe)throw new q(`${c}This custom command's hook couldn't be recreated: ${t.toSource}`);const s=new ea({changer:n,hook:i,variables:qa.deserialise(\"a custom command's variables\",\"temp\",t.variables,r,a),toSource:t.toSource});if(s instanceof qe)throw new q(`${c}This custom command couldn't be recreated: ${t.toSource}`);o.variableStore[e]=s}else if(\"object\"==typeof t){const n=_t.dereference(e,t,r,a);if(n instanceof qe)throw new q(`${c}An error was produced when recreating a variable from a reference: ${n.message}`);o.variableStore[e]=n,(o.valueRefs||=Object.create(null))[e]=new _t(t)}else{const n=a.eval(Fa(t,\"\",\"macro\"));if(n instanceof qe)throw new q(`${c}An error was produced when recreating a variable from a reference: ${n.message}`);let r;if(r=et(t))throw new q(`${c}A value was recreated that can't be stored in a variable: ${it(r)}`);o.variableStore[e]=n}}for(let e in s){const t=a.eval(Fa(s[e],\"\",\"macro\"));if(t instanceof qe)throw new q(`${c}An error was produced when recreating a variable's datatype: ${t.message}`);let n;if(n=et(t))throw new q(`${c}A variable's datatype was recreated that can't be stored in a variable: ${it(n)}`);o.typeDefs[e]=t}return o}}var za=qa;class Wa{value;static{Object.assign(this.prototype,{typeID:\"spreader\",typeName:\"a spreaded '...' value\",unstorable:!0})}get objectName(){return j(\"string\"==typeof this.value||Array.isArray(this.value)?[...this.value].length:1,\"spreaded '...' value\")}toSource(){return`${\"string\"==typeof this.value||Array.isArray(this.value)?[...this.value].map(ut):`...${ut(this.value)}`}`}static create(e){if(e instanceof qe)return e;if(e instanceof Da||e instanceof fa){const t=at(e);return(t instanceof Da?t.datatype:t).rest=!0,t}return Array.isArray(e)||\"string\"==typeof e||e instanceof Set?new Wa(e):new qe(\"operation\",`I can't spread out ${it(e)}, because it is not a string, dataset, or array.`)}constructor(e){this.value=e}}class Ba{passage=\"\";variables;constructor(e=\"\",t=new za(\"a past turn's variables\",\"global\")){this.passage=e,this.variables=t}flatten(e){const t=[];this.forgetVisits=0,this.turns=0,this.pastVisits=[];for(let n=e.length-1;n>=0;n-=1){const r=e[n];for(let e of[\"mockVisits\",\"mockTurns\",\"seed\",\"seedIter\"])e in r&&void 0===this[e]&&(this[e]=r[e]);r.forgetVisits&&(this.forgetVisits=Math.max(this.forgetVisits,r.forgetVisits)),void 0!==r.turns&&(this.turns+=r.turns),n!==e.length-1&&(void 0!==e[n+1].visits&&Array.isArray(this.pastVisits[0])?this.pastVisits[0].unshift(r.passage):this.pastVisits.unshift(r.passage)),void 0!==r.pastVisits&&this.pastVisits.unshift(...r.pastVisits),void 0!==r.visits&&this.pastVisits.unshift(r.visits),t.push(r.variables)}this.variables.flatten(t)}#y(){return void 0===this.visits&&void 0===this.turns&&void 0===this.mockVisits&&void 0===this.forgetVisits&&void 0===this.pastVisits&&void 0===this.mockTurns&&void 0===this.seed&&void 0===this.seedIter&&0===Object.keys(this.variables.variableStore).length}serialise(){return this.#y()?this.passage:{...this,variables:this.variables.serialise()}}static deserialise(e,t,n){if(\"string\"==typeof e){if(!Xe.hasValid(e))throw new q(`The data refers to a passage named \\`\"${e}\"\\`, but it isn't in this story.`);return new Ba(e)}if(\"object\"!=typeof e||!(\"variables\"in e))throw new q(\"One of the saved turns is unintelligible.\");if(!Xe.hasValid(e.passage))throw new q(`The data refers to a passage named \\`\"${e.passage}\"\\`, but it isn't in this story.`);let r=new Ba(e.passage,za.deserialise(\"a past turn's variables\",\"global\",e.variables,t.map((e=>e.variables)),n));for(let t of[\"turns\",\"forgetVisits\",\"seed\",\"seedIter\",\"mockVisits\",\"mockTurns\",\"visits\",\"pastVisits\"])t in e&&(r[t]=e[t]);return r}}const{assign:Ua,create:_a,defineProperty:Ga}=Object,{isArray:Xa}=Array;Ga(Map.prototype,\"toJSON\",{value:void 0}),Ga(Set.prototype,\"toJSON\",{value:void 0});const Ya=[\"localStorage\",\"sessionStorage\"].map((e=>{try{return!!window[e]&&(window[e].setItem(\"test\",\"1\"),window[e].removeItem(\"test\"),!0)}catch(e){return!1}})),Ja={forward:[],back:[],load:[],beforeForward:[],beforeBack:[],beforeLoad:[],forgetUndos:[]};let Ka=[],Qa=-1,Za=new Ba,eo=\"\";const to=new za(\"definitions\",\"global\");let no=Ua(_a(Ba.prototype),{reconstruct(e=[]){no.variables=new ro(\"this story's variables\",\"global\"),no.history=[],no.visits=[],no.mockVisits=void 0,no.mockTurns=void 0,no.flatten(e),no.variables.flatten([to]),no.mockVisits||=[],no.mockTurns||=0,no.reconstructHistory(),zt(no.seed,no.seedIter),no.seed=void 0,no.seedIter=void 0,no.passage=\"\"},reconstructHistory(){no.history=(no.pastVisits||[]).slice(no.forgetVisits||0).reduce(((e,t)=>e.concat(t)),[]),no.mockVisits&&(no.history=(no.mockVisits||[]).concat(no.history))}});class ro extends za{delete(e){super.delete(e),Za.variables.variableStore[e]=null,delete Za.variables.valueRefs?.[e]}set(e,t,n){if(super.set(e,t,n),Za.variables.variableStore[e]=t,n)(Za.variables.valueRefs||=Object.create(null))[e]=n;else if((Xa(t)||t instanceof Map||t instanceof Set||\"string\"==typeof t)&&!g.uncompressedStructures)for(let n=Qa;n>=0;n-=1){const r=Ka[n].variables.variableStore[e];if(null!=r){const n=_t.modifierRef(r,t,\"it\");n&&(\"it\"===n.via?delete Za.variables.variableStore[e]:(Za.variables.valueRefs||=Object.create(null))[e]=n);break}}}defineType(e,t){super.defineType(e,t),Za.variables.typeDefs[e]=t}}no.reconstruct(),Za.seed=Pt,Za.seedIter=Rt;const ao={get passage(){return Za.passage},get variables(){return no.variables},get pastLength(){return Qa},get turns(){return Qa+1+(no.turns||0)+(no.mockTurns||0)},get futureLength(){return Ka.length-1-Qa},get mockVisits(){return no.mockVisits||[]},set mockVisits(e){no.mockVisits=e,Za.mockVisits=e,no.reconstructHistory()},get mockTurns(){return no.mockTurns||0},set mockTurns(e){no.mockTurns=e,Za.mockTurns=e},history:()=>no.history,forgetUndos(e){e<0&&(e=Ka.length+e);const t=Ka.splice(0,Math.min(Ka.length-1,e));if(!t.length)return;Qa=Ka.length-1;const n=Ka[0];n.flatten(t),(n.pastVisits||=[]).push(t[t.length-1].passage),n.turns=(n.turns||0)+t.length,no.turns=(no.turns||0)+t.length,n.forgetVisits&&(n.pastVisits=n.pastVisits.slice(n.forgetVisits-n.turns),n.forgetVisits-=n.turns),eo=\"\",0===Qa&&a(\"tw-link[undo], tw-icon[alt='Undo']\",h).each(((e,t)=>{(a(t).closest(\"tw-expression, tw-hook\").data(\"forgetUndosEvent\")||Object)(t)})),Ja.forgetUndos.forEach((e=>e()))},forgetVisits(e){e<0&&(e=Ka.length+e),e>Qa+(no.turns||0)&&(e=Qa+(no.turns||0)),Za.forgetVisits=no.forgetVisits=Math.max(no.forgetVisits||0,e),no.reconstructHistory()},passageNameVisited(e){let t=0;if(!Xe.get(e))return 0;for(let n=0;n<no.history.length;n++)t+=+(e===no.history[n]);return t},timeline:Ka,definitions:to,play(e){H(Za,\"present is undefined!\"),Ja.beforeForward.forEach((e=>e())),Za.passage&&(Za.visits?.length&&Array.isArray(no.pastVisits)&&Array.isArray(no.pastVisits[no.pastVisits.length-1])?no.pastVisits[no.pastVisits.length-1].push(Za.passage):(no.pastVisits||=[]).push(Za.passage),(no.history||=[]).push(Za.passage)),Za.passage=e,Ka=Ka.slice(0,Qa+1).concat(Za),Qa+=1,oo(e),Ja.forward.forEach((t=>t(e)))},redirect(e){H(Za,\"present is undefined!\"),Za.passage&&(Za.visits?.length&&Array.isArray(no.pastVisits)&&Array.isArray(no.pastVisits[no.pastVisits.length-1])?no.pastVisits[no.pastVisits.length-1].push(Za.passage):(no.pastVisits||=[]).push([Za.passage]),(no.history||=[]).push(Za.passage)),(Za.visits||=[]).push(e),Za.passage=e},rewind(e=1){let t=!1;for(;e>0&&Qa>0;e--)t=!0,Qa-=1;return t&&(Ja.beforeBack.forEach((e=>e())),eo=\"\",oo(Ka[Qa].passage),no.reconstruct(Ka.slice(0,Qa+1)),Ja.back.forEach((e=>e()))),t},fastForward(e=1){let t=!1;for(;e>0&&Ka.length>0;e--)t=!0,Qa+=1;return t&&(Ja.beforeForward.forEach((e=>e())),oo(Ka[Qa].passage),no.reconstruct(Ka.slice(0,Qa+1)),Ja.forward.forEach((e=>e(Ka[Qa].passage,\"fastForward\")))),t},on:(e,t)=>(\"function\"!=typeof t||Ja[e].includes(t)||Ja[e].push(t),ao),reset(){Ja.beforeLoad.forEach((e=>e())),Ka=[],Qa=-1,no.reconstruct(),Za=new Ba,Object.keys(to.variableStore).forEach((e=>delete to.variableStore[e])),zt(),Za.seed=Pt,Za.seedIter=0,eo=\"\",Ja.load.forEach((e=>e(Ka)))},hasStorage:Ya[0],hasSessionStorage:Ya[1],setSeed(e){zt(e),Za.seed=e,Za.seedIter=0},random:()=>{const e=qt();return Za.seedIter=Rt,e},shuffled(...e){const t=e.reduce(((e,t,n)=>{const r=this.random()*(n+1)|0;return r===n?e.push(t):(e.push(e[r]),e[r]=t),e}),[]);return Za.seedIter=Rt,t},addDefinitions(){no.variables.flatten([to])},serialise(e){let t=Ka.slice(eo?e?Qa-1:Qa:0,Qa+1),n=t.slice(0,-1),r=eo;try{return n.length&&(r=(r?`${r.slice(0,-1)},`:\"[\")+JSON.stringify(n.map((e=>e.serialise()))).slice(1)),{past:r,pastAndPresent:r.slice(0,-1)+(r?\",\":\"[\")+JSON.stringify(t.at(-1).serialise())+\"]\"}}catch(e){return{past:\"\",pastAndPresent:\"\"}}},deserialise(e,t){let n;try{n=JSON.parse(t)}catch(e){throw new q(\"The save data is unintelligible.\")}if(!Xa(n))throw new q(\"The save data isn't a sequence of past turns.\");let r=[];for(let t=0;t<n.length;t+=1)r.push(Ba.deserialise(n[t],r,e));return Ka=r,Qa=Ka.length-1,Ja.load.forEach((e=>e(Ka))),eo=\"\",no.reconstruct(Ka.slice(0,Qa+1)),oo(Ka[Qa].passage),!0}};function oo(e){let t;Za=new Ba(e),({past:eo,pastAndPresent:t}=ao.serialise(!0)),function(e){if(ao.hasSessionStorage)try{sessionStorage.setItem(\"Saved Session\",e)}catch(e){return}}(t)}Object.seal(Ba);var io=ao;let so,co;function lo(e,t,n){let r;if(n){const e=n.get(\"name\"),a=Xe.getTree(e);a.children.length&&(r=Object.setPrototypeOf({type:\"include\",tag:t,name:e,children:a.children,text:a.text},Ee.prototype))}else r=Xe.getTree(t);r&&e.push(r)}function uo(e,t={}){const{loadedGame:n}=t,r=Xe.get(e),o=h;let i=o.parent(),{stretch:s,transition:{depart:c=\"instant\",arrive:l=\"dissolve\",departOrigin:u,arriveOrigin:d,time:m}={}}=t;i.findAndFilter(\"tw-enchantment\").each(((e,t)=>{let n=a(t);const r=n.data(\"enchantedProperties\");r&&o.css(r.reduce(((e,t)=>(e[t]=\"\",e)),{})),n[0]===i[0]&&(i=o.unwrap().parent())})),H(!!r,`No passage named \"${e}\"!`);const y=o.children(\"tw-passage\").not(\".transition-out, .transition-out *\"),b=(r.get(\"tags\")||[]).join(\" \"),v=function(){const e=a(\"<tw-passage><tw-sidebar>\"),t=e.children(\"tw-sidebar\"),n=a('<tw-icon tabindex=0 alt=\"Undo\" title=\"Undo\">&#8630;</tw-icon>'),r=a('<tw-icon tabindex=0 alt=\"Redo\" title=\"Redo\">&#8631;</tw-icon>');return io.pastLength<=0&&n.css(\"visibility\",\"hidden\"),io.futureLength<=0&&r.css(\"visibility\",\"hidden\"),t.append(n,r),e}();let w=u?.call(y[0]),$=d?.call(v[0]);const k=!s&&c,S=k&&y.css(\"width\");document.documentElement.contains(h[0])&&(f=h.parent(),h.detach()),v.appendTo(o).attr({tags:b}),k&&(((e,t,n,r=0,a=0,o=0,i)=>{if(0===e.length)return;n||=p(t),(e.length>1||!L(e)||![\"tw-hook\",\"tw-passage\",\"tw-sidebar\",\"tw-expression\"].includes(e.tag()))&&(e=e.wrapAll(\"<tw-transition-container>\").parent()),i&&(\"string\"==typeof i||i instanceof Function?e.css(\"transform-origin\",i):e.css(i)),e.attr(\"data-t8n\",t).addClass(\"transition-out\").css({\"animation-duration\":`${n}ms`,\"animation-delay\":-o+\"ms\",\"animation-play-state\":\"paused\"}),requestAnimationFrame((()=>{L(e)?e.css(\"display\",\"inline\"):e.parent().is(\"tw-backdrop,tw-story\")||e[0].setAttribute(\"style\",`${e[0].getAttribute(\"style\")}display:block !important;width:100%`)})),x(e,n,r-o,a,(()=>{e.remove()}))})(y,c,m,0,0,0,w),y.css({position:\"absolute\",width:()=>\"0px\"!==S?S:\"100%\"})),o.attr({tags:b});const T=new jn(v);n&&(T.loadedGame=!0);const C=[];if(io.pastLength<=0&&1===io.turns){for(let e of Xe.getTagged(\"startup\"))lo(C,\"startup\",e);if(g.debug)for(let e of Xe.getTagged(\"debug-startup\"))lo(C,\"debug-startup\",e)}for(let e of Xe.getTagged(\"header\"))lo(C,\"header\",e);if(g.debug)for(let e of Xe.getTagged(\"debug-header\"))lo(C,\"debug-header\",e);lo(C,e);for(let e of Xe.getTagged(\"footer\"))lo(C,\"footer\",e);if(g.debug)for(let e of Xe.getTagged(\"debug-footer\"))lo(C,\"debug-footer\",e);T.renderInto(C,v,{transition:l,transitionTime:m,transitionOrigin:$}),T.loadedGame=!1,F(),scroll(0,s?v.offset().top-.05*a(window).height():o[0].getBoundingClientRect().top+document.body.scrollTop)}so={goBack(e){io.rewind()&&uo(io.passage,e)},goForward(e){io.fastForward()&&uo(io.passage,e)},goToPassage(e,t){io.play(e),uo(e,t)},redirect(e,t){io.redirect(e),uo(e,t)},toggleFullscreen(){const e=document.documentElement;document.fullscreenElement?document.exitFullscreen():e.requestFullscreen.call(e)},showPassage:uo,enableDebugMode(){co&&co()},registerDebugMode(e){!co&&(co=e)}};var po=Object.freeze(so);const ho=W();class fo{constructor({className:e,rowWrite:t,rowCheck:n,rowSort:r,columnHead:o,tabName:i,tabNameCounter:s=!0,tabUpdate:c}){const l=a(`<div class='panel panel-${e}' style='${new.target.defaultMaxHeight?`max-height:${new.target.defaultMaxHeight}px`:\"\"}' hidden><div class=\"resizer-v\"></div><table class='panel-rows'></table></div>`),u=a(`<button class='tab tab-${e}'>${s?`0 ${i}s`:i}</button>`);u.click((()=>{u.toggleClass(\"enabled\"),u.parent().siblings(\".panel\").attr(\"hidden\",\"\"),u.is(\".enabled\")&&(u.siblings(`.tab:not(.tab-${e})`).removeClass(\"enabled\"),l.removeAttr(\"hidden\"))})),l.on(\"click\",\"th\",(({target:e})=>{let t=(e=a(e)).attr(\"data-order\");t=\"desc\"===t?\"asc\":\"desc\",this.sort(e.attr(\"data-col\"),t),l.find(\"th[data-order]\").removeAttr(\"data-order\"),e.attr(\"data-order\",t)})),c||(c=e=>u.text(s?`${e} ${i}${1!==e?\"s\":\"\"}`:i)),Object.assign(this,{tabName:i,tab:u,panel:l,panelRows:l.find(\".panel-rows\"),rowWrite:t,rowSort:r,rowCheck:n,columnHead:o,tabUpdate:c})}sort(e,t){this.panelRows.children(\":not(.panel-head, .panel-row-source)\").get().sort(((n,r)=>(\"desc\"===t&&([n,r]=[r,n]),n=n.querySelector(`.${e}`),r=r.querySelector(`.${e}`),this.rowSort&&this.rowSort(e,a(n),a(r))||ho(n.textContent,r.textContent)))).forEach((e=>{const t=a(e).next(\".panel-row-source\").get();this.panelRows.append(e,t)}))}update(e,t=0){const{rowCheck:n,rowWrite:r,panelRows:o,columnHead:i,panel:s}=this,c=[],l=o.children();e.forEach((e=>{const t=l.get().filter((t=>n(e,a(t)))),i=r(e,t.length?a(t):void 0);i&&(t.length||o.append(i),c.push(...i.get()))})),l.filter(((e,t)=>!c.includes(t)&&!t.className.includes(\"panel-head\"))).remove(),this.tabUpdate(t),t>0&&!o.find(\".panel-head\").length?o.prepend(i()||\"\"):0===t&&o.find(\".panel-head\").remove();const u=s.find(\"th[data-order]\");u.length&&this.sort(u.attr(\"data-col\"),u.attr(\"data-order\"))}static defaultMaxHeight=300}const go={boolean:\"color:hsla(0,0%,30%,1.0)\",array:\"color:hsla(0,100%,30%,1.0)\",dataset:\"color:hsla(30,100%,40%,1.0)\",number:\"color:hsla(30,100%,30%,1.0)\",datamap:\"color:hsla(60,100%,30%,1.0)\",changer:\"color:hsla(90,100%,30%,1.0)\",lambda:\"color:hsla(120,100%,40%,1.0)\",hookName:\"color:hsla(160,100%,30%,1.0)\",string:\"color:hsla(180,100%,30%,1.0)\",identifier:\"color:hsla(200,80%,40%,1.0)\",variable:\"color:hsla(200,100%,30%,1.0)\",tempVariable:\"color:hsla(200,70%,20%,1.0)\",datatype:\"color:hsla(220,100%,30%,1.0)\",colour:\"color:hsla(280,100%,30%,1.0)\",macro:\"color:hsla(320,80%,30%,1.0)\",twineLink:\"color:hsla(240,100%,20%,1.0)\"};go.gradient=go.image=go.colour,go.command=go.twineLink,go.instant=go.metadata=go.any=go.customMacro=go.macro;const{min:mo}=Math,yo=(e,t,n)=>r=>`background-color: hsla(${e},${t}%,${n}%,${r});`,bo=yo(40,100,50),vo=yo(220,100,50),wo=/hsla\\((\\d+),\\s*(\\d+)%,\\s*(\\d+)%,\\s*(\\d+\\.\\d+)\\)/g,$o=\"cm-harlowe-4-\",ko=`${{root:\"box-sizing:border-box;\",hook:bo(.05),\"hook-2\":bo(.1),\"hook-3\":bo(.15),\"hook-4\":bo(.2),\"hook-5\":bo(.25),\"hook-6\":bo(.3),\"hook-7\":bo(.35),\"hook-8\":bo(.4),\"^=hook , ^=hook-\":\"font-weight:bold;\",unclosedHook:`${bo(.05)}font-weight:bold;`,[`error:not([class*='${$o}string'])`]:\"background-color: hsla(17,100%,50%,0.5) !important;\",\"^=macroName\":\"font-style:italic;\",\"macroName-boolean\":go.boolean,\"macroName-array\":go.array,\"macroName-dataset\":go.dataset,\"macroName-datatype\":go.datatype,\"macroName-number\":go.number,\"macroName-datamap\":go.datamap,\"macroName-changer\":go.changer,\"macroName-string\":go.string,\"macroName-colour, macroName-gradient, macroName-image\":go.colour,\"macroName-command, macroName-instant, macroName-metadata\":go.command,\"macroName-custommacro, macroName-macro, macroName-any\":go.macro,\"^=macro \":`font-weight:bold;${go.macro}`,\"comma, spread\":go.macro,addition:go.any,\"subtraction, multiplication, division\":go.number,\"is, and, or, not, isNot, contains, doesNotContain, isIn, isA, isNotA, isNotIn, matches, doesNotMatch\":go.boolean,\"bold, strong\":\"font-weight:bold;\",\"italic, em\":\"font-style:italic;\",sup:\"vertical-align: super;font-size:0.8em;\",strike:\"text-decoration: line-through;\",verbatim:\"background-color: hsla(0,0%,50%,0.25); font:var(--font-monospaced)\",comment:\"color: hsla(120, 80%, 40%, 1); font-style:italic;\",\"^=bold, ^=strong, ^=italic, ^=em, ^=sup, ^=verbatim, ^=strike\":\"font-weight:100; color: hsla(0,0%,0%,0.5)\",\"^=collapsed\":\"font-weight:bold; color: hsla(201,100%,30%,1.0);\",unclosedCollapsed:`${vo(.025)}font-weight:bold; color: hsla(201,100%,30%,1.0);`,collapsed:vo(.025),\"collapsed.hook\":vo(.05),\"collapsed.hook-2\":vo(.1),\"collapsed.hook-3\":vo(.15),\"collapsed.hook-4\":vo(.2),\"collapsed.hook-5\":vo(.25),\"collapsed.hook-6\":vo(.3),\"collapsed.hook-7\":vo(.35),\"collapsed.hook-8\":vo(.4),\"twineLink:not(.text)\":go.twineLink,\"tag, scriptStyleTag, htmlComment\":\"color: hsla(240,34%,25%,1.0);\",boolean:go.boolean,string:go.string,number:go.number,variable:go.variable,tempVariable:go.tempVariable,hookName:go.hookName,datatype:go.datatype,colour:go.colour,cssTime:go.number,passageString:`${go.variable};text-decoration:underline 1px;`,tagString:`${go.variable};text-decoration:underline 1px dotted;`,\"variableOccurrence, hookOccurrence\":\"background: hsla(159,50%,75%,1.0) !important;\",\"^=where, ^=via, ^=with, ^=making, ^=each, ^=when\":`${go.lambda}; font-style:italic;`,heading:\"font-weight:bold;\",hr:\"background-image: linear-gradient(0deg, transparent, transparent 45%, hsla(0,0%,75%,1.0) 45%, transparent 55%, transparent);\",align:\"color: hsla(14,99%,37%,1.0); background-color: hsla(14,99%,87%,0.1);\",column:\"color: hsla(204,99%,37%,1.0); background-color: hsla(204,99%,87%,0.1);\",escapedLine:\"font-weight:bold; color: hsla(51,100%,30%,1.0);\",\"identifier, property, belongingProperty, itsProperty, belongingItProperty, belongingItOperator, possessiveOperator, belongingOperator\":go.identifier,toString(){return Object.keys(this).reduce(((e,t)=>{if(\"toString\"===t)return e;const n=t.split(\", \").map((function e(t){return t.includes(\".\")?t.split(/\\./g).map(e).join(\"\"):0===t.indexOf(\"^=\")?`[class^='${$o}${t.slice(2)}']`:`.${$o}${t}`}));return e+=`${n.join(\", \")}{${this[t]}}`,this[t].match(wo)&&[\".theme-dark\",\"[data-app-theme=dark]\"].forEach((r=>{e+=`${n.map((e=>`${r} ${e}`)).join(\", \")}{${this[t].replace(wo,((e,t,n,r,a)=>`hsla(${t},${mo(100,1.5*+n)}%,${100-r}%,${a})`))}}`})),e}),\"\")}}}`,{lex:xo}=Ve;function So(e){let t={},n=\"\";for(let r=0;r<e.length;r+=1){const{type:a,text:o}=e[r];\"verbatim\"!==a&&\"comment\"!==a||(n=\"\");let i=$o+a;switch(t[i]=(t[i]||0)+1,t[i]>1&&(i+=`-${t[i]}`),a){case\"text\":if(o.trim()){e.slice(r+1).reduce(((e,t)=>void 0===e?\"macro\"===t.type||\"hook\"!==t.type&&e:e),void 0)&&(i+=` ${$o}error`)}break;case\"macroName\":{const t=e[r].text[0];if(\"_\"===t||\"$\"===t){i+=` ${$o}customMacro ${$o+(\"_\"===t?\"tempV\":\"v\")}ariable`;break}const n=I(e[r].text.slice(0,-1));Et.has(n)?i+=`-${Et.get(n).returnType.toLowerCase()}`:i+=` ${$o}error`;break}}n+=`${i} `}return n}function To(e,t,n=0,r=e.length){if(e.length>9999)return[a(\"<span>\").text(e)[0]];const o=xo(e,\"\",t||\"macro\"),i=[];let s=\"\",c=[o];for(let e=o.start;e<o.end;e+=1){const t=o.pathAt(e);t[0]!==c[0]&&(i.length&&(i[i.length-1].textContent=s),s=\"\",c=t,i.push(a(`<${r&&e>=n&&e<r?\"mark\":\"span\"} class=\"${So(c)}\">`)[0])),s+=o.text[e-o.start]}return i.length&&(i[i.length-1].textContent=s),i}const{dialog:Co}=vn,No=a();let jo=(e,t)=>{const n=a(document.documentElement),r=W();let o={darkMode:!0,fadePanel:!0,evalReplay:!0,width:null,maxHeight:400};if(io.hasStorage)try{const e=localStorage.getItem(`(Debug Options ${g.ifid})`);e&&(o=JSON.parse(e))}catch(e){}function i(){if(io.hasStorage)try{localStorage.setItem(`(Debug Options ${g.ifid})`,JSON.stringify(o))}catch(e){}}fo.defaultMaxHeight=o.maxHeight;let s=a(`<tw-debugger class=\"${[o.darkMode?\"theme-dark\":\"\",o.fadePanel?\"fade-panel\":\"\"].join(\" \")}\" style=\"${o.width?`width:${o.width}px`:\"\"}\">\\n<div class='panel panel-errors' hidden><table></table></div>\\n<div class='tabs'></div>\\n<label style='user-select:none'>Turns: </label><select class='turns' disabled></select>\\n<button class='show-invisibles'>🔍 Debug View</button>\\n<button class='show-dom'><span style=\"vertical-align:text-top\">&lt;</span><span style=\"vertical-align:text-bottom\">&gt;</span> DOM View</button>\\n<button class='close'>✖</button>\\n<div class='resizer-h'>\\n</tw-debugger>`);const c=s.find(\".tabs\"),l=s.find(\".show-dom\"),u=s.find(\".show-invisibles\"),d=s.find(\".close\"),p=s.find(\".turns\"),h=e=>P(((...t)=>{if(g.debug)return e(...t)}),{maxWait:2e3});a(document.documentElement).on(\"click\",\"tw-expression, tw-error, tw-eval-explanation\",P((e=>{const t=a(e.target||No).data(\"evalReplay\");t&&function(e){let t=0;const n=Co({buttons:[{name:\"Understood\",confirm:!0,callback:()=>!s.find(\"tw-backdrop\").length&&s.removeClass(\"show-dialog\")}]}).addClass(\"eval-replay\"),r=a(`<tw-eval-replay>${1===e.length?\"\":\"<tw-eval-code></tw-eval-code>\"}<tw-eval-explanation></tw-eval-explanation><tw-eval-it></tw-eval-it><tw-eval-reason></tw-eval-reason>${1===e.length?\"\":\"<tw-dialog-links><tw-link style='visibility:hidden'>← 10</tw-link><tw-link style='visibility:hidden'>← ←</tw-link><b></b><tw-link>→ →</tw-link><tw-link>10 →</tw-link></tw-dialog-links>\"}</tw-eval-replay>`);n.find(\"tw-dialog\").css({width:\"75vw\",\"max-width\":\"75vw\"}).prepend(r);const o=r.find(\"tw-link:first-of-type\"),i=o.next(),c=i.next(),l=c.next(),u=l.next();function d(){const n=e[t],s=r.find(\"tw-eval-explanation\").empty(),d=r.find(\"tw-eval-code\");if(n.toCode||n.toDesc||n.error||n.lambda){if(r.find(\"tw-eval-code\").empty().append(To(n.code,\"macro\",t>0?n.start:void 0,t>0?n.end+n.diff:void 0)),s.append(n.lambda?\"\":`<code class='${n.fromCode.length>56?\"from-block\":\"from-inline\"}'></code>`,n.error?\"<span> caused an error: </span>\":n.lambda?\"<span>The lambda <code class='to-lambda'></code> was run, producing these results.</span>\":`<span> became${n.toDesc?\"…\":\"\"} </span>${n.toDesc?`<span class='to-desc'>${D(n.toDesc)}.</span>`:\"<code class='to-code'></code>\"}`),n.error)s.append(n.error);else if(n.lambda){const e=(e,t)=>a(`<${e}><code></${e}>`).find(\"code\").append(To(t,\"macro\")).end();s.find(\".to-lambda\").append(To(n.lambda.obj.source,\"macro\")).end().append(a(\"<table>\").append(a(\"<tr>\").append(e(\"th\",\"pos\"),n.lambda.obj.loop?e(\"th\",`_${n.lambda.obj.loop.getName()}`).append(\" / \",a(\"<code>\").append(To(\"it\",\"macro\"))):e(\"th\",\"it\"),n.lambda.obj.making?e(\"th\",`_${n.lambda.obj.making.getName()}`):No,n.lambda.obj.where?e(\"th\",\"where\").append(\" result\"):No,n.lambda.obj.via?e(\"th\",\"via\").append(\" result\"):No),...n.lambda.loops.map((({it:t,pos:r,making:o,whereResult:i,whereReplay:s,viaResult:c,viaReplay:l})=>a(\"<tr>\").append(e(\"td\",ut(r)),e(\"td\",ut(t)),void 0!==o?e(\"td\",ut(o)):No,void 0!==i&&(i instanceof qe?a(\"<td>\").append(i.render(n.lambda.obj.source,!0)):e(\"td\",ut(i))).append(s&&a(\"<tw-open-button replay label='🔍'>\").data(\"evalReplay\",s)||No)||No,null!=c&&(c instanceof qe?a(\"<td>\").append(c.render(n.lambda.obj.source,!0)):e(\"td\",ut(c))).append(l&&a(\"<tw-open-button replay label='🔍'>\").data(\"evalReplay\",l)||No)||No)))))}else n.toDesc||s.find(\".to-code\").append(To(n.toCode,\"macro\"));s.next().html(n.itIdentifier?`(The <code class=\"cm-harlowe-4-identifier\">it</code> identifier now refers to ${D(n.itIdentifier)}.)`:\"\").next().text(n.reason||\"\")}else d.empty().append(To(n.code,\"macro\")),s.html(\"<center>First, there was <code></code>.</center>\").next().empty().next().empty();!n.lambda&&s.find(\"code\").first().append(To(n.fromCode,\"macro\")),r.find(\"mark\").each(((e,t)=>{t.scrollIntoView()})),o.css(\"visibility\",t<=9?\"hidden\":\"visible\"),i.css(\"visibility\",t<=0?\"hidden\":\"visible\"),l.css(\"visibility\",t>=e.length-1?\"hidden\":\"visible\"),u.css(\"visibility\",t>=e.length-10?\"hidden\":\"visible\"),c.html(`( ${t+1}/${e.length} )`)}d(),o.on(\"click\",(()=>{t=Math.max(0,t-10),d()})),i.on(\"click\",(()=>{t=Math.max(0,t-1),d()})),l.on(\"click\",(()=>{t=Math.min(e.length-1,t+1),d()})),u.on(\"click\",(()=>{t=Math.min(e.length-1,t+10),d()})),s.find(\"tw-backdrop\").length?s.find(\"tw-backdrop\").before(n):s.addClass(\"show-dialog\").append(n)}(t);const n=a(e.target||No).data(\"goto\");if(n){let e=g.ignoreGotos;g.ignoreGotos=!1,n.command.runCommand(n.section),g.ignoreGotos=e}e.stopPropagation()}))),s.find(\".resizer-h\").mousedown((e=>{if(1!==e.which)return!0;e.stopPropagation();const t=e.pageX,r=s.width();n.on(\"mousemove.debugger-resizer-h\",(({pageX:e})=>{s.width(r+t-(0|e)+\"px\")})).on(\"mouseup.debugger-resizer-h\",(()=>{n.off(\".debugger-resizer-h\"),o.width=s.width(),i()}))})),s.on(\"mousedown\",\".resizer-v\",(e=>{if(1!==e.which)return!0;e.stopPropagation();const t=e.pageY,r=a(e.target.parentNode).height();n.on(\"mousemove.debugger-resizer-v\",(({pageY:e})=>{s.find(\".panel\").css(\"maxHeight\",r+t-(0|e)+\"px\")})).on(\"mouseup.debugger-resizer-v\",(()=>{n.off(\".debugger-resizer-v\"),o.maxHeight=+s.find(\".panel\").css(\"maxHeight\"),i()}))})),u.click((()=>{n.toggleClass(\"debug-mode\").removeClass(\"dom-debug-mode\"),u.toggleClass(\"enabled\"),l.removeClass(\"enabled\")})),l.click((()=>{n.toggleClass(\"dom-debug-mode\").removeClass(\"debug-mode\"),l.toggleClass(\"enabled\"),u.removeClass(\"enabled\")})),d.click((()=>{n.removeClass(\"debug-mode dom-debug-mode\"),s.detach(),Object.assign(g,{debug:!1,speedMultiplier:1,ignoreClickEvents:!1,ignoreGotos:!1})}));const f=h((()=>{const e=p.children().get(),{timeline:t}=io;let n=0;t.forEach((({turns:t=0,passage:r},a)=>{n+=1+t;const o=`${n}: ${r}`;e[a]?e[a].textContent=o:p.append(`<option value='${a}'>${o}</option>`)})),t.length<e.length&&a(e.slice(t.length)).remove(),p[t.length>=1?\"removeAttr\":\"attr\"](\"disabled\"),p.val(io.pastLength)}));p.change((({target:e})=>{let{value:t}=e;const n=+t-io.pastLength;0!==n&&(io[n<0?\"rewind\":\"fastForward\"](Math.abs(n)),po.showPassage(io.passage))})),f(),io.on(\"forward\",f).on(\"load\",f).on(\"forgetUndos\",(()=>f)).on(\"back\",(()=>{io.pastLength<=1&&p.attr(\"disabled\"),p.find(\"[selected]\").removeAttr(\"selected\"),p.val(io.pastLength)}));const m=e=>{const t=e.parents(\".variable-row, .enchantment-row, .source-row\");t.next(\".panel-row-source\").find(\"td\").empty().append(To(t.data(\"value\")||ut(t.data(\"enchantment\").changer),t.is(\"source-row\")?\"markup\":\"macro\"))};let y=new Set;const b=new fo({className:\"variables\",tabName:\"Variable\",rowWrite({name:e,dataset:t,path:n,value:r,tempScope:o,type:i},s){const c=D(it(r)),l=c.length>48&&!nt(r,\"debugName\"),u=nt(r,\"debugName\")?r.debugName():c;let d=\"\";n.length&&(d=n.reduce(((e,t)=>`${e+t}'s `),\"\")),t&&(e=\"???\");const p=i?ut(i):\"\",h=\"object\"==typeof r||l;if(s){s[0].firstChild.innerHTML=p||\"\",d&&a(s[0].firstChild).children(\".variable-path\").html((o?\"_\":\"$\")+D(d)),s[0].childNodes[1].lastChild.textContent=(d?\"\":o?\"_\":\"$\")+D(`${e}`),s[0].childNodes[2].textContent=o||\"\",s[0].childNodes[3].innerHTML=u;const t=a(s[0].lastChild.firstChild),n=t.is(\".open\");t[h?\"show\":\"hide\"]();const i=s.next(\".panel-row-source\");return n&&i.find(\"td\").empty().append(To(ut(r))),s.data(\"value\",ut(r)),s.add(i)}return s=a('<div class=\"variable-row\">').attr(\"data-name\",e).attr(\"data-path\",`${n}`).attr(\"data-scope\",o||\"\").css(\"padding-left\",`${Math.min(5,n.length)}em`).append(`<td class='variable-type'>${p||\"\"}</td>`,`<td class='variable-name cm-harlowe-4-${o?\"tempV\":\"v\"}ariable'><span class='variable-path'>${d?(o?\"_\":\"$\")+D(d):\"\"}</span> ${d?\"\":o?\"_\":\"$\"}${D(`${e}`)}</td>`,`<td class='temporary-variable-scope'>${o||\"\"}</td>`,`<td class='variable-value cm-harlowe-4-macroName-${ct(r)}'>${u}</td><td class='panel-row-buttons'><tw-folddown tabindex=0 style='display:${h?\"visible\":\"none\"}'>(source:) </tw-folddown></td>`).data(\"value\",ut(r)).find(\"tw-folddown\").data(\"folddown\",m).end().add(\"<tr class='variable-row panel-row-source' style='display:none'><td colspan='5'></td></tr>\")},rowCheck:({name:e,path:t,tempScope:n},r)=>r[0]&&r[0].getAttribute(\"data-name\")===e&&r[0].getAttribute(\"data-path\")===`${t}`&&r[0].getAttribute(\"data-scope\")===n,columnHead:()=>'<tr class=\"panel-head\"><th data-col=\"variable-type\">Type</th><th data-col=\"variable-name\">Name</th><th data-col=\"temporary-variable-scope\">Scope</th><th data-col=\"variable-value\">Value</th></tr>',rowSort(e,t,n){if(\"variable-value\"===e)return r(t.attr(\"class\"),n.attr(\"class\"))||r(t.parent().data(\"value\"),n.parent().data(\"value\"))}}),v=h((()=>{const e=[],t=io.variables;let n=e.length;function r(t){if(e.length>500)return;e.push(t);const n=t.path.concat(t.name),{value:a,tempScope:o}=t;n.length<=4&&(Array.isArray(a)?a.forEach(((e,t)=>r({name:N(t+1),path:n,value:e,tempScope:o}))):a instanceof Map?[...a].forEach((([e,t])=>r({name:e,path:n,value:t,tempScope:o}))):a instanceof Set&&[...a].forEach(((e,t)=>r({name:`${t}`,dataset:!0,path:n,value:e,tempScope:o}))))}for(let e in t.variableStore){const a=t.variableStore[e];null!==a&&(n+=1,r({name:e,path:[],value:a,tempScope:\"\",type:t.typeDefs?.[e]}))}e.push(...y),n+=y.size,b.update(e,n),0===n!==b.panel[0].classList.contains(\"panel-variables-empty\")&&b.panel.toggleClass(\"panel-variables-empty\")}));let w;Un.on(\"set\",((e,t,n)=>{if(e instanceof za&&\"temp\"===e.type&&!e.name.match(/#\\d+$/)){const r=e.name,a=\"string\"==typeof t&&e.typeDefs?.[t],o=[...y].find((e=>e.name===t&&e.tempScope===r));o?o.value=n:y.add({name:`${t}`,path:[],value:n,tempScope:r,type:a})}v(),w()})).on(\"delete\",(()=>{v(),w()})),b.panel.append(\"<div class='panel-variables-bottom'>\\n\\t\\t\\t<button class='panel-variables-copy'>Copy $ variables as (set:) call</button>\\n\\t\\t\\t<input class='clipboard' type=\\\"text\\\" style='opacity:0;pointer-events:none;position:absolute;'></input>\\n\\t\\t</div>\").removeAttr(\"hidden\"),b.tab.addClass(\"enabled\");const $=b.panel.find(\".clipboard\");n.on(\"click\",\".panel-variables-copy\",(()=>{let e=[];for(let t in io.variables.variableStore)e.push(`$${t} to ${ut(io.variables.variableStore[t])}`);$.val(`(set:${e})`)[0].select(),document.execCommand(\"copy\")}));const k=new fo({className:\"enchantments\",tabName:\"Enchantment\",rowWrite(e,t){const{scope:n,changer:r,lambda:o,name:i,localHook:s}=e;let c;return c=r?D(it(r)):o?D(ut(o)):`<em>enchanted with (${i}:)</em>`,t||a('<div class=\"enchantment-row\">').data(\"enchantment\",e).append(`<td><span class='enchantment-name'>${ut(n)}${s?`</span><span class='enchantment-local cm-harlowe-4-hookName'>${nt(s,\"toSource\")?s.toSource():\"jquery\"in s&&s.attr(\"name\")?`?${s.attr(\"name\")}`:\"an unnamed hook\"}`:\"\"}</span></td><td class='enchantment-value cm-harlowe-4-macroName-${r?\"changer\":\"command\"} '>${c}</td>${r?\"<td class='panel-row-buttons'><tw-folddown tabindex=0>(source:)</tw-folddown></td>\":\"\"}`).find(\"tw-folddown\").data(\"folddown\",m).end().add(r?a(\"<tr class='panel-row-source' style='display:none'><td colspan='3'></td></tr>\"):\"\")},rowCheck:(e,t)=>t.data(\"enchantment\")===e,columnHead:()=>'<tr class=\"panel-head\"><th data-col=\"enchantment-name\">Scope</th><th data-col=\"enchantment-value\">Value</th></div>'}),x=h((e=>{k.update(e.enchantments,e.enchantments.length)}));jn.on(\"add\",x).on(\"remove\",x);const S=new jn,T=new fo({className:\"storylets\",tabName:\"Storylet\",rowWrite({name:e,active:t,storyletSource:n,exclusive:r,urgent:o},i){if(i)return i.toggleClass(\"storylet-closed\",!t),i[0].firstChild.textContent=t?\"✓\":\"\",i;const s=a(`<tr class=\"storylet-row ${t?\"\":\"storylet-closed\"}\">`).attr(\"data-name\",e).append(`<td class='storylet-open'>${t?\"✓\":\"\"}</td><td class='storylet-name'>${e}</td><td class='storylet-lambda'></td><td class='storylet-exclusive'>${r}</td><td class='storylet-urgent'>${o}</td>`);return s.find(\".storylet-lambda\").append(To(n.replace(/^when\\s+/i,\"\"))),s},rowCheck:({name:e},t)=>t[0].getAttribute(\"data-name\")===D(`${e}`),columnHead:()=>'<tr class=\"panel-head\"><th data-col=\"storylet-open\" data-order=\"desc\">Open</th><th data-col=\"storylet-name\">Name</th><th data-col=\"storylet-lambda\">Condition</th><th data-col=\"storylet-exclusive\" class=\\'storylet-exclusive\\'>Exclusivity</th><th data-col=\"storylet-urgent\" class=\\'storylet-urgent\\'>Urgency</th></tr>'});T.tab.hide(),w=h((()=>{const e=Xe.getStorylets(S),t=e instanceof qe,n=Xe.allStorylets();let r=!1,a=!1;T.update(n.map((n=>{const o=\"number\"==typeof n.get(\"exclusivity\")?n.get(\"exclusivity\"):0,i=\"number\"==typeof n.get(\"urgency\")?n.get(\"urgency\"):0;return r||=o,a||=o,{name:n.get(\"name\"),storyletSource:n.get(\"storylet\").toSource(),active:!t&&e.some((e=>e.get(\"name\")===n.get(\"name\"))),exclusive:o,urgent:i}})),t?0:e.length),T.panel.toggleClass(\"storylet-error\",t),T.panel.toggleClass(\"panel-exclusive\",r),T.panel.toggleClass(\"panel-urgent\",a),n.length&&T.tab.show()}));const C=new fo({className:\"source\",tabName:\"Source\",tabNameCounter:!1,rowWrite({name:e,tag:t},n){if(n)return n.add(n.next(\".panel-row-source\"));const r=Xe.get(e).get(\"source\");return a(`<div class=\"source-row\" data-tag=\"${t}\">`).data(\"value\",r).append(`<td class=\"source-name\">${e}</td><td class=\"source-tags\">${t}</td><td class='panel-row-buttons'><tw-folddown class='${t?\"\":\"open\"}' tabindex=0></tw-folddown></td>`).find(\"tw-folddown\").data(\"folddown\",m).end().add(a(`<tr class='panel-row-source' style='${t?\"display:none\":\"\"}'><td colspan='3'></td></tr>`).find(\"td\").append(!t&&To(r,\"markup\")||No).end())},rowCheck:({name:e},t)=>t[0].firstChild.textContent===D(`${e}`),tabUpdate:a.noop,columnHead:a.noop}),j=[\"debug-startup\",\"startup\",\"header\",\"debug-header\",\"footer\",\"debug-footer\"].reduce(((e,t)=>e.concat(Xe.getTagged(t).map((e=>({name:e.get(\"name\"),tag:t}))))),[]),A=new fo({className:\"errors\",tabName:\"Error\",rowWrite:a.noop,rowCheck:a.noop,columnHead:a.noop,tabUpdate:e=>A.tab.css({background:e?\"rgba(230,101,204,0.3)\":\"\"}).text(`${e} Error${1!==e?\"s\":\"\"}`)}),E=P((e=>{if(!g.debug)return;A.panelRows.append(e.reduce(((e,[t,n])=>\"propagated\"===t.type?e:`${e}<tr class=\"error-row\"><td class=\"error-passage\">${io.passage}</td><td class=\"error-message\" title=\"${D(n)}\">${t.message}</td></tr>`),\"\"));const t=A.panelRows.children(),n=t.length;n>500&&a(Array.prototype.slice.call(A.panelRows[0].childNodes,0,n-500)).remove(),A.tabUpdate(Math.min(500,t.length))}),{batch:!0});qe.on(E),A.panel.append(\"<div class='panel-errors-bottom'>\\n\\t\\t\\t<button class='panel-errors-clean'>🧹 Clear this panel</button>\\n\\t\\t</div>\"),n.on(\"click\",\".panel-errors-clean\",(()=>{A.panelRows.empty(),A.tabUpdate(0)}));const O=new fo({className:\"tools\",tabName:\"Tools\",tabNameCounter:!1,rowWrite:({id:e,type:t,label:n,dropdownItems:r,dropdownValue:o},i)=>\"checkbox\"===t?i?i.find(\"input\").prop(\"checked\",!1):a(`<span><input id=\"debug-${e}\" type=\"checkbox\"></input><label for=\"debug-${e}\">${n}</label></span>`):\"dropdown\"===t?i?i.find(\"input\").prop(\"checked\",!1):a(`<span>${n}<select style=\"width:3em\" data-default=\"${o}\" id=\"debug-${e}\"></span>`).find(\"select\").append(...r.map((e=>`<option value='${e}' ${e===o?\"selected\":\"\"}>${e}x</option>`))).end():No,rowCheck:a.noop,columnHead:a.noop,tabUpdate:e=>O.tab.css({background:e?\"hsla(210, 72%, 65%, .3)\":\"\"})});n.on(\"click, change\",'.panel-tools [type=\"checkbox\"], .panel-tools select',(({target:e})=>{const t=(e=a(e)).attr(\"id\"),r=e.is(\":checked\")||e.is(\"select\")&&e.val()!==+e.attr(\"data-default\");\"debug-peekBehindDialogs\"===t&&n.toggleClass(\"debug-dialogs\",r),\"debug-ignoreClickEvents\"===t&&(g.ignoreClickEvents=r),\"debug-ignoreGotos\"===t&&(g.ignoreGotos=r),\"debug-speedMultiplier\"===t&&(g.speedMultiplier=+e.val()),O.tabUpdate(r)})),O.update([{id:\"peekBehindDialogs\",type:\"checkbox\",label:\"See through and click through <code>(dialog:)</code> boxes\"},{id:\"ignoreClickEvents\",type:\"checkbox\",label:\"Stop links, <code>(click:)</code> and <code>(hover-style:)</code> from activating\"},{id:\"ignoreGotos\",type:\"checkbox\",label:\"Stop <code>(go-to:)</code>, <code>(undo:)</code>, <code>(redirect:)</code> and <code>(restart:)</code> from activating<br><small>(Click 'GO' buttons in Debug View to activate later)</small>\"},{id:\"speedMultiplier\",label:\"Speed of timed events (<code>time</code>, <code>(live:)</code>, <code>(after:)</code>): \",type:\"dropdown\",dropdownValue:1,dropdownItems:[.25,.5,.75,1,1.25,1.5,1.75,2,3,5,10]}]);const I=new fo({className:\"options\",tabName:\"⚙️\",tabNameCounter:!1,rowWrite:({name:e,label:t},n)=>{const r={darkMode:o.darkMode,fadePanel:o.fadePanel,evalReplay:o.evalReplay}[e];return n?n.find(\"input\").prop(\"checked\",r):a(`<span><input id=\"debug-${e}\" type=\"checkbox\" ${r?\"checked\":\"\"}></input><label for=\"debug-${e}\">${t}</label></span>`)},rowCheck:a.noop,tabUpdate:a.noop,columnHead:a.noop});n.on(\"click\",'.panel-options [type=\"checkbox\"]',(({target:e})=>{const t=(e=a(e)).attr(\"id\"),n=e.is(\":checked\");\"debug-darkMode\"===t&&(o.darkMode=n,s.toggleClass(\"theme-dark\",n)),\"debug-fadePanel\"===t&&(o.fadePanel=n,s.toggleClass(\"fade-panel\",n)),\"debug-evalReplay\"===t&&(g.evalReplay=o.evalReplay=n),i()})),I.update([{name:\"darkMode\",label:\"Debug panel is dark\"},{name:\"fadePanel\",label:\"Debug panel is transparent unless the cursor is over it\"},{name:\"evalReplay\",label:\"Record expression replays (viewable via 🔍 buttons in Debug View; slower)\"}]),s.prepend(b.panel,k.panel,A.panel,T.panel,C.panel,O.panel,I.panel),c.prepend(b.tab,k.tab,A.tab,T.tab,C.tab,O.tab,I.tab);const M=()=>y=new Set;io.on(\"beforeForward\",M).on(\"beforeBack\",M).on(\"beforeLoad\",M);const L=h((()=>{v(),w(),k.panelRows.empty(),k.tabUpdate(0),io.passage&&Xe.get(io.passage)&&(C.update(j.concat({name:io.passage,tag:\"\"})),C.panel.find('[data-tag=\"\"], [data-tag=\"\"] + .panel-row-source').insertBefore(C.panel.find('[data-tag=\"footer\"]').first()))}));io.on(\"forward\",L).on(\"back\",L).on(\"load\",L);const R=()=>{a(document.body).append(s),g.debug=!0,g.evalReplay=o.evalReplay,g.speedMultiplier=1,g.ignoreClickEvents=!1,g.ignoreGotos=!1,L()};jo=R,a(document.head).append(a(\"<style>\").html(ko)),R(),e&&E(e,t)};po.registerDebugMode(((e,t)=>g.debug?a.noop:jo(e,t)));var Ao=jo;const{rest:Eo,zeroOrMore:Oo,either:Do,optional:Io,insensitiveSet:Mo,numberRange:Lo,percent:Ro,nonNegativeInteger:Po,positiveInteger:Vo,Any:Fo}=Et.TypeSignature,{max:Ho,min:qo,round:zo,floor:Wo,ceil:Bo}=Math,{assign:Uo}=Object;function _o(e){return(...t)=>{const n=e(...t);return\"number\"!=typeof n||Number.isNaN(+n)||!Number.isFinite(+n)?new qe(\"macrocall\",\"This mathematical expression doesn't compute!\"):n}}Et.add([\"str\",\"string\",\"text\"],\"String\",((e,...t)=>t.map((e=>e instanceof ir?e.toSource():e)).join(\"\")),[Oo(Et.TypeSignature.either(String,Number,Boolean,Array,ir))])(\"source\",\"String\",((e,t)=>ut(t)),[Fo])(\"substring\",\"String\",((e,t,n,r)=>gt(t,n,r)),[String,parseInt,parseInt])(\"lowercase\",\"String\",((e,t)=>t.toLowerCase()),[String])(\"uppercase\",\"String\",((e,t)=>t.toUpperCase()),[String])(\"lowerfirst\",\"String\",((e,t)=>t.replace(RegExp(`${O}+`),(e=>{let t=Array.from(e);return t[0].toLowerCase()+t.slice(1).join(\"\").toLowerCase()}))),[String])(\"upperfirst\",\"String\",((e,t)=>t.replace(RegExp(`${O}+`),(e=>{let t=Array.from(e);return t[0].toUpperCase()+t.slice(1).join(\"\").toLowerCase()}))),[String])(\"words\",\"Array\",((e,t)=>t.split(RegExp(`${E}+`)).filter(Boolean)),[String])([\"str-repeated\",\"string-repeated\"],\"String\",((e,t,n)=>0===n.length?new qe(\"macrocall\",\"I can't repeat an empty string.\"):n.repeat(t)),[Po,String])([\"str-reversed\",\"string-reversed\"],\"String\",((e,t)=>[...t].reverse().join(\"\")),[String])(\"joined\",\"String\",((e,t,...n)=>n.join(t)),[Eo(String)])(\"plural\",\"String\",((e,t,n,r)=>n&&\"\"!==r?j(t,n,r):new qe(\"macrocall\",\"The (plural:) macro can't be given empty strings.\")),[parseInt,String,Io(String)])([\"str-nth\",\"string-nth\"],\"String\",((e,t)=>N(t)),[parseInt])(\"digit-format\",\"String\",((e,t,n)=>{if(Math.abs(n)>=1e21)return new qe(\"macrocall\",\"The number given to (digit-format:) is too big.\");const r=/([^#0])(?=[#0]*$)/g,a=(r.exec(t)||[])[1],o=(/^[#0]*([^#0])/g.exec(t)||[])[1];let i=[...t],s=i.length;a&&(\",\"!==a||o&&\",\"!==o)&&(s=r.lastIndex-1);let c=Math.abs(n).toFixed(16).replace(/(\\.\\d*?)0+$/,((e,t)=>t)).replace(/^0+/,\"\"),l=c.includes(\".\")?c.indexOf(\".\"):c.length,u=0,d=\"\";for(let e=i.length-1;e>=0;e-=1){const t=i[e];if(\"0\"===t||\"#\"===t){const n=c[l-s+e+u];d=(n||(\"0\"===t?\"0\":\"\"))+d}else e<i.length-1&&e>0&&(d=t+d,u+=e===s?0:1)}return(n<0?\"-\":\"\")+d}),[String,Number])([\"num\",\"number\"],\"Number\",((e,t)=>Number.isNaN(+t)?new qe(\"macrocall\",`I couldn't convert ${it(t)} to a number.`):+t),[String])(\"datatype\",\"Datatype\",((e,t)=>fa.from(t)),[Fo])(\"datapattern\",\"Any\",((e,t)=>function e(t){let n;if(Array.isArray(t)){n=[];for(const r of t){const t=e(r);if(t instanceof qe)return t;n.push(t)}}else if(t instanceof Map){n=new Map;for(const[r,a]of t){const t=e(a);if(t instanceof qe)return t;n.set(r,t)}}else n=fa.from(t);return n}(t)),[Fo])([\"rgb\",\"rgba\"],\"Colour\",((e,...t)=>new Kr({r:t[0],g:t[1],b:t[2],a:t[3]})),[Lo(0,255),Lo(0,255),Lo(0,255),Io(Ro)])([\"hsl\",\"hsla\"],\"Colour\",((e,t,n,r,a)=>((t=zo(t)%360)<0&&(t+=360),new Kr({h:t,s:n,l:r,a}))),[Number,Ro,Ro,Io(Ro)])([\"oklch\",\"oklcha\"],\"Colour\",((e,t,n,r,a)=>((r=zo(r)%360)<0&&(r+=360),new Kr({l:t,c:n,h:r,a,ok:!0}))),[Ro,Ro,Number,Io(Ro)])([\"lch\",\"lcha\"],\"Colour\",((e,t,n,r,a)=>((r=zo(r)%360)<0&&(r+=360),new Kr({l:t,c:n,h:r,a,ok:!1}))),[Ro,Lo(0,150),Number,Io(Ro)])(\"complement\",\"Colour\",((e,t)=>t.OKLCHRotate(180)),[Kr]),Et.add(\"mix\",\"Colour\",((e,...t)=>{let n,r,a,o,i=\"oklch\";\"string\"==typeof t[0]&&(i=I(t.shift()));const s=(e,t,n)=>`The ${N(e)} value given to (mix:) after the colour model string, ${it(t)}, should be a ${n}.`;if(\"number\"!=typeof t[0])return new qe(\"datatype\",s(0,t[0],\"number\"));if(!(t[1]instanceof Kr))return new qe(\"datatype\",s(1,t[1],\"colour\"));if(\"number\"!=typeof t[2])return new qe(\"datatype\",s(2,t[2],\"number\"));if(!(t[3]instanceof Kr))return new qe(\"datatype\",s(3,t[3],\"colour\"));[n,r,a,o]=t;const c=[\"rgb\",\"hsl\",\"lch\",\"oklch\"];if(!c.includes(i))return new qe(\"datatype\",`(mix:) should be given one of ${A(c.map((e=>JSON.stringify(e))))}, not ${it(i)}`);if(\"rgb\"===i){let e=r.toRGBA(),t=o.toRGBA();return Kr.mixRGB(e,n,t,a)}if(\"hsl\"===i){let e=r.toHSLA(),t=o.toHSLA();return Kr.mixHSL(e,n,t,a)}if(\"lch\"===i){let e=r.toLCHA(),t=o.toLCHA();return Kr.mixLCH(e,n,t,a,!1)}if(\"oklch\"===i){let e=r.toOKLCHA(),t=o.toOKLCHA();return Kr.mixLCH(e,n,t,a)}return new Kr(\"#000000\")}),[Do(String,Ro),Do(Ro,Kr),Do(Ro,Kr),Do(Ro,Kr),Io(Do(Ro,Kr))])(\"palette\",\"Array\",((e,t,n)=>{const{l:r,h:a}=n.toLCHA(),o={l:r<=.75?.75+r/3:.75-3*(1-r),c:80,h:a,a:1};let i,s,c;return i=new Kr(o),o.l+=r<=.75?-.1:.1,o.l<.5&&(o.l*=.5/o.l),s=new Kr(o),o.l+=r<=.85?.15:-.15,c=new Kr(o),\"adjacent\"===t?(i=i.OKLCHRotate(-30),s=i.OKLCHRotate(30),c=i.OKLCHRotate(60)):\"triad\"===t&&(c=i.OKLCHRotate(180),s=i.OKLCHRotate(140),i=i.OKLCHRotate(-140)),[n,i,s,c]}),[Mo(\"mono\",\"adjacent\",\"triad\"),Kr])(\"gradient\",\"Gradient\",((e,t,...n)=>{if((t=zo(t)%360)<0&&(t+=360),n.length<4)return new qe(\"datatype\",\"(gradient:) must be given at least 2 colour-stop pairs of numbers and colours.\");let r;const a=[],o=n.reduce(((e,t)=>{if(e instanceof qe)return e;if(void 0===r)r=t;else{if(!(\"number\"==typeof r&&t instanceof Kr))return new qe(\"datatype\",\"(gradient:) colour-stops should be pairs of numbers and colours, not colours and numbers.\");a.push({stop:r,colour:at(t)}),r=void 0}return e}),!0);return o instanceof qe?o:void 0!==r?new qe(\"macrocall\",\"This gradient has a colour-stop percent without a colour.\"):new ya(t,a.sort(((e,t)=>e.stop-t.stop)))}),[Number,Eo(Do(Ro,Kr))])(\"stripes\",\"Gradient\",((e,t,n,...r)=>{if(\"px\"!==n.unit)return new qe(\"datatype\",`(stripes:) must be given a measurement with px units, not ${n.unit}`);if(n.value<=0)return new qe(\"datatype\",`(stripes:) must be given a positive measurement, not ${n.toSource()}`);(t=zo(t)%360)<0&&(t+=360);let a=Uo(n.clone(),{value:0});const o=[];return r.forEach(((e,t)=>{o.push({stop:a,colour:at(e)}),a=Uo(a.clone(),{value:n.value*(t+1)}),o.push({stop:a,colour:at(e)})})),new ya(t,o,!0)}),[Number,Ia,Kr,Eo(Kr)])(\"image\",\"Image\",((e,...t)=>{if(\"a (define:) macro\"!==e.stackTop.evaluateOnly)return new qe(\"macrocall\",\"(image:) can only be used inside a (define:) macro call\",\"Store the image in a variable using (define:) in order to use it for other purposes.\");let n,r=new Set;for(let e=0;e<t.length;e+=1){let a=t[e];if(\"string\"!=typeof a){if(0===e)return new qe(\"macrocall\",\"(image:) must be given at least one string URL, instead of just a fallback.\");if(e<t.length-1)return new qe(\"macrocall\",`The ${N(e+1)} value (of ${t.length}) given to (image:) was ${it(a)}, but all except the last value should be a string URL.`);n=t.pop()}else{if(\"\"===a)return new qe(\"macrocall\",`The ${N(e+1)} value given to (image:) was an empty string.`);if(r.has(a))return new qe(\"macrocall\",`${it(a)} was given to (image:) twice.`);r.add(a)}}return new Ra(t,n)}),[Eo(Do(String,Kr,ya))])(\"hooks-named\",\"HookName\",((e,t)=>t?new ka({type:\"name\",data:t}):new qe(\"datatype\",\"(hooks-named:) can't be given an empty string.\")),[String])(\"cond\",\"Any\",((e,...t)=>{for(let e=0;e<t.length;e+=2){const n=t[e];if(e===t.length-1||n instanceof qe)return n;if(\"boolean\"!=typeof n)return new qe(\"datatype\",`(cond:)'s ${N(e+1)} value is ${it(n)}, but should be a boolean.`);if(n)return t[e+1]}return new qe(\"macrocall\",`An odd number of values must be given to (cond:), not ${t.length}`,\"(cond:) must be given one or more pairs of booleans and values, as well as one final value.\")}),[Boolean,Fo,Eo(Fo)]);const Go=e=>(t,...n)=>e(...n);for(let[e,t]of Object.entries({weekday:[()=>`${[\"Sun\",\"Mon\",\"Tues\",\"Wednes\",\"Thurs\",\"Fri\",\"Satur\"][(new Date).getDay()]}day`,null],monthday:[()=>(new Date).getDate(),null],currenttime:[()=>{const e=new Date,t=e.getHours()<12;return`${e.getHours()%12||12}:${(e.getMinutes()<10?\"0\":\"\")+e.getMinutes()} ${t?\"A\":\"P\"}M`},null],currentdate:[()=>(new Date).toDateString(),null],min:[qo,Eo(Number)],max:[Ho,Eo(Number)],abs:[Math.abs,Number],sign:[Math.sign,Number],sin:[Math.sin,Number],cos:[Math.cos,Number],tan:[Math.tan,Number],floor:[Wo,Number],round:[zo,Number],trunc:[Math.trunc,Number],ceil:[Bo,Number],pow:[_o(Math.pow),[Number,Number]],exp:[Math.exp,Number],sqrt:[_o(Math.sqrt),Number],log:[_o(Math.log),Number],log10:[_o(Math.log10),Number],log2:[_o(Math.log2),Number],random:[(e,t)=>{let n,r;return t?(n=qo(e,t),r=Ho(e,t)):(n=0,r=e),r+=1,~~(io.random()*(r-n))+n},[parseInt,Et.TypeSignature.optional(parseInt)]]}))Et.add(e,\"Number\",Go(t[0]),t[1]);Et.add(\"either\",\"Any\",((e,...t)=>t[~~(io.random()*t.length)]),Eo(Fo))(\"nth\",\"Any\",((e,t,...n)=>n[(t-1)%n.length]),[Vo,Eo(Fo)]);const{dialog:Xo,geomParse:Yo,geomStringRegExp:Jo}=vn,{Any:Ko,Everything:Qo,rest:Zo,either:ei,optional:ti,zeroOrMore:ni,percent:ri,nonNegativeInteger:ai,positiveInteger:oi,positiveNumber:ii}=Et.TypeSignature,{assign:si}=Object,{floor:ci,ceil:li,abs:ui,max:di,min:pi}=Math,{noop:hi}=a;function fi(e){return`(${e} ${g.ifid}) `}for(let e of[\"set\",\"put\",\"unpack\"])Et.addCommand(e,((...t)=>{for(let n of t){if(\"into\"===n.operator&&\"set\"===e)return new qe(\"macrocall\",\"Please say 'to' when using the (set:) macro.\");if(\"to\"===n.operator&&\"set\"!==e)return new qe(\"macrocall\",\"Please say 'into' when using the (put:) or (unpack:) macro.\");if((n.dest instanceof Un||n.dest instanceof Da)==(\"unpack\"===e))return new qe(\"macrocall\",\"unpack\"===e?\"Please use the (unpack:) macro with arrays, datamaps or (p:) patterns containing variables to the right of 'into'.\":`Please use the (${e}:) macro with just single variables and typed variables to the ${\"set\"===e?\"left of 'to'.\":\"right of 'into'.\"}`,`You may wish to change this to the (${\"unpack\"!==e?\"unpack\":\"to\"===n.operator?\"set\":\"put\"}:) macro.`)}}),((e,...t)=>{let n=\"\";for(let e of t){const t=e.set();if(t instanceof qe)return t;n+=`${t}\\n`}return new na(n)}),[Zo(Gn)],{attachable:!1,storable:!1});Et.addCommand(\"move\",((...e)=>{for(let t of e)if(\"into\"!==t.operator)return new qe(\"macrocall\",\"Please say 'into' when using the (move:) macro.\")}),((e,...t)=>{let n=\"\";for(let e of t){const t=e.set(!0);if(t instanceof qe)return t;n+=`${t}\\n`}return new na(n)}),[Zo(Gn)],{attachable:!1,storable:!1})(\"display\",(e=>{if(!Xe.hasValid(e))return new qe(\"macrocall\",`I can't (display:) the passage '${e}' because it doesn't exist.`)}),((e,t,n)=>(e.source=[Xe.getTree(n)],e)),[String])(\"print\",hi,((e,t,n)=>si(e,{source:yt(n)})),[Ko])([\"verbatim-print\",\"v6m-print\"],hi,((e,t,n)=>si(e,{verbatim:!0,source:yt(n)})),[Ko])([\"verbatim-source\",\"v6m-source\"],hi,((e,t,n)=>si(e,{verbatim:!0,source:yt(ut(n))})),[Ko])(\"go-to\",(e=>{if(!Xe.hasValid(e))return new qe(\"macrocall\",`I can't (go-to:) to the passage '${e}' because it doesn't exist.`,\"Check that you didn't mistype the passage name, or rename the passage to something else.\")}),((e,t,n)=>{if(!g.ignoreGotos)return requestAnimationFrame((()=>po.goToPassage(n,{transition:e.data.passageT8n}))),{blocked:!0}}),[String])(\"redirect\",(e=>{if(!Xe.hasValid(e))return new qe(\"macrocall\",`I can't (redirect:) to the passage '${e}' because it doesn't exist.`,\"Check that you didn't mistype the passage name, or rename the passage to something else.\")}),((e,t,n)=>{if(!g.ignoreGotos)return requestAnimationFrame((()=>po.redirect(n,{transition:e.data.passageT8n}))),{blocked:!0}}),[String])(\"undo\",hi,((e,t,n)=>io.pastLength<1?si(e,{source:n}):g.ignoreGotos?void 0:(requestAnimationFrame((()=>po.goBack({transition:e.data.passageT8n}))),{blocked:!0})),[ti(String)])(\"debug\",hi,po.enableDebugMode,[],{attachable:!1}),V((()=>h.on(\"click.icon\",\"tw-icon\",(function(e){const t=a(this),n=t.data(\"clickEvent\"),r=t.attr(\"alt\");n&&n(t),\"Undo\"===r&&(e.stopPropagation(),po.goBack()),\"Redo\"===r&&(e.stopPropagation(),po.goForward()),\"Fullscreen\"===r&&(e.stopPropagation(),po.toggleFullscreen()),\"Restart\"===r&&(io.hasSessionStorage&&sessionStorage.removeItem(\"Saved Session\"),window.location.reload())})))),[[\"Undo\",\"&#8630;\",()=>io.pastLength>0],[\"Redo\",\"&#8631;\",()=>io.futureLength>0],[\"Fullscreen\",\"&#9974;\",()=>document.fullscreenEnabled],[\"Restart\",\"&#10226;\",Object]].forEach((([e,t,n])=>{Et.addCommand(`icon-${e.toLowerCase()}`,((t,n)=>{if(\"string\"==typeof t&&\"string\"==typeof n){const r=[...t].length,a=[...n].length;if(r>1&&a>1)return new qe(\"datatype\",`One of the two strings given to (icon-${e.toLowerCase()}:) should be 1 character long, for its icon.`);if(1===r&&1===a)return new qe(\"datatype\",`One of the two strings given to (icon-${e.toLowerCase()}:) should be 2 or more characters long, for its label.`)}}),((r,o,i,s)=>((\"string\"==typeof s&&1===[...s].length||\"string\"==typeof i&&[...i].length>1)&&([i,s]=[s,i]),\"Undo\"===e&&(r.data.forgetUndosEvent=e=>{r.section.whenUnblocked((()=>a(e).css(\"visibility\",\"hidden\")))}),si(r,{source:`<tw-icon tabindex=0 alt=\"${e}\" ${s?`data-label=\"${s.replace('\"',\"&quot;\")}\"`:\"\"} title=\"${e}\" ${n()?\"\":'style=\"visibility:hidden\"'}>${i||t}</tw-icon>`}))),[ti(String),ti(String)])})),Et.addCommand(\"icon-counter\",((e,t,n)=>{const r=\" label string given to (icon-counter:) can't be empty or only whitespace.\";return t?.trim()?\"string\"!=typeof n||n.trim()?void 0:new qe(\"datatype\",`The 2nd ${r}`):new qe(\"datatype\",`The 1st ${r}`)}),((e,t,n,r,a)=>{e.attr.push({\"data-2bind\":!0}),e.data.twoWayBindEvent=(t,o,i)=>{if(n.varRef.matches(o,i)){const t=n.varRef.get();if(\"number\"==typeof t){(\"function\"==typeof e.target?e.target():e.target).children(\"tw-icon\").text(t>0?ci(t):li(t)).attr(\"data-label\",1!==ui(t)&&void 0!==a?a:r)}}};const o=n.varRef.get();return o instanceof qe?o:\"number\"!=typeof o?new qe(\"datatype\",`(icon-counter:) can only be bound to a variable holding a number, not ${it(o)}.`):si(e,{source:`<tw-icon data-label=\"${D(1!==ui(o)&&void 0!==a?a:r)}\">${o>0?ci(o):li(o)}</tw-icon>`})}),[La,String,ti(String)]),Et.addCommand(\"meter\",((e,t,n,r)=>\"two way\"===e.bind?new qe(\"datatype\",\"(meter:) shouldn't be given two-way bound variables.\",'Change the \"2bind\" keyword to just \"bind\".'):\"string\"!=typeof r||r.trim()?-1===n.search(Jo)||!n.includes(\"=\")&&n.length>1?new qe(\"datatype\",`The (meter:) macro requires a sizing line(\"==X==\", \"==X\", \"=XXXX=\" etc.) be provided, not ${JSON.stringify(n)}.`):void 0:new qe(\"datatype\",\"The label string given to (meter:) can't be empty or only whitespace.\")),((e,t,n,r,a,o,i)=>{o&&\"string\"!=typeof o&&(i=o,o=void 0),i||(i=new Kr({h:0,s:0,l:.5,a:.5})),i instanceof Kr&&(i=new ya(90,[{colour:i,stop:0},{colour:i,stop:1}]));const{marginLeft:s,size:c}=Yo(a),l=s>0&&Math.ceil(s+c)<100,u=e=>{const t=di(0,pi(1,e/r)),n=i.repeating?i:i.multiply(r/e);return`height:100%;background-repeat:no-repeat;background-image:${(l?`${si(n,n.repeating?{}:{angle:270}).toLinearGradientString()}, `:\"\")+si(n,n.repeating?{}:{angle:l||0===s?90:270}).toLinearGradientString()};background-size:${l?Array(2).fill(50*t+\"%\"):100*t+\"%\"};background-position-x:${l?`${-100/(2-t)+100}%,${100/(2-t)}%`:0===s?\"left\":\"right\"};text-align:${l?\"center\":0===s?\"left\":\"right\"}`};e.styles.push({\"margin-left\":`${s}%`,width:`${c}%`,height:\"1.5em\",display:\"block\"}),e.attr.push({\"data-2bind\":!0});const d=\"string\"==typeof o?t.stackTop.tempVariables:void 0;e.data.twoWayBindEvent=(t,r,a)=>{if(n.varRef.matches(r,a)){const t=n.varRef.get();if(\"number\"==typeof t){const n=(\"function\"==typeof e.target?e.target():e.target).children(\"tw-meter\");n.attr(\"style\",u(t)),o&&e.section.renderInto(\"\",void 0,{source:o,target:n,append:\"replace\",transitionDeferred:!1},d)}}};let p=n.varRef.get();return p instanceof qe?p:\"number\"!=typeof p?new qe(\"datatype\",`(meter:) can only be bound to a variable holding a number, not ${it(p)}.`):si(e,{source:`<tw-meter style=\"${u(p)}\">${o||\"\"}</tw-meter>`})}),[La,ii,String,ti(ei(String,Kr,ya)),ti(ei(Kr,ya))]),[[\"cycling-link\"],[\"seq-link\",\"sequence-link\"]].forEach(((e,t)=>Et.addCommand(e,((...n)=>\"\"===n[0]?new qe(\"datatype\",`The first string in a (${e[0]}:) can't be empty.`):n.length<=(n[0]instanceof La?2:1)?new qe(\"datatype\",`I need two or more strings to ${t?\"sequence\":\"cycle\"} through, not just '${n[n.length-1]}'.`):void 0),((e,n,...r)=>{let a;r[0]instanceof La&&(a=r.shift());let o=0;if(\"two way\"===a?.bind&&(e.attr.push({\"data-2bind\":!0}),a.varRef.has())){let e=a.varRef.get();if(e instanceof qe)return e;const t=r.indexOf(e);t>-1&&(o=t)}const{tempVariables:i}=n.stackTop;function s(n,s){const c=o>=r.length-1&&t;let l=\"\"===r[o]?\"\":c?r[o]:`<tw-link>${r[o]}</tw-link>`;if(c&&(e.data.clickEvent=void 0),a&&!s){const e=a.set(r[o]);if(e instanceof qe)return void n.replaceWith(e.render(\"\"))}const u={...e,source:l,transitionDeferred:!1};e.section.renderInto(\"\",void 0,u,i)}r[o]&&(e.data.clickEvent=e=>{o=(o+1)%r.length,s(e,!1)})&&(e.data.twoWayBindEvent=(e,t,n)=>{if(a?.varRef.matches(t,n)){const t=a.varRef.get();if(t instanceof qe)return void e.replaceWith(t.render(\"\"));const n=r.indexOf(t);n>-1&&n!==o&&(o=n,s(e,!0))}});let c=`<tw-link>${r[o]}</tw-link>`;if(a){const e=a.set(r[o]);if(e instanceof qe)return e}return si(e,{source:c,append:\"replace\",transitionDeferred:!0})}),[ei(La,String),Zo(String)]))),V((()=>h.on(\"change.dropdown-macro\",\"select\",(function(){const e=a(this),t=e.closest(\"tw-expression, tw-hook\").data(\"dropdownEvent\");t&&t(e)})))),Et.addCommand([\"pic\",\"picture\"],hi,((e,t,n)=>(n.loaded?e.source=`<img src=\"${n.loaded}\">`:(e.source=`<tw-fallback style=\"display:inline-block; width: 64px; height: 64px; background:${n.fallbackCSS()||\"#000\"}\">`,e.attr.push({\"data-img-fallback\":!0}),e.data.imageLoadEvent=(t,r)=>{r===n&&n.loaded&&(e.source=`<img src=\"${n.loaded}\">`,e.render())}),e)),[Ra]),Et.addCommand(\"dropdown\",((e,...t)=>\"\"===t[0]||\"\"===t[t.length-1]?new qe(\"datatype\",\"The first or last strings in a (dropdown:) can't be empty.\",\"Because empty strings create separators within (dropdown:)s, having them at the start or end doesn't make sense.\"):t.length<=1?new qe(\"datatype\",`I need two or more strings to create a (dropdown:) menu, not just ${t.length}.`):void 0),((e,t,n,...r)=>{let o=0;if(\"two way\"===n.bind&&(e.attr.push({\"data-2bind\":!0}),n.varRef.has())){let e=n.varRef.get();if(e instanceof qe)return e;const t=r.indexOf(e);t>-1&&(o=t)}const i=Math.max(...r.map((e=>[...e].length)));let s=`<select>${r.map(((e,t)=>`<option${t===o?\" selected\":\"\"}${\"\"===e?\" disabled\":\"\"}>${D(e||\"─\".repeat(i))}</option>`)).join(\"\\n\")}</select>`;e.data.dropdownEvent=e=>{const t=e.val(),r=n.set(t);r instanceof qe&&e.replaceWith(r.render(\"\"))},e.data.twoWayBindEvent=(e,t,a)=>{if(n.varRef.matches(t,a)){const t=n.varRef.get();t instanceof qe&&e.replaceWith(t.render(\"\"));const a=r.indexOf(t);a>-1&&a!==o&&(e.find(\"select\").val(t),o=a)}},e.styles.push({\"background-color\"(){return M(a(this)).backgroundColour||void 0}});const c=n.set(r[o]);return c instanceof qe?c:si(e,{source:s,append:\"replace\"})}),[La,String,Zo(String)]),V((()=>h.on(\"input.checkbox-macro\",\"input[type=checkbox]\",(function(){const e=a(this),t=e.closest(\"tw-expression\").data(\"checkboxEvent\");t&&t(e)}))));let gi=1;Et.addCommand(\"checkbox\",hi,((e,t,n,r)=>{let a=!1,o=\"checkbox-\"+ ++gi;if(\"two way\"===n.bind){if(e.attr.push({\"data-2bind\":!0}),n.varRef.has()){const e=n.varRef.get();if(e instanceof qe)return e;\"boolean\"==typeof e&&(a=e)}e.data.twoWayBindEvent=(e,t,r)=>{if(n.varRef.matches(t,r)){const t=n.varRef.get();\"boolean\"==typeof t&&e.children(\"input[type=checkbox]\").prop(\"checked\",t)}}}e.data.checkboxEvent=e=>{const t=e.is(\":checked\"),r=n.set(t);r instanceof qe&&e.replaceWith(r.render(\"\"))};const i=n.set(a);return i instanceof qe?i:si(e,{source:`<input id=\"${o}\" type=\"checkbox\" ${a?\"checked\":\"\"}><label for=\"${o}\">${r}</label>`,append:\"replace\"})}),[La,String]),V((()=>a(document).on(\"fullscreenchange\",(()=>{a(\"input[type=checkbox][id^=fullscreen]\",h).each(((e,t)=>{(a(t).closest(\"tw-expression\").data(\"fullscreenEvent\")||Object)(t)}))})))),Et.addCommand(\"checkbox-fullscreen\",hi,((e,t,n)=>{let r=\"fullscreenCheckbox-\"+ ++gi;return e.data.fullscreenEvent=e=>a(e).prop(\"checked\",!!document.fullscreenElement),e.data.checkboxEvent=()=>po.toggleFullscreen(),si(e,{source:`<input id=\"${r}\" type=\"checkbox\" ${document.fullscreenEnabled?\" \":\"disabled \"}${document.fullscreenElement?\"checked\":\"\"}><label for=\"${r}\">${n}</label>`,append:\"replace\"})}),[String]),V((()=>h.on(\"input.input-box-macro\",\"textarea, input[type=text]\",(function(){const e=a(this),t=e.closest(\"tw-expression\").data(\"inputBoxEvent\");t&&t(e)})))),[\"input\",\"force-input\",\"input-box\",\"force-input-box\"].forEach((e=>Et.addCommand(e,((...t)=>{const n=e.endsWith(\"box\"),r=t[0]instanceof La,a=\"string\"==typeof t[+r],o=n&&t[+a+ +r]instanceof Ia,i=a?t[+r]:t[+r+ +o],s=Yo(i).size>0,c=s?t[+r+ +o+ +a]:i;if(e.startsWith(\"force\")&&\"string\"!=typeof c)return new qe(\"datatype\",`The (${e}:) macro requires a string of text to forcibly input.`);const l=+r+ +o+ +s+ +(\"string\"==typeof c);return t.length>l?new qe(\"datatype\",`An incorrect combination of values was given to this (${e}:) macro.`):void 0}),((t,n,...r)=>{const a=e.startsWith(\"force\"),o=e.endsWith(\"box\"),i=r[0]instanceof La,s=\"string\"==typeof r[+i],c=o&&r[+s+ +i]instanceof Ia,l=i&&r[0],u=c?r[+s+ +i]:new Ia(3,\"Lh\"),{marginLeft:d=0,size:p=0}=s?Yo(r[+i]):{},h=(p?r[+i+ +c+ +s]:+s&&r[+i])||\"\";let f=a?\"\":h,g=!1;if(l&&\"two way\"===l.bind){if(t.attr.push({\"data-2bind\":!0}),l.varRef.has()){const e=l.varRef.get();if(e instanceof qe)return e;if(\"string\"==typeof e){f=a?h.slice(0,e.length):e;const t=l.set(f);if(g=!0,t instanceof qe)return t}}t.data.twoWayBindEvent=(e,t,n)=>{if(l.varRef.matches(t,n)){const t=l.varRef.get();\"string\"==typeof t&&e.find(o?\"textarea\":\"input\").val(a?h.slice(0,t.length):t)}}}if(l&&!g){const e=l.set(a?\"\":h);if(e instanceof qe)return e}!a&&l&&(t.data.inputBoxEvent=e=>{const t=e.val(),n=l.set(t);n instanceof qe&&e.replaceWith(n.render(\"\"))});let m=`<${o?\"textarea\":\"input type=text\"} style=\"width:100%;${o?`height:${u.toCSSString()}\">`:'\" value=\"'}${D(f)}${o?\"</textarea>\":'\">'}`;if(a){const e=Array.from(h);t.data.inputBoxEvent=t=>{const{length:n}=t.val(),r=e.slice(0,n).join(\"\");if(t.val(r),l){const e=l.set(r);e instanceof qe&&t.replaceWith(e.render(\"\"))}return!0}}return t.styles.push({display:\"block\",...p?{\"margin-left\":`${d}%`}:void 0,width:p?`${p}%`:\"100%\",...c?{height:u.toCSSString()}:void 0,\"border-style\"(){return this.style.borderStyle||\"solid\"}}),si(t,{source:m,append:\"replace\"})}),e.endsWith(\"box\")?[ei(La,String),ti(ei(Ia,String)),ti(ei(Ia,String)),ti(String)]:[ti(ei(La,String)),ti(String),ti(String)]))),[\"show\",\"rerun\"].forEach((e=>Et.addCommand(e,((...e)=>{let t;return e.some((function e({selector:n,next:r}){return\"name\"===n.type&&\"page\"===n.data?(t=new qe(\"macrocall\",\"You can't (hide:) the ?page. Sorry.\"),!0):!!(\"base\"===n.type&&e(n.data)||r&&e(r))||void 0})),t}),((t,n,...r)=>(r.forEach((r=>r.forEach(n,(r=>{const a=r.data(\"hidden\");if(void 0!==a!=(\"rerun\"===e))if(r.removeData(\"hidden\"),\"object\"==typeof a&&\"jquery\"in a)r.empty().append(a);else{const e=r.data(\"tempVariables\"),a=\"tw-passage\"===r.tag(),o=a?Xe.getTree(io.passage):r.data(\"originalSource\")||\"\";let i;a&&(i=r.find(\"tw-sidebar\").detach()),n.renderInto(\"\",void 0,{...t,append:\"replace\",source:o,target:r},e&&Object.create(e)),i&&r.prepend(i)}})))),t)),[Zo(ka)])));const mi=e=>[`I can't use a dialog macro in ${e}.`,\"Please rewrite this without putting such macros here.\"];Et.addCommand(\"hide\",((...e)=>{let t;return e.some((function e({selector:n,next:r}){return\"name\"===n.type&&\"page\"===n.data?(t=new qe(\"macrocall\",\"You can't (hide:) the ?page. Sorry.\"),!0):!!(\"base\"===n.type&&e(n.data)||r&&e(r))||void 0})),t}),((e,...t)=>{for(let n of t)n.forEach(e,(e=>{e.data(\"hidden\")||e.data(\"hidden\",e.contents().detach())}))}),[Zo(ka)],{attachable:!1});Et.addCommand([\"scroll-to\",\"scroll\"],hi,((e,t,n)=>{requestAnimationFrame((()=>{t.forEach(e,(t=>{if(n instanceof Ia){let e=(e=>(e===h[0]&&e.scrollHeight===e.clientHeight&&(e=getComputedStyle(document.body).overflow.includes(\" scroll\")?document.body:document.documentElement),e))(t[0]);e.scrollTo?.(0,n.pxLengthInElement(e,!0))}else for(let r of n.hooks(e).get())if(t.find(r)){const e=[];let n=t[0];for(;(n=n.parentNode)&&n!==document.body;)e.push([n,n.scrollLeft,n.scrollTop]);r.scrollIntoView();for(let[t,n,r]of e)t.scrollLeft=n,t.scrollTop=r;break}}))}))}),[ka,ei(Ia,ka)],{attachable:!1})(\"scroll-by\",hi,((e,t,n)=>{requestAnimationFrame((()=>{t.forEach(e,(e=>{if(n instanceof Ia){let t=(e=>(e===h[0]&&e.scrollHeight===e.clientHeight&&(e=getComputedStyle(document.body).overflow.includes(\" scroll\")?document.body:document.documentElement),e))(e[0]);t.scrollBy?.(0,n.pxLengthInElement(t,!0))}}))}))}),[ka,Ia],{attachable:!1})(\"stop\",hi,hi,[],{attachable:!1})(\"load-game\",hi,((e,t)=>{if(e.loadedGame)return new qe(\"infinite\",\"I can't use (load-game:) immediately after loading a game.\");const n=localStorage.getItem(fi(\"Saved Game\")+t);if(!n)return new qe(\"saving\",`I can't find a save slot named '${t}'!`);try{io.deserialise(e,n)}catch(n){if(!(n instanceof q))throw n;const r=Xo({message:`Sorry to interrupt... The story tried to load saved data, but there was a problem.\\n${n.message}\\n\\nThat data might have been saved from a different version of this story. Should I delete it?\\n(Type 'delete' and choose Yes to delete it.)\\n\\nEither way, the story will now continue without loading the data.`,defaultValue:\"\",buttons:[{name:\"Yes\",confirm:!0,callback:()=>{\"delete\"===r.find(\"input\").last().val()&&localStorage.removeItem(fi(\"Saved Game\")+t),e.unblock(\"\")}},{name:\"No\",confirm:!1,callback:()=>e.unblock()}]});return{blocked:r}}requestAnimationFrame(po.showPassage.bind(po,io.passage,{loadedGame:!0}))}),[String],{attachable:!1})(\"forget-undos\",hi,((e,t)=>{io.futureLength||io.forgetUndos(t)}),[parseInt],{attachable:!1})(\"forget-visits\",hi,((e,t)=>{io.forgetVisits(t)}),[parseInt],{attachable:!1})(\"mock-visits\",((...e)=>{if(!g.debug)return new qe(\"debugonly\",\"(mock-visits:) cannot be used outside of debug mode.\");const t=e.find((e=>!Xe.hasValid(e)));return t?new qe(\"datatype\",`I can't mock-visit '${t}' because no passage with that name exists.`):void 0}),((e,...t)=>{io.mockVisits=at(t)}),[Zo(String)],{attachable:!1})(\"mock-turns\",(()=>{if(!g.debug)return new qe(\"debugonly\",\"(mock-turns:) cannot be used outside of debug mode.\")}),((e,t)=>{io.mockTurns=t}),[ai],{attachable:!1})(\"seed\",hi,((e,t)=>{io.setSeed(t)}),[String],{attachable:!1})([\"dialog\",\"alert\"],((e,t,...n)=>{if(e instanceof La){if(\"two way\"===e.bind)return new qe(\"datatype\",\"(dialog:) shouldn't be given two-way bound variables.\",'Change the \"2bind\" keyword to just \"bind\".');if(void 0===t)return new qe(\"datatype\",\"(dialog:) needs a message string or codehook to display.\")}else void 0!==t&&n.unshift(t);const r=n.findIndex((e=>\"\"===e));if(r>-1)return new qe(\"datatype\",`(dialog:)'s ${N(r+1)} link text shouldn't be an empty string.`)}),((e,t,n,r,...a)=>{n instanceof La||(\"string\"==typeof r&&a.unshift(r),r=n,n=void 0),a.length||(a=[\"OK\"]);return{blocked:Xo({section:t,message:r,cd:e,buttons:a.map((e=>({name:e,callback(){t.unblock(n?.set(e)||\"\")}})))})}}),[ei(La,String,ir),ti(ei(ir,String)),ni(String)])(\"open-url\",hi,((e,t)=>{window.open(t,\"\")}),[String],{attachable:!1})([\"restart\",\"reload\"],hi,(()=>{if(!g.ignoreGotos){if(io.turns<=1)return new qe(\"infinite\",\"I mustn't (restart:) the story in the starting passage.\");io.hasSessionStorage&&sessionStorage.removeItem(\"Saved Session\"),window.location.reload()}}),[],{attachable:!1})(\"goto-url\",hi,((e,t)=>{window.location.assign(t)}),[String],{attachable:!1})(\"ignore\",hi,hi,[ni(Qo)])(\"assert-exists\",(e=>{if(\"\"===e)return new qe(\"datatype\",\"(assert-exists:) mustn't be given an empty string.\")}),((e,t,n)=>{let r=0;return(\"string\"==typeof n?new ka({type:\"string\",data:n}):n).forEach(t,(()=>{++r})),r?e:new qe(\"assertion\",`I didn't see any ${\"string\"==typeof n?\"text occurrences of\":\"hooks matching\"} ${ut(n)} in this passage.`)}),[ei(ka,String)])(\"assert\",(e=>e?void 0:new qe(\"assertion\",\"An assertion failed\")),hi,[Boolean],{storable:!1}),Et.add(\"save-game\",\"Boolean\",((e,t,n)=>{if(n||=\"\",!io.hasStorage)return!1;const{pastAndPresent:r}=io.serialise(!1);if(\"\"===r)return!1;try{return localStorage.setItem(fi(\"Saved Game\")+t,r),localStorage.setItem(fi(\"Saved Game Filename\")+t,n),!0}catch(e){return!1}}),[String,ti(String)])(\"prompt\",\"String\",((e,t,n,r,a)=>{if(e.stackTop?.evaluateOnly)return new qe(\"macrocall\",...mi(e.stackTop.evaluateOnly));if(\"\"===a)return new qe(\"datatype\",\"The text for (prompt:)'s confirm link can't be blank.\");const o=Xo({section:e,message:t,defaultValue:n,buttons:[{name:a||\"OK\",confirm:!0,callback:()=>e.unblock(o.find(\"input\").last().val())}].concat(\"\"===r?[]:{name:r||\"Cancel\",confirm:!1,callback:()=>e.unblock(n)})});return e.stackTop.blocked=o,0}),[ei(String,ir),String,ti(String),ti(String)])(\"confirm\",\"Boolean\",((e,t,n,r)=>{if(e.stackTop?.evaluateOnly)return new qe(\"macrocall\",...mi(e.stackTop.evaluateOnly));if(\"\"===r)return new qe(\"datatype\",\"The text for (confirm:)'s confirm link can't be blank.\");const a=Xo({section:e,message:t,defaultValue:!1,buttons:[{name:r||\"OK\",confirm:!0,callback:()=>e.unblock(!0)}].concat(\"\"===n?[]:{name:n||\"Cancel\",confirm:!1,callback:()=>e.unblock(!1)})});return e.stackTop.blocked=a,0}),[ei(String,ir),ti(String),ti(String)])(\"page-url\",\"String\",(()=>window.location.href),[]);const{optional:yi,rest:bi,either:vi,zeroOrMore:wi,Any:$i,nonNegativeInteger:ki}=Et.TypeSignature,xi=W(\"en\");Et.add([\"a\",\"array\"],\"Array\",((e,...t)=>t),wi(vi(Da,$i)))(\"range\",\"Array\",((e,t,n)=>bt(t,n)),[parseInt,parseInt])(\"subarray\",\"Array\",((e,t,n,r)=>gt(t,n,r)),[Array,parseInt,parseInt])(\"reversed\",\"Array\",((e,...t)=>t.reverse().map(at)),wi($i))(\"shuffled\",\"Array\",((e,...t)=>io.shuffled(...t).map(at)),[wi($i)])(\"sorted\",\"Array\",((e,...t)=>{if(!(t[0]instanceof ja)){const e=t.filter((e=>\"string\"!=typeof e&&\"number\"!=typeof e));return e?.length?1===e.length&&Array.isArray(e[0])?new qe(\"macrocall\",\"Please give multiple numbers or strings to (sorted:), not a single array.\",\"You can use the spread ... syntax to spread out the array's values into (sorted:).\"):new qe(\"datatype\",`If (sorted:) isn't given a 'via' lambda, it must be given only numbers and strings, not ${it(e[0])}.`):t.sort(xi)}let n=t.shift();if(\"making\"in n||\"where\"in n||\"when\"in n||!(\"via\"in n))return new qe(\"datatype\",`The optional lambda given to (sorted:) must be a 'via' lambda, not ${it(n)}.`);let r=[];for(let a=0;a<t.length;a+=1){const o=n.apply(e,{loop:t[a],pos:a+1});if(o instanceof qe)return o;if(\"string\"!=typeof o&&\"number\"!=typeof o)return new qe(\"datatype\",`The \"via\" lambda given to (sorted:) converted ${it(t[a])} into ${it(o)}, but it should have produced a string or number.`,\"(sorted:) can only sort strings and numbers, so the lambda needs to convert values into either of those types.\");r[a]=[t[a],o]}return r.sort(((e,t)=>xi(e[1],t[1]))).map((e=>e[0]))}),[wi($i)])(\"rotated\",\"Array\",((e,t,...n)=>{if(0===t)return new qe(\"macrocall\",\"I can't rotate these values by 0 positions.\");const r=-1*(t=Math.abs(t)%n.length*Math.sign(t));return n.slice(r).concat(n.slice(0,r)).map(at)}),[parseInt,wi($i)])(\"rotated-to\",\"Array\",((e,t,...n)=>{const r=t.filter(e,n);if(r instanceof qe)return r;if(!r.length)return new qe(\"macrocall\",`None of these ${n.length} values matched the lambda, so I can't rotate them.`);const a=n.indexOf(r[0]);return n.slice(a).concat(n.slice(0,a)).map(at)}),[ja.TypeSignature(\"where\"),bi($i)])(\"repeated\",\"Array\",((e,t,...n)=>{const r=[];if(!n.length)return r;for(;t-- >0;)r.push(...n);return r.map(at)}),[ki,bi($i)])(\"interlaced\",\"Array\",((e,...t)=>{let n=Math.min(...t.map((e=>e.length)));const r=[];for(let e=0;e<n;e+=1)for(let n=0;n<t.length;n+=1)r.push(at(t[n][e]));return r}),[Array,bi(Array)])(\"permutations\",\"Array\",((e,...t)=>t.length?C(...t):[]),[wi($i)])(\"unique\",\"Array\",((e,...t)=>t.filter(wt)),[wi($i)])(\"altered\",\"Array\",((e,t,...n)=>n.reduce(((n,r,a)=>{if(n instanceof qe)return n;const o=t.apply(e,{loop:r,pos:a+1});if(null===o)return n.push(r),n;if(o instanceof qe)return o;let i;return(i=et(o))?new qe(\"datatype\",`(altered:)'s 'via' lambda produced ${it(i)}, which can't be stored in arrays.`):(n.push(o),n)}),[])),[vi(ja.TypeSignature(\"via\"),ja.TypeSignature(\"where\",\"via\")),wi($i)])(\"find\",\"Array\",((e,t,...n)=>t.filter(e,n)),[ja.TypeSignature(\"where\"),wi($i)])([\"all-pass\",\"pass\"],\"Boolean\",((e,t,...n)=>{const r=t.filter(e,n);return r instanceof qe?r:r.length===n.length}),[ja.TypeSignature(\"where\"),wi($i)])(\"some-pass\",\"Boolean\",((e,t,...n)=>{const r=t.filter(e,n);return r instanceof qe?r:r.length>0}),[ja.TypeSignature(\"where\"),wi($i)])(\"none-pass\",\"Boolean\",((e,t,...n)=>{const r=t.filter(e,n);return r instanceof qe?r:0===r.length}),[ja.TypeSignature(\"where\"),wi($i)])(\"folded\",\"Any\",((e,t,...n)=>n.reduce(((n,r,a)=>{if(n instanceof qe)return n;if(r instanceof qe)return r;const o=t.apply(e,{making:n,loop:r,pos:a+1});if(o instanceof qe)return o;if(null===o)return n;let i;return(i=et(o))?new qe(\"datatype\",`(folded:)'s 'via' lambda produced ${it(i)}, which can't be stored in arrays.`):o}))),[vi(ja.TypeSignature(\"where\",\"via\",\"making\"),ja.TypeSignature(\"via\",\"making\")),bi($i)])([\"dm-names\",\"datamap-names\",\"datanames\"],\"Array\",((e,t)=>Array.from(t.keys()).sort(W(\"en\"))),[Map])([\"dm-values\",\"datamap-values\",\"datavalues\"],\"Array\",((e,t)=>Array.from(t.entries()).sort(W(\"en\",(e=>String(e[0])))).map((e=>at(e[1])))),[Map])([\"dm-entries\",\"datamap-entries\",\"dataentries\"],\"Array\",((e,t)=>Array.from(t.entries()).sort(((e,t)=>[e[0],t[0]].sort(W(\"en\"))[0]===e[0]?-1:1)).map((e=>new Map([[\"name\",e[0]],[\"value\",at(e[1])]])))),[Map])([\"dm-altered\",\"datamap-altered\"],\"Datamap\",((e,t,n)=>Array.from(n.entries()).sort(((e,t)=>[e[0],t[0]].sort(W(\"en\"))[0]===e[0]?-1:1)).reduce(((n,r,a)=>{if(n instanceof qe)return n;const o=new Map([[\"name\",r[0]],[\"value\",at(r[1])]]),i=t.apply(e,{loop:o,pos:a+1});if(i instanceof qe)return i;if(null===i)return n.set(r[0],r[1]);let s;return(s=et(i))?new qe(\"datatype\",`(dm-altered:)'s 'via' lambda produced ${it(s)}, which can't be stored in datamaps.`):n.set(r[0],i)}),new Map)),[vi(ja.TypeSignature(\"via\"),ja.TypeSignature(\"where\",\"via\")),Map])(\"history\",\"Array\",((e,t)=>{const n=io.history();if(!t)return n;const r=t.filter(e,n.map((e=>Xe.get(e))));return r instanceof qe?r:r.map((e=>e.get(\"name\")))}),[yi(ja.TypeSignature(\"where\"))])(\"visited\",\"Boolean\",((e,t)=>{if(\"string\"==typeof t)return Xe.has(t)?io.passageNameVisited(t)>0||io.passage===t:new qe(\"macrocall\",`There's no passage named '${t}' in this story.`);let n=io.history(),r=t.filter(e,n.concat(io.passage).map((e=>Xe.get(e))));return r instanceof qe?r:r.length>0}),[vi(String,ja.TypeSignature(\"where\"))])(\"passage\",\"Datamap\",((e,t)=>at(Xe.get(t||io.passage))||new qe(\"macrocall\",`There's no passage named '${t}' in this story.`)),[yi(String)])(\"passages\",\"Array\",((e,t)=>{const n=W(\"en\"),r=[...Xe.values()].map((e=>at(e))),a=t?t.filter(e,r):r;return a instanceof qe?a:a.sort(((e,t)=>n(e.get(\"name\"),t.get(\"name\"))))}),[yi(ja.TypeSignature(\"where\"))])(\"open-storylets\",\"Array\",((e,t)=>{if(e.stackTop.evaluateOnly)return new qe(\"macrocall\",`(open-storylets:) can't be used in ${e.stackTop.evaluateOnly}.`);const n=Xe.getStorylets(e,t);return n instanceof qe?n:n.map(at)}),[yi(ja.TypeSignature(\"where\"))])(\"savedgames\",\"Datamap\",(()=>{function e(e){return`(${e} ${g.ifid}) `}let t,n=0;const r=new Map;do{if(!io.hasStorage)break;t=localStorage.key(n),n+=1;const a=e(\"Saved Game\");t?.startsWith(a)&&(t=t.slice(a.length),r.set(t,localStorage.getItem(e(\"Saved Game Filename\")+t)))}while(t);return r}),[])([\"datamap\",\"dm\"],\"Datamap\",((e,...t)=>{let n;const r=new Map,a=t.reduce(((e,t)=>{if(e instanceof qe)return e;if(void 0===n)n=t;else{let e=tt(r,n);if(e instanceof qe)return e;if(r.has(n))return new qe(\"macrocall\",`You used the same data name (${it(n)}) twice in the same (datamap:) call.`);r.set(n,at(t)),n=void 0}return!0}),!0);return a instanceof qe?a:void 0!==n?new qe(\"macrocall\",\"This datamap has a data name without a value.\"):r}),wi(vi(Da,$i)))([\"dataset\",\"ds\"],\"Dataset\",((e,...t)=>new Set(t.filter(wt).map(at))),wi($i))(\"count\",\"Number\",(function e(t,n,...r){if(r.length>1){const a=r.map((r=>e(t,n,r)));for(let e of a)if(e instanceof qe)return e;return a.reduce(((e,t)=>e+t),0)}const[a]=r;switch(Ze(n)){case\"dataset\":case\"datamap\":return new qe(\"macrocall\",\"(count:) shouldn't be given a datamap or dataset.\",\"You should use the 'contains' operator instead. For instance, write: $variable contains 'value'.\");case\"string\":return\"string\"!=typeof a?new qe(\"macrocall\",`${it(n)} can't contain ${it(a)} because it isn't also a string.`):a?n.split(a).length-1:0;case\"array\":return n.reduce(((e,t)=>e+ +dt(t,a)),0);default:return new qe(\"macrocall\",`${it(n)} can't contain values, let alone ${it(a)}.`)}}),[$i,bi($i)]);const{geomParse:Si,geomStringRegExp:Ti}=vn,{assign:Ci}=Object,{either:Ni,wrapped:ji,optional:Ai,Any:Ei,Everything:Oi,zeroOrMore:Di,rest:Ii,insensitiveSet:Mi,positiveNumber:Li,nonNegativeNumber:Ri,percent:Pi}=Et.TypeSignature,Vi=[ji(Boolean,'If you gave a number, you may instead want to check that the number is not 0. If you gave a string, you may instead want to check that the string is not \"\".')];V((()=>h.on(\"mouseenter.hover-macro\",\"[hover=false]\",(function(){const e=a(this),t=e.data(\"hoverChanger\");if(g.debug&&g.ignoreClickEvents&&!e.is(\"tw-backdrop.eval-replay *, tw-backdrop.harlowe-crash *\"))return;e.data({mouseoutStyle:e.attr(\"style\")||\"\"});const n=new nr({target:e});t?.run(n),n.update(),e.attr(\"hover\",\"true\")})).on(\"mouseleave.hover-macro\",\"[hover=true]\",(function(){const e=a(this),t=e.data(\"mouseoutStyle\");e.attr(\"style\",t).removeData(\"mouseoutStyle\").attr(\"hover\",\"false\")})))),qe.on((()=>{a(\"tw-expression, tw-hook\",h).each(((e,t)=>{let n=a(t);(n.data(\"errorEvent\")||Object)(n)}))}));const Fi=Mi(\"instant\",\"dissolve\",\"fade\",\"rumble\",\"shudder\",\"pulse\",\"zoom\",\"flicker\",\"slideleft\",\"slideright\",\"slideup\",\"slidedown\",\"fadeleft\",\"faderight\",\"fadeup\",\"fadedown\",\"blur\"),Hi=Mi(\"dotted\",\"dashed\",\"solid\",\"double\",\"groove\",\"ridge\",\"inset\",\"outset\",\"none\");Et.addChanger(\"if\",((e,t)=>new or(\"if\",[t])),((e,t)=>{e.enabled&&=t}),Vi)(\"unless\",((e,t)=>new or(\"unless\",[t])),((e,t)=>{e.enabled&&=!t}),Vi)(\"elseif\",((e,t)=>void 0===e.stackTop.lastHookShown?new qe(\"macrocall\",\"There's no (if:) or something else before this to do (else-if:) with.\"):new or(\"elseif\",[!1===e.stackTop.lastHookShown&&!!t])),((e,t)=>{e.enabled&&=t}),Vi)(\"else\",(e=>void 0===e.stackTop.lastHookShown?new qe(\"macrocall\",\"There's nothing before this to do (else:) with.\"):new or(\"else\",[!1===e.stackTop.lastHookShown])),((e,t)=>{e.enabled&&=t}),null)(\"hidden\",(()=>new or(\"hidden\")),(e=>{e.enabled=!1}),null)([\"verbatim\",\"v6m\"],(()=>new or(\"verbatim\")),(e=>{e.verbatim=!0}),null)(\"live\",((e,t)=>new or(\"live\",t?[t]:[])),((e,t)=>{e.enabled=!1,e.transitionDeferred=!0,e.data.live={delay:t}}),Ai(Number))(\"event\",((e,t)=>new or(\"event\",[t])),((e,t)=>{e.enabled=!1,e.transitionDeferred=!0,e.data.live={event:t}}),ja.TypeSignature(\"when\"))(\"more\",(()=>new or(\"more\")),(e=>{e.enabled=!1,e.transitionDeferred=!0,e.data.live={event:{when:!0,filter:e=>0!==e.Identifiers.exits?[]:[!0]}}}),null)(\"after\",((e,t,n)=>new or(\"after\",[t].concat(void 0!==n?[n]:[]))),((e,t,n)=>{e.enabled=!1,e.transitionDeferred=!0,e.data.live={event:{when:!0,filter:e=>(b+w>0&&n&&(t-=n),e.Identifiers.time>t?[!0]:[])}}}),[Li,Ai(Ri)])(\"after-error\",(()=>new or(\"after-error\",[])),(e=>{e.enabled=!1,e.transitionDeferred=!0;const{tempVariables:t}=e.section.stackTop;e.data.errorEvent=n=>{n.removeData(\"errorEvent\");const r={...e,enabled:!0,transitionDeferred:!1};r.data&&(r.data.errorEvent=void 0),e.section.whenUnblocked((()=>e.section.renderInto(\"\",void 0,r,t)))}}),[])(\"hook\",((e,t)=>{if(!t)return new qe(\"datatype\",\"The string given to (hook:) was empty.\");const n=I(t);return n?new or(\"hook\",[n]):new qe(\"datatype\",`The string given to (hook:), \"${t}\", contained only dashes and underscores.`)}),((e,t)=>{e.attr.push({name:t})}),[String])([\"for\",\"loop\"],((e,t,...n)=>t.loop?new or(\"for\",[t].concat(n)):new qe(\"datatype\",\"The lambda provided to (for:) must refer to a temp variable, not just 'it'.\")),((e,t,...n)=>{const r=t.filter(e.section,n);let a;if(a=qe.containsError(r))return a;(e.loopVars||=Object.create(null))[t.loop.getName()]=r||[]}),[ja.TypeSignature(\"where\"),Di(Ei)])([\"transition\",\"t8n\"],((e,t)=>new or(\"transition\",[I(t)])),((e,t)=>{e.transition=t,\"zoom\"===t&&(e.transitionOrigin=function(){const{left:e=0,top:t=0}=a(this).offset()||{};return`${k.x-e}px ${k.y-t}px`})}),[Fi])([\"transition-time\",\"t8n-time\"],((e,t)=>new or(\"transition-time\",[t])),((e,t)=>{e.transitionTime=t,e.data.passageT8n={...e.data.passageT8n,time:t}}),[Li])([\"transition-delay\",\"t8n-delay\"],((e,t)=>new or(\"transition-delay\",[t])),((e,t)=>{e.transitionDelay=t}),[Ri])([\"transition-skip\",\"t8n-skip\"],((e,t)=>new or(\"transition-skip\",[t])),((e,t)=>{e.transitionSkip=t}),[Li])([\"transition-depart\",\"t8n-depart\"],((e,t)=>new or(\"transition-depart\",[I(t)])),((e,t)=>{e.data.passageT8n={...e.data.passageT8n,depart:t,departOrigin:\"zoom\"===t?function(){const{left:e=0,top:t=0}=a(this).offset()||{};return`${k.x-e}px ${k.y-t}px`}:void 0}}),[Fi])([\"transition-arrive\",\"t8n-arrive\"],((e,t)=>new or(\"transition-arrive\",[I(t)])),((e,t)=>{e.data.passageT8n={...e.data.passageT8n,arrive:t,arriveOrigin:\"zoom\"===t?function(){const e=a(this),{left:t=0,top:n=0}=e.offset()||{},r=e.height()||1;return{\"transform-origin\":`${100*(k.x-t)/(e.width()||1)}% ${100*(k.y-n)/r}%`,height:`${r}px`}}:void 0}}),[Fi])(\"button\",((e,t)=>void 0===t||Si(t).size?new or(\"button\",t?[t]:[]):new qe(\"datatype\",`The string given to (button:) should be a sizing line (\"==X==\", \"==X\", \"=XXXX=\" etc.), not ${JSON.stringify(t)}.`)),((e,t)=>{const{marginLeft:n,size:r}=Si(t);e.attr.push({class(){return this.className+(this.classList.contains(\"enchantment-button\")?\"\":`${\" \".repeat(+(this.className.length>0))}enchantment-button`)}}),e.styles.push({...r?{\"margin-left\":`${n}%`}:void 0,width:r?`${r}%`:\"100%\"})}),[Ai(String)]);const qi={click:{className:\"enchantment-link\",blockClassName:\"enchantment-clickblock\"},doubleclick:{className:\"enchantment-dblclick\",blockClassName:\"enchantment-dblclickblock\"},mouseover:{className:\"enchantment-mouseover\",blockClassName:\"enchantment-mouseoverblock\"},mouseout:{className:\"enchantment-mouseout\",blockClassName:\"enchantment-mouseoutblock\"}};Et.addChanger(\"action\",((e,t)=>new or(\"action\",[I(t)])),((e,t)=>{e.attr.push({class(){const e=function e(t){const n=a(t);return n.is(\"tw-story, tw-sidebar, tw-passage\")||[\"block\",\"flex\"].includes(n.css(\"display\"))||n.children().get().some(e)}(this);return Array.from(this.classList).filter((e=>!Object.keys(qi).some((t=>qi[t].className===e||qi[t].blockClassName===e)))).concat(qi[t][e?\"blockClassName\":\"className\"]).join(\" \")}})}),[Mi(...Object.keys(qi))])([\"border\",\"b4r\"],((e,...t)=>new or(\"border\",t.map(I))),((e,...t)=>{e.styles.push({display(){let e=a(this).css(\"display\");return t.every((e=>\"none\"===e))||!e.includes(\"inline\")?e:\"inline-block\"},\"border-style\":t.join(\" \"),\"border-width\"(){return this.style.borderWidth||\"2px\"}})}),[Hi,...Array(3).fill(Ai(Hi))])([\"border-size\",\"b4r-size\"],((e,...t)=>{for(let e of t)if(e.containsUnits(\"w\",\"h\",\"Lh\"))return new qe(\"macrocall\",\"(border-size:) can't be given measurements with w, h, or Lh units.\");return new or(\"border-size\",t)}),((e,...t)=>{e.styles.push({\"border-width\":t.map((e=>e.toCSSString())).join(\" \")})}),[Ia,...Array(3).fill(Ai(Ia))])(\"corner-radius\",((e,...t)=>new or(\"corner-radius\",t)),((e,...t)=>{e.styles.push({\"border-radius\":t.map((e=>e.toCSSString())).join(\" \"),padding(){return this.style.padding||t.map((e=>e.toCSSString())).join(\" \")}})}),[Ia,...Array(3).fill(Ai(Ia))])([\"border-colour\",\"b4r-colour\",\"border-color\",\"b4r-color\"],((e,...t)=>new or(\"border-colour\",t.map((e=>e instanceof Kr?e.toCSSString():e)))),((e,...t)=>{e.styles.push({\"border-color\":t.join(\" \")})}),[Ni(String,Kr),...Array(3).fill(Ai(Ni(String,Kr)))])(\"opacity\",((e,t)=>new or(\"opacity\",[t])),((e,t)=>{e.styles.push({opacity:t})}),[Pi])(\"font\",((e,t)=>new or(\"font\",[t])),((e,t)=>{e.styles.push({\"font-family\":t})}),[String])(\"align\",((e,t)=>/^(==+>|<=+|=+><=+|<==+>)$/.test(t)?new or(\"align\",[t]):new qe(\"datatype\",`The (align:) macro requires an alignment arrow (\"==>\", \"<==\", \"==><=\" etc.) be provided, not \"${t}\"`)),((e,t)=>{let n,r=t.indexOf(\"><\");if(~r){const e=Math.round(r/(t.length-2)*50);n={\"text-align\":\"center\",\"max-width\":\"50%\",...25===e?{\"margin-left\":\"auto\",\"margin-right\":\"auto\"}:{\"margin-left\":`${e}%`}}}else n=t.startsWith(\"<\")&&t.endsWith(\">\")?{\"text-align\":\"justify\",\"max-width\":\"50%\"}:t.includes(\">\")?{\"text-align\":\"right\"}:{\"text-align\":\"left\"};n.display=\"block\",e.styles.push(n)}),[String])([\"text-colour\",\"text-color\",\"color\",\"colour\"],((e,t)=>new or(\"text-colour\",[t])),((e,t)=>{t instanceof Kr&&(t=t.toCSSString()),e.styles.push({color:t})}),[Ni(String,Kr)])([\"text-size\",\"size\"],((e,t,n)=>t.containsUnits(\"w\",\"h\")?new qe(\"datatype\",\"The (text-size:) macro's 1st argument can't have w or h units.\"):t.value<=0||(n?.value??1)<=0?new qe(\"datatype\",`The (text-size:) macro requires positive measures be given, not ${(t.value<=0?t:n).toSource()}`):new or(\"text-size\",[t].concat(n??[]))),((e,t,n)=>{e.styles.push({\"font-size\":t.toCSSString(),\"line-height\":n?.toCSSString()??\"1.5\"})}),[Ia,Ai(Ia)])(\"text-indent\",((e,t)=>new or(\"text-indent\",[t])),((e,t)=>{e.styles.push({\"text-indent\":t.toCSSString(),display:\"inline-block\"})}),[Ia])([\"text-rotate-z\",\"text-rotate\"],((e,t)=>new or(\"text-rotate-z\",[t])),((e,t)=>{e.styles.push({display:\"inline-block\",transform(){let e=a(this).css(\"transform\")||\"\";return\"none\"===e&&(e=\"\"),`${e} rotate(${t}deg)`}})}),[Number])(\"text-rotate-y\",((e,t)=>new or(\"text-rotate-y\",[t])),((e,t)=>{e.styles.push({display:\"inline-block\",transform(){let e=a(this).css(\"transform\")||\"\";return\"none\"===e&&(e=\"\"),`${e} perspective(50vw) rotateY(${t}deg)`}})}),[Number])(\"text-rotate-x\",((e,t)=>new or(\"text-rotate-x\",[t])),((e,t)=>{e.styles.push({display:\"inline-block\",transform(){let e=a(this).css(\"transform\")||\"\";return\"none\"===e&&(e=\"\"),`${e} perspective(50vw) rotateX(${t}deg)`}})}),[Number])([\"background\",\"bg\"],((e,t)=>new or(\"background\",[t])),((e,t)=>{let n;t instanceof Ra&&(t=t.loaded||t.fallback||\"#000\"),t instanceof Kr?t=t.toCSSString():t instanceof ya&&(t=t.toLinearGradientString()),n=/^\\s*(?:repeating-)?(?:linear|radial|conic)-gradient\\(/.test(t)?{\"background-image\":t}:Kr.isHexString(t)||/^\\s*(?:\\w+)\\(/.test(t)?{\"background-color\":t}:{\"background-size\":\"cover\",\"background-image\":`url(${t})`,\"background-attachment\":\"fixed\"},e.styles.push(n,{display(){const e=a(this);return!e.children().length||L(e)?a(this).css(\"display\"):\"block\"}})}),[Ni(String,Kr,ya,Ra)])(...(()=>{const e={color:()=>\"transparent\"},t=Object.setPrototypeOf({none:{},bold:{\"font-weight\":\"bold\"},italic:{\"font-style\":\"italic\"},underline:{\"text-decoration\":\"underline\"},doubleunderline:{\"text-decoration\":\"underline\",\"text-decoration-style\":\"double\"},wavyunderline:{\"text-decoration\":\"underline\",\"text-decoration-style\":\"wavy\"},strike:{\"text-decoration\":\"line-through\"},doublestrike:{\"text-decoration\":\"line-through\",\"text-decoration-style\":\"double\"},wavystrike:{\"text-decoration\":\"line-through\",\"text-decoration-style\":\"wavy\"},superscript:{\"vertical-align\":\"super\",\"font-size\":\".83em\"},subscript:{\"vertical-align\":\"sub\",\"font-size\":\".83em\"},blink:{animation:\"fade-in-out 1s steps(1,end) infinite alternate\"},shudder:{animation:\"shudder linear 0.1s 0s infinite\"},mark:{\"background-color\":\"hsla(60, 100%, 50%, 0.6)\"},condense:{\"letter-spacing\":\"-0.08em\"},expand:{\"letter-spacing\":\"0.1em\"},outline:[{\"text-shadow\"(){const e=a(this).css(\"color\");return`-1px -1px 0 ${e}, 1px -1px 0 ${e},-1px  1px 0 ${e}, 1px  1px 0 ${e}`}},{color(){return M(a(this)).backgroundColour||void 0}}],shadow:{\"text-shadow\"(){return`0.08em 0.08em 0.08em ${a(this).css(\"color\")}`}},emboss:{\"text-shadow\"(){return`0.04em 0.04em 0em ${a(this).css(\"color\")}`}},smear:[{\"text-shadow\"(){const e=a(this).css(\"color\");return`0em   0em 0.02em ${e},-0.2em 0em  0.5em ${e}, 0.2em 0em  0.5em ${e}`}},e],blur:[{\"text-shadow\"(){return`0em 0em 0.08em ${a(this).css(\"color\")}`}},e],blurrier:[{\"text-shadow\"(){return`0em 0em 0.2em ${a(this).css(\"color\")}`},\"user-select\":\"none\"},e],mirror:{display:\"inline-block\",transform:\"scaleX(-1)\"},upsidedown:{display:\"inline-block\",transform:\"scaleY(-1)\"},tall:{display:\"inline-block\",transform:\"scaleY(1.5) translateY(-0.25ex)\"},flat:{display:\"inline-block\",transform:\"scaleY(0.5) translateY(0.25ex)\"},fadeinout:{animation:\"fade-in-out 2s ease-in-out infinite alternate\"},rumble:{animation:\"rumble linear 0.1s 0s infinite\"},sway:{animation:\"sway linear 2.5s 0s infinite\"},buoy:{animation:\"buoy linear 2.5s 0s infinite\"},fidget:{animation:()=>`fidget step-end 60s ${60*-Math.random()}s infinite${Math.random()<.5?\" reverse\":\"\"}`}},null);return[\"text-style\",(e,...t)=>new or(\"text-style\",t.map(I)),(e,...n)=>{for(let r=0;r<n.length;r+=1)\"none\"===n[r]?e.styles=[]:e.styles=e.styles.concat(t[n[r]])},[Ii(Mi(...Object.keys(t)))]]})())([\"scrollbar\",\"scrollbar-y\"],((e,t)=>new or(\"scrollbar\",[t])),((e,t)=>{e.styles.push({overflowY:{auto:\"auto\",off:\"hidden\",on:\"scroll\",never:\"clip\"}[t]})}),[Mi(\"auto\",\"off\",\"on\",\"never\")])(\"scrollbar-x\",((e,t)=>new or(\"scrollbar-x\",[t])),((e,t)=>{e.styles.push({overflowX:{auto:\"auto\",off:\"hidden\",on:\"scroll\",never:\"clip\"}[t]})}),[Mi(\"auto\",\"off\",\"on\",\"never\")])(\"collapse\",(()=>new or(\"collapse\")),(e=>{e.attr.push({collapsing:!0})}),[])(\"hover-style\",((e,t)=>{const n=new nr,r=(t.run(n),n.summary());return\"styles\"==`${r}`||r.every((e=>\"styles\"===e||\"attr\"===e))&&n.attr.every((e=>\"style\"==`${Object.keys(e)}`))?new or(\"hover-style\",[t]):new qe(\"datatype\",\"The changer given to (hover-style:) must only change the hook's style.\")}),((e,t)=>{e.data.hoverChanger=t,e.attr.push({hover:(e,t)=>void 0!==t&&t})}),[or])(\"css\",((e,t)=>(t.trim().endsWith(\";\")||(t+=\";\"),new or(\"css\",[t]))),((e,t)=>{e.attr.push({style(){return(a(this).attr(\"style\")||\"\")+t}})}),[String])(\"test-true\",(()=>new or(\"test-true\",[])),(e=>{e.enabled=!0}),Di(Oi))(\"test-false\",(()=>new or(\"test-false\",[])),(e=>{e.enabled=!1}),Di(Oi)),Et.addCommand(\"animate\",a.noop,((e,t,n,r,a)=>{n.forEach(t,(t=>{let n;if(\"zoom\"===r){const{left:e=0,top:r=0}=t.offset()||{};n=`${k.x-e}px ${k.y-r}px`}R(t,r,e.transitionTime||a,e.transitionDelay,e.transitionSkip,0,n)}))}),[ka,Mi(...Fi.innerType.filter((e=>\"instant\"!==e))),Ai(Li)]);for(const e of[\"box\",\"float-box\"])Et.addChanger(e,((t,n,r)=>{const a=-1===n.search(Ti)||n.length>1&&!n.includes(\"=\"),o=\"string\"==typeof r&&(-1===r.search(Ti)||r.length>1&&!r.includes(\"=\"));return a||o?new qe(\"datatype\",`The (${e}:) macro requires a sizing line(\"==X==\", \"==X\", \"=XXXX=\" etc.) be provided, not \"${a?n:r}\".`):new or(e,[n,r].filter((e=>void 0!==e)))}),((t,n,r)=>{const{marginLeft:o,size:i}=Si(n);let s,c;\"float-box\"===e?({marginLeft:s,size:c}=Si(r)):c=r;const l=\"box\"===e?\"%\":\"vw\",u={display:\"block\",width:i+l,\"max-width\":i+l,[\"box\"===e?\"margin-left\":\"left\"]:o+l,\"overflow-y\"(){const e=a(this).css(\"overflow-y\");return e&&\"visible\"!==e?e:\"auto\"},padding(){const e=a(this).css(\"padding\");return e&&\"0px\"!==e?e:\"1em\"}};void 0!==c&&(u.height=\"box\"===e?c.toCSSString():`${c}vh`),\"float-box\"===e&&Ci(u,{position:\"fixed\",top:`${s}vh`,\"background-color\"(){return M(a(this)).backgroundColour||void 0}}),t.styles.push(u)}),[String,\"box\"===e?Ai(Ia):String]);const{either:zi,rest:Wi,optional:Bi}=Et.TypeSignature;function Ui(e,t){if(t instanceof or&&!t.canEnchant)return new qe(\"datatype\",`The changer given to (${e}:) can't include a revision, enchantment, or interaction changer like (replace:), (click:), or (link:).`)}[\"enchant\",\"change\"].forEach((e=>{Et.addCommand(e,((t,n)=>{const r=Ui(e,n);if(r)return r}),((t,n,r)=>{const a=ka.from(n),o=[];if(r instanceof or){const e=new nr({section:t});if(r.run(e),(e.innerEnchantments||[]).length>0){const t=e.innerEnchantments.map((e=>e(a)));o.push(...t)}}o.push(new Va({scope:a,[r instanceof or?\"changer\":\"lambda\"]:r,section:t})),o.forEach((n=>{\"enchant\"===e?(t.addEnchantment(n),t.updateEnchantments()):n.enchantScope()}))}),[zi(ka,String),zi(or,ja.TypeSignature(\"via\"))],{attachable:!1})})),Et.addChanger(\"enchant-in\",((e,t,n)=>{const r=Ui(\"enchant-in\",n);return r||new or(\"enchant-in\",[t,n])}),((e,t,n)=>{(e.innerEnchantments||=[]).push((r=>new Va({scope:ka.from(t),localHook:r,[n instanceof or?\"changer\":\"lambda\"]:n,section:e.section})))}),[zi(ka,String),zi(or,ja.TypeSignature(\"via\"))]),[[\"link-style\",new ka({type:\"name\",data:\"link\"})],[\"line-style\",new ka({type:\"base\",data:new ka({type:\"name\",data:\"page\"})},\"lines\",void 0)],[\"char-style\",new ka({type:\"base\",data:new ka({type:\"name\",data:\"page\"})},\"chars\",void 0)]].forEach((([e,t])=>{Et.addChanger(e,((t,n)=>{const r=Ui(e,n);return r||new or(e,[n])}),((e,n)=>{(e.innerEnchantments||=[]).push((r=>new Va({scope:t,localHook:r,[n instanceof or?\"changer\":\"lambda\"]:n,section:e.section})))}),[zi(or,ja.TypeSignature(\"via\"))])}));const _i=[\"replace\",\"append\",\"prepend\"];function Gi(e,t){return V((()=>{const t=e.classList.replace(/ /g,\".\"),n=e.blockClassList?e.blockClassList.replace(/ /g,\".\"):\"\",r=`.${t}${n?`,.${n}`:\"\"}`;h.on(e.event.map((e=>`${e}.enchantment`)).join(\" \"),r,(function(){const e=a(this);if(g.debug&&g.ignoreClickEvents&&!e.is(\"tw-backdrop.eval-replay *, tw-backdrop.harlowe-crash *\"))return;if(e.is(\"tw-open-button\"))return;const t=a(Array.from(e.parents(r).add(this)).sort(((e,t)=>8&e.compareDocumentPosition(t)?1:-1))[0]),n=t.data(\"enchantmentEvent\");n&&n(t)}))})),[(e,n,r)=>{if(!n)return new qe(\"datatype\",`A string given to this (${t}:) macro was empty.`);if(r){const e=Ui(t,r);if(e)return e}return new or(t,[ka.from(n)].concat(r?[r]:[]))},(n,r,a)=>{n.enabled=!1,n.transitionDeferred=!0,e.rerender&&(n.newTargets=(n.newTargets||[]).concat({target:r,append:e.rerender}));const o=n.section?.stackTop?n.section.stackTop.tempVariables:Object.create(null),i=new Va({functions:[t=>{t.attr(\"class\",t.children().is(\"tw-story, tw-sidebar, tw-passage\")||[\"block\",\"flex\"].includes(t.children().css(\"display\"))?e.blockClassList:e.classList),t.attr({tabIndex:\"0\"})}],data:{enchantmentEvent(){n.section.stackTop?.blocked||(e.once&&n.section.removeEnchantment(i),e.goto?po.goToPassage(e.goto,{transition:e.transition}):e.undo?po.goBack({transition:e.transition}):n.section.renderInto(n.source,void 0,{...n,append:e.once?\"append\":\"replace\",enabled:!0,transitionDeferred:!1},o))}},scope:r,section:n.section,name:t,[a instanceof or?\"changer\":\"lambda\"]:a});n.section&&(n.section.addEnchantment(i),i.enchantScope())},[zi(ka,String),Bi(zi(or,ja.TypeSignature(\"via\")))]]}_i.forEach((e=>{Et.addChanger(e,((t,...n)=>n.every(Boolean)?new or(e,n.map(ka.from),void 0,!1):new qe(\"datatype\",`A string given to this (${e}:) macro was empty.`)),((t,...n)=>{t.target?.parents().filter(\"tw-collapsed,[collapsing=true]\").length>0||t.attr.some((e=>e.collapsing))||(t.attr=[...t.attr,{collapsing:!1}]),t.newTargets||=[],t.newTargets.push(...n.filter((n=>!t.newTargets?.some((({target:t,append:r})=>dt(n,t)&&e===r)))).map((t=>({target:t,append:e,before:!0}))))}),Wi(zi(ka,String)))(`${e}-with`,((t,n)=>new or(`${e}-with`,[n],void 0,!1)),((t,n)=>{t.appendSource=(t.appendSource||[]).concat({source:n instanceof ir?n.code:n,append:e})}),zi(ir,String))}));const Xi=\"ontouchstart\"in window||navigator.maxTouchPoints>0,Yi=[{name:\"click\",enchantDesc:{event:[\"click\"],once:!0,rerender:\"\",classList:\"link enchantment-link\",blockClassList:\"enchantment-clickblock\"}},{name:\"mouseover\",enchantDesc:{event:[\"mouseenter\",Xi?\"click\":\"\"].filter(Boolean),once:!0,rerender:\"\",classList:\"link enchantment-mouseover\",blockClassList:\"enchantment-mouseoverblock\"}},{name:\"mouseout\",enchantDesc:{event:[\"mouseleave\",Xi?\"click\":\"\"].filter(Boolean),once:!0,rerender:\"\",classList:\"link enchantment-mouseout\",blockClassList:\"enchantment-mouseoutblock\"}},{name:\"doubleclick\",enchantDesc:{event:[\"dblclick\"],once:!0,rerender:\"\",classList:\"link enchantment-dblclick\",blockClassList:\"enchantment-dblclickblock\"}}];Yi.forEach((e=>{\"doubleclick\"!==e.name&&(Et.addChanger(e.name,...Gi(e.enchantDesc,e.name)),\"click\"===e.name&&Et.addChanger(`${e.name}-rerun`,...Gi({...e.enchantDesc,once:!1},`${e.name}-rerun`)))})),V((()=>{Yi.forEach((({enchantDesc:e})=>{e.blockClassList&&h.on(e.event.map((e=>`${e}.enchantment`)).join(\" \"),(function(){const t=a(this);if(g.debug&&g.ignoreClickEvents&&!t.is(\"tw-backdrop.eval-replay *, tw-backdrop.harlowe-crash *\"))return;if(t.is(\"tw-open-button\"))return;const n=a(Array.from(t.parents(`.${e.blockClassList.replace(/ /g,\".\")}`)).sort(((e,t)=>8&e.compareDocumentPosition(t)?1:-1))[0]),r=n.data(\"enchantmentEvent\");r&&r(n)}))}))})),_i.forEach((e=>{Yi.forEach((t=>{const n={...t.enchantDesc,rerender:e},r=`${t.name}-${e}`;Et.addChanger(r,...Gi(n,r))}))})),Yi.forEach((e=>{\"doubleclick\"!==e.name&&[\"goto\",\"undo\"].forEach((t=>{const n=`${e.name}-${t}`;Et.addCommand(n,((e,r)=>!e||!r&&\"goto\"===t?new qe(\"datatype\",`A string given to this (${n}:) macro was empty.`):\"goto\"!==t||Xe.hasValid(r)?void 0:new qe(\"macrocall\",`I can't (${n}:) the passage '${r}' because it doesn't exist.`)),((r,a,o,i)=>{if(\"undo\"===t&&io.pastLength<1)return new qe(\"macrocall\",\"I can't (undo:) on the first turn.\");const[,s]=Gi({...e.enchantDesc,transition:r.data.passageT8n,...\"undo\"===t?{undo:!0}:{goto:i}},n);s({section:a},ka.from(o)),r.source=\"\"}),[zi(ka,String),...\"undo\"===t?[]:[String]])}))}));const{zeroOrMore:Ji,Any:Ki}=Et.TypeSignature,Qi=e=>({typeID:\"metadata\",typeName:`a (${e}:) macro`,objectName:`a (${e}:) macro`,unstorable:!0,print:()=>\"\"});for(let[e,t]of[[\"storylet\",ja.TypeSignature(\"when\")],[\"urgency\",Number],[\"exclusivity\",Number]])Et.add(e,\"Metadata\",((t,n)=>t.stackTop.speculativePassage?n:Qi(e)),t);Et.add(\"metadata\",\"Metadata\",((e,...t)=>{let n;const r=new Map,a=t.reduce(((e,t)=>{if(e instanceof qe)return e;if(void 0===n)n=t;else{let e=tt(r,n);if(e instanceof qe)return e;if(r.has(n))return new qe(\"macrocall\",`You used the same data name (${it(n)}) twice in the same (metadata:) call.`);r.set(n,at(t)),n=void 0}return e}),!0);return a instanceof qe?a:void 0!==n?new qe(\"macrocall\",\"This (metadata:) macro has a data name without a value.\"):e.stackTop.speculativePassage?r:Qi(\"metadata\")}),Ji(Ki))(\"define\",\"Metadata\",((e,...t)=>{if(!e.stackTop.speculativePassage)return Qi(\"metadata\");for(let n of t){if(\"into\"===n.operator)return new qe(\"macrocall\",\"Please say 'to' when using the (define:) macro.\");if(!(n.dest instanceof Da))return new qe(\"macrocall\",\"Please use the (define:) macro with just single variables to the left of 'to'.\");if(n.dest.varRef.object!==io.variables)return new qe(\"macrocall\",\"Please use the (define:) macro with story-wide variables (like $this), not temp variables.\");if(1!==n.dest.varRef.propertyChain.length)return new qe(\"macrocall\",\"You can't use the (define:) macro with data names of other variables.\");let r=n.dest.datatype instanceof fa&&n.dest.datatype.name;if(!r||\"any\"!==r&&\"const\"!==r)return new qe(\"macrocall\",\"Don't use -type syntax with (define:) - each definition is always considered to be const-type.\");let[a]=n.dest.varRef.propertyChain;if(a in io.definitions.variableStore)return new qe(\"macrocall\",`The variable '$${a}' has already been used in another (define:) call.`);n.dest.varRef.object=io.definitions,n.dest.datatype=new fa(\"definition\");const o=n.set();if(o instanceof qe)return o;function i(e,t){if(t instanceof Ra)t.knownName=e;else if(Array.isArray(t))for(let n=0;n<t.length;n+=1)i(`${e}'s ${N(n+1)}`,t[n]);else if(t instanceof Map)for(let[n,r]of t.entries())i(`${e}'s (${ut(n)})`,r);else if(t instanceof Set){t=mt(t);for(let n=0;n<t.length;n+=1)i(`(a:...${e})'s ${N(n)}`,t[n])}}i(`$${a}`,n.src)}return Qi(\"metadata\")}),[Et.TypeSignature.rest(Gn)]);const{rest:Zi,either:es,optional:ts,nonNegativeInteger:ns}=Et.TypeSignature,rs=Zi(es(String,fa,Da));Et.add([\"p\",\"pattern\"],\"Datatype\",((e,...t)=>ma.create({name:\"p\",args:t})),rs)([\"p-either\",\"pattern-either\"],\"Datatype\",((e,...t)=>ma.create({name:\"p-either\",args:t,canContainTypedVars:!1,makeRegExpString:e=>`(?:${e.join(\"|\")})`})),rs)([\"p-opt\",\"pattern-opt\",\"p-optional\",\"pattern-optional\"],\"Datatype\",((e,...t)=>ma.create({name:\"p-opt\",args:t,canContainTypedVars:!1,makeRegExpString:e=>`(?:${e.join(\"\")})?`})),rs)([\"p-not\",\"pattern-not\"],\"Datatype\",((e,...t)=>t.find((e=>\"string\"==typeof e?1!==[...e].length:e instanceof fa&&!(e instanceof ma)?e.rest||[\"str\",\"empty\"].includes(e.name):e instanceof ma))?new qe(\"datatype\",\"(p-not:) should only be given single characters, or datatypes that match single characters\"):ma.create({name:\"p-not\",args:t,canContainTypedVars:!1,makeRegExpString:e=>`[^${e.map((e=>e.startsWith(\"[\")&&e.endsWith(\"]\")?e.slice(1,-1):e)).join(\"\")}]`})),rs)([\"p-not-before\",\"pattern-not-before\"],\"Datatype\",((e,...t)=>ma.create({name:\"p-not-before\",args:t,canContainTypedVars:!1,makeRegExpString:e=>`(?!${e.join(\"\")})`})),rs)([\"p-before\",\"pattern-before\"],\"Datatype\",((e,...t)=>ma.create({name:\"p-before\",args:t,canContainTypedVars:!1,makeRegExpString:e=>`(?=${e.join(\"\")})`})),rs)([\"p-start\",\"pattern-start\"],\"Datatype\",((e,...t)=>ma.create({name:\"p-start\",args:t,makeRegExpString:e=>`^(?:${e.join(\"\")})`})),rs)([\"p-end\",\"pattern-end\"],\"Datatype\",((e,...t)=>ma.create({name:\"p-end\",args:t,makeRegExpString:e=>`(?:${e.join(\"\")})$`})),rs)([\"p-many\",\"pattern-many\"],\"Datatype\",((e,...t)=>{const n=t.slice();let r,a;if(\"number\"==typeof t[0]&&(r=t.shift(),a=\"number\"==typeof t[0]?t.shift():1/0),void 0!==a&&a<r)return new qe(\"datatype\",\"The (p-many:) macro needs to be given string patterns, not just min and max numbers.\");if(!t.length)return new qe(\"datatype\",\"The (p-many:) macro needs to be given string patterns, not just min and max numbers.\");const o=t.find((e=>!(\"string\"==typeof e||e instanceof fa||e instanceof Da)));return o?new qe(\"datatype\",`This (p-many:) macro can only be given a min and max number followed by datatypes or strings, but was also given ${it(o)}.`):ma.create({name:\"p-many\",args:t,fullArgs:n,canContainTypedVars:!!r&&r>0,makeRegExpString:e=>`(?:${e.join(\"\")})${void 0!==r?`{${r}${a===1/0?\",\":a!==r?`,${a}`:\"\"}}`:\"+\"}`})}),[Zi(es(ns,String,fa,Da))])([\"p-ins\",\"pattern-ins\",\"p-insensitive\",\"pattern-insensitive\"],\"Datatype\",((e,...t)=>ma.create({name:\"p-ins\",args:t,insensitive:!0})),rs)([\"split\",\"splitted\"],\"Array\",((e,t,n)=>{let r=ma.create({name:\"split\",args:[t],canContainTypedVars:!1});if(r instanceof qe)return r;if(!n)return[\"\"];if(!(r instanceof ma&&r.regExp))return[...n];const a=RegExp(r.regExp),o=[];let i;for(;n&&(i=a.exec(n));){if(i.index+i[0].length===0)return o;o.push(n.slice(0,i.index)),n=n.slice(i.index+i[0].length)}return o.concat(n||[])}),[es(String,fa),String])(\"trimmed\",\"String\",((e,t,n)=>{if(t instanceof fa&&void 0===n)return new qe(\"datatype\",`Only a trimming pattern, ${t.toSource()}, was given to (trimmed:)`);if(void 0===n||t instanceof fa&&\"whitespace\"===t.name)return(n||t).trim();let r=ma.create({name:\"trimmed\",args:[t],canContainTypedVars:!1});return r instanceof qe?r:r.regExp?n.replace(RegExp(`^(${r.regExp})*|(${r.regExp})*$`,\"g\"),\"\"):n}),[es(String,fa),ts(String)])([\"str-find\",\"string-find\"],\"String\",((e,t,n)=>{let r=ma.create({name:\"str-find\",args:[t],canContainTypedGlobals:!1});if(r instanceof qe)return r;const a=r.typedVars();if(a instanceof qe)return a;const o=RegExp(r.regExp,\"g\");let i,s=[],{lastIndex:c}=o;for(;(i=o.exec(n))&&c!==o.lastIndex;)if(c=o.lastIndex,a.length){const e=new Map;for(let t=0;t<a.length;t+=1){if(\"match\"===a[t].varRef.getName())return new qe(\"macrocall\",\"There was a typed temp variable named _match in the pattern given to (str-find:)\",\"The variable _match is reserved, and can't be used inside (str-find:)'s pattern.\");e.set(a[t].varRef.getName(),i[t+1]),e.set(\"match\",i[0])}s.push(e)}else s.push(i[0]);return s}),[fa,String])([\"str-replaced\",\"string-replaced\",\"replaced\"],\"String\",((e,t,n,r,a)=>{if(\"number\"!=typeof t){if(void 0!==a)return new qe(\"macrocall\",\"1 too many values were given to (str-replaced:).\",\"If this is given 5 values, the first value must be a number of replacements.\");a=r,r=n,n=t,t=1/0}else if(void 0===a)return new qe(\"macrocall\",\"The (str-replaced:) macro needs 1 more value.\",\"The final string seems to be missing.\");if(r instanceof fa)return new qe(\"datatype\",`The replacement value for (str-replaced:) must be a string or lambda, not ${it(r)}`);if(a instanceof ja||n instanceof ja)return new qe(\"datatype\",`The ${a instanceof ja?\"search pattern\":\"final string\"} given to (str-replaced:) can't be a lambda.`,\"Only the replacement value (after the search pattern) can be a 'via' lambda.\");let o=ma.create({name:\"str-replaced\",args:[n],canContainTypedGlobals:!1});if(o instanceof qe)return o;if(!(o instanceof ma&&o.regExp))return a;const i=RegExp(o.regExp,\"g\"),s=r instanceof ja?o.typedVars():[];let c,l=1,u=0,d=\"\",{lastIndex:p}=i;for(;a&&(c=i.exec(a))&&t>0&&p!==i.lastIndex;){p=i.lastIndex;const n=Object.create(e.stack.length?e.stackTop.tempVariables:za);for(let e=0;e<s.length;e+=1){const t=s[e],r=Un.create(n,t.varRef.propertyChain);if(r instanceof qe)return r;const a=r.defineType(t.datatype);if(a instanceof qe)return a;r.set(c[e+1])}const o=r instanceof ja?r.apply(e,{loop:c[0],pos:l,tempVariables:n}):r;if(o instanceof qe)return o;if(\"string\"!=typeof o)return new qe(\"datatype\",`(str-replaced:)'s lambda must produce a string, but it produced ${it(o)} when given \"${c[0]}\".`);d+=a.slice(u,c.index)+o,l+=1,t-=1,u=c.index+c[0].length}return d+=a.slice(u),d}),[es(ns,String,fa),es(fa,String,ja.TypeSignature(\"via\")),es(String,ja.TypeSignature(\"via\")),ts(String)]);const{optional:as,rest:os,either:is}=Et.TypeSignature,ss=[\"Links can't have empty strings for their displayed text.\",\"In the link syntax, a link's displayed text is inside the [[ and ]], and on the non-pointy side of the -> or <- arrow if it's there.\"],{assign:cs}=Object;function ls(e,t,n=t){const r=Xe.hasValid(t)&&t===n;let a,o=e.evaluateTwineMarkup(unescape(n),\"a link's passage name\");if(r){let e=o.children().length>0?\"`\".repeat((n.match(/`+/)||[]).reduce(((e,t)=>Math.max(e,t.length+1)),1)):\"\";t=e+\"\\0\".repeat(+!!e)+t+\"\\0\".repeat(+!!e)+e}else o.findAndFilter(\"tw-error\").length&&(a=o.findAndFilter(\"tw-error\").data(\"TwineError\")),n=o.text();return{text:t,passage:n,error:a}}V((()=>{const e=\"ontouchstart\"in window||navigator.maxTouchPoints>0;function t(e){const t=a(this),n=t.closest(\"tw-expression\"),r=t.closest(\"tw-expression, tw-hook\"),o=r.data(\"clickEvent\"),i=r.data(\"section\");if(g.debug&&g.ignoreClickEvents&&!t.is(\"tw-backdrop.eval-replay *, tw-backdrop.harlowe-crash *\"))return;if(t.is(\"tw-open-button\"))return;if(i?.stackTop?.blocked&&(!(i.stackTop.blocked instanceof a)||!i.stackTop.blocked.find(t).length))return;if(o){if(t.find(\"tw-error\").length>0)return;return e.stopPropagation(),void o(t)}const s=n.data(\"linkPassageName\");let c={...n.data(\"passageT8n\")||{}};return n.find(\"tw-enchantment\").each(((e,t)=>{Object.assign(c,a(t).data(\"passageT8n\")||{})})),s?(e.stopPropagation(),void po.goToPassage(s,{transition:c})):t.is(\"[undo]\")?(e.stopPropagation(),void po.goBack({transition:c})):t.is(\"[fullscreen]\")?(e.stopPropagation(),void po.toggleFullscreen()):void 0}h.on(\"click.passage-link\",\"tw-link\"+(e?\"\":\":not(.enchantment-mouseover):not(.enchantment-mouseout):not(.enchantment-dblclick)\"),t).on(\"mouseover.passage-link\",\"tw-link.enchantment-mouseover, tw-expression.enchantment-mouseover > tw-link\",t).on(\"mouseout.passage-link\",\"tw-link.enchantment-mouseout, tw-expression.enchantment-mouseout > tw-link\",t).on(\"dblclick.passage-link\",\"tw-link.enchantment-dblclick, tw-expression.enchantment-dblclick > tw-link\",t),a(document).on(\"fullscreenchange\",(()=>{a(\"tw-link[fullscreen]\",h).each(((e,t)=>{(a(t).closest(\"tw-expression, tw-hook\").data(\"fullscreenEvent\")||Object)(t)}))}))})),[[\"link\",\"link-replace\"],[\"link-reveal\",\"link-append\"],[\"link-repeat\"],[\"link-rerun\"]].forEach((e=>Et.addChanger(e,((t,n,r)=>n?r&&!r.canEnchant?new qe(\"datatype\",`The changer given to (${e[0]}:) can't be (or include) a revision, enchantment, or interaction changer like (replace:), (click:), or (link:).`):new or(e[0],[n].concat(r||[]),void 0,!0):new qe(\"datatype\",ss[0])),((t,n,r)=>{const a=e[0],o=t.section?.stackTop?t.section.stackTop.tempVariables:Object.create(null),i=new nr({source:`<tw-link tabindex=0>${n}</tw-link>`,target:t.target instanceof Function?t.target:()=>t.target,append:\"replace\",data:{section:t.section,clickEvent:e=>{t.enablers=t.enablers.filter((e=>e.descriptor!==i)),\"link-reveal\"===a&&e.contents().unwrap();let n=e.parentsUntil(\":not(tw-enchantment)\").parent();if(n.length||(n=e.parent()),\"link-rerun\"===a){const t=e.parentsUntil(\":not(tw-enchantment)\");e.detach(),t.remove()}\"link\"!==a&&\"link-rerun\"!==a||n.empty(),t.section.renderInto(\"\",void 0,t,o),\"link-rerun\"===a&&n.prepend(e)}}});t.enablers=(t.enablers||[]).concat({descriptor:i,changer:r})}),[String,as(or)]))),Et.addCommand(\"link-goto\",(e=>{if(!e)return new qe(\"datatype\",...ss)}),((e,t,n,r)=>{let a,o;if(({text:n,passage:r,error:a}=ls(t,n,r)),a)return a;if(e.transition){const e=\"transition\";return new qe(\"datatype\",`Please attach (${e}-depart:) or (${e}-arrive:) to a passage link, not (${e}:).`)}return Xe.hasValid(r)||(o=`<tw-broken-link passage-name=\"${escape(r)}\">${n}</tw-broken-link>`),o||=`<tw-link tabindex=0 ${io.passageNameVisited(r)>0?'class=\"visited\" ':\"\"}>${n}</tw-link>`,e.data.linkPassageName=r,e.data.section=t,cs(e,{source:o,transitionDeferred:!0})}),[String,as(String)])(\"link-storylet\",((...e)=>{const t=e[1===e.length||\"string\"!=typeof e[0]?0:1];if(!t||\"string\"==typeof t)return new qe(\"datatype\",\"(link-storylet:) should be given one index number or one 'where' lambda, after the optional link text string.\")}),((e,t,...n)=>{const r=n[\"string\"==typeof n[0]?1:0];let a=\"string\"==typeof n[0]&&n[0];const o=n[n.length-1]!==r&&n[n.length-1];if(e.transition){const e=\"transition\";return new qe(\"datatype\",`Please attach (${e}-depart:) or (${e}-arrive:) to (link-storylet:), not (${e}:).`)}const i=r instanceof ja,s=Xe.getStorylets(t,i?r:void 0);if(s instanceof qe)return s;let c,l=s[i?0:r<0?s.length+r:r-1];if(l){let n=l.get(\"name\");a||=n,c||=`<tw-link tabindex=0 ${io.passageNameVisited(n)>0?'class=\"visited\" ':\"\"}>${a}</tw-link>`,e.data.linkPassageName=n,e.data.section=t}else{if(!o)return e;c=o}return cs(e,{source:c,transitionDeferred:!0})}),[is(parseInt,String,ja.TypeSignature(\"where\")),as(is(parseInt,String,ja.TypeSignature(\"where\"))),as(String)])(\"link-undo\",(e=>{if(!e)return new qe(\"datatype\",ss[0])}),((e,t,n,r=\"\")=>{if(io.pastLength<1)return cs(e,{source:r});e.data.section=t;const{tempVariables:a}=t.stackTop;return e.data.forgetUndosEvent=()=>e.data.section.whenUnblocked((()=>{const t={...e,append:\"replace\",source:r,transitionDeferred:!1};e.section.renderInto(\"\",void 0,t,a)})),cs(e,{source:`<tw-link tabindex=0 undo>${n}</tw-link>`,transitionDeferred:!0})}),[String,as(String)])(\"link-show\",(e=>{if(!e)return new qe(\"datatype\",ss[0])}),((e,t,n,...r)=>(e.data.section=t,e.data.clickEvent=n=>{n.contents().unwrap(),r.forEach((n=>n.forEach(t,(n=>{const r=n.data(\"originalSource\")||\"\",a=n.data(\"hidden\");if(a)if(n.removeData(\"hidden\"),\"object\"==typeof a&&\"jquery\"in a)n.empty().append(a);else{const a=n.data(\"tempVariables\");t.renderInto(\"\",void 0,{...e,source:r,target:n,transitionDeferred:!1},a&&Object.create(a))}}))))},cs(e,{source:`<tw-link tabindex=0>${n}</tw-link>`,transitionDeferred:!0}))),[String,os(ka)])(\"link-fullscreen\",((e,t)=>{if(!e||!t)return new qe(\"datatype\",ss[0])}),((e,t,n,r)=>{const a=()=>document.fullscreenEnabled?`<tw-link tabindex=0 fullscreen>${document.fullscreenElement?r:n}</tw-link>`:r?`<tw-broken-link>${r}</tw-broken-link>`:\"\",{tempVariables:o}=t.stackTop;return e.data.section=t,e.data.fullscreenEvent=()=>{document.fullscreenEnabled&&e.data.section.whenUnblocked((()=>{const t={...e,append:\"replace\",source:a(),transitionDeferred:!1};e.section.renderInto(\"\",void 0,t,o)}))},cs(e,{source:a(),transitionDeferred:!0})}),[String,String,as(String)]),Et.addChanger([\"link-reveal-goto\"],((e,t,n,r)=>{if(!t)return new qe(\"datatype\",...ss);if(n instanceof or){if(r instanceof or)return new qe(\"datatype\",\"You mustn't give two changers to (link-reveal-goto:)\");r=n,n=void 0}if(r&&!r.canEnchant)return new qe(\"datatype\",\"The changer given to (link-reveal-goto:) can't include a revision, enchantment, or interaction changer like (replace:), (click:), or (link:).\");let a;return({text:t,passage:n,error:a}=ls(e,t,n)),a||new or(\"link-reveal-goto\",[t,n,r].filter((e=>void 0!==e)),void 0,!1)}),((e,t,n,r)=>{if(!Xe.hasValid(n))return void(e.source=`<tw-broken-link passage-name=\"${escape(n)}\">${t}</tw-broken-link>`);const a=io.passageNameVisited(n),o=e.section?.stackTop?e.section.stackTop.tempVariables:Object.create(null),i=new nr({source:`<tw-link tabindex=0 ${a>0?'class=\"visited\" ':\"\"}>${t}</tw-link>`,target:e.target,append:\"replace\",data:{section:e.section,clickEvent:t=>{e.enablers=e.enablers.filter((e=>e.descriptor!==i)),t.contents().unwrap(),e.section.renderInto(\"\",void 0,e,o),e.section.whenUnblocked((()=>po.goToPassage(n,{transition:e.data.passageT8n})))}}});e.enablers=(e.enablers||[]).concat({descriptor:i,changer:r})}),[String,as(is(or,String)),as(or)]);const{add:us,addChanger:ds,addCommand:ps,TypeSignature:{rest:hs,either:fs,Any:gs,Everything:ms,zeroOrMore:ys}}=Et;us(\"macro\",\"CustomMacro\",((e,...t)=>{let n;const r=[];for(n=0;n<t.length;n+=1){const e=n===t.length-1,a=t[n];if(a instanceof Da===e)return new qe(\"datatype\",`The ${e?\"\":`${N(t.length-n+1)}-`}last value given to (macro:) should be a ${e?\"code hook\":\"datatyped variable\"}, not ${it(t[n])}`);if(!e){const e=\"A custom macro\";if(a.varRef.object===io.variables)return new qe(\"datatype\",`${e}'s typed variables must be temp variables (with a '_'), not global variables (with a '$').`,\"Write them with a _ symbol at the start instead of a $ symbol.\");if(a.varRef.propertyChain.length>1)return new qe(\"datatype\",`${e}'s typed variables can't be properties inside a data structure.`);if(a.datatype instanceof fa&&a.datatype.rest&&n!==t.length-2)return new qe(\"datatype\",`${e} can only have one spread variable, and it must be its last variable.`);const o=a.getName();if(r.includes(o))return new qe(\"datatype\",`${e}'s typed variables can't both be named '${o}'.`);r.push(o)}}return new ca(t.slice(0,-1),t[t.length-1])}),[hs(fs(Da,ir))]);const bs=(e,t,n)=>{if(!t.some((e=>{if(\"function\"==typeof e.output)return e.output(n),!0})))return new qe(\"macrocall\",`(${e}:) should only be used inside a code hook passed to (macro:).`)};ps([\"output-data\",\"out-data\"],a.noop,(({stack:e},t)=>bs(\"output-data\",e,t)||{blocked:!0}),[gs],{attachable:!1}),ds([\"output\",\"out\"],(()=>Object.assign(new or(\"output\",[]))),((e,t)=>{if(!e.section)return;const{section:{stack:n,stackTop:r}}=e,a=r.tempVariables,o=Array.isArray(e.source)?`[${e.source.map((e=>e.text)).join(\"\")}]`:e.source;bs(\"output\",n,{changer:t,hook:o,variables:a}),e.output=!0,r.blocked=!0}),[]),ps(\"error\",(e=>{if(!e)return new qe(\"datatype\",\"This (error:) macro was given an empty string.\")}),(({stack:e},t)=>bs(\"error\",e,new qe(\"user\",t))||{blocked:!0}),[String],{attachable:!1}),us(\"partial\",\"CustomMacro\",((e,t,...n)=>{const r=\"string\"!=typeof t?t:void 0,a=\"string\"==typeof t&&t;if(!r){if(\"string\"!=typeof a||!Et.has(a))return new qe(\"macrocall\",`The macro name given to (partial:), \"${t}\", isn't the name of a built-in macro.`);if(\"Metadata\"===Et.get(a).returnType)return new qe(\"macrocall\",`(partial:) can't be used with metadata macros such as (${t}:)`)}const o=`(partial:${ut(t)},${n.map((e=>ut(e)))})`,i=ca.createFromFn(((e,...r)=>{const a=\"string\"==typeof t?Et.run(t,e,n.concat(r)):Et.runCustom(t,e,n.concat(r));return a instanceof qe&&(a.message=`An error occurred while running the (partial:)-created macro, ${i.objectName}:\\n${a.message}`),a}),\"a (partial:) custom macro of \"+(r&&!r.knownName?\"another unnamed custom macro\":`(${a||r.knownName}:${n.map((e=>ut(e)))})`),(()=>o),(a?Et.get(a).typeSignature:r.typeSignature).filter(((e,t)=>t>=n.length||\"pattern\"in e&&(\"rest\"===e.pattern||\"zero or more\"===e.pattern))));return i}),[fs(String,ca),ys(ms)]),a.prototype.extend({popAttr(e){const t=this.attr(e);return this.removeAttr(e),t},popData(e){const t=this.data(e);return this.removeData(e),t},tag(){return this[0]?.tagName?.toLowerCase()},textNodes(e=\"*\"){return 1===this.length&&this[0]&&this[0].nodeType===Node.TEXT_NODE?[this[0]]:this.get().concat(this.contents().get(),this.find(e).contents().get()).filter(((e,t,n)=>e?.nodeType===Node.TEXT_NODE&&n.indexOf(e)===t)).sort(((e,t)=>2&e.compareDocumentPosition(t)?1:-1))},findAndFilter(e){const t=this.find(e),n=this.filter(e);return n.length?t.add(n):t}}),V((()=>setTimeout((()=>{g.debug&&Object.assign(globalThis,{REPL(e){let t=new jn,n=t.eval(Ve.lex(`(print:${e})`));return\"object\"==typeof n&&\"runCommand\"in n&&\"function\"==typeof n.runCommand?n.runCommand(t).source:n},LEX(e){let t=Ve.lex(e);return 1===t.children?.length?t.children[0]:t}})}))));const{dialog:vs}=vn;function ws(e){let t=`${e.name}: ${e.message}`;if(e.stack){const n=e.stack.split(\"\\n\"),r=n.findIndex((e=>e.includes(\"__HarloweEval\")));t+=`\\n${n.slice(0,r).join(\"\\n\").replace(/\\([^)]+\\)/g,\"\")}`}return`<div style='font-family:monospace;overflow-y:scroll;max-height:30vh'>\\`\\`\\`${t}\\`\\`\\`</div>`}var $s;window.$=a,$s=window.onerror,window.onerror=function(...e){window.onerror=$s,h.parent().append(vs({message:`Sorry to interrupt, but this page's code has got itself in a mess.\\n\\n${e[4]?ws(e[4]):\"\"}\\n(This is probably due to a bug in the Harlowe game engine.)`}).addClass(\"harlowe-crash\")),\"function\"==typeof $s&&$s(...e)},V((()=>{const e=a(\"tw-storydata\");if(0===e.length)return;g.ifid=e.attr(\"ifid\"),(e.attr(\"tags\")||\"\").split(/\\s/).forEach((e=>{\"uncompressed-pure-values\"!==e&&\"uncompressed-saves\"!==e||(g.uncompressedPureValues=!0),\"uncompressed-structures\"!==e&&\"uncompressed-saves\"!==e||(g.uncompressedStructures=!0)})),(e.attr(\"options\")||\"\").split(/\\s/).forEach((e=>{e&&(g[e]=!0),\"debug\"===e&&Ao()}));let t=e.attr(\"startnode\");void 0===t&&(t=a(\"tw-passagedata\").get().reduce(((e,t)=>{const n=t.getAttribute(\"pid\")||\"\";return!Number.isNaN(n)&&+n<e?+n:e}),1/0));let n=a(`tw-passagedata[pid='${t}']`).attr(\"name\");a(document.documentElement).on(\"keydown\",(e=>{13===e.which&&\"0\"===e.target.getAttribute(\"tabindex\")&&a(e.target).trigger(\"click\")}));let r=!1;a(\"[role=script]\").each((function(e){try{t=a(this).html(),Function(\"script\",\"DebugMode\",\"Renderer\",\"State\",\"Section\",\"Engine\",\"Passages\",\"Utils\",\"RenderUtils\",\"ImageAsset\",\"arguments=void 0;eval([script,script=void 0][0]);\")(t,Ao,dn,io,jn,po,Xe,{options:g,onStartup:V,storyElement:h,nth:N},vn,Ra)}catch(t){r||(r=!0,vs({parent:h.parent(),message:`There is a problem with this story's ${N(e+1)} script:\\n\\n${ws(t)}`}))}var t})),a(\"[role=stylesheet]\").each(((e,t)=>{a(document.head).append(`<style data-title=\"Story stylesheet '${e+1}'\">${a(t).html()}`)}));const o=new jn;o.stack=[new xn({tempVariables:new za(\"\")})];const i=Xe.loadMetadata(o);if(i.length){const e=vs({parent:h.parent(),message:\"These errors occurred when running the `(metadata:)` macro calls in this story's passages:<p></p>\"});i.forEach((t=>e.find(\"p\").append(t.render())))}Ra.loadAssets();const s=!g.debug&&io.hasSessionStorage&&sessionStorage.getItem(\"Saved Session\");s&&!0===io.deserialise(o,s)?po.showPassage(io.passage):po.goToPassage(n)}))}();//# sourceMappingURL=harlowe-min.js.map\n</script>\n\n</body>\n</html>\n","setup": function(){function escape(e){return e&&"object"==typeof e?(Object.keys(e).forEach((a=>{e[a]=escape(e[a])})),e):`${e}`.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}function makeWrapper(e){return(...a)=>`(${e}${a.join("|")})`}const e=makeWrapper("?:"),a=makeWrapper("?!"),t=makeWrapper("?="),r="[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*",o=r.replace("*","+"),n="\\b",s="[\\w\\-\\u00c0-\\u00de\\u00df-\\u00ff\\u0150\\u0170\\u0151\\u0171\\uD800-\\uDFFF]",i=s.replace("\\-",""),l=e("\\n","$"),c=`${r}(\\*+)${o}`,h=`${r}((?:0\\.)+)${o}`,d=`${r}-{3,}${r}${l}`,m=`${r}(#{1,6})${r}`,p=`${r}(==+>|<=+|=+><=+|<==+>)${r}${l}`,u=`${r}(=+\\|+|\\|+=+|=+\\|+=+|\\|=+\\|)${r}${l}`,g={opener:"\\[\\[(?!\\[)",main:void 0,text:`(${function notChars(...e){return`[^${e.map(escape).join("")}]*`}("]")})`,rightSeparator:e("\\->","\\|"),leftSeparator:"<\\-",closer:"\\]\\]",legacySeparator:"\\|",legacyText:`(${e("[^\\|\\]]",`\\]${a("\\]")}`)}+)`},y=`${i}*${i.replace("\\w","a-zA-Z")}${i}*`,b=`\\$(${y})`,f=`_(${y})`,w=`${r}'s${o}${a("_")}(${y})`,k=`(${y})${o}of${n}${a(`it${n}`)}`,v=`'s${o}`,x=`of${n}`,T=e("it","time","turns?","visits?","exits?","user","pos")+n,$=`its${o}(${y})`,C=`its${n}`,S=`(${y})${o}of${o}it${n}`,N=`of${o}it${n}`,A={opener:"\\(",name:`(${e("\\$","_")}?${s}+):${a("\\/")}`,closer:"\\)"},_=e("=<","=>",`[gl]te?${n}`,`n?eq${n}`,`isnot${n}`,`are${n}`,`x${n}`,`isa${n}`,`or${o}a${n}`),O="[a-zA-Z][\\w\\-]*",H="(?:\"[^\"]*\"|'[^']*'|[^'\">])*?",L=`\\|(${s}+)(>|\\))`,M=`(<|\\()(${s}+)\\|`,P=`((?:\\b\\d+(?:\\.\\d+)?|\\.\\d+)(?:[eE][+\\-]?\\d+)?)${a("m?s")}${n}`;g.main=g.opener+e(g.text+g.rightSeparator,g.text.replace("*","*?")+g.leftSeparator)+g.text;const I={upperLetter:"[A-Z\\u00c0-\\u00de\\u0150\\u0170]",lowerLetter:"[a-z0-9_\\-\\u00df-\\u00ff\\u0151\\u0171]",anyLetter:s,anyLetterStrict:i,whitespace:o.replace("[","[\\n\\r"),comment:"\\-\\-",escapedLine:"\\\\\\n\\\\?|\\n\\\\",br:"\\n(?!\\\\)",tag:`<\\/?${O}${H}>`,scriptStyleTag:`<(${e("script","style","textarea")})${H}>[^]*?<\\/\\1>`,scriptStyleTagOpener:"<",url:`(${e("https?","mailto","javascript","ftp","data")}:\\/\\/[^\\s<]+[^<.,:;"')\\]\\s])`,bullet:"\\*",hr:d,heading:m,align:p,column:u,bulleted:c,numbered:h,verbatimOpener:"`+",hookAppendedFront:`\\[${a("=+")}`,hookPrependedFront:`${L}\\[${a("=+")}`,hookFront:`\\[${a("=+")}`,hookBack:`\\]${a(M)}`,hookAppendedBack:`\\]${M}`,unclosedHook:"\\[=+",unclosedHookPrepended:`${L}\\[=+`,unclosedCollapsed:"\\{=+",passageLink:g.main+g.closer,legacyLink:g.opener+g.legacyText+g.legacySeparator+g.legacyText+g.closer,simpleLink:g.opener+g.legacyText+g.closer,macroFront:A.opener+t(A.name),macroName:A.name,groupingFront:`\\(${a(A.name)}`,twine1Macro:"<<[^>\\s]+\\s*(?:\\\\.|'(?:[^'\\\\]*\\\\.)*[^'\\\\]*'|\"(?:[^\"\\\\]*\\\\.)*[^\"\\\\]*\"|[^'\"\\\\>]|>(?!>))*>>",validPropertyName:y,property:w,belongingProperty:k,possessiveOperator:v,belongingOperator:x,itsOperator:C,belongingItOperator:N,variable:b,tempVariable:f,hookName:`\\?(${s}+)\\b`,cssMeasure:`(\\-?\\d+\\.?\\d*|\\d*\\.?\\d+)(m?s|px|r?em|w|l?h)${n}`,colour:e(e("Red","Orange","Yellow","Lime","Green","Cyan","Aqua","Blue","Navy","Purple","Fuchsia","Magenta","White","Gray","Grey","Black","Transparent"),"#[\\dA-Fa-f]{3}(?:[\\dA-Fa-f]{3})?"),datatype:e("alnum","alphanumeric","any(?:case)?","array","bool(?:ean)?","changer","codehook","colou?r","const","command","dm",`data${e("map","type","set")}`,"ds","digit","gradient","empty","even","image",`int${a("o")}(?:eger)?`,"lambda","lowercase","macro","measure","linebreak","newline","num(?:ber)?","odd","str(?:ing)?","uppercase","whitespace")+n,number:P,boolean:e("true","false")+n,identifier:T,itsProperty:$,belongingItProperty:S,escapedStringChar:"\\\\[^\\n]",singleStringOpener:"'",doubleStringOpener:'"',singleStringCloser:"'",doubleStringCloser:'"',is:`is${a(`${o}not${n}`,`${o}an?${n}`,`${o}in${n}`,`${o}<`,`${o}>`)}${n}`,isNot:`is${o}not${a(o+e("an?","in")+n)}${n}`,isA:`is${o}an?${n}`,isNotA:`is${o}not${o}an?${n}`,matches:`matches${n}`,doesNotMatch:`does${o}not${o}match${n}`,and:`and${n}`,or:`or${n}`,not:`not${n}`,inequality:`((?:is(?:${o}not)?${r})*)(${e("<(?!=)","<=",">(?!=)",">=")})`,isIn:`is${o}in${n}`,contains:`contains${n}`,doesNotContain:`does${o}not${o}contain${n}`,isNotIn:`is${o}not${o}in${n}`,addition:escape("+")+a("="),subtraction:escape("-")+a("=","type"),multiplication:escape("*")+a("="),division:e("/","%")+a("="),spread:`\\.\\.\\.${a("\\.")}`,to:e(`to${n}`,"="),into:`into${n}`,making:`making${n}`,where:`where${n}`,when:`when${n}`,via:`via${n}`,each:`each${n}`,bind:`2?bind${n}`,typeSignature:escape("-type")+n,incorrectOperator:_,PlainCompare:{comma:",",htmlCommentFront:"\x3c!--",htmlCommentBack:"--\x3e",strikeOpener:"~~",italicOpener:"//",boldOpener:"''",supOpener:"^^",strongFront:"**",strongBack:"**",emFront:"*",emBack:"*",collapsedFront:"{",collapsedBack:"}",groupingBack:")"}},{assign:E}=Object,R={};class Token{start=0;end=0;children=[];innerText="";constructor(e){E(this,e)}addChild(e){const a=this.lastChildEnd()||0,t=new Token(e);return t.start=a,t.end=a+e.text?.length||0,t.place=this.place,t.children=[],t.innerText&&lex$2(t),this.children.push(t),t}lastChildEnd(){const e=this.children&&this.children[this.children.length-1]||null;return e?e.end:this.start+Math.max(0,this.text.indexOf(this.innerText))}tokenAt(e){if(e<this.start||e>=this.end)return null;if(this.children.length)for(let a=0;a<this.children.length;a+=1)if(e>=this.children[a].start&&e<this.children[a].end){const t=this.children[a].tokenAt(e);if(t)return t}return this}pathAt(e){if(e<this.start||e>=this.end)return[];let a=[];if(this.children.length)for(let t=0;t<this.children.length;t+=1)if(e>=this.children[t].start&&e<this.children[t].end){const r=this.children[t].pathAt(e);if(r.length){a=a.concat(r);break}}return a.concat(this)}nearestTokenAt(e){return e<this.start||e>=this.end?null:this.children?this.children.reduce(((a,t)=>a||(e>=t.start&&e<t.end?t:null)),null):this}everyLeaf(e){return this.children&&0!==this.children.length?this.children.reduce(((a,t)=>a&&t.everyLeaf(e)),!0):!!e(this)}demote(){this.type="text"}debugRender(e=0){return`${"\t".repeat(e)}• ${this.type}\n${this.children.map((a=>a.debugRender(e+1))).join("")}`}error(e){this.type="error",this.message=e}toString(){let e=`${this.type}(${this.start}→${this.end})`;return this.children&&this.children.length>0&&(e+=`[${this.children}]`),e}copy(){const e=new Token(this);return e.children=e.children.slice(),e}foldChildren(){let e=[];const a=this.children.slice();for(let t=0;t<a.length;t+=1){const r=a[t];let o=!1;if(r.matches)for(let a=0;a<e.length;a+=1){let{type:t}=e[a];t in r.matches&&(foldTokens(this,r,e[a]),e=e.slice(a+1),o=!0)}!o&&r.isFront&&e.unshift(r)}}}function lex$2(e,a){const t=e.innerText;let r=null,o=0,n=o,s=t.length,i=null;for(;o<s;){const s=t.slice(o);let l=(r?.length?r[0]:e).innerMode,c=0,h=l.length;for(;c<h;c+=1){const h=R[l[c]];if(h.constraint&&!h.constraint(i)||h.cannotFollowText&&("text"===i?.type||n<o)||(h.plainCompare?!s.startsWith(h.pattern):!h.pattern.test(s)))continue;const d=h.fn(h.plainCompare?h.pattern:h.pattern.exec(s)||"");let m=!1,p=0;if(d.matches){for(;r&&p<r.length;p+=1){let{type:e,aka:a}=r[p];if(e in d.matches){m=!0;break}a&&(e=a),d.cannotCross?.includes(e)&&(p=r.length-1)}if((!r||p>=r.length)&&!d.isFront)continue}n<o&&e.addChild({type:"text",text:t.slice(n,o),innerMode:l}),i=e.addChild(d),o+=i.text.length,n=o;let u=!1;m&&r&&(a&&foldTokens(e,i,r[p]),r=r.slice(p+1),u=!0),!u&&i.isFront&&(r?r.unshift(i):r=[i]);break}c===h&&(o+=1,null===i&&(i=new Token({type:"text",text:"",innerMode:l})))}for(n<o&&e.addChild({type:"text",text:t.slice(n,o),innerMode:(r?.length?r[0]:e).innerMode});r?.length;)r.shift()?.demote();return e}function foldTokens(e,a,t){const r=e.children.indexOf(a),o=e.children.indexOf(t);if(a.children=e.children.splice(o+1,r-(o+1)),!a.matches?.[t.type])throw Error(`Couldn't fold backToken ${a.type} to match frontToken ${t.type}`);a.type=a.matches[t.type]||"",a.innerText="";for(let e=0,t=a.children.length;e<t;e++)a.innerText+=a.children[e].text;a.start=t.start,a.text=t.text+a.innerText+a.text;for(let e in t)e in t&&!(e in a)&&(a[e]=t[e]);e.children.splice(o,1)}const F={lex:(e,a="",t="start",r=!1)=>lex$2(new Token({type:"root",place:a,start:0,end:e.length,text:e,innerText:e,children:[],innerMode:F.modes[t]}),!r),rules:R,modes:{}},z=["boolean","is","to","into","where","when","via","making","each","and","or","not","isNot","contains","doesNotContain","isIn","isA","isNotA","isNotIn","matches","doesNotMatch","typifies","untypifies","bind"],B=["comma","spread","typeSignature","addition","subtraction","multiplication","division"],{keys:W,assign:q}=Object;let D=Object.freeze({lex:function rules(e){function textTokenFn(e){return e||="innerText",a=>({[e]:"string"==typeof a?a:a.reduceRight(((e,a,t)=>e||(t?a:"")),"")})}function openerFn(e,a){const t={};return t[e]=a,()=>({isFront:!0,matches:t,cannotCross:["verbatimOpener"]})}const a=Object.bind(0,null);function setupRules(e,a){for(let t of W(a)){let r=a[t];if(!r)continue;const o=r.fn;r.fn=a=>{const r=o(a);return r.text||(r.text="string"==typeof a?a:a[0]),r.type||(r.type=t),r.innerMode||(r.innerMode=e),r}}return a}const t=[],r=[],o=[],n=setupRules(t,{hr:{fn:a},bulleted:{fn:e=>({depth:e[1].length})},numbered:{fn:e=>({depth:e[1].length/2})},heading:{fn:e=>({depth:e[1].length})},align:{fn(e){let a;const t=e[1],r=t.indexOf("><");return~r?(a=Math.round(r/(t.length-2)*50),25===a&&(a="center")):t.startsWith("<")&&t.endsWith(">")?a="justify":t.indexOf(">")>-1?a="right":t.indexOf("<")>-1&&(a="left"),{align:a}}},column:{fn(e){let a;const t=e[1],r=t.indexOf("|");return a=r&&r<t.length-1?"center":t.startsWith("|")&&t.endsWith("|")?"none":r===t.length-1?"right":"left",{column:a,width:/\|+/.exec(t)?.[0].length,marginLeft:/^=*/.exec(t)?.[0].length,marginRight:/=*$/.exec(t)?.[0].length}}}}),blockRuleConstraint=e=>{switch(e?e.type:e){case null:case"br":case"hr":case"bulleted":case"numbered":case"heading":case"align":case"column":case"escapedLine":return!0}return!1};for(const e in n){const a=n[e];a&&(a.constraint=blockRuleConstraint),a&&(a.cannotFollowText=!0)}const s=setupRules(t,{twine1Macro:{fn:()=>({type:"error",message:"Harlowe macros use a different syntax to Twine 1, SugarCube, and Yarn macros."})},emBack:{fn:()=>({matches:{emFront:"em"},cannotCross:["verbatimOpener"]})},strongBack:{fn:()=>({matches:{strongFront:"strong"},cannotCross:["verbatimOpener"]})},strongFront:{fn:()=>({isFront:!0})},emFront:{fn:()=>({isFront:!0})},boldOpener:{fn:openerFn("boldOpener","bold")},italicOpener:{fn:openerFn("italicOpener","italic")},strikeOpener:{fn:openerFn("strikeOpener","strike")},supOpener:{fn:openerFn("supOpener","sup")},comment:{fn:a},htmlCommentFront:{fn:()=>({isFront:!0})},htmlCommentBack:{fn:()=>({matches:{htmlCommentFront:"htmlComment"}})},scriptStyleTag:{fn:a},tag:{fn:a},url:{fn:a},hookPrependedFront:{fn:e=>({name:e[1],hidden:")"===e[2],isFront:!0,tagPosition:"prepended"})},hookFront:{fn:()=>({isFront:!0})},hookBack:{fn:()=>({matches:{hookPrependedFront:"hook",hookFront:"hook"},cannotCross:["verbatimOpener"]})},hookAppendedBack:{fn:e=>({name:e[2],hidden:"("===e[1],tagPosition:"appended",matches:{hookFront:"hook"},cannotCross:["verbatimOpener"]})},unclosedHook:{fn:a},unclosedHookPrepended:{fn:e=>({type:"unclosedHook",name:e[1],hidden:")"===e[2]})},verbatimOpener:{fn(e){let a=e[0].length,t={};return t[`verbatim${a}`]="verbatim",{type:`verbatim${a}`,isFront:!0,matches:t,aka:"verbatimOpener"}}},unclosedCollapsed:{fn:a},collapsedFront:{fn:()=>({isFront:!0})},collapsedBack:{fn:()=>({matches:{collapsedFront:"collapsed"},cannotCross:["verbatimOpener"]})},escapedLine:{fn:a},legacyLink:{fn:e=>({type:"twineLink",innerText:e[1],passage:e[2],innerMode:t})},br:{fn:a}}),i=q(setupRules(r,{macroFront:{fn:e=>({isFront:!0,name:e[1]})},groupingBack:{fn:()=>({matches:{groupingFront:"grouping",macroFront:"macro"},cannotCross:["singleStringOpener","doubleStringOpener","hookFront"]})},passageLink:{fn(e){const a=e[1]||"",r=e[2]||"",o=e[3]||"";return{type:"twineLink",innerText:r?o:a,passage:a?o:r,innerMode:t}}},simpleLink:{fn:e=>({type:"twineLink",innerText:e[1]||"",passage:e[1]||"",innerMode:t})},variable:{constraint:e=>!e||"macroFront"!==e.type,fn:textTokenFn("name")},tempVariable:{constraint:e=>!e||"macroFront"!==e.type,fn:textTokenFn("name")}}),{hookFront:s.hookFront,hookBack:s.hookBack}),l=setupRules(r,{htmlCommentBack:{fn:()=>({matches:{htmlCommentFront:"htmlComment"}})},comment:{fn:a},macroName:{constraint:e=>!!e&&"macroFront"===e.type,fn:textTokenFn("name")},groupingFront:{fn:()=>({isFront:!0})},property:{fn:textTokenFn("name"),constraint(e){if(e)switch(e.type){case"variable":case"hookName":case"property":case"tempVariable":case"colour":case"itsProperty":case"belongingItProperty":case"macro":case"grouping":case"string":case"datatype":case"hook":case"boolean":case"number":return!0;case"identifier":{let a=e.text?.toLowerCase();return"user"===a||"it"===a}}return!1}},possessiveOperator:{fn:a},itsProperty:{cannotFollowText:!0,fn:textTokenFn("name")},itsOperator:{cannotFollowText:!0,fn:a},belongingItProperty:{cannotFollowText:!0,fn:textTokenFn("name")},belongingItOperator:{cannotFollowText:!0,fn:a},belongingProperty:{cannotFollowText:!0,fn:textTokenFn("name")},belongingOperator:{cannotFollowText:!0,fn:a},escapedStringChar:{fn:()=>({type:"text"})},singleStringOpener:{fn:()=>({isFront:!0,matches:{singleStringOpener:"string"},innerMode:o})},doubleStringOpener:{fn:()=>({isFront:!0,matches:{doubleStringOpener:"string"},innerMode:o})},hookName:{fn:textTokenFn("name")},cssMeasure:{fn(e){let a=e[2].toLowerCase();return"ms"===a||"s"===a?{unit:a,value:+e[1]*("s"===a?1e3:1)}:{unit:a,value:+e[1]}}},datatype:{cannotFollowText:!0,fn:e=>({name:e[0].toLowerCase()})},colour:{cannotFollowText:!0,fn(e){let a,t=e[0].toLowerCase();const r={red:"e61919",orange:"e68019",yellow:"e5e619",lime:"80e619",green:"19e619",cyan:"19e5e6",aqua:"19e5e6",blue:"197fe6",navy:"1919e6",purple:"7f19e6",fuchsia:"e619e5",magenta:"e619e5",white:"fff",black:"000",gray:"888",grey:"888"};return a=t in r?`#${r[t]}`:t,{colour:a}}},number:{fn:e=>({value:parseFloat(e[0])})},inequality:{fn:e=>({operator:e[2],negate:e[1].indexOf("not")>-1})},identifier:{fn:textTokenFn("name"),cannotFollowText:!0},whitespace:{fn:a,cannotFollowText:!0},incorrectOperator:{fn:e=>{const a={"=>":">=","=<":"<=",gte:">=",lte:"<=",gt:">",lt:"<",eq:"is",isnot:"is not",neq:"is not",isa:"is a",are:"is",x:"*","or a":"or"}[e[0].toLowerCase().replace(/\s+/g," ")];return{type:"error",message:`Please say ${a?`'${a}'`:"something else"} instead of '${e[0]}'.`,explanation:"In the interests of readability, I want certain operators to be in a specific form."}},cannotFollowText:!0},...z.reduce(((e,t)=>(e[t]={fn:a,cannotFollowText:!0},e)),{}),...B.reduce(((e,t)=>(e[t]={fn:a},e)),{})}),c=setupRules(o,{singleStringCloser:l.singleStringOpener,doubleStringCloser:l.doubleStringOpener,escapedStringChar:l.escapedStringChar});t.push(...W(n),...W(i),...W(s)),r.push(...W(i),...W(l)),o.push(...W(c));const h={...n,...s,...i,...l,...c};for(const e in h){const a=h[e];a&&(e in I.PlainCompare?(a.pattern=I.PlainCompare[e],a.plainCompare=!0):a.pattern=RegExp(`^(?:${I[e]})`,"i"))}q(e.rules,h);const{modes:d}=e;return d.start=d.markup=t,d.macro=r,d.string=o,e}(F).lex,Patterns:I});const{round:V}=Math,insensitiveName=e=>`${e}`.toLowerCase().replace(/-|_/g,""),j={Macro:{set:{name:"set",sig:" ...VariableToValue",returnType:"Command",aka:[],abstract:"Stores data values in variables, optionally allowing you to permanently restrict the variable to a single datatype. The variable's contents can be changed throughout the story, as long as the optional datatype restriction is obeyed.  ",anchor:"macro_set",category:"basics",categoryOrder:"1"},put:{name:"put",sig:" ...VariableToValue",returnType:"Command",aka:[],abstract:"A left-to-right version of (set:) that requires the word `into` rather than `to`.  ",anchor:"macro_put",category:"basics",categoryOrder:"2"},unpack:{name:"unpack",sig:" ...VariableToValue",returnType:"Command",aka:[],abstract:'A specialised variation of (put:) that lets you extract multiple values from an array, datamap or string, at once, and put them into multiple variables, by placing a matching data structure on the right of `into` containing variables at the positions of those values. For instance, `(unpack: (a: 1, 2, 3) into (a: $x, 2, $y))` sets $x to 1 and $y to 3, and `(unpack: (dm: "B", 3, "A", 1) into (dm: "A", $x, "B", $y))` sets $x to 1 and $y to 3.   ',anchor:"macro_unpack",category:"data structure"},move:{name:"move",sig:" ...VariableToValue",returnType:"Command",aka:[],abstract:"A variant of (put:) that, if transferring data from a data structure, deletes the source value after copying it - in effect moving the value from the source to the destination.  ",anchor:"macro_move",category:"basics",categoryOrder:"3"},display:{name:"display",sig:" String",returnType:"Command",aka:[],abstract:"This command writes out the contents of the passage with the given string name. If a passage of that name does not exist, this produces an error.  ",anchor:"macro_display",category:"basics",categoryOrder:"5"},print:{name:"print",sig:" Any",returnType:"Command",aka:[],abstract:"This command prints out any data provided to it, as text.  ",anchor:"macro_print",category:"basics",categoryOrder:"4"},verbatimprint:{name:"verbatim-print",sig:" Any",returnType:"Command",aka:["v6m-print"],abstract:"A convenient combination of (verbatim:) and (print:), this prints out any single argument given to it, as text, but without rendering the resulting text as markup.  ",anchor:"macro_verbatim-print",category:"basics",categoryOrder:"16"},v6mprint:{name:"verbatim-print",sig:" Any",returnType:"Command",aka:["v6m-print"],abstract:"A convenient combination of (verbatim:) and (print:), this prints out any single argument given to it, as text, but without rendering the resulting text as markup.  ",anchor:"macro_verbatim-print",category:"basics",categoryOrder:"16"},verbatimsource:{name:"verbatim-source",sig:" Any",returnType:"Command",aka:["v6m-source"],abstract:"A convenient combination of (verbatim-print:) and (source:), this prints out the Harlowe source code of any value given to it.  ",anchor:"macro_verbatim-source",category:"debugging"},v6msource:{name:"verbatim-source",sig:" Any",returnType:"Command",aka:["v6m-source"],abstract:"A convenient combination of (verbatim-print:) and (source:), this prints out the Harlowe source code of any value given to it.  ",anchor:"macro_verbatim-source",category:"debugging"},goto:{name:"go-to",sig:" String",returnType:"Command",aka:[],abstract:"This command stops passage code and sends the player to a new passage, starting a new turn as if a passage link was clicked. If the passage named by the string does not exist, this produces an error.  ",anchor:"macro_go-to",category:"navigation",categoryOrder:"1"},redirect:{name:"redirect",sig:" String",returnType:"Command",aka:[],abstract:"This command sends the player to a new passage. However, unlike (goto:), this does *not* start a new turn - undoing after this will send the player to the turn before the redirect occurred.  ",anchor:"macro_redirect",category:"navigation",categoryOrder:"2"},undo:{name:"undo",sig:" [String]",returnType:"Command",aka:[],abstract:'This command stops passage code and "undoes" the current turn, sending the player to the previous visited passage and forgetting any variable changes that occurred in this passage. You may provide an optional string to display if undos aren\'t available.  ',anchor:"macro_undo",category:"navigation",categoryOrder:"3"},debug:{name:"debug",sig:"",returnType:"Command",aka:[],abstract:"This command, which takes no values, opens the Debug Mode panel if it wasn't open already. This can be used even if the story didn't begin in Debug Mode initially.  ",anchor:"macro_debug",category:"debugging"},iconundo:{name:"icon-undo",sig:" [String], [String]",returnType:"Command",aka:[],abstract:"Creates an icon, similar to those in the sidebar, that, if visible and clicked, undoes the current turn, returning to the previous passage, as if by (undo:). It is not visible if undos aren't available.  ",anchor:"macro_icon-undo",category:"sidebar",categoryOrder:"2"},iconredo:{name:"icon-redo",sig:" [String], [String]",returnType:"Command",aka:[],abstract:'Creates an icon, similar to those in the sidebar, that, if visible and clicked, "re-does" a turn that was undone. It is only visible if a turn has been undone.  ',anchor:"macro_icon-redo",category:"sidebar",categoryOrder:"3"},iconfullscreen:{name:"icon-fullscreen",sig:" [String], [String]",returnType:"Command",aka:[],abstract:"Creates an icon, similar to those in the sidebar, that, if visible and clicked, toggles fullscreen mode on or off.  ",anchor:"macro_icon-fullscreen",category:"sidebar",categoryOrder:"4"},iconrestart:{name:"icon-restart",sig:" [String]",returnType:"Command",aka:[],abstract:"Creates an icon, similar to those in the sidebar, that, if visible and clicked, reloads the whole page, restarting the story from the beginning.  ",anchor:"macro_icon-restart",category:"sidebar",categoryOrder:"5"},iconcounter:{name:"icon-counter",sig:" Bind, String, [String]",returnType:"Command",aka:[],abstract:"A command that creates a numeric counter element with a text label, designed to fit in the sidebar, displaying the contents of a number variable (rounded to a whole number as if by (trunc:)), and updating it whenever another macro changes it.  ",anchor:"macro_icon-counter",category:"sidebar",categoryOrder:"6"},meter:{name:"meter",sig:" Bind, Number, String, [String], [Colour or Gradient]",returnType:"Command",aka:[],abstract:"A command that creates a horizontal bar-graph meter, showing the current value of a number variable, relative to a maximum value (the number), and updating it whenever that variable changes.  ",anchor:"macro_meter",category:"input and interface"},cyclinglink:{name:"cycling-link",sig:" [Bind], ...String",returnType:"Command",aka:[],abstract:"A command that, when evaluated, creates a cycling link - a link which does not go anywhere, but changes its own text to the next in a looping sequence of strings, and sets the optional bound variable to match the string value of the text.  ",anchor:"macro_cycling-link",category:"input and interface",categoryOrder:"1"},seqlink:{name:"seq-link",sig:" [Bind], ...String",returnType:"Command",aka:["sequence-link"],abstract:"A command that creates a link that does not go anywhere, but changes its own text to the next in a sequence of strings, becoming plain text once the final string is reached, and setting the optional bound variable to match the text at all times.  ",anchor:"macro_seq-link",category:"input and interface",categoryOrder:"2"},sequencelink:{name:"seq-link",sig:" [Bind], ...String",returnType:"Command",aka:["sequence-link"],abstract:"A command that creates a link that does not go anywhere, but changes its own text to the next in a sequence of strings, becoming plain text once the final string is reached, and setting the optional bound variable to match the text at all times.  ",anchor:"macro_seq-link",category:"input and interface",categoryOrder:"2"},pic:{name:"pic",sig:" Image",returnType:"Command",aka:["picture"],abstract:"A basic command to show an image as a picture in your story's prose. The image appears as if by a HTML `<img>` tag.  ",anchor:"macro_pic",category:"basics"},picture:{name:"pic",sig:" Image",returnType:"Command",aka:["picture"],abstract:"A basic command to show an image as a picture in your story's prose. The image appears as if by a HTML `<img>` tag.  ",anchor:"macro_pic",category:"basics"},dropdown:{name:"dropdown",sig:" Bind, ...String",returnType:"Command",aka:[],abstract:"A command that, when evaluated, creates a dropdown menu with the given strings as options. When one option is selected, the bound variable is set to match the string value of the text.  ",anchor:"macro_dropdown",category:"input and interface"},checkbox:{name:"checkbox",sig:" Bind, String",returnType:"Command",aka:[],abstract:"A command that creates a checkbox input, which sets the given bound variable to `true` or `false`, depending on its state.  ",anchor:"macro_checkbox",category:"input and interface",categoryOrder:"7"},checkboxfullscreen:{name:"checkbox-fullscreen",sig:" String",returnType:"Command",aka:[],abstract:"A command that creates a checkbox input, which toggles the browser's fullscreen mode and windowed mode. The checkbox will automatically update to match the browser's fullscreen status. If fullscreen mode cannot be entered, the checkbox will be disabled.  ",anchor:"macro_checkbox-fullscreen",category:"input and interface",categoryOrder:"8"},input:{name:"input",sig:" [Bind], [String], [String]",returnType:"Command",aka:[],abstract:"A command macro that creates a single-line text input element, allowing the player to input any amount of text without newlines, which can optionally be automatically stored in a variable. The first string specifies the horizontal position and width, and the second string specifies an initial default value to fill the element with.  ",anchor:"macro_input",category:"input and interface",categoryOrder:"3"},forceinput:{name:"force-input",sig:" [Bind], [String], String",returnType:"Command",aka:[],abstract:"A command macro that creates a single-line text input element which appears to offer the player a means to input text, but instead replaces every keypress inside it with characters from a pre-set string that's relevant to the story.  ",anchor:"macro_force-input",category:"input and interface",categoryOrder:"4"},inputbox:{name:"input-box",sig:" [Bind], [String], [Measurement], [String]",returnType:"Command",aka:[],abstract:"A command macro that creates a multi-line text input box of the given position, width (specified by the first, optional string) and height (specified by the optional measurement), allowing the player to input any amount of text, which can optionally be automatically stored in a variable. The final optional string specifies an initial default value to fill the box with.  ",anchor:"macro_input-box",category:"input and interface",categoryOrder:"5"},forceinputbox:{name:"force-input-box",sig:" [Bind], [String], [Measurement], String",returnType:"Command",aka:[],abstract:"A command macro that creates an empty text input box of the given position, width (specified by the first, optional string) and height (specified by the optional measurement), which appears to offer the player a means to input text, but instead replaces every keypress inside it with characters from a pre-set string that's relevant to the story.  ",anchor:"macro_force-input-box",category:"input and interface",categoryOrder:"6"},show:{name:"show",sig:" ...HookName",returnType:"Command",aka:[],abstract:"Reveals hidden hooks, running the code within if it's not been shown yet.  ",anchor:"macro_show",category:"showing and hiding"},rerun:{name:"rerun",sig:" ...HookName",returnType:"Command",aka:[],abstract:"Reruns hooks, restoring them to their original contents, and running the macros within them an additional time.  ",anchor:"macro_rerun",category:"revision"},hide:{name:"hide",sig:" ...HookName",returnType:"Command",aka:[],abstract:"Hides a hook, or hooks, that were already visible, without fully erasing them or their contained macro calls.  ",anchor:"macro_hide",category:"showing and hiding"},scrollto:{name:"scroll-to",sig:" HookName, Measurement or HookName",returnType:"Command",aka:["scroll"],abstract:"This command, when given a HookName, followed by a measurement, will change the scroll position of every hook with that name to the height signified by the measurement, measured from the top. You may alternatively give another HookName instead, which, if a hook of that name is inside the first hook, will scroll the first hook and each containing hook such that the second hook is visible.  ",anchor:"macro_scroll-to",category:"window"},scroll:{name:"scroll-to",sig:" HookName, Measurement or HookName",returnType:"Command",aka:["scroll"],abstract:"This command, when given a HookName, followed by a measurement, will change the scroll position of every hook with that name to the height signified by the measurement, measured from the top. You may alternatively give another HookName instead, which, if a hook of that name is inside the first hook, will scroll the first hook and each containing hook such that the second hook is visible.  ",anchor:"macro_scroll-to",category:"window"},scrollby:{name:"scroll-by",sig:" HookName, Measurement",returnType:"Command",aka:[],abstract:"This command, when given a HookName, followed by a measurement, will vertically scroll every hook with that name by the distance specified by that measurement.  ",anchor:"macro_scroll-by",category:"window"},stop:{name:"stop",sig:"",returnType:"Command",aka:[],abstract:"This macro, which accepts no arguments, creates a (stop:) command, which is not configurable.  ",anchor:"macro_stop",category:"live",categoryOrder:"2"},loadgame:{name:"load-game",sig:" String",returnType:"Command",aka:[],abstract:"This command attempts to load a saved game from the given slot, ending the current game and replacing it with the loaded one. This causes the passage to change.  ",anchor:"macro_load-game",category:"saving"},forgetundos:{name:"forget-undos",sig:" Number",returnType:"Command",aka:[],abstract:'This macro, when used, "forgets" previous turns, preventing the player from using undo features (like (link-undo:)) to return to them. Providing a positive number will forget that many turns from the start of the game, and providing a negative number will forget all the turns up to that point from the end.  ',anchor:"macro_forget-undos",category:"game state",categoryOrder:"6"},forgetvisits:{name:"forget-visits",sig:" Number",returnType:"Command",aka:[],abstract:'This macro "forgets" all visits that occurred before the given turn number - any passage visits that occurred on those turns are treated as if they didn\'t happen. This causes (history:) to no longer list those passages at the start of the array, the `visits` identifier to report a different number for those passages, and (if the only visit to a passage was erased) the (visited:) macro to no longer regard a passage as visited.  ',anchor:"macro_forget-visits",category:"game state",categoryOrder:"5"},mockvisits:{name:"mock-visits",sig:" ...String",returnType:"Command",aka:[],abstract:'A macro that can only be used in debug mode, this allows you to mark various passages as "visited", even though the player actually hasn\'t. This allows you to quickly test passages that use the `visits` keyword, or the `(history:)` datamap, without having to play through the whole game from the start.  ',anchor:"macro_mock-visits",category:"debugging"},mockturns:{name:"mock-turns",sig:" Number",returnType:"Command",aka:[],abstract:"A macro that can only be used in debug mode, this allows you to artificially increase the number that the `visits` keyword evaluates to, without having to play through that many turns yourself.  ",anchor:"macro_mock-turns",category:"debugging"},seed:{name:"seed",sig:" String",returnType:"Command",aka:[],abstract:'A command that "fixes" Harlowe\'s random number generator, causing all random macros and features to output predetermined values based on the given "seed" string.  ',anchor:"macro_seed",category:"game state"},dialog:{name:"dialog",sig:" [Bind], String or CodeHook, ...String",returnType:"Command",aka:["alert"],abstract:"A command that, when used, displays a pop-up dialog box with the given string or codehook displayed, and a number of button-shaped links labeled with the remaining other strings. If an optional bound variable is provided, that variable is updated to match the pressed button.  ",anchor:"macro_dialog",category:"popup",categoryOrder:"1"},alert:{name:"dialog",sig:" [Bind], String or CodeHook, ...String",returnType:"Command",aka:["alert"],abstract:"A command that, when used, displays a pop-up dialog box with the given string or codehook displayed, and a number of button-shaped links labeled with the remaining other strings. If an optional bound variable is provided, that variable is updated to match the pressed button.  ",anchor:"macro_dialog",category:"popup",categoryOrder:"1"},openurl:{name:"open-url",sig:" String",returnType:"Command",aka:[],abstract:"When this macro is evaluated, the player's browser attempts to open a new tab with the given URL. This will usually require confirmation from the player, as most browsers block Javascript programs such as Harlowe from opening tabs by default.  ",anchor:"macro_open-url",category:"window"},restart:{name:"restart",sig:"",returnType:"Command",aka:["reload"],abstract:"When this command is used, the player's browser will immediately attempt to reload the page, in effect restarting the entire story.  ",anchor:"macro_restart",category:"navigation"},reload:{name:"restart",sig:"",returnType:"Command",aka:["reload"],abstract:"When this command is used, the player's browser will immediately attempt to reload the page, in effect restarting the entire story.  ",anchor:"macro_restart",category:"navigation"},gotourl:{name:"goto-url",sig:" String",returnType:"Command",aka:[],abstract:"When this command is used, the player's browser will immediately attempt to leave the story's page, and navigate to the given URL in the same tab. If this succeeds, then the story session will \"end\".  ",anchor:"macro_goto-url",category:"window"},ignore:{name:"ignore",sig:" [...Any]",returnType:"Command",aka:[],abstract:"If you want to test your passage while ignoring a specific command macro in it, temporarily change that command macro's name to (ignore:), and it will ignore all of the data given to it.  ",anchor:"macro_ignore",category:"debugging",categoryOrder:"1"},assertexists:{name:"assert-exists",sig:" HookName or String",returnType:"Command",aka:[],abstract:"A debugging macro that confirms whether a hook with the given name, or passage text matching the given string, is present in the passage. If not, it will produce a helpful error. Use this to test whether enchantment macros like (click:), (enchant:) or (show:) are working properly.  ",anchor:"macro_assert-exists",category:"debugging",categoryOrder:"5"},assert:{name:"assert",sig:" Boolean",returnType:"Command",aka:[],abstract:"A debugging macro that produces a helpful error whenever the expression given to it produces Boolean false. Use this when testing your story to help ensure that certain facts about the game state are true or not.  ",anchor:"macro_assert",category:"debugging",categoryOrder:"4"},savegame:{name:"save-game",sig:" String, [String]",returnType:"Boolean",aka:[],abstract:"This macro saves the current game's state in browser storage, in the given save slot, and including a special filename. It can then be restored using (load-game:).  ",anchor:"macro_save-game",category:"saving"},prompt:{name:"prompt",sig:" String or CodeHook, String, [String], [String]",returnType:"String",aka:[],abstract:'When this macro is evaluated, a browser pop-up dialog box is shown with the first string displayed, a text entry box containing the second string (as a default value), a confirm link and a cancel link. If the confirm link is clicked, it evaluates to the string in the text entry box. If "Cancel" is clicked, it evaluates to the default value regardless of the entry box\'s contents.  ',anchor:"macro_prompt",category:"popup"},confirm:{name:"confirm",sig:" String or CodeHook, [String], [String]",returnType:"Boolean",aka:[],abstract:"When this macro is evaluated, a pop-up dialog box is shown with the given string displayed, as well as two links (whose text can also be provided) to confirm or cancel whatever action or fact the string tells the player. When it is submitted, it evaluates to the boolean `true` if the confirm link had been clicked, and `false` if the cancel link had.  ",anchor:"macro_confirm",category:"popup"},pageurl:{name:"page-url",sig:"",returnType:"String",aka:[],abstract:"This macro produces the full URL of the story's HTML page, as it is in the player's browser.  ",anchor:"macro_page-url",category:"window"},macro:{name:"macro",sig:" [...TypedVar], CodeHook",returnType:"CustomMacro",aka:[],abstract:"Use this macro to construct your own custom macros, which you can (define:) or (set:) into variables and call as easily as a built-in macro.  ",anchor:"macro_macro",category:"custom macros",categoryOrder:"1"},outputdata:{name:"output-data",sig:" Any",returnType:"Instant",aka:["out-data"],abstract:"Use this macro inside a (macro:)'s CodeHook to output the value that the macro produces.  ",anchor:"macro_output-data",category:"custom macros",categoryOrder:"3"},outdata:{name:"output-data",sig:" Any",returnType:"Instant",aka:["out-data"],abstract:"Use this macro inside a (macro:)'s CodeHook to output the value that the macro produces.  ",anchor:"macro_output-data",category:"custom macros",categoryOrder:"3"},output:{name:"output",sig:"",returnType:"Changer",aka:["out"],abstract:"Use this macro inside a (macro:)'s CodeHook to output a command that, when run, renders the attached hook.  ",anchor:"macro_output",category:"custom macros",categoryOrder:"2"},out:{name:"output",sig:"",returnType:"Changer",aka:["out"],abstract:"Use this macro inside a (macro:)'s CodeHook to output a command that, when run, renders the attached hook.  ",anchor:"macro_output",category:"custom macros",categoryOrder:"2"},error:{name:"error",sig:" String",returnType:"Instant",aka:[],abstract:"Designed for use in custom macros, this causes the custom macro to immediately produce an error, with the given message string, and ceases running any further code in the CodeHook.  ",anchor:"macro_error",category:"custom macros",categoryOrder:"4"},partial:{name:"partial",sig:" String or CustomMacro, [...Any]",returnType:"CustomMacro",aka:[],abstract:"When given either the string name of a built-in macro, or a custom macro, followed by various values, this creates a custom macro that serves as a shorthand for calling the given macro with those values, plus any additional values.  ",anchor:"macro_partial",category:"custom macros"},a:{name:"a",sig:" [...Any]",returnType:"Array",aka:["array"],abstract:"Creates an array, which is an ordered collection of values.  ",anchor:"macro_a",category:"data structure",categoryOrder:"1"},array:{name:"a",sig:" [...Any]",returnType:"Array",aka:["array"],abstract:"Creates an array, which is an ordered collection of values.  ",anchor:"macro_a",category:"data structure",categoryOrder:"1"},range:{name:"range",sig:" Number, Number",returnType:"Array",aka:[],abstract:"Produces an array containing an inclusive range of whole numbers from a to b, in ascending order.  ",anchor:"macro_range",category:"data structure"},subarray:{name:"subarray",sig:" Array, Number, Number",returnType:"Array",aka:[],abstract:"When given an array, this returns a new array containing only the elements whose positions are between the two numbers, inclusively.  ",anchor:"macro_subarray",category:"data structure"},reversed:{name:"reversed",sig:" [...Any]",returnType:"Array",aka:[],abstract:"Similar to (a:), except that it creates an array containing the elements in reverse order.  ",anchor:"macro_reversed",category:"data structure"},shuffled:{name:"shuffled",sig:" ...Any",returnType:"Array",aka:[],abstract:"Similar to (a:), this produces an array of the given values, except that it randomly rearranges the elements instead of placing them in the given order.  ",anchor:"macro_shuffled",category:"data structure"},sorted:{name:"sorted",sig:" [Lambda], ...Any",returnType:"Array",aka:[],abstract:'This macro produces an array in which the values are sorted in English alphanumeric sort order. If any of the values are not numbers or strings, a "via" lambda must be given first, which is used to translate the value into a number or string that it should be sorted by.  ',anchor:"macro_sorted",category:"data structure"},rotated:{name:"rotated",sig:" Number, ...Any",returnType:"Array",aka:[],abstract:"Similar to the (a:) macro, but it also takes a number at the start, and moves each item forward by that number, wrapping back to the start if they pass the end of the array.  ",anchor:"macro_rotated",category:"data structure"},rotatedto:{name:"rotated-to",sig:" Lambda, [...Any]",returnType:"Array",aka:[],abstract:'Similar to the (a:) macro, but it also takes a "where" lambda at the start, and cycles the order of the subsequent values so that the first value to match the lambda is placed at the start.  ',anchor:"macro_rotated-to",category:"data structure"},repeated:{name:"repeated",sig:" Number, ...Any",returnType:"Array",aka:[],abstract:"When given a number and a sequence of values, this macro produces an array containing those values repeated, in order, by the given number of times.  ",anchor:"macro_repeated",category:"data structure"},interlaced:{name:"interlaced",sig:" Array, ...Array",returnType:"Array",aka:[],abstract:"Takes multiple arrays, and pairs up each value in those arrays: it creates an array containing each array's first value followed by each array's second value, and so forth. If some values have no matching pair (i.e. one array is longer than the other) then those values are ignored.  ",anchor:"macro_interlaced",category:"data structure"},permutations:{name:"permutations",sig:" ...Any",returnType:"Array",aka:[],abstract:"When given a sequence of values, this produces an array containing each permutation of the order of those values, as arrays.  ",anchor:"macro_permutations",category:"data structure"},unique:{name:"unique",sig:" ...Any",returnType:"Array",aka:[],abstract:"When given a sequence of values, this produces an array containing each unique value once, in the order that they appeared.  ",anchor:"macro_unique",category:"data structure"},altered:{name:"altered",sig:" Lambda, [...Any]",returnType:"Array",aka:[],abstract:'This takes a "via" lambda and a sequence of values, and creates a new array with the same values in the same order, but altered via the operation in the lambda\'s "via" clause. An optional "where" clause can also be provided, which, if its condition is false, causes that particular value to be unchanged.  ',anchor:"macro_altered",category:"data structure"},find:{name:"find",sig:" Lambda, [...Any]",returnType:"Array",aka:[],abstract:"This searches through the given values, and produces an array of those which match the given search test (which is expressed using a temp variable, the `where` keyword, and a boolean condition). If none match, an empty array is produced.  ",anchor:"macro_find",category:"data structure"},allpass:{name:"all-pass",sig:" Lambda, [...Any]",returnType:"Boolean",aka:["pass"],abstract:'This takes a "where" lambda and a series of values, and evaluates to true if the lambda, when run using each value, never evaluated to false.  ',anchor:"macro_all-pass",category:"data structure"},pass:{name:"all-pass",sig:" Lambda, [...Any]",returnType:"Boolean",aka:["pass"],abstract:'This takes a "where" lambda and a series of values, and evaluates to true if the lambda, when run using each value, never evaluated to false.  ',anchor:"macro_all-pass",category:"data structure"},somepass:{name:"some-pass",sig:" Lambda, ...Any",returnType:"Boolean",aka:[],abstract:"This is similar to (all-pass:), but produces true if one or more value, when given to the lambda, evaluated to true. It can be thought of as shorthand for putting `not` in front of (none-pass:). If zero values are given to (all-pass:), then it will return false by default. For more information, consult the description of (all-pass:).  ",anchor:"macro_some-pass",category:"data structure"},nonepass:{name:"none-pass",sig:" Lambda, ...Any",returnType:"Boolean",aka:[],abstract:"This can be thought of as the opposite of (all-pass:): it produces true if every value, when given to the lambda, never evaluated to true. If zero values are given to (none-pass:), then it will return true by default, just like (all-pass:). For more information, consult the description of (all-pass:).  ",anchor:"macro_none-pass",category:"data structure"},folded:{name:"folded",sig:" Lambda, ...Any",returnType:"Any",aka:[],abstract:'This takes a "making" lambda and a sequence of values, and creates a new value (the "total") by feeding every value in the sequence to the lambda, akin to folding a long strip of paper into a single square. The first value after the lambda is put into the total (which is the variable inside the lambda\'s "making" clause) before running the lambda on the remaining values.  ',anchor:"macro_folded",category:"data structure"},dmnames:{name:"dm-names",sig:" Datamap",returnType:"Array",aka:["data-names","datamap-names"],abstract:"This takes a datamap, and returns a sorted array of its data names, sorted alphabetically.  ",anchor:"macro_dm-names",category:"data structure"},datanames:{name:"dm-names",sig:" Datamap",returnType:"Array",aka:["data-names","datamap-names"],abstract:"This takes a datamap, and returns a sorted array of its data names, sorted alphabetically.  ",anchor:"macro_dm-names",category:"data structure"},datamapnames:{name:"dm-names",sig:" Datamap",returnType:"Array",aka:["data-names","datamap-names"],abstract:"This takes a datamap, and returns a sorted array of its data names, sorted alphabetically.  ",anchor:"macro_dm-names",category:"data structure"},dmvalues:{name:"dm-values",sig:" Datamap",returnType:"Array",aka:["data-values","datamap-values"],abstract:"This takes a datamap, and returns an array of its values, sorted alphabetically by their name.  ",anchor:"macro_dm-values",category:"data structure"},datavalues:{name:"dm-values",sig:" Datamap",returnType:"Array",aka:["data-values","datamap-values"],abstract:"This takes a datamap, and returns an array of its values, sorted alphabetically by their name.  ",anchor:"macro_dm-values",category:"data structure"},datamapvalues:{name:"dm-values",sig:" Datamap",returnType:"Array",aka:["data-values","datamap-values"],abstract:"This takes a datamap, and returns an array of its values, sorted alphabetically by their name.  ",anchor:"macro_dm-values",category:"data structure"},dmentries:{name:"dm-entries",sig:" Datamap",returnType:"Array",aka:["data-entries","datamap-entries"],abstract:'This takes a datamap, and returns an array of its name/value pairs. Each pair is a datamap that only has "name" and "value" data. The pairs are ordered by their name.  ',anchor:"macro_dm-entries",category:"data structure"},dataentries:{name:"dm-entries",sig:" Datamap",returnType:"Array",aka:["data-entries","datamap-entries"],abstract:'This takes a datamap, and returns an array of its name/value pairs. Each pair is a datamap that only has "name" and "value" data. The pairs are ordered by their name.  ',anchor:"macro_dm-entries",category:"data structure"},datamapentries:{name:"dm-entries",sig:" Datamap",returnType:"Array",aka:["data-entries","datamap-entries"],abstract:'This takes a datamap, and returns an array of its name/value pairs. Each pair is a datamap that only has "name" and "value" data. The pairs are ordered by their name.  ',anchor:"macro_dm-entries",category:"data structure"},dmaltered:{name:"dm-altered",sig:" Lambda, Datamap",returnType:"Datamap",aka:["datamap-altered"],abstract:"This is a variant of (altered:) which takes a \"via\" lambda and a single datamap, and creates a new datamap with the same datanames, but with the values changed by the 'via' lambda. The 'via' lambda is given a datamap with 'name' and 'value' datanames (identical to those in the array produced by (data-entries:)), so that the name of each data value can be used in the lambda, but it must produce a single data value. An optional \"where\" clause can also be provided, which, if its condition is false, causes that particular value to be unchanged.  ",anchor:"macro_dm-altered",category:"data structure"},datamapaltered:{name:"dm-altered",sig:" Lambda, Datamap",returnType:"Datamap",aka:["datamap-altered"],abstract:"This is a variant of (altered:) which takes a \"via\" lambda and a single datamap, and creates a new datamap with the same datanames, but with the values changed by the 'via' lambda. The 'via' lambda is given a datamap with 'name' and 'value' datanames (identical to those in the array produced by (data-entries:)), so that the name of each data value can be used in the lambda, but it must produce a single data value. An optional \"where\" clause can also be provided, which, if its condition is false, causes that particular value to be unchanged.  ",anchor:"macro_dm-altered",category:"data structure"},history:{name:"history",sig:" [Lambda]",returnType:"Array",aka:[],abstract:"This returns an array containing the string names of all of the passages the player has previously visited up to now, in the order that the player visited them. An optional lambda can filter the passages, by checking the (passage:) datamap of each. The (mock-visits:) macro can, during debugging, artifically add values to this array to simulate having visited various passages.  ",anchor:"macro_history",category:"game state",categoryOrder:"1"},visited:{name:"visited",sig:" String or Lambda",returnType:"Boolean",aka:[],abstract:'When given a string, this macro produces true if the passage has ever been visited during this game, and false otherwise. When given a "where" lambda, this returns true if any passage matching the lambda has ever been visited during this game. The (mock-visits:) macro can, during debugging, make this macro return true in cases where it would otherwise be false.  ',anchor:"macro_visited",category:"game state",categoryOrder:"2"},passage:{name:"passage",sig:" [String]",returnType:"Datamap",aka:[],abstract:"When given a passage string name, this provides a datamap containing information about that passage. If no name was provided, then it provides information about the current passage.  ",anchor:"macro_passage",category:"game state",categoryOrder:"3"},passages:{name:"passages",sig:" [Lambda]",returnType:"Array",aka:[],abstract:"This returns an array containing datamaps of information for the passages in the story, sorted by passage name, and using the optional search test to only include certain types of passages.  ",anchor:"macro_passages",category:"game state",categoryOrder:"4"},openstorylets:{name:"open-storylets",sig:" [Lambda]",returnType:"Array",aka:[],abstract:'Checks all of the (storylet:) macros in every passage, and provides an array of datamaps for every passage whose (storylet:) lambda produced true, sorted by their "urgency" metadata value, then by passage name. If a lambda was provided, the storylets are filtered using it as a search test.  ',anchor:"macro_open-storylets",category:"storylet",categoryOrder:"2"},savedgames:{name:"saved-games",sig:"",returnType:"Datamap",aka:[],abstract:"This returns a datamap containing the names of currently occupied save game slots.  ",anchor:"macro_saved-games",category:"saving"},dm:{name:"dm",sig:" [...Any]",returnType:"Datamap",aka:["datamap"],abstract:"Creates a datamap, which is a data structure that pairs string names with data values. You should provide a string name, followed by the value paired with it, and then another string name, another value, and so on, for as many as you'd like.  ",anchor:"macro_dm",category:"data structure",categoryOrder:"2"},datamap:{name:"dm",sig:" [...Any]",returnType:"Datamap",aka:["datamap"],abstract:"Creates a datamap, which is a data structure that pairs string names with data values. You should provide a string name, followed by the value paired with it, and then another string name, another value, and so on, for as many as you'd like.  ",anchor:"macro_dm",category:"data structure",categoryOrder:"2"},ds:{name:"ds",sig:" [...Any]",returnType:"Dataset",aka:["dataset"],abstract:"Creates a dataset, which is an unordered collection of unique values.  ",anchor:"macro_ds",category:"data structure",categoryOrder:"3"},dataset:{name:"ds",sig:" [...Any]",returnType:"Dataset",aka:["dataset"],abstract:"Creates a dataset, which is an unordered collection of unique values.  ",anchor:"macro_ds",category:"data structure",categoryOrder:"3"},count:{name:"count",sig:" Array or String, ...Any",returnType:"Number",aka:[],abstract:"Accepts a string or array, followed by a value, and produces the number of times any of the values are inside the string or array.  ",anchor:"macro_count",category:"data structure"},change:{name:"change",sig:" HookName or String, Changer or Lambda",returnType:"Command",aka:[],abstract:'Applies a changer (or a "via" lambda producing a changer) to every occurrence of a hook or string in a passage, once.  ',anchor:"macro_change",category:"basics",categoryOrder:"17"},enchant:{name:"enchant",sig:" HookName or String, Changer or Lambda",returnType:"Command",aka:[],abstract:'Applies a changer (or a "via" lambda producing a changer) to every occurrence of a hook or string in a passage, and continues applying that changer to any further occurrences that are made to appear in the same passage later.  ',anchor:"macro_enchant",category:"basics",categoryOrder:"18"},enchantin:{name:"enchant-in",sig:" HookName or String, Changer or Lambda",returnType:"Changer",aka:[],abstract:"A variation of (enchant:) and (change:), this applies a changer to every occurrence of a hook or string within just the attached hook, rather than the whole passage. As with (enchant:), the changer will be applied to every additional occurrence inserted into the attached hook.  ",anchor:"macro_enchant-in",category:"basics",categoryOrder:"19"},linkstyle:{name:"link-style",sig:" Changer or Lambda",returnType:"Changer",aka:[],abstract:"When attached to a hook, this causes all of the links inside the hook to be styled using the specified changer. This is equivalent to using (enchant-in:) with `?link`.  ",anchor:"macro_link-style",category:"styling"},linestyle:{name:"line-style",sig:" Changer or Lambda",returnType:"Changer",aka:[],abstract:"When attached to a hook, this causes all of the lines of prose inside the hook (identical to those that would be selected by `?page's lines`) to be styled using the specified changer.  ",anchor:"macro_line-style",category:"styling"},charstyle:{name:"char-style",sig:" Changer or Lambda",returnType:"Changer",aka:[],abstract:"When attached to a hook, this causes all of the individual non-whitespace characters inside the hook (identical to those that would be selected by `?page's chars`) to be styled using the specified changer.  ",anchor:"macro_char-style",category:"styling"},replace:{name:"replace",sig:" ...HookName or String",returnType:"Changer",aka:[],abstract:"Creates a command which you can attach to a hook, and replace target destinations with the hook's contents. The targets are either text strings within the current passage, or hook references.  Not to be confused with (str-replaced:).  ",anchor:"macro_replace",category:"revision",categoryOrder:"1"},replacewith:{name:"replace-with",sig:" String or CodeHook",returnType:"Changer",aka:[],abstract:"A counterpart to (append-with:) and (prepend-with:), this replaces the entirety of the attached hook with the contents of the given string (or code hook).  ",anchor:"macro_replace-with",category:"revision",categoryOrder:"4"},append:{name:"append",sig:" ...HookName or String",returnType:"Changer",aka:[],abstract:"A variation of (replace:) which adds the attached hook's contents to the end of each target, rather than replacing it entirely.  ",anchor:"macro_append",category:"revision",categoryOrder:"2"},appendwith:{name:"append-with",sig:" String or CodeHook",returnType:"Changer",aka:[],abstract:"Creates a changer that, when attached to a hook, adds the contents of the given string (or code hook) to the end of the hook.  ",anchor:"macro_append-with",category:"revision",categoryOrder:"5"},prepend:{name:"prepend",sig:" ...HookName or String",returnType:"Changer",aka:[],abstract:"A variation of (replace:) which adds the attached hook's contents to the beginning of each target, rather than replacing it entirely.  ",anchor:"macro_prepend",category:"revision",categoryOrder:"3"},prependwith:{name:"prepend-with",sig:" String or CodeHook",returnType:"Changer",aka:[],abstract:"Creates a changer that, when attached to a hook, adds the contents of a given string (or code hook) to the start of the hook.  ",anchor:"macro_prepend-with",category:"revision",categoryOrder:"6"},click:{name:"click",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"Produces a changer which, when attached to a hook, hides it and enchants the specified target, such that it visually resembles a link, and that clicking it causes the attached hook to be revealed.  ",anchor:"macro_click",category:"links",categoryOrder:"9"},clickrerun:{name:"click-rerun",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"A special version of the (click:) macro which allows the enchanted hook or text (specified by the first value) to be activated multiple times to re-run the attached hook.  ",anchor:"macro_click-rerun",category:"links",categoryOrder:"10"},mouseover:{name:"mouseover",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"",anchor:"macro_mouseover",category:"deprecated"},mouseout:{name:"mouseout",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"",anchor:"macro_mouseout",category:"deprecated"},clickreplace:{name:"click-replace",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"A special shorthand combination of the (click:) and (replace:) macros, this allows you to make a hook replace its own text with that of the attached hook whenever it's clicked. `(click: ?1)[(replace:?1)[...]]` can be rewritten as `(click-replace: ?1)[...]`.  ",anchor:"macro_click-replace",category:"links",categoryOrder:"10"},clickappend:{name:"click-append",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"A special shorthand combination of the (click:) and (append:) macros, this allows you to append text to a hook or string when it's clicked. `(click: ?1)[(append:?1)[...]]` can be rewritten as `(click-append: ?1)[...]`.  ",anchor:"macro_click-append",category:"links",categoryOrder:"11"},clickprepend:{name:"click-prepend",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"A special shorthand combination of the (click:) and (prepend:) macros, this allows you to prepend text to a hook or string when it's clicked. `(click: ?1)[(prepend:?1)[...]]` can be rewritten as `(click-prepend: ?1)[...]`.  ",anchor:"macro_click-prepend",category:"links",categoryOrder:"12"},mouseoverreplace:{name:"mouseover-replace",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"",anchor:"macro_mouseover-replace",category:"deprecated"},mouseoverappend:{name:"mouseover-append",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"",anchor:"macro_mouseover-append",category:"deprecated"},mouseoverprepend:{name:"mouseover-prepend",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"",anchor:"macro_mouseover-prepend",category:"deprecated"},mouseoutreplace:{name:"mouseout-replace",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"",anchor:"macro_mouseout-replace",category:"deprecated"},mouseoutappend:{name:"mouseout-append",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"",anchor:"macro_mouseout-append",category:"deprecated"},mouseoutprepend:{name:"mouseout-prepend",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"",anchor:"macro_mouseout-prepend",category:"deprecated"},clickgoto:{name:"click-goto",sig:" HookName or String, String",returnType:"Command",aka:[],abstract:"A special shorthand combination of the (click:) and (go-to:) macros, this allows you to make a hook or bit of text into a passage link. `(click-goto: ?1, 'Passage Name')` is equivalent to `(click: ?1)[(goto:'Passage Name')]`  ",anchor:"macro_click-goto",category:"links",categoryOrder:"11"},mouseovergoto:{name:"mouseover-goto",sig:" HookName or String, String",returnType:"Command",aka:[],abstract:"",anchor:"macro_mouseover-goto",category:"deprecated"},mouseoutgoto:{name:"mouseout-goto",sig:" HookName or String, String",returnType:"Command",aka:[],abstract:"",anchor:"macro_mouseout-goto",category:"deprecated"},clickundo:{name:"click-undo",sig:" HookName or String",returnType:"Command",aka:[],abstract:"A special shorthand combination of the (click:) and (undo:) macros, this allows you to make a hook or bit of text into a passage link. `(click-undo: ?1)` is equivalent to `(click: ?1)[(undo: )]`  ",anchor:"macro_click-undo",category:"links",categoryOrder:"11"},mouseoverundo:{name:"mouseover-undo",sig:" HookName or String, String",returnType:"Command",aka:[],abstract:"",anchor:"macro_mouseover-undo",category:"deprecated"},mouseoutundo:{name:"mouseout-undo",sig:" HookName or String, String",returnType:"Command",aka:[],abstract:"",anchor:"macro_mouseout-undo",category:"deprecated"},link:{name:"link",sig:" String, [Changer]",returnType:"Changer",aka:["link-replace"],abstract:"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, vanishes and reveals the hook. An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  ",anchor:"macro_link",category:"links",categoryOrder:"1"},linkreplace:{name:"link",sig:" String, [Changer]",returnType:"Changer",aka:["link-replace"],abstract:"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, vanishes and reveals the hook. An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  ",anchor:"macro_link",category:"links",categoryOrder:"1"},linkreveal:{name:"link-reveal",sig:" String, [Changer]",returnType:"Changer",aka:["link-append"],abstract:"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, reveals the hook and becomes plain, unstyled text. An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  ",anchor:"macro_link-reveal",category:"links",categoryOrder:"2"},linkappend:{name:"link-reveal",sig:" String, [Changer]",returnType:"Changer",aka:["link-append"],abstract:"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, reveals the hook and becomes plain, unstyled text. An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  ",anchor:"macro_link-reveal",category:"links",categoryOrder:"2"},linkrepeat:{name:"link-repeat",sig:" String, [Changer]",returnType:"Changer",aka:[],abstract:"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, reveals the hook. Further clicks will cause the hook to repeat itself - a copy of the hook's code will be run, and the result appended to it, in a manner similar to (for:). An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  ",anchor:"macro_link-repeat",category:"links",categoryOrder:"3"},linkrerun:{name:"link-rerun",sig:" String, [Changer]",returnType:"Changer",aka:[],abstract:"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, reveals the hook. Further clicks will cause the hook to rerun itself, as if by the effect of (rerun:). An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  ",anchor:"macro_link-rerun",category:"links",categoryOrder:"4"},linkgoto:{name:"link-goto",sig:" String, [String]",returnType:"Command",aka:[],abstract:"Takes a string of link text, and an optional destination passage name, and makes a command to create a link that takes the player to another passage. The link functions identically to a standard link.  ",anchor:"macro_link-goto",category:"links",categoryOrder:"5"},linkstorylet:{name:"link-storylet",sig:" [String], Number or Lambda, [String]",returnType:"Command",aka:[],abstract:"If there are storylets (storylets are passages containing a (storylet:) call) in this story, this will create a link to the first open storylet that matches the passed-in 'where' lambda, or, if a number **n** was passed in, the **n**th (or, if negative, **n**thlast) open storylet. An optional first string can provide the link text - otherwise, the link text is the passage name of the storylet. An optional final string can provide text to display when no such storylet is open currently.  ",anchor:"macro_link-storylet",category:"links",categoryOrder:"8"},linkundo:{name:"link-undo",sig:" String, [String]",returnType:"Command",aka:[],abstract:"Takes a string of link text, and produces a link that, when clicked, undoes the current turn and sends the player back to the previously visited passage. The link appears identical to a typical passage link. An optional second string can be provided, which is shown instead of the link if it's not possible to undo.  ",anchor:"macro_link-undo",category:"links",categoryOrder:"7"},linkshow:{name:"link-show",sig:" String, ...HookName",returnType:"Command",aka:[],abstract:"Creates a link that, when clicked, shows the given hidden hooks, running the code within.  ",anchor:"macro_link-show",category:"links",categoryOrder:"8"},linkfullscreen:{name:"link-fullscreen",sig:" String, String, [String]",returnType:"Command",aka:[],abstract:"Creates a link that, when clicked, toggles the browser's fullscreen mode and windowed mode. The first string is used as its link text if the browser is currently in windowed mode, and the second string if it's currently in fullscreen mode. The link will automatically update (re-rendering the link text) to match the browser's current fullscreen state. The optional third string is used when fullscreen mode isn't allowed by the browser - if it's absent or an empty string, the link won't be displayed at all in that situation.  ",anchor:"macro_link-fullscreen",category:"links",categoryOrder:"8"},linkrevealgoto:{name:"link-reveal-goto",sig:" String, [String], [Changer]",returnType:"Changer",aka:[],abstract:"This is a convenient combination of the (link-reveal:) and (go-to:) macros, designed to let you run commands like (set:) just before going to another passage. The first string is the link text, and the second is the passage name. An optional changer, with which to style the link, can also be provided.  ",anchor:"macro_link-reveal-goto",category:"links",categoryOrder:"6"},storylet:{name:"storylet",sig:" Lambda",returnType:"Metadata",aka:[],abstract:"When placed in a passage, it marks that passage as the beginning of a storylet, using the lambda as the condition upon which it's available to the player, so that other macros, like (open-storylets:), can see and select the passage.  ",anchor:"macro_storylet",category:"storylet",categoryOrder:"1"},urgency:{name:"urgency",sig:" Number",returnType:"Metadata",aka:[],abstract:'When placed in a passage that also has a (storylet:) call, it marks that passage as being more or less "urgent", meaning that (open-storylets:) will sort it earlier or later than other passages.  ',anchor:"macro_urgency",category:"storylet",categoryOrder:"4"},exclusivity:{name:"exclusivity",sig:" Number",returnType:"Metadata",aka:[],abstract:'When placed in a passage that also has a (storylet:) call, it marks that passage as being more or less "exclusive", meaning that if it\'s open, it will prevent storylets with lesser exclusivity from appearing in (open-storylets:).  ',anchor:"macro_exclusivity",category:"storylet",categoryOrder:"3"},metadata:{name:"metadata",sig:" [...Any]",returnType:"Metadata",aka:[],abstract:"When placed in a passage, this adds the given names and values to the (passage:) datamap for this passage.  ",anchor:"macro_metadata",category:"game state"},define:{name:"define",sig:" ...VariableToValue",returnType:"Metadata",aka:[],abstract:'Stores data in a variable permanently, and make it available from the very start of the story, regardless of which passage this macro call appears in. It "defines" the variable to always mean that given data.  ',anchor:"macro_define",category:"basics",categoryOrder:"3"},p:{name:"p",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern"],abstract:"Creates a string pattern, a special kind of datatype that can match complex string structures. The pattern matches the entire sequence of strings or datatypes given, in order.  ",anchor:"macro_p",category:"patterns",categoryOrder:"1"},pattern:{name:"p",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern"],abstract:"Creates a string pattern, a special kind of datatype that can match complex string structures. The pattern matches the entire sequence of strings or datatypes given, in order.  ",anchor:"macro_p",category:"patterns",categoryOrder:"1"},peither:{name:"p-either",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-either"],abstract:"Creates a string pattern that matches either of the single strings or datatypes given.  ",anchor:"macro_p-either",category:"patterns",categoryOrder:"2"},patterneither:{name:"p-either",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-either"],abstract:"Creates a string pattern that matches either of the single strings or datatypes given.  ",anchor:"macro_p-either",category:"patterns",categoryOrder:"2"},popt:{name:"p-opt",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-opt","p-optional","pattern-optional"],abstract:"Creates a string pattern that either matches the sequence of strings or datatypes given, or matches the empty string.  ",anchor:"macro_p-opt",category:"patterns",categoryOrder:"3"},patternopt:{name:"p-opt",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-opt","p-optional","pattern-optional"],abstract:"Creates a string pattern that either matches the sequence of strings or datatypes given, or matches the empty string.  ",anchor:"macro_p-opt",category:"patterns",categoryOrder:"3"},poptional:{name:"p-opt",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-opt","p-optional","pattern-optional"],abstract:"Creates a string pattern that either matches the sequence of strings or datatypes given, or matches the empty string.  ",anchor:"macro_p-opt",category:"patterns",categoryOrder:"3"},patternoptional:{name:"p-opt",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-opt","p-optional","pattern-optional"],abstract:"Creates a string pattern that either matches the sequence of strings or datatypes given, or matches the empty string.  ",anchor:"macro_p-opt",category:"patterns",categoryOrder:"3"},pnot:{name:"p-not",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-not"],abstract:"Given any number of single characters or non-spread datatypes, this creates a string pattern that matches any one character that doesn't match any of those values.  ",anchor:"macro_p-not",category:"patterns",categoryOrder:"6"},patternnot:{name:"p-not",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-not"],abstract:"Given any number of single characters or non-spread datatypes, this creates a string pattern that matches any one character that doesn't match any of those values.  ",anchor:"macro_p-not",category:"patterns",categoryOrder:"6"},pnotbefore:{name:"p-not-before",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-not-before"],abstract:'Creates a string pattern that matches the empty string, *unless* it is followed by the given sequence of strings or datatypes. This is best used inside another pattern macro like (p:), alongside a pattern to match, where it serves as an extra restriction on that pattern (making it match only if it\'s "not before" something).  ',anchor:"macro_p-not-before",category:"patterns",categoryOrder:"8"},patternnotbefore:{name:"p-not-before",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-not-before"],abstract:'Creates a string pattern that matches the empty string, *unless* it is followed by the given sequence of strings or datatypes. This is best used inside another pattern macro like (p:), alongside a pattern to match, where it serves as an extra restriction on that pattern (making it match only if it\'s "not before" something).  ',anchor:"macro_p-not-before",category:"patterns",categoryOrder:"8"},pbefore:{name:"p-before",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-before"],abstract:'Creates a string pattern that matches the empty string, *only* it is followed by the given sequence of strings or datatypes. This is best used inside another pattern macro like (p:), alongside a pattern to match, where it serves as an extra restriction on that pattern (making it match only if it\'s "not before" something).  ',anchor:"macro_p-before",category:"patterns",categoryOrder:"7"},patternbefore:{name:"p-before",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-before"],abstract:'Creates a string pattern that matches the empty string, *only* it is followed by the given sequence of strings or datatypes. This is best used inside another pattern macro like (p:), alongside a pattern to match, where it serves as an extra restriction on that pattern (making it match only if it\'s "not before" something).  ',anchor:"macro_p-before",category:"patterns",categoryOrder:"7"},pstart:{name:"p-start",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-start"],abstract:"Identical to (p:), except that when used with macros that search for substrings in strings, like (str-find:), (str-replaced:) and (trimmed:), this only matches if the given strings or datatypes appear at the very start of the string.  ",anchor:"macro_p-start",category:"patterns",categoryOrder:"9"},patternstart:{name:"p-end",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-start"],abstract:"Identical to (p:), except that when used with macros that search for substrings in strings, like (str-find:), (str-replaced:) and (trimmed:), this only matches if the given strings or datatypes appear at the very end of the string.  ",anchor:"macro_p-end",category:"patterns",categoryOrder:"10"},pend:{name:"p-end",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-start"],abstract:"Identical to (p:), except that when used with macros that search for substrings in strings, like (str-find:), (str-replaced:) and (trimmed:), this only matches if the given strings or datatypes appear at the very end of the string.  ",anchor:"macro_p-end",category:"patterns",categoryOrder:"10"},pmany:{name:"p-many",sig:" [Number], [Number], ...String or Datatype",returnType:"Datatype",aka:["pattern-many"],abstract:"Creates a string pattern that matches the given sequence of strings and datatypes, repeated a given minimum and maximum number of times - or, if these aren't provided, repeated any number of times.  ",anchor:"macro_p-many",category:"patterns",categoryOrder:"4"},patternmany:{name:"p-many",sig:" [Number], [Number], ...String or Datatype",returnType:"Datatype",aka:["pattern-many"],abstract:"Creates a string pattern that matches the given sequence of strings and datatypes, repeated a given minimum and maximum number of times - or, if these aren't provided, repeated any number of times.  ",anchor:"macro_p-many",category:"patterns",categoryOrder:"4"},pins:{name:"p-ins",sig:" ...String or Datatype",returnType:"Datatype",aka:["p-insensitive","pattern-ins","pattern-insensitive"],abstract:"Creates a string pattern that matches the sequence of strings or datatypes given, case-insensitively.  ",anchor:"macro_p-ins",category:"patterns",categoryOrder:"10"},pinsensitive:{name:"p-ins",sig:" ...String or Datatype",returnType:"Datatype",aka:["p-insensitive","pattern-ins","pattern-insensitive"],abstract:"Creates a string pattern that matches the sequence of strings or datatypes given, case-insensitively.  ",anchor:"macro_p-ins",category:"patterns",categoryOrder:"10"},patternins:{name:"p-ins",sig:" ...String or Datatype",returnType:"Datatype",aka:["p-insensitive","pattern-ins","pattern-insensitive"],abstract:"Creates a string pattern that matches the sequence of strings or datatypes given, case-insensitively.  ",anchor:"macro_p-ins",category:"patterns",categoryOrder:"10"},patterninsensitive:{name:"p-ins",sig:" ...String or Datatype",returnType:"Datatype",aka:["p-insensitive","pattern-ins","pattern-insensitive"],abstract:"Creates a string pattern that matches the sequence of strings or datatypes given, case-insensitively.  ",anchor:"macro_p-ins",category:"patterns",categoryOrder:"10"},split:{name:"split",sig:" String or Datatype, String",returnType:"Array",aka:["splitted"],abstract:"This splits up the second value given to it into an array of substrings, after finding and removing each occurrence of the first string or pattern (which is used as a separator value).  ",anchor:"macro_split",category:"string"},splitted:{name:"split",sig:" String or Datatype, String",returnType:"Array",aka:["splitted"],abstract:"This splits up the second value given to it into an array of substrings, after finding and removing each occurrence of the first string or pattern (which is used as a separator value).  ",anchor:"macro_split",category:"string"},trimmed:{name:"trimmed",sig:" [String or Datatype], String",returnType:"String",aka:[],abstract:"This macro takes one string (the last value), and produces a copy with every character matching the given pattern (the first value) removed from the start and end of it. If no pattern is given, it defaults to removing whitespace, as if `whitespace` was the first argument.  ",anchor:"macro_trimmed",category:"string"},strfind:{name:"str-find",sig:" Datatype, String",returnType:"Array",aka:["string-find"],abstract:'Also known as: (string-find:)  When given a string pattern and a string, this produces an array of each substring within the string that the pattern matched. If typed variables were in the pattern, this instead produces an array of datamaps, each of which has data names matching the variables, and data values matching the portions of the string matched by those typed variables, as well as a "match" data name for the full substring.  ',anchor:"macro_str-find",category:"string"},stringfind:{name:"str-find",sig:" Datatype, String",returnType:"Array",aka:["string-find"],abstract:'Also known as: (string-find:)  When given a string pattern and a string, this produces an array of each substring within the string that the pattern matched. If typed variables were in the pattern, this instead produces an array of datamaps, each of which has data names matching the variables, and data values matching the portions of the string matched by those typed variables, as well as a "match" data name for the full substring.  ',anchor:"macro_str-find",category:"string"},strreplaced:{name:"str-replaced",sig:" [Number], String or Datatype, String or Lambda, String",returnType:"String",aka:["string-replaced","replaced"],abstract:'Also known as: (string-replaced:), (replaced:)  This macro produces a copy of the content string (the last string given), with all instances of a certain search string (or pattern) replaced using a given string (or a "via" lambda that constructs a replacement string). Giving an optional number N lets you only replace the first N instances. If a pattern is given, TypedVars may be used inside it, and they will be accessible in the "via" lambda.  ',anchor:"macro_str-replaced",category:"string"},stringreplaced:{name:"str-replaced",sig:" [Number], String or Datatype, String or Lambda, String",returnType:"String",aka:["string-replaced","replaced"],abstract:'Also known as: (string-replaced:), (replaced:)  This macro produces a copy of the content string (the last string given), with all instances of a certain search string (or pattern) replaced using a given string (or a "via" lambda that constructs a replacement string). Giving an optional number N lets you only replace the first N instances. If a pattern is given, TypedVars may be used inside it, and they will be accessible in the "via" lambda.  ',anchor:"macro_str-replaced",category:"string"},replaced:{name:"str-replaced",sig:" [Number], String or Datatype, String or Lambda, String",returnType:"String",aka:["string-replaced","replaced"],abstract:'Also known as: (string-replaced:), (replaced:)  This macro produces a copy of the content string (the last string given), with all instances of a certain search string (or pattern) replaced using a given string (or a "via" lambda that constructs a replacement string). Giving an optional number N lets you only replace the first N instances. If a pattern is given, TypedVars may be used inside it, and they will be accessible in the "via" lambda.  ',anchor:"macro_str-replaced",category:"string"},if:{name:"if",sig:" Boolean",returnType:"Changer",aka:[],abstract:'This macro accepts only booleans (variables with `true` or `false`, or expressions using `is`, `contains`, or another such operator), and produces a changer that can be attached to hooks to hide them "if" the value was false.  ',anchor:"macro_if",category:"basics",categoryOrder:"6"},unless:{name:"unless",sig:" Boolean",returnType:"Changer",aka:[],abstract:'This macro is the negated form of (if:): it accepts only booleans, and returns a changer that can be attached hooks to hide them "if" the value was true.  For more information, see the documentation of (if:).  ',anchor:"macro_unless",category:"basics",categoryOrder:"7"},elseif:{name:"else-if",sig:" Boolean",returnType:"Changer",aka:[],abstract:"This macro's result changes depending on whether the previous hook in the passage was shown or hidden. If the previous hook was shown, then this changer hides the attached hook. Otherwise, it acts like (if:), showing the attached hook if it's true, and hiding it if it's false. If there was no preceding hook before this, then an error message will be printed.  ",anchor:"macro_else-if",category:"basics",categoryOrder:"8"},else:{name:"else",sig:"",returnType:"Changer",aka:[],abstract:"This is a convenient limited variant of the (else-if:) macro. It will simply show the attached hook if the preceding hook was hidden, and hide it otherwise. If there was no preceding hook before this, then an error message will be printed.  ",anchor:"macro_else",category:"basics",categoryOrder:"9"},hidden:{name:"hidden",sig:"",returnType:"Changer",aka:[],abstract:"Produces a changer that can be attached to hooks to hide them.  ",anchor:"macro_hidden",category:"showing and hiding"},verbatim:{name:"verbatim",sig:"",returnType:"Changer",aka:["v6m"],abstract:"When attached to a hook or command, the markup inside that would normally be rendered into HTML is instead presented as plain text, as if the verbatim markup was used on it.  ",anchor:"macro_verbatim",category:"basics",categoryOrder:"15"},v6m:{name:"verbatim",sig:"",returnType:"Changer",aka:["v6m"],abstract:"When attached to a hook or command, the markup inside that would normally be rendered into HTML is instead presented as plain text, as if the verbatim markup was used on it.  ",anchor:"macro_verbatim",category:"basics",categoryOrder:"15"},live:{name:"live",sig:" [Number]",returnType:"Changer",aka:[],abstract:'When you attach this changer to a hook, the hook becomes "live", which means that it\'s repeatedly re-run every certain number of milliseconds, replacing the source inside of the hook with a newly computed version.  ',anchor:"macro_live",category:"live",categoryOrder:"1"},event:{name:"event",sig:" Lambda",returnType:"Changer",aka:[],abstract:"Hooks that have this changer attached will only be run when the given condition becomes true.  ",anchor:"macro_event",category:"live",categoryOrder:"3"},more:{name:"more",sig:"",returnType:"Changer",aka:[],abstract:'Hooks that have this changer attached will only be run once no other exits - links and (click:)-enchanted areas - are remaining in the passage, and will reveal "more" prose.  ',anchor:"macro_more",category:"live",categoryOrder:"5"},after:{name:"after",sig:" Number, [Number]",returnType:"Changer",aka:[],abstract:"Hooks that have this changer attached will only be run once the given amount of time has passed since the passage was rendered. An optional second number specifies that the player can speed up the delay by holding down a keyboard key or mouse button, or by touching the touch device.  ",anchor:"macro_after",category:"live",categoryOrder:"4"},aftererror:{name:"after-error",sig:"",returnType:"Changer",aka:[],abstract:"A bug-specific event macro, this hides the hook and only causes it to run once an error occurs.  ",anchor:"macro_after-error",category:"live",categoryOrder:"5"},hook:{name:"hook",sig:" String",returnType:"Changer",aka:[],abstract:"A changer that allows the author to give a hook a computed tag name.  ",anchor:"macro_hook",category:"styling"},for:{name:"for",sig:" Lambda, [...Any]",returnType:"Changer",aka:["loop"],abstract:"When attached to a hook, this repeats the attached hook, setting a temporary variable to a different value on each repeat.  ",anchor:"macro_for",category:"basics",categoryOrder:"10"},loop:{name:"for",sig:" Lambda, [...Any]",returnType:"Changer",aka:["loop"],abstract:"When attached to a hook, this repeats the attached hook, setting a temporary variable to a different value on each repeat.  ",anchor:"macro_for",category:"basics",categoryOrder:"10"},transition:{name:"transition",sig:" String",returnType:"Changer",aka:["t8n"],abstract:'A changer that applies a built-in CSS transition to a hook as it appears. Give this macro one of these strings (capitalisation and hyphens ignored): `"instant"`, `"dissolve"`, `"fade"`, `"rumble"`, `"shudder"`, `"pulse"`, `"zoom"`, `"flicker"`, `"slide-left"`, `"slide-right"`, `"slide-up"`, `"slide-down"`, `"fade-left"`, `"fade-right"`, `"fade-up"` and `"fade-down"`.  ',anchor:"macro_transition",category:"transitions",categoryOrder:"1"},t8n:{name:"transition",sig:" String",returnType:"Changer",aka:["t8n"],abstract:'A changer that applies a built-in CSS transition to a hook as it appears. Give this macro one of these strings (capitalisation and hyphens ignored): `"instant"`, `"dissolve"`, `"fade"`, `"rumble"`, `"shudder"`, `"pulse"`, `"zoom"`, `"flicker"`, `"slide-left"`, `"slide-right"`, `"slide-up"`, `"slide-down"`, `"fade-left"`, `"fade-right"`, `"fade-up"` and `"fade-down"`.  ',anchor:"macro_transition",category:"transitions",categoryOrder:"1"},transitiontime:{name:"transition-time",sig:" Number",returnType:"Changer",aka:["t8n-time"],abstract:"A changer that, when added to a (transition:) changer, adjusts the time of the transition.  ",anchor:"macro_transition-time",category:"transitions",categoryOrder:"2"},t8ntime:{name:"transition-time",sig:" Number",returnType:"Changer",aka:["t8n-time"],abstract:"A changer that, when added to a (transition:) changer, adjusts the time of the transition.  ",anchor:"macro_transition-time",category:"transitions",categoryOrder:"2"},transitiondelay:{name:"transition-delay",sig:" Number",returnType:"Changer",aka:["t8n-delay"],abstract:"A changer that, when added to a (transition:) changer, delays the start of the transition by a given time.  ",anchor:"macro_transition-delay",category:"transitions",categoryOrder:"2"},t8ndelay:{name:"transition-delay",sig:" Number",returnType:"Changer",aka:["t8n-delay"],abstract:"A changer that, when added to a (transition:) changer, delays the start of the transition by a given time.  ",anchor:"macro_transition-delay",category:"transitions",categoryOrder:"2"},transitionskip:{name:"transition-skip",sig:" Number",returnType:"Changer",aka:["t8n-skip"],abstract:"A changer that, when added to a (transition:) changer, allows the player to skip or accelerate the transition by holding down a keyboard key or mouse button, or by touching the touch device.  ",anchor:"macro_transition-skip",category:"transitions",categoryOrder:"6"},t8nskip:{name:"transition-skip",sig:" Number",returnType:"Changer",aka:["t8n-skip"],abstract:"A changer that, when added to a (transition:) changer, allows the player to skip or accelerate the transition by holding down a keyboard key or mouse button, or by touching the touch device.  ",anchor:"macro_transition-skip",category:"transitions",categoryOrder:"6"},transitiondepart:{name:"transition-depart",sig:" String",returnType:"Changer",aka:["t8n-depart"],abstract:"A changer that alters passage links, (link-goto:)s, and most every other kind of link, changing which passage fade-out animation the link uses.  ",anchor:"macro_transition-depart",category:"transitions",categoryOrder:"4"},t8ndepart:{name:"transition-depart",sig:" String",returnType:"Changer",aka:["t8n-depart"],abstract:"A changer that alters passage links, (link-goto:)s, and most every other kind of link, changing which passage fade-out animation the link uses.  ",anchor:"macro_transition-depart",category:"transitions",categoryOrder:"4"},transitionarrive:{name:"transition-arrive",sig:" String",returnType:"Changer",aka:["t8n-arrive"],abstract:"A changer that alters passage links, (link-goto:)s, and most every other kind of link, changing which passage fade-in animation the link uses.  ",anchor:"macro_transition-arrive",category:"transitions",categoryOrder:"5"},t8narrive:{name:"transition-arrive",sig:" String",returnType:"Changer",aka:["t8n-arrive"],abstract:"A changer that alters passage links, (link-goto:)s, and most every other kind of link, changing which passage fade-in animation the link uses.  ",anchor:"macro_transition-arrive",category:"transitions",categoryOrder:"5"},button:{name:"button",sig:" [String]",returnType:"Changer",aka:[],abstract:"When applied to a link, this changer styles it so that it resembles a button, and makes it take up the entire passage width. The optional sizing string lets you specify width and horizontal margins for the button. It is not recommended that this be used on non-link hooks.  ",anchor:"macro_button",category:"styling"},action:{name:"action",sig:" String",returnType:"Changer",aka:[],abstract:"When attached to a link command, or given to a link changer macro as the second value, this changer turns the link into a different kind of interaction element with a different appearance - one that is either activated by hovering the mouse pointer over it, hoving the mouse pointer off of it, or double-clicking it. This does nothing when attached or supplied to a non-link hook.  ",anchor:"macro_action",category:"links",categoryOrder:"99"},border:{name:"border",sig:" String, [String], [String], [String]",returnType:"Changer",aka:["b4r"],abstract:"A changer macro that applies a CSS border to the hook.  ",anchor:"macro_border",category:"borders",categoryOrder:"1"},b4r:{name:"border",sig:" String, [String], [String], [String]",returnType:"Changer",aka:["b4r"],abstract:"A changer macro that applies a CSS border to the hook.  ",anchor:"macro_border",category:"borders",categoryOrder:"1"},bordersize:{name:"border-size",sig:" Measurement, [Measurement], [Measurement], [Measurement]",returnType:"Changer",aka:["b4r-size"],abstract:"When applied to a hook being changed by the (border:) changer, this multiplies the size of the border by the given size measurement. This can accept any measurement unit except `w`, `h`, and `lh`.  ",anchor:"macro_border-size",category:"borders",categoryOrder:"3"},b4rsize:{name:"border-size",sig:" Measurement, [Measurement], [Measurement], [Measurement]",returnType:"Changer",aka:["b4r-size"],abstract:"When applied to a hook being changed by the (border:) changer, this multiplies the size of the border by the given size measurement. This can accept any measurement unit except `w`, `h`, and `lh`.  ",anchor:"macro_border-size",category:"borders",categoryOrder:"3"},cornerradius:{name:"corner-radius",sig:" Measurement, [Measurement], [Measurement], [Measurement]",returnType:"Changer",aka:[],abstract:"When applied to a hook, this rounds the corners by the given measurements, causing the hook to become increasingly round or button-like.  ",anchor:"macro_corner-radius",category:"borders",categoryOrder:"4"},bordercolour:{name:"border-colour",sig:" String or Colour, [String or Colour], [String or Colour], [String or Colour]",returnType:"Changer",aka:["b4r-colour","border-color","b4r-color"],abstract:"When applied to a hook being changed by the (border:) changer, this changes the border's colour.  ",anchor:"macro_border-colour",category:"borders",categoryOrder:"2"},b4rcolour:{name:"border-colour",sig:" String or Colour, [String or Colour], [String or Colour], [String or Colour]",returnType:"Changer",aka:["b4r-colour","border-color","b4r-color"],abstract:"When applied to a hook being changed by the (border:) changer, this changes the border's colour.  ",anchor:"macro_border-colour",category:"borders",categoryOrder:"2"},bordercolor:{name:"border-colour",sig:" String or Colour, [String or Colour], [String or Colour], [String or Colour]",returnType:"Changer",aka:["b4r-colour","border-color","b4r-color"],abstract:"When applied to a hook being changed by the (border:) changer, this changes the border's colour.  ",anchor:"macro_border-colour",category:"borders",categoryOrder:"2"},b4rcolor:{name:"border-colour",sig:" String or Colour, [String or Colour], [String or Colour], [String or Colour]",returnType:"Changer",aka:["b4r-colour","border-color","b4r-color"],abstract:"When applied to a hook being changed by the (border:) changer, this changes the border's colour.  ",anchor:"macro_border-colour",category:"borders",categoryOrder:"2"},opacity:{name:"opacity",sig:" Number",returnType:"Changer",aka:[],abstract:"This styling changer changes how opaque the attached hook is, using a value from 0 to 1. Reducing the value makes it more transparent. An opacity of 0 makes the hook invisible.  ",anchor:"macro_opacity",category:"styling"},font:{name:"font",sig:" String",returnType:"Changer",aka:[],abstract:'This styling changer changes the font used to display the text of the attached hook. Provide the font\'s family name (such as "Helvetica Neue" or "Courier") as a string.  ',anchor:"macro_font",category:"styling"},align:{name:"align",sig:" String",returnType:"Changer",aka:[],abstract:"This styling changer changes the alignment of text in the attached hook, as if the `===>`~ arrow syntax was used. In fact, these same arrows (`==>`~, `=><=`~, `<==>`~, `====><=`~ etc.) should be supplied as a string to specify the degree of alignment.  ",anchor:"macro_align",category:"styling"},textcolour:{name:"text-colour",sig:" String or Colour",returnType:"Changer",aka:["colour","text-color","color"],abstract:"This styling changer changes the colour used by the text in the attached hook. You can supply either a string with a CSS-style colour (a colour name or RGB number supported by CSS), or a built-in colour object.  ",anchor:"macro_text-colour",category:"styling"},colour:{name:"text-colour",sig:" String or Colour",returnType:"Changer",aka:["colour","text-color","color"],abstract:"This styling changer changes the colour used by the text in the attached hook. You can supply either a string with a CSS-style colour (a colour name or RGB number supported by CSS), or a built-in colour object.  ",anchor:"macro_text-colour",category:"styling"},textcolor:{name:"text-colour",sig:" String or Colour",returnType:"Changer",aka:["colour","text-color","color"],abstract:"This styling changer changes the colour used by the text in the attached hook. You can supply either a string with a CSS-style colour (a colour name or RGB number supported by CSS), or a built-in colour object.  ",anchor:"macro_text-colour",category:"styling"},color:{name:"text-colour",sig:" String or Colour",returnType:"Changer",aka:["colour","text-color","color"],abstract:"This styling changer changes the colour used by the text in the attached hook. You can supply either a string with a CSS-style colour (a colour name or RGB number supported by CSS), or a built-in colour object.  ",anchor:"macro_text-colour",category:"styling"},textsize:{name:"text-size",sig:" Measurement, [Measurement]",returnType:"Changer",aka:["size"],abstract:"When given a positive measurement (such as `20px`), this changes the text size of the attached hook. The optional second value determines the line height of the text (the distance between each line). If none is given, then this defaults to the first measurement multiplied by 1.5.  ",anchor:"macro_text-size",category:"styling"},size:{name:"text-size",sig:" Measurement, [Measurement]",returnType:"Changer",aka:["size"],abstract:"When given a positive measurement (such as `20px`), this changes the text size of the attached hook. The optional second value determines the line height of the text (the distance between each line). If none is given, then this defaults to the first measurement multiplied by 1.5.  ",anchor:"macro_text-size",category:"styling"},textindent:{name:"text-indent",sig:" Measurement",returnType:"Changer",aka:[],abstract:"This styling changer causes the attached hook to be indented by the given measurement.  ",anchor:"macro_text-indent",category:"styling"},textrotatez:{name:"text-rotate-z",sig:" Number",returnType:"Changer",aka:["text-rotate"],abstract:"This styling changer visually rotates the attached hook clockwise by a given number of degrees. The rotational axis is in the centre of the hook.  ",anchor:"macro_text-rotate-z",category:"styling"},textrotate:{name:"text-rotate-z",sig:" Number",returnType:"Changer",aka:["text-rotate"],abstract:"This styling changer visually rotates the attached hook clockwise by a given number of degrees. The rotational axis is in the centre of the hook.  ",anchor:"macro_text-rotate-z",category:"styling"},textrotatey:{name:"text-rotate-y",sig:" Number",returnType:"Changer",aka:[],abstract:"This styling changer visually rotates the attached hook clockwise, around the Y axis (vertical), by a given number of degrees, making it appear to lean into the page. The rotational axis is in the centre of the hook.  ",anchor:"macro_text-rotate-y",category:"styling"},textrotatex:{name:"text-rotate-x",sig:" Number",returnType:"Changer",aka:[],abstract:"This styling changer visually rotates the attached hook clockwise, around the X axis (horizontal), by a given number of degrees, making it appear to lean into the page. The rotational axis is in the centre of the hook.  ",anchor:"macro_text-rotate-x",category:"styling"},bg:{name:"bg",sig:" Colour or String or Gradient or Image",returnType:"Changer",aka:["background"],abstract:'This styling changer alters the background colour or background image of the attached hook. Supplying a gradient (produced by (gradient:)) will set the background to that gradient. Supplying a colour (produced by (rgb:), (hsl:), (lch:) or another such macro), a built-in colour value like `red`, or a bare colour value like #FA9138) will set the background to a flat colour. CSS strings that resemble HTML hex colours (like "#FA9138") will also provide flat colour. Other strings will be interpreted as an image URL, and the background will be set to it.  ',anchor:"macro_bg",category:"styling"},background:{name:"bg",sig:" Colour or String or Gradient or Image",returnType:"Changer",aka:["background"],abstract:'This styling changer alters the background colour or background image of the attached hook. Supplying a gradient (produced by (gradient:)) will set the background to that gradient. Supplying a colour (produced by (rgb:), (hsl:), (lch:) or another such macro), a built-in colour value like `red`, or a bare colour value like #FA9138) will set the background to a flat colour. CSS strings that resemble HTML hex colours (like "#FA9138") will also provide flat colour. Other strings will be interpreted as an image URL, and the background will be set to it.  ',anchor:"macro_bg",category:"styling"},textstyle:{name:"text-style",sig:" ...String",returnType:"Changer",aka:[],abstract:'This applies one or more selected built-in text styles to the hook\'s text. Give this macro one of these strings (capitalisation and hyphens ignored): `"none"`, `"bold"`, `"italic"`, `"underline"`, `"double-underline"`, `"wavy-underline"`, `"strike"`, `"double-strike"`, `"wavy-strike"`, `"superscript"`, `"subscript"`, `"blink"`, `"shudder"`, `"mark"`, `"condense"`, `"expand"`, `"outline"`, `"shadow"`, `"emboss"`, `"smear"`, `"blur"`, `"blurrier"`, `"mirror"`, `"upside-down"`, `"tall"`, `"flat"`, `"fade-in-out"`, `"rumble"`, `"sway"`, `"buoy"` or `"fidget"`.  ',anchor:"macro_text-style",category:"styling"},scrollbar:{name:"scrollbar",sig:" String",returnType:"Changer",aka:["scrollbar-y"],abstract:'When attached to a hook that can scroll, such as one with (box:) also attached, this changes whether the vertical scroll bar is present on the hook, allowing the player to scroll it freely. This accepts the strings "auto" (the default), "on", "off" and "never".  ',anchor:"macro_scrollbar",category:"window"},scrollbary:{name:"scrollbar",sig:" String",returnType:"Changer",aka:["scrollbar-y"],abstract:'When attached to a hook that can scroll, such as one with (box:) also attached, this changes whether the vertical scroll bar is present on the hook, allowing the player to scroll it freely. This accepts the strings "auto" (the default), "on", "off" and "never".  ',anchor:"macro_scrollbar",category:"window"},scrollbarx:{name:"scrollbar-x",sig:" String",returnType:"Changer",aka:[],abstract:"",anchor:"macro_scrollbar-x",category:"window"},collapse:{name:"collapse",sig:"",returnType:"Changer",aka:[],abstract:"When attached to a hook, this collapses the whitespace within the hook, in the same manner as the collapsing whitespace markup.  ",anchor:"macro_collapse",category:"styling"},hoverstyle:{name:"hover-style",sig:" Changer",returnType:"Changer",aka:[],abstract:"Given a style-altering changer, it makes a changer which only applies when the hook or command is hovered over with the mouse pointer, and is removed when hovering off.  ",anchor:"macro_hover-style",category:"styling"},css:{name:"css",sig:" String",returnType:"Changer",aka:[],abstract:'This takes a string of inline CSS, and applies it to the hook, as if it were a HTML "style" property.  ',anchor:"macro_css",category:"styling"},testtrue:{name:"test-true",sig:" [...Any]",returnType:"Changer",aka:[],abstract:"If you want to test your passage, while ignoring a specific changer macro in it, temporarily change that changer macro's name to (test-true:), and it will ignore all of the data given to it, while enabling the hook.  ",anchor:"macro_test-true",category:"debugging",categoryOrder:"2"},testfalse:{name:"test-false",sig:" [...Any]",returnType:"Changer",aka:[],abstract:"If you want to test your passage in order to see what would happen if an (if:), (unless:) or (else-if:) macro would hide the hook it's attached to, you can temporarily change the name of the macro to (test-false:), which causes it to ignore the data given to it and act as if it was given `false`.  ",anchor:"macro_test-false",category:"debugging",categoryOrder:"3"},animate:{name:"animate",sig:" HookName, String, [Number]",returnType:"Command",aka:[],abstract:"A command that causes a hook to briefly animate, as if a (transition:) was applied to it. The length of time that the animation plays can be optionally altered by providing a number.  ",anchor:"macro_animate",category:"transitions"},box:{name:"box",sig:" String, [Measurement]",returnType:"Changer",aka:[],abstract:'When attached to a hook, it becomes a "box", with a given width proportional to the containing element\'s width, an optional number of lines tall, and a scroll bar if its contained text is longer than its height can contain.  ',anchor:"macro_box",category:"styling"},floatbox:{name:"float-box",sig:" String, String",returnType:"Changer",aka:[],abstract:'When attached to a hook, it becomes a "floating box", placed at a given portion of the window, sized proportionally to the window\'s dimensions, and with a scroll bar if its contained text is longer than its height can contain.  ',anchor:"macro_float-box",category:"styling"},str:{name:"str",sig:" ...[Number or String or Boolean or Array]",returnType:"String",aka:["string","text"],abstract:"(str:) accepts any amount of values and tries to convert them all to a single String.  ",anchor:"macro_str",category:"string",categoryOrder:"1"},string:{name:"str",sig:" ...[Number or String or Boolean or Array]",returnType:"String",aka:["string","text"],abstract:"(str:) accepts any amount of values and tries to convert them all to a single String.  ",anchor:"macro_str",category:"string",categoryOrder:"1"},text:{name:"str",sig:" ...[Number or String or Boolean or Array]",returnType:"String",aka:["string","text"],abstract:"(str:) accepts any amount of values and tries to convert them all to a single String.  ",anchor:"macro_str",category:"string",categoryOrder:"1"},source:{name:"source",sig:" Any",returnType:"String",aka:[],abstract:"When given almost any data value, this will produce a string representation of Harlowe source code that can, when run, create that value exactly.  ",anchor:"macro_source",category:"string"},substring:{name:"substring",sig:" String, Number, Number",returnType:"String",aka:[],abstract:"This macro produces a substring of the given string, cut from two inclusive number positions.  ",anchor:"macro_substring",category:"string"},lowercase:{name:"lowercase",sig:" String",returnType:"String",aka:[],abstract:"This macro produces a lowercase version of the given string.  ",anchor:"macro_lowercase",category:"string"},uppercase:{name:"uppercase",sig:" String",returnType:"String",aka:[],abstract:"This macro produces an uppercase version of the given string.  ",anchor:"macro_uppercase",category:"string"},lowerfirst:{name:"lowerfirst",sig:" String",returnType:"String",aka:[],abstract:"This macro produces a version of the given string, where the first alphanumeric character is lowercase, and other characters are left as-is.  ",anchor:"macro_lowerfirst",category:"string"},upperfirst:{name:"upperfirst",sig:" String",returnType:"String",aka:[],abstract:"This macro produces a version of the given string, where the first alphanumeric character is uppercase, and other characters are left as-is.  ",anchor:"macro_upperfirst",category:"string"},words:{name:"words",sig:" String",returnType:"Array",aka:[],abstract:'This macro takes a string and creates an array of each word ("word" meaning a sequence of non-whitespace characters) in the string.  ',anchor:"macro_words",category:"string"},strrepeated:{name:"str-repeated",sig:" Number, String",returnType:"String",aka:["string-repeated"],abstract:"A special shorthand combination of the (str:) and (repeated:) macros, this accepts a single string and duplicates it the given number of times.  ",anchor:"macro_str-repeated",category:"string"},stringrepeated:{name:"str-repeated",sig:" Number, String",returnType:"String",aka:["string-repeated"],abstract:"A special shorthand combination of the (str:) and (repeated:) macros, this accepts a single string and duplicates it the given number of times.  ",anchor:"macro_str-repeated",category:"string"},strreversed:{name:"str-reversed",sig:" String",returnType:"String",aka:["string-reversed"],abstract:"A special shorthand combination of the (str:) and (reversed:) macros, this accepts a single string and reverses it.  ",anchor:"macro_str-reversed",category:"string"},stringreversed:{name:"str-reversed",sig:" String",returnType:"String",aka:["string-reversed"],abstract:"A special shorthand combination of the (str:) and (reversed:) macros, this accepts a single string and reverses it.  ",anchor:"macro_str-reversed",category:"string"},joined:{name:"joined",sig:" ...String",returnType:"String",aka:[],abstract:"Using the first string as a separator value, this macro takes all of the other strings given to it, and joins them into a single string.  ",anchor:"macro_joined",category:"string"},plural:{name:"plural",sig:" Number, String, [String]",returnType:"String",aka:[],abstract:'This macro takes a whole number and a string, then converts the number to a string, joins them up with a space character, and pluralises the string if the number wasn\'t 1 or -1. By default, this pluralisation is done by adding "s", as in some English plurals. An optional extra string can specify a different plural word to use instead.  ',anchor:"macro_plural",category:"string"},strnth:{name:"str-nth",sig:" Number",returnType:"String",aka:["string-nth"],abstract:'This macro takes a whole number, and converts it to a string comprising an English ordinal abbreviation (of the form "nth", such as "1st", "22nd", etc.).  ',anchor:"macro_str-nth",category:"string"},stringnth:{name:"str-nth",sig:" Number",returnType:"String",aka:["string-nth"],abstract:'This macro takes a whole number, and converts it to a string comprising an English ordinal abbreviation (of the form "nth", such as "1st", "22nd", etc.).  ',anchor:"macro_str-nth",category:"string"},digitformat:{name:"digit-format",sig:" String, Number",returnType:"String",aka:[],abstract:"",anchor:"macro_digit-format",category:"string"},num:{name:"num",sig:" String",returnType:"Number",aka:["number"],abstract:"This macro converts strings to numbers by reading the digits in the entire string. It can handle decimal fractions and negative numbers. If any letters or other unusual characters appear in the number, it will result in an error.  ",anchor:"macro_num",category:"number"},number:{name:"num",sig:" String",returnType:"Number",aka:["number"],abstract:"This macro converts strings to numbers by reading the digits in the entire string. It can handle decimal fractions and negative numbers. If any letters or other unusual characters appear in the number, it will result in an error.  ",anchor:"macro_num",category:"number"},datatype:{name:"datatype",sig:" Any",returnType:"Datatype",aka:[],abstract:"This macro takes any storeable value, and produces a datatype that matches it.  ",anchor:"macro_datatype",category:"custom macros",categoryOrder:"5"},datapattern:{name:"datapattern",sig:" Any",returnType:"Any",aka:[],abstract:"This takes any storeable value, and produces a datatype that matches it, in a manner similar to (datatype:). However, when given an array or datamap, it creates an array or datamap with its values replaced with their datatypes, which can be used as a more accurate pattern with `matches` or (set:) elsewhere.  ",anchor:"macro_datapattern",category:"custom macros",categoryOrder:"6"},rgb:{name:"rgb",sig:" Number, Number, Number, [Number]",returnType:"Colour",aka:["rgba"],abstract:"This macro creates a colour using the three red (r), green (g) and blue (b) values provided, whose values are numbers between 0 and 255, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  ",anchor:"macro_rgb",category:"colour",categoryOrder:"2"},rgba:{name:"rgb",sig:" Number, Number, Number, [Number]",returnType:"Colour",aka:["rgba"],abstract:"This macro creates a colour using the three red (r), green (g) and blue (b) values provided, whose values are numbers between 0 and 255, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  ",anchor:"macro_rgb",category:"colour",categoryOrder:"2"},hsl:{name:"hsl",sig:" Number, Number, Number, [Number]",returnType:"Colour",aka:["hsla"],abstract:"This macro creates a colour using the given hue (h) angle in degrees, as well as the given saturation (s) and lightness (l) percentages, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  ",anchor:"macro_hsl",category:"colour",categoryOrder:"1"},hsla:{name:"hsl",sig:" Number, Number, Number, [Number]",returnType:"Colour",aka:["hsla"],abstract:"This macro creates a colour using the given hue (h) angle in degrees, as well as the given saturation (s) and lightness (l) percentages, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  ",anchor:"macro_hsl",category:"colour",categoryOrder:"1"},oklch:{name:"oklch",sig:" Number, Number, Number, [Number]",returnType:"Colour",aka:["oklcha"],abstract:"This macro creates a colour using three values in the OKLCH colour model - a lightness (L) percentage, a chroma (C) value between 0 and 1, and a hue (H) angle in degrees, and, optionally, the transparency (alpha, or A) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  ",anchor:"macro_oklch",category:"colour",categoryOrder:"3"},oklcha:{name:"oklch",sig:" Number, Number, Number, [Number]",returnType:"Colour",aka:["oklcha"],abstract:"This macro creates a colour using three values in the OKLCH colour model - a lightness (L) percentage, a chroma (C) value between 0 and 1, and a hue (H) angle in degrees, and, optionally, the transparency (alpha, or A) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  ",anchor:"macro_oklch",category:"colour",categoryOrder:"3"},lch:{name:"lch",sig:" Number, Number, Number, [Number]",returnType:"Colour",aka:["lcha"],abstract:"This macro creates a colour using three values in the CIELAB colour model - a lightness (L) percentage, a chroma (C) value, and a hue (H) angle in degrees, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Note that the C value is *not* the same as that given to (oklch:)! (oklch:) accepts a C value between 0 and 1, whereas this accepts a C value between 0 and 150.  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  ",anchor:"macro_lch",category:"colour",categoryOrder:"3"},lcha:{name:"lch",sig:" Number, Number, Number, [Number]",returnType:"Colour",aka:["lcha"],abstract:"This macro creates a colour using three values in the CIELAB colour model - a lightness (L) percentage, a chroma (C) value, and a hue (H) angle in degrees, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Note that the C value is *not* the same as that given to (oklch:)! (oklch:) accepts a C value between 0 and 1, whereas this accepts a C value between 0 and 150.  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  ",anchor:"macro_lch",category:"colour",categoryOrder:"3"},complement:{name:"complement",sig:" Colour",returnType:"Colour",aka:[],abstract:"When given a colour, this provides a complement to that colour in the OKLCH colour model.  ",anchor:"macro_complement",category:"colour",categoryOrder:"4"},mix:{name:"mix",sig:" [String], Number, Colour, Number, Colour",returnType:"Colour",aka:[],abstract:'When given two pairs of values - each a number from 0 to 1 and a colour - this macro produces a mix of the two colours, using the numbers as ratios of each colour. The colours are mixed using the given colour model specified by a string (either "oklch", "lch", "hsl" or "rgb"), or the (oklch:) colour model if no string is given.  ',anchor:"macro_mix",category:"colour"},palette:{name:"palette",sig:" String, Colour",returnType:"Array",aka:[],abstract:"When given a string specifying a palette type, and a colour, this macro produces an array containing the given colour followed by three additional colours that together form a palette, for use with (text-colour:), (bg:), and other macros.  ",anchor:"macro_palette",category:"colour",categoryOrder:"5"},gradient:{name:"gradient",sig:" Number, ...Number or Colour",returnType:"Gradient",aka:[],abstract:'When given a degree angle, followed by any number of number-colour pairs called "colour stops", this macro produces a gradient that fades between those colours in the direction of the angle.  ',anchor:"macro_gradient",category:"colour",categoryOrder:"6"},stripes:{name:"stripes",sig:" Number, Measurement, Colour, Colour",returnType:"Gradient",aka:[],abstract:"When given a degree angle, a `px` measurement, and two or more colours, this macro produces a gradient that draws a striped background, with each stripe as wide as the measurement, and alternating through the given colours.  ",anchor:"macro_stripes",category:"colour",categoryOrder:"7"},image:{name:"image",sig:" ...String, [Gradient or Colour]",returnType:"Image",aka:[],abstract:"This macro is used to access image files and use them as assets in your story. It takes one or more URL strings (relative or absolute), and Harlowe tries downloading from each, in turn, until one succeeds. It produces an image value, which *can only be stored in a variable with (define:)* - but that variable can be used with other macros, such as (bg:). If none of the URLs load, then the optional fallback gradient or colour (if given) will be used whenever you try to display the image.  ",anchor:"macro_image",category:"images"},hooksnamed:{name:"hooks-named",sig:" String",returnType:"HookName",aka:[],abstract:"When given a string, this creates a HookName from it. This can be used to dynamically create HookNames.  ",anchor:"macro_hooks-named",category:"basics"},cond:{name:"cond",sig:" Boolean, Any, ...Any",returnType:"Any",aka:[],abstract:'When given a sequence of booleans (the "conditions") paired with values, this provides the first value that was paired with a `true` condition. This can give you one value or another based on a quick check.  ',anchor:"macro_cond",category:"basics",categoryOrder:"12"},weekday:{name:"weekday",sig:"",returnType:"String",aka:[],abstract:'This date/time macro produces one of the strings "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday" or "Saturday", based on the weekday on the current player\'s system clock.  ',anchor:"macro_weekday",category:"date and time"},monthday:{name:"monthday",sig:"",returnType:"Number",aka:[],abstract:"This date/time macro produces a number corresponding to the day of the month on the current player's system clock. This should be between 1 (on the 1st of the month) and 31, inclusive.  ",anchor:"macro_monthday",category:"date and time"},currenttime:{name:"current-time",sig:"",returnType:"String",aka:[],abstract:'This date/time macro produces a string of the current 12-hour time on the current player\'s system clock, in the format "12:00 AM".  ',anchor:"macro_current-time",category:"date and time"},currentdate:{name:"current-date",sig:"",returnType:"String",aka:[],abstract:'This date/time macro produces a string of the current date the current player\'s system clock, in the format "Thu Jan 01 1970".  ',anchor:"macro_current-date",category:"date and time"},min:{name:"min",sig:" ...Number",returnType:"Number",aka:[],abstract:"This maths macro accepts numbers, and evaluates to the lowest valued number.  ",anchor:"macro_min",category:"maths"},max:{name:"max",sig:" ...Number",returnType:"Number",aka:[],abstract:"This maths macro accepts numbers, and evaluates to the highest valued number.  ",anchor:"macro_max",category:"maths"},abs:{name:"abs",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro finds the absolute value of a number (without the sign).  ",anchor:"macro_abs",category:"maths"},sign:{name:"sign",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro produces -1 when given a negative number, 0 when given 0, and 1 when given a positive number.  ",anchor:"macro_sign",category:"maths"},sin:{name:"sin",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro computes the sine of the given number of radians.  ",anchor:"macro_sin",category:"maths"},cos:{name:"cos",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro computes the cosine of the given number of radians.  ",anchor:"macro_cos",category:"maths"},tan:{name:"tan",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro computes the tangent of the given number of radians.  ",anchor:"macro_tan",category:"maths"},floor:{name:"floor",sig:" Number",returnType:"Number",aka:[],abstract:"This macro rounds the given number downward to a whole number. If a whole number is provided, it returns the number as-is.  ",anchor:"macro_floor",category:"number"},round:{name:"round",sig:" Number",returnType:"Number",aka:[],abstract:"This macro rounds the given number to the nearest whole number - downward if its decimals are smaller than 0.5, and upward otherwise. If a whole number is provided, it returns the number as-is.  ",anchor:"macro_round",category:"number"},trunc:{name:"trunc",sig:" Number",returnType:"Number",aka:[],abstract:'This macro rounds the given number towards zero. This "truncates" the fractional portion of the number, removing it and leaving just the whole portion.  ',anchor:"macro_trunc",category:"number"},ceil:{name:"ceil",sig:" Number",returnType:"Number",aka:[],abstract:"This macro rounds the given number upward to a whole number. If a whole number is provided, it returns the number as-is.  ",anchor:"macro_ceil",category:"number"},pow:{name:"pow",sig:" Number, Number",returnType:"Number",aka:[],abstract:"This maths macro raises the first number to the power of the second number, and provides the result.  ",anchor:"macro_pow",category:"maths"},exp:{name:"exp",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro raises Euler's number to the power of the given number, and provides the result.  ",anchor:"macro_exp",category:"maths"},sqrt:{name:"sqrt",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro produces the square root of the given number.  ",anchor:"macro_sqrt",category:"maths"},log:{name:"log",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro produces the natural logarithm (the base-e logarithm) of the given number.  ",anchor:"macro_log",category:"maths"},log10:{name:"log10",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro produces the base-10 logarithm of the given number.  ",anchor:"macro_log10",category:"maths"},log2:{name:"log2",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro produces the base-2 logarithm of the given number.  ",anchor:"macro_log2",category:"maths"},random:{name:"random",sig:" Number, [Number]",returnType:"Number",aka:[],abstract:"This macro produces a whole number randomly selected between the two whole numbers, inclusive (or, if the second number is absent, then between 0 and the first number, inclusive).  ",anchor:"macro_random",category:"number"},either:{name:"either",sig:" ...Any",returnType:"Any",aka:[],abstract:"Give this macro several values, separated by commas, and it will pick and return one of them randomly.  ",anchor:"macro_either",category:"basics",categoryOrder:"11"},nth:{name:"nth",sig:" Number, ...Any",returnType:"Any",aka:[],abstract:"Given a positive whole number and a sequence of values, this selects the nth value in the sequence, where n is the number. If n is larger than the number of items in the sequence, the selection loops around to the start.  ",anchor:"macro_nth",category:"basics",categoryOrder:"13"}}};if(!Object.keys(j).length)throw Error("ShortDefs wasn't inserted at build time");const Y={"#e61919":"red","#e68019":"orange","#e5e619":"yellow","#80e619":"lime","#19e619":"green","#19e5e6":"cyan","#197fe6":"blue","#1919e6":"navy","#7f19e6":"purple","#e619e5":"magenta","#ffffff":"white","#000000":"black","#888888":"grey"},fontIcon=(e,a=20,t=20)=>`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" width="${a}" height="${t}"><path fill='currentColor' d="${{search:"M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z","align-center":"M432 160H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0 256H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM108.1 96h231.81A12.09 12.09 0 0 0 352 83.9V44.09A12.09 12.09 0 0 0 339.91 32H108.1A12.09 12.09 0 0 0 96 44.09V83.9A12.1 12.1 0 0 0 108.1 96zm231.81 256A12.09 12.09 0 0 0 352 339.9v-39.81A12.09 12.09 0 0 0 339.91 288H108.1A12.09 12.09 0 0 0 96 300.09v39.81a12.1 12.1 0 0 0 12.1 12.1z","align-right":"M16 224h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16zm416 192H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm3.17-384H172.83A12.82 12.82 0 0 0 160 44.83v38.34A12.82 12.82 0 0 0 172.83 96h262.34A12.82 12.82 0 0 0 448 83.17V44.83A12.82 12.82 0 0 0 435.17 32zm0 256H172.83A12.82 12.82 0 0 0 160 300.83v38.34A12.82 12.82 0 0 0 172.83 352h262.34A12.82 12.82 0 0 0 448 339.17v-38.34A12.82 12.82 0 0 0 435.17 288z","list-ol":"M48 48a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm448 16H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z","list-ul":"M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z","border-style":"M240 416h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm-96 0h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm192 0h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm96-192h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0 96h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0 96h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-288h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-96H32A32 32 0 0 0 0 64v400a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16V96h368a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z",columns:"M464 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V80c0-26.51-21.49-48-48-48zM224 416H64V160h160v256zm224 0H288V160h160v256z",eye:"M288 144a110.94 110.94 0 0 0-31.24 5 55.4 55.4 0 0 1 7.24 27 56 56 0 0 1-56 56 55.4 55.4 0 0 1-27-7.24A111.71 111.71 0 1 0 288 144zm284.52 97.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400c-98.65 0-189.09-55-237.93-144C98.91 167 189.34 112 288 112s189.09 55 237.93 144C477.1 345 386.66 400 288 400z",comment:"M256 32C114.6 32 0 125.1 0 240c0 49.6 21.4 95 57 130.7C44.5 421.1 2.7 466 2.2 466.5c-2.2 2.3-2.8 5.7-1.5 8.7S4.8 480 8 480c66.3 0 116-31.8 140.6-51.4 32.7 12.3 69 19.4 107.4 19.4 141.4 0 256-93.1 256-208S397.4 32 256 32z",plus:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z",minus:"M416 208H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z",times:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z",check:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z","chevron-up":"M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z",gear:"M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336c44.2 0 80-35.8 80-80s-35.8-80-80-80s-80 35.8-80 80s35.8 80 80 80z"}[e]}"/></svg>`,GCD=(e,a)=>e?a?e>a?GCD(e-a,a):GCD(e,a-e):e:a,fourDecimals=e=>V(1e4*e)/1e4;function toHarloweColour(e,a){let t=e;return t=t.toLowerCase(),0==+a?"transparent":+a<1?(t=function hexToHSL(e){e=e.slice(1);const a=parseInt(e.slice(0,2),16)/255,t=parseInt(e.slice(2,4),16)/255,r=parseInt(e.slice(4,6),16)/255,o=Math.max(a,t,r),n=Math.min(a,t,r),s=(o+n)/2,i=o-n;if(o===n)return{h:0,s:0,l:s};let l;switch(o){case a:l=(t-r)/i+(t<r?6:0);break;case t:l=(r-a)/i+2;break;case r:l=(a-t)/i+4}return l=Math.round(60*l),{h:l,s:s>.5?i/(2-o-n):i/(o+n),l:s}}(t),`(hsl:${fourDecimals(t.h)},${fourDecimals(t.s)},${fourDecimals(t.l)},${fourDecimals(a)})`):t in Y?Y[t]:t[1]===t[2]&&t[3]===t[4]&&t[5]===t[6]?`#${t[1]}${t[3]}${t[5]}`:t}function toCSSColour(e,a){if(0==+a)return"transparent";if(+a<1){e=e.slice(1);return`rgba(${parseInt(e.slice(0,2),16)},${parseInt(e.slice(2,4),16)},${parseInt(e.slice(4,6),16)},${a})`}return e}function setOptionalStyles({codeUsesCodeFont:e=!0}){const a="cm-harlowe-4-";let t=document.querySelector(`style#${a}optionalStyles`);t||(t=document.createElement("style"),t.setAttribute("id",`${a}optionalStyles`),document.head.appendChild(t));let r="",o=1;if(e)try{for(let e of localStorage.getItem("twine-prefs")?.split(",")||[]){let{name:a,value:t}=JSON.parse(localStorage.getItem(`twine-prefs-${e}`));"codeEditorFontFamily"===a?r=t.includes(" ")?`"${t}"`:t:"codeEditorFontScale"===a&&(o=t)}}catch(e){}t.innerHTML=e?`.${a}root:not([class^='${a}text']):not([class^='${a}verbatim']) { ${r?`font-family:${r}`:""}; ${o?`font-size:${100*o}%`:""}`:""}function getPrefs(){try{return JSON.parse(localStorage.getItem("harlowe-prefs"))||{}}catch(e){return{}}}function setPref(e,a){try{const t=getPrefs();t[e]=a,localStorage.setItem("harlowe-prefs",JSON.stringify(t)),setOptionalStyles(t)}catch(e){return{}}}const U=document.createElement("p");function el(e){return U.innerHTML=e,U.firstChild}const G=!!document.querySelector('html[data-version^="2.3."]'),buttonClass=e=>G?" ":`icon-button variant-${e?"primary":"secondary"} `,X="opacity:0.5;pointer-events:none",{stringify:Z}=JSON;let{lex:J}=D,K={};const Q="querySelector",ee=`${Q}All`,ae="addEventListener",te="removeEventListener",re=[["#f8f9fa","#fff5f5","#fff0f6","#f8f0fc","#f3f0ff","#edf2ff","#e7f5ff","#e3fafc","#e6fcf5","#ebfbee","#f4fce3","#fff9db","#fff4e6"],["#f1f3f5","#ffe3e3","#ffdeeb","#f3d9fa","#e5dbff","#dbe4ff","#d0ebff","#c5f6fa","#c3fae8","#d3f9d8","#e9fac8","#fff3bf","#ffe8cc"],["#e9ecef","#ffc9c9","#fcc2d7","#eebefa","#d0bfff","#bac8ff","#a5d8ff","#99e9f2","#96f2d7","#b2f2bb","#d8f5a2","#ffec99","#ffd8a8"],["#dee2e6","#ffa8a8","#faa2c1","#e599f7","#b197fc","#91a7ff","#74c0fc","#66d9e8","#63e6be","#8ce99a","#c0eb75","#ffe066","#ffc078"],["#ced4da","#ff8787","#f783ac","#da77f2","#9775fa","#748ffc","#4dabf7","#3bc9db","#38d9a9","#69db7c","#a9e34b","#ffd43b","#ffa94d"],["#adb5bd","#ff6b6b","#f06595","#cc5de8","#845ef7","#5c7cfa","#339af0","#22b8cf","#20c997","#51cf66","#94d82d","#fcc419","#ff922b"],["#868e96","#fa5252","#e64980","#be4bdb","#7950f2","#4c6ef5","#228be6","#15aabf","#12b886","#40c057","#82c91e","#fab005","#fd7e14"],["#495057","#f03e3e","#d6336c","#ae3ec9","#7048e8","#4263eb","#1c7ed6","#1098ad","#0ca678","#37b24d","#74b816","#f59f00","#f76707"],["#343a40","#e03131","#c2255c","#9c36b5","#6741d9","#3b5bdb","#1971c2","#0c8599","#099268","#2f9e44","#66a80f","#f08c00","#e8590c"],["#212529","#c92a2a","#a61e4d","#862e9c","#5f3dc4","#364fc7","#1864ab","#0b7285","#087f5b","#2b8a3e","#5c940d","#e67700","#d9480f"]],dataValueRow=(e=((e,a)=>{e.expression=a}),a,t=!1)=>({type:"inline-dropdown-rows",text:"Value: ",name:"variable-datatype",width:"16%",options:[["text string",{type:"inline-string-textarea",width:"55%",text:"",placeholder:"Text",modelCallback:e,modelRegistry:a}],["number",{type:"inline-number-textarea",width:"20%",text:"",modelCallback:e,modelRegistry:a}],["Boolean value",{type:"inline-dropdown",text:"",options:["false","true"],model(a,t){e(a,`${!!t[Q]("select").value}`)},modelRegistry:a}],["colour",{type:"inline-colour",text:"",value:"#ffffff",model(a,t){const r=t[Q]("[type=color]").value,o=+t[Q]("[type=range]").value;e(a,toHarloweColour(r,o))},modelRegistry:a}],["array",{type:"datavalue-rows",text:"<div class='harlowe-4-datavalueRowHint'>An <b>array</b> is a sequence of ordered datavalues that can be used without having to create separate variables for each. Use it to store similar values whose order and position matter, or to store an ever-changing quantity of similar values.</div>",modelRows(a,t){e(a,`(a:${t})`)},renumber(e,a){const t=`${a+=1}`.slice(-1);e.textContent=a+("1"===t?"st":"2"===t?"nd":"3"===t?"rd":"th")+": "},modelRegistry:a}],["datamap",{type:"datavalue-map",text:"<div class='harlowe-4-datavalueRowHint'>A <b>datamap</b> is a value that holds any number of other values, each of which is \"mapped\" to a unique name. Use it to store data values that represent parts of a larger game entity, or rows of a table.</div>",modelRows(a,t){t.every(((e,a)=>a%2!=0||'""'!==e&&"''"!==e))||(a.invalidSubrow=!0),e(a,`(dm:${t})`)},renumber(e){e.textContent=":"},modelRegistry:a}],[],["randomly chosen value",{type:"datavalue-rows",text:"<div class='harlowe-4-datavalueRowHint'>One of the following values is randomly chosen <b>each time the macro is run</b>.</div>",modelRows(a,t){t.length||(a.invalidSubrow=!0),e(a,`(either:${t})`)},renumber(e){e.textContent="•",e.style.marginRight="0.5em"},modelRegistry:a}],["random number",el("<div class='harlowe-4-datavalueRowHint'>A number between these two values is randomly chosen <b>each time the macro is run</b>.</div>"),{type:"inline-number-textarea",width:"20%",text:"From",model(){},modelRegistry:a},{type:"inline-number-textarea",width:"20%",text:"to",model(a,t){e(a,`(random:${+t.previousElementSibling[Q]("input").value||0},${+t[Q]("input").value||0})`)},modelRegistry:a}],...t?[]:[[],["itself + value",{type:"datavalue-inner",text:"<div class='harlowe-4-datavalueRowHint'>The following value is added to the existing value in the variable. NOTE: if the values aren't the same type of data, an error will result.</div>",modelRows(a,t){1!==t.length&&(a.invalidSubrow=!0),e(a,`it + ${t}`)},renumber(e){e&&(e.textContent="it + ")},modelRegistry:a}],["variable + value",{type:"inline-dropdown",text:" Other variable: ",options:["$","_"],model(e,a){e.innerVariable=a[Q]("select").value?"_":"$"}},{type:"inline-textarea",width:"25%",text:"",placeholder:"Variable name",model(e,a){const t=a[Q]("input").value;t&&RegExp(`^${I.validPropertyName}$`).exec(t)&&!RegExp(/^\d/).exec(t)&&(e.innerVariable+=t)}},{type:"datavalue-inner",text:"<div class='harlowe-4-datavalueRowHint'>The above variable's value and the value below are added together. NOTE: if the values aren't the same type of data, an error will result.</div>",modelRows(a,t){1!==t.length&&(a.invalidSubrow=!0),e(a,`${a.innerVariable} + ${t}`)},renumber(e){e&&(e.textContent="")},modelRegistry:a}]],[],["coded expression",{type:"expression-textarea",width:"90%",text:"<div>Write a Harlowe code expression that should be computed to produce the desired value.</div>",placeholder:"Code",modelCallback:e,modelRegistry:a}]]}),folddownPanel=(...e)=>()=>{if(!e.length)return el("<div>");const a=[],t=[];function output(){return Object.entries(this.changers).map((([e,a])=>`(${e}:${a.join(",")})`)).join("+")}function changerNamed(e){return this.changers[e]||=[]}const model=e=>a.reduce(((e,a)=>(a(e),e)),{changers:{},wrapStart:"[",wrapEnd:"]",wrapStringify:!1,innerText:void 0,valid:!1,output,changerNamed,initiator:e});function update({target:e}={target:null}){const a=model(e??void 0);t.forEach((e=>e(a)))}const r=el(`<div class="harlowe-4-toolbarPanel${G?"":" card floating"}" style="transition:max-height 0.8s;overflow-y:auto">`),makeColourPicker=e=>{const makeSwatchRow=(e,a,t)=>el(`<span class=harlowe-4-swatchRow data-index="${a}" ${t?"":'style="display:none"'}>${e.map((e=>`<span class=harlowe-4-swatch style="background-color:${e}"></span>`)).join("")}</span>`),a=el(`<div class=harlowe-4-singleColourPicker><input style="width:48px;margin-right:8px" type=color value="${e}"></div>`),t=el(`<span class="text-select-control"><select ${G?"":'style="max-width: 9em;"'}><option value="" selected>Harlowe built-ins</option></select></span>`),r=t[Q]("select");return a.append(makeSwatchRow(Object.keys(Y),"",!0)),re.forEach(((e,t)=>{a.append(makeSwatchRow(e,t)),r?.append(el(`<option value=${t}>OpenColor ${t}</option>`))})),r?.[ae]("change",(()=>{a[ee]("[data-index]").forEach((e=>e.style.display="none")),a[Q](`[data-index="${r.value}"]`).style.display="inline-block"})),a.append(t,el("<br>"),new Text("Opacity: "),el('<input type=range style="width:64px;top:8px;position:relative" value=1 min=0 max=1 step=0.05>')),a[ae]("click",(({target:e})=>{if(e instanceof HTMLElement&&e.classList.contains("harlowe-4-swatch")){const t=a[Q]("input");t&&(t.value=e?.getAttribute("style")?.slice(-7)||"",t.dispatchEvent(new Event("change")))}})),a},o=e.reduce((function reducer(e,r){let o,n;const s=e instanceof HTMLElement&&"label"===e.tagName.toLowerCase();if(r instanceof Node)return e.append(r),e;if(n=r.type.startsWith("inline"),e instanceof HTMLElement)switch(r.type){case"text":case"inline-text":o=el(`<${n?"span":"div"}>${r.text}</${n?"span":"div"}>`);break;case"notice":case"small":o=el(`<small style="display:block">${r.text}</small>`);break;case"buttons":e.append(...r.buttons.map((e=>{if("tagName"in e)return e;const a=el(`<button title="${e.title}" class="${buttonClass()}${e.active?" active":""}${e.danger?" variant-danger":""}">${e.html}</button>`);return e.onClick&&a[ae]("click",e.onClick),e.update&&t.push((t=>e.update(t,a))),a})));break;case"preview":case"t8n-preview":{const e="t8n-preview"===r.type,a=r.tagName||"span";if(o=el(`<div class="harlowe-4-stylePreview" style="${e?"cursor:pointer;height: 2.6rem;":""}" ${e?'alt="Click to preview the transition"':""}><${a}>${r.text||""}</${a}>${e?`<${a}>${r.text2}</${a}>`:""}</div>`),e){o[ae]("mouseup",update),o[ae]("touchend",update);const e=o[Q](":first-child");e[ae]("animationend",(()=>e.style.visibility="hidden"))}}break;case"checkbox":case"checkboxrow":case"inline-checkbox":o=el(`<label${n?"":' style="display:block"'} class="harlowe-4-checkboxRow"><input type="checkbox" ${"persist"in r&&r.persist?"data-persist":""}></input>${r.text}</label>`),"checkboxrow"===r.type&&(r.subrow.reduce(reducer,o),r.subrow.forEach((a=>{if(a instanceof Node)return;const t=a.model;a.model=(a,r)=>!o[Q](":scope > input:checked")||s&&!e[Q](":scope > input:checked")?a:t(a,r)}))),o[ae]("change",update);break;case"checkboxes":o=el(`<div class="harlowe-4-toolbarCheckboxes" ${!1===r.bottomBorder?' style="border:none"':""}><div${r.bold?' style="font-weight:bold"':""}>${r.name}</div></div>`),r.options.forEach(((e,a)=>{const t=el(`<label${r.capitalise?' style="text-transform:capitalize;"':""} class="${buttonClass()}"><input type="checkbox" ${r.persist?"data-persist":""} ${r.checked?.(a)?"checked":""}></input>${e}</label>`);t[ae]("change",update),o.append(t)}));break;case"radios":o=el(`<div class="harlowe-4-toolbarCheckboxes"><div${r.bold?' style="font-weight:bold"':""}>${r.name}</div></div>`),r.options.forEach(((e,a)=>{const t=el(`<label${r.capitalise?' style="text-transform:capitalize;"':""} class="${buttonClass()}"><input type="radio" name="${r.name}" value="${e}" ${a?"":"checked"} ${r.persist?"data-persist":""}></input>${e}</label>`);t[ae]("change",update),o.append(t)}));break;case"textarea":case"inline-textarea":case"inline-string-textarea":case"inline-passage-textarea":case"inline-number-textarea":case"expression-textarea":{let e="text";const a="multiline"in r&&r.multiline?"textarea":"input";"expression-textarea"===r.type&&(r.update=(e,t)=>{!e.expression&&t[Q](a).value?t.setAttribute("invalid","This doesn't seem to be valid code."):t.removeAttribute("invalid")},r.model=(e,t)=>{const o=(t[Q](a).value||"").trim();if(o){if(J(o,"","macro").children.every((function recur(e){return"text"!==e.type&&"error"!==e.type&&("string"===e.type||"hook"===e.type||e.children.every(recur))})))return void r.modelCallback(e,o);e.valid=!0}}),"inline-string-textarea"===r.type&&(r.model||=(e,t)=>{r.modelCallback(e,JSON.stringify(t[Q](a).value||""))}),"inline-number-textarea"===r.type&&(e="number",r.model||=(e,t)=>{r.modelCallback(e,+t[Q](a).value||0)}),o=el(`<${n?"span":"div"} class="harlowe-4-labeledInput">${r.text}<${a} ${"useSelection"in r&&r.useSelection?"data-use-selection":""}${r.type.includes("passage")?'list="harlowe-4-passages"':""} style="width:${r.width};${"multiline"in r&&r.multiline?`max-width:${r.width};`:""}padding:var(--grid-size);margin${n?":2px 0.5rem 0 0.5rem":"-left:1rem"};${"multiline"in r&&r.multiline&&n?"display:inline-block;height:40px":""}" type=${e} ${"persist"in r&&r.persist?"data-persist":""} placeholder="${r.placeholder||""}"></${a}></${n?"span":"div"}>`),o[Q](a)[ae]("input",update)}break;case"inline-number":case"range":case"inline-range":o=el(`<${n?"span":"div"} class="harlowe-4-labeledInput">${r.text}<input style="padding:var(--grid-size);${r.width?`width:${r.width}`:""}" type=${r.type.endsWith("range")?"range":"number"} min=${r.min} max=${r.max} value=${r.value}${r.step?` step=${r.step}`:""}></input></${n?"span":"div"}>`),o[Q]("input")[ae](r.type.endsWith("range")?"input":"change",update);break;case"inline-colour":{o=el(`<${n?"span":"div"} class="harlowe-4-labeledInput">${r.text}</${n?"span":"div"}>`);const e=makeColourPicker(r.value);o.append(e),o[ee]("input").forEach((e=>e[ae]("change",update)))}break;case"gradient":{o=el(`<div style='position:relative'><span class=harlowe-4-gradientBar></span><button class="${buttonClass()}">${fontIcon("plus")} Colour</button></div>`);const e=o[Q](".harlowe-4-gradientBar"),createColourStop=(a,t,r)=>{const o=el(`<div ${r?"selected":""} data-colour="${t}" data-pos="${a}" class=harlowe-4-colourStop style="left:calc(${100*a}% - 8px); top:-8px"><div class=harlowe-4-colourStopButtons style="left:${-(G?464:384)*a-(G?0:40)}px"></div></div>`),n=makeColourPicker(t);n[ee]("input").forEach((e=>e[ae]("change",(()=>{const e=n[Q]("input[type=range]").value,a=n[Q]("[type=color]").value;o.setAttribute("data-colour",toCSSColour(a,e)),+e<1&&o.setAttribute("data-harlowe-colour",toHarloweColour(a,+e)),update()}))));const s=el(`<button class="${buttonClass()}" style='float:right'>${fontIcon("times")} Delete</button>`);s[ae]("click",(()=>{o.remove(),update()})),n.append(s),o.firstElementChild?.prepend(n),e.append(o),update()};setTimeout((()=>{createColourStop(0,"#ffffff"),createColourStop(.5,"#000000",!0),createColourStop(1,"#ffffff")})),o[Q]("button")[ae]("click",(()=>createColourStop(.5,"#888888")));const listener=({target:a})=>{if(a instanceof HTMLElement&&a.classList.contains("harlowe-4-colourStop")){const t=document.documentElement,{left:r,right:o}=e.getBoundingClientRect(),n=o-r,onMouseMove=e=>{let t="pageX"in e?e.pageX:e.touches[0].pageX;if(void 0===t)return;const o=Math.min(1,Math.max(0,(t-window.scrollX-r)/n));a.style.left=`calc(${100*o}% - 8px)`,a.firstChild.style.left=-(G?464:384)*o-(G?0:40)+"px",a.setAttribute("data-pos",`${o}`),update()},onMouseUp=()=>{t[te]("mousemove",onMouseMove),t[te]("mouseup",onMouseUp),t[te]("touchmove",onMouseMove),t[te]("touchend",onMouseUp)};t[ae]("mousemove",onMouseMove),t[ae]("mouseup",onMouseUp),t[ae]("touchmove",onMouseMove),t[ae]("touchend",onMouseUp),Array.from(e[ee]("[selected]")).forEach((e=>e.removeAttribute("selected"))),a.setAttribute("selected","true")}};o[ae]("mousedown",listener),o[ae]("touchstart",listener),t.push((()=>{e.style.background=`linear-gradient(to right, ${Array.from(e[ee](".harlowe-4-colourStop")).sort(((e,a)=>(+e.getAttribute("data-pos")||0)-(+a.getAttribute("data-pos")||0))).map((e=>`${e.getAttribute("data-colour")} ${100*(+e.getAttribute("data-pos")||0)}%`))})`}))}break;case"dropdown":case"inline-dropdown":{const e=el(`<${n?"span":"div"} style="white-space:nowrap;${n?"":"width:50%;"}position:relative;">${r.text}<span class="text-select-control"><select style="${n?"margin:0.5rem;":"margin-left:1rem;"}font-size:0.9rem;margin-top:4px" ${r.persist?"data-persist":""}></select></span></${n?"span":"div"}>`);r.options.forEach(((a,t)=>{e[Q]("select")?.append(el(`<option value="${t?a:""}"${a?t?"":" selected":" disabled"}>${a||"───────"}</select>`))})),e[Q]("select")?.[ae]("change",update),o=e}break;case"radiorows":o=el("<div>"),r.options.forEach(((a,t)=>{if(a instanceof HTMLElement)return;const n=el(`<label class='harlowe-4-radioRow'><input type="radio" name="${r.name}" value="${t||"none"}" ${t?"":"checked"}></input></label>`);o.append(a.reduce(reducer,n)),a.forEach((a=>{if(a instanceof Node)return;const{model:t}=a;t&&(a.model=(a,r)=>!n[Q](":scope > input:checked")||s&&!e[Q](":scope > input:checked")?a:t(a,r))})),n[Q]("input")?.[ae]("change",update)}));break;case"macro-list":{o=el('<div><div style="text-align:center">Category: </div></div>');const e=el("<span class='text-select-control'><select></span>");o.firstChild.append(e);const a=e[Q]("select"),t=el('<div style="margin-top:8px;border-top:1px solid hsla(0,0%,50%,0.5);max-height:40vh;overflow-y:scroll">');o.append(t),a?.[ae]("change",(()=>{const e=t[Q](`[name="${a.value}"]`);e?.scrollIntoView()})),Object.values(j.Macro).sort((({name:e,category:a,categoryOrder:t},{name:r,category:o,categoryOrder:n})=>a!==o?(a||"").localeCompare(o||""):t!==n?isNaN(+t)?1:isNaN(+n)?-1:Math.sign(+t-+n):e.localeCompare(r))).forEach(((e,r,o)=>{if(0!==r&&e.category===o[r-1].category||(t.append(el(`<h3 style="text-transform:capitalize" name="${e.category}">${e.category}</h3>`)),a?.append(el(`<option value="${e.category}">${e.category}</option>`))),r>0&&e.name===o[r-1].name)return;const n=el(`<label class='harlowe-4-radioRow'><input type="radio" name="macro-list" value="${e.name}"></input><code><a href="https://twine2.neocities.org/#${e.anchor}" target="_blank" rel="noopener noreferrer">(${e.name}: ${e.sig}) → ${e.returnType}</a></code>${e.aka.length?`<div><i>Also known as: ${e.aka.map((e=>`<code>(${e}:)</code>`)).join(", ")}</i>`:""}</div><div>${e.abstract.replace(/`([^`]+)`/g,((e,a)=>`<code>${a}</code>`))}</div></label>`);t.append(n),n[Q]("input")?.[ae]("change",update)}))}break;case"inline-dropdown-rows":{o=el(`<${n?"span":"div"}><span class="harlowe-4-dropdownRowLabel">${r.text}</span><span class="text-select-control"><select style="font-size:1rem;margin-top:4px;${r.width?`width:${r.width};text-overflow:ellipsis`:""}"></select></span><span class="harlowe-4-dropdownRows"></span></${n?"span":"div"}>`);const a=o[Q]("select");r.options.forEach((([t,...r],n)=>{if(!t)return void a.append(el("<option disabled>───────</option>"));a.append(el(`<option value="${t}" ${n?"":"selected"}>${t}<option>`));const i=el(`<span data-value="${t}" ${n?"hidden":""}>`);o[Q](".harlowe-4-dropdownRows").append(r.reduce(reducer,i)),r.forEach((r=>{const{model:o}=r;o&&(r.model=(r,n)=>a.value!==t||s&&!e[Q](":scope > input:checked")?r:o(r,n))}))})),a[ae]("change",(()=>{const e=a.value;o[ee](":scope > .harlowe-4-dropdownRows > span").forEach((a=>{a[(a.getAttribute("data-value")===e?"remove":"set")+"Attribute"]("hidden","")})),update()}))}break;case"textarea-rows":{o=el(`<div class="harlowe-4-textareaRows ${r.nonZeroRows?"harlowe-4-nonZeroRows":""}">`);const makeRow=()=>{if(o.childNodes.length>100)return;const e=el(`<div class="harlowe-4-dataRow"><input type=text style="width:80%;padding:var(--grid-size)" placeholder="${r.placeholder}"></input><button class="${buttonClass()} harlowe-4-rowMinus">${fontIcon("minus")}</button><button class="${buttonClass()} harlowe-4-rowPlus">${fontIcon("plus")}</button></div>`);e[Q]("input")?.[ae]("input",update),e[Q](".harlowe-4-rowPlus")?.[ae]("click",(()=>{makeRow(),update()})),e[Q](".harlowe-4-rowMinus")?.[ae]("click",(()=>{e.remove(),update()})),o.append(e)};makeRow()}break;case"datavalue-inner":{o=el(`<div class="harlowe-4-dataRow" style='margin:0.2em 0px'>${r.text}</div>`);const e=[];let a=[];reducer(o,dataValueRow(((e,t)=>a.push(t)),e,!0));const t=r.modelRows;r.model=r=>{a=[],e.reduce(((e,a)=>(a(e),e)),r),t?.(r,a)},r.renumber(o[Q](":scope > * > .harlowe-4-dropdownRowLabel"))}break;case"datavalue-rows":case"datavalue-map":{o=el(`<div class="harlowe-4-datavalueRows">${r.text||""}<div class="harlowe-4-dataEmptyRow"><i>No data</i></div><button class="${buttonClass()} harlowe-4-rowPlus">${fontIcon("plus")} Value</button></div>`);const e=o[Q](".harlowe-4-rowPlus"),a=new Set;let t=[];const renumber=()=>{Array.from(o[ee](":scope > .harlowe-4-dataRow > * > .harlowe-4-dropdownRowLabel")).forEach(r.renumber)},makeRow=()=>{if(o.childNodes.length>50)return;const n=el('<div class="harlowe-4-dataRow">'),s=[];o.insertBefore([...r.type.endsWith("map")?[{type:"inline-textarea",text:"",placeholder:"Data name",width:"15%",model(e,a){t.push(Z(a[Q]("input").value))},modelRegistry:s}]:[],dataValueRow(((e,a)=>{t.push(`${a}`)}),s,!0)].reduce(reducer,n),e),s.forEach((e=>a.add(e))),n.append(el(`<button class="${buttonClass()} harlowe-4-rowMinus">${fontIcon("minus")}</button>`)),n[Q](":scope > .harlowe-4-rowMinus")?.[ae]("click",(()=>{n.remove(),s.forEach((e=>a.delete(e))),0===o.childNodes.length&&makeRow(),update(),renumber()}))},{modelRows:n}=r;r.model=e=>{t=[],[...a].reduce(((e,a)=>(a(e),e)),e),n?.(e,t)},e[ae]("click",(()=>{makeRow(),update(),renumber()}))}break;case"scroll-wrapper":o=el('<div class="harlowe-4-scrollWrapper"></div>'),r.contents.reduce(reducer,o);break;case"confirm":{if(!G){const a=el('<div class="harlowe-4-scrollWrapper"></div>');a.append(...e.childNodes),e.append(a)}const a=el('<div class="harlowe-4-confirmButtons" style="padding-bottom:8px;"></div>'),r=el(`<button class="${buttonClass()}">${fontIcon("times")} Cancel</button>`),n=el(`<button class="${buttonClass(!0)} create">${fontIcon("check")} Add</button>`);n.setAttribute("style",X),t.push((e=>{const a=e.valid?"removeAttribute":"setAttribute";n[a]("style",X),e.valid&&("function"==typeof e.wrapStart&&(e.wrapStart=e.wrapStart(e)),"function"==typeof e.wrapEnd&&(e.wrapEnd=e.wrapEnd(e)))})),r[ae]("click",(()=>K.switchPanel())),n[ae]("click",(()=>{const e=model();"function"==typeof e.wrapStart&&(e.wrapStart=e.wrapStart(e)),"function"==typeof e.wrapEnd&&(e.wrapEnd=e.wrapEnd(e)),K.wrapSelection(e.output()+e.wrapStart,e.wrapEnd,"",e.innerText,e.wrapStringify),K.switchPanel()})),a.append(r,n),o=a}break;default:return console.error(`Invalid PanelRow type: ${r.type}`),e}if(s){const a=r.update;r.update=(t,r)=>{const o=e[Q](":scope > input:checked");Array.from(e[ee]("div,br ~ *")).forEach((e=>e[(o?"remove":"set")+"Attribute"]("hidden",""))),Array.from(e[ee]("input,select")).slice(1).forEach((e=>e[(o?"remove":"set")+"Attribute"]("disabled",""))),a?.(t,r)}}return r.model&&("modelRegistry"in r&&r.modelRegistry||a).push((e=>r.model(e,o))),r.update&&t.push((e=>r.update(e,o))),o&&e.append(o),e.onreset=update,e}),r);return e.splice(0,e.length),o},{stringify:oe,parse:ne}=JSON,{round:se}=Math;let ie,le={},ce=getPrefs().tooltips;void 0===ce&&(ce=!0);const he="querySelector",de=`${he}All`,me="addEventListener",pe=el('<div class="harloweToolbar">'),twine2KeymapOverride=e=>{pe[he](".harlowe-4-toolbarPanel")&&"Escape"===e.key&&(switchPanel(),e.stopPropagation())};function wrapSelection(e,a,t,r,o){if(0===(e+a).length)return;const n=void 0!==r?r:ie.doc.getSelection()||t||"Your Text Here";ie.doc.replaceSelection(e+(o||String)(n)+a,"around")}function switchPanel(e="default"){if(!G&&"default"===e)return void pe[de](".harlowe-4-toolbarPanel").forEach((e=>e.remove()));Object.entries(le).forEach((([a,t])=>{if("function"==typeof t){if(a!==e)return;t=le[a]=t()}t[de]("[type=radio]:not([data-persist])").forEach((e=>{e.checked=e.parentNode?.parentNode?.[he]("label:first-of-type")===e.parentNode})),t[de]("[type=checkbox]:not([data-persist])").forEach((e=>{e.checked=e.hasAttribute("checked")})),t[de]("[type=text]:not([data-persist])").forEach((e=>{e.value=""})),t[de]("select:not([data-persist])").forEach((e=>{e.value=e.firstElementChild?.getAttribute("value")||"";const{nextElementSibling:a}=e;a?.className.includes("harlowe-4-dropdownRows")&&Array.from(a.children).forEach((a=>{a[(a.getAttribute("data-value")===e.value?"remove":"set")+"Attribute"]("hidden","")}))})),"onreset"in t&&"function"==typeof t.onreset&&t.onreset()}));let a=le[e];if(!(a instanceof HTMLElement))return;const{height:t}=getComputedStyle(pe);pe[de](".harlowe-4-toolbarPanel").forEach((e=>e.remove())),G?(a.style.maxHeight=t,pe[de]("[data-use-selection]").forEach((e=>e.value=ie.doc.getSelection())),setTimeout((()=>a.style.maxHeight="70vh"),100)):a.classList.add("card-button-card","card","floating"),pe.append(a),pe.parentNode?.addEventListener("keydown",twine2KeymapOverride),document.addEventListener("keydown",twine2KeymapOverride)}K.wrapSelection=wrapSelection,K.switchPanel=switchPanel;const ue={default:e=>e?"appear step-end":"appear",dissolve:()=>"appear",shudder:()=>"shudder-in",rumble:()=>"rumble-in",zoom:()=>"zoom-in","slide-left":e=>e?"slide-right":"slide-left","slide-right":e=>e?"slide-left":"slide-right","slide-up":e=>e?"slide-down":"slide-up","slide-down":e=>e?"slide-up":"slide-down",flicker:()=>"flicker",pulse:()=>"pulse",instant:e=>"appear step-"+(e?"end":"start"),"fade-right":e=>e?"fade-left":"fade-right","fade-left":e=>e?"fade-right":"fade-left","fade-up":e=>e?"fade-down":"fade-up","fade-down":e=>e?"fade-up":"fade-down",blur:()=>"blur"},ge=["default","","instant","dissolve","blur","rumble","shudder","pulse","zoom","flicker","slide-left","slide-right","slide-up","slide-down","fade-left","fade-right","fade-up","fade-down"],ye={type:"checkbox",text:"Affect the entire remainder of the passage or hook",model(e,a){a[he](":checked")&&(e.wrapStart="[=\n",e.wrapEnd="")}},be="A <b>hook</b> is a section of passage prose enclosed in <code>[</code> or <code>]</code>, or preceded with <code>[=</code>.",doneRow=()=>{const e=el(`<span style="${G?"float:right;":"position:absolute;bottom:var(--grid-size);right:var(--grid-size);"}"><button class="variant-primary primary icon-button">Done</button></span>`);return e?.firstChild?.[me]("click",(()=>{switchPanel(),ie.constructor.signal(ie,"harlowe-4-findDone")})),e};le={textstyle:(()=>{const e={bold:"font-weight:bold",italic:"font-style:italic",underline:"text-decoration: underline","double-underline":"text-decoration: underline;text-decoration-style:double","wavy-underline":"text-decoration: underline;text-decoration-style:wavy",strike:"text-decoration: line-through","double-strike":"text-decoration: line-through;text-decoration-style:double","wavy-strike":"text-decoration: line-through;text-decoration-style:wavy",superscript:"vertical-align:super;font-size:.83em",subscript:"vertical-align:sub;font-size:.83em",mark:"background-color: hsla(60, 100%, 50%, 0.6)",outline:"color:black; text-shadow: -1px -1px 0 white, 1px -1px 0 white, -1px  1px 0 white, 1px  1px 0 white",shadow:"text-shadow: 0.08em 0.08em 0.08em white",emboss:"text-shadow: 0.04em 0.04em 0em white",condense:"letter-spacing:-0.08em",expand:"letter-spacing:0.1em",blur:"text-shadow: 0em 0em 0.08em white; color:transparent",blurrier:"text-shadow: 0em 0em 0.2em white; color:transparent",smear:"text-shadow: 0em 0em 0.02em white, -0.2em 0em 0.5em white, 0.2em 0em 0.5em white; color:transparent",mirror:"display:inline-block;transform:scaleX(-1)","upside-down":"display:inline-block;transform:scaleY(-1)",tall:"display:inline-block;transform:scaleY(1.5) translateY(-0.25ex)",flat:"display:inline-block;transform:scaleY(0.5) translateY(0.25ex)",blink:"animation:harlowe-4-fade-in-out 1s steps(1,end) infinite alternate","fade-in-out":"animation:harlowe-4-fade-in-out 2s ease-in-out infinite alternate",rumble:"display:inline-block;animation:harlowe-4-rumble linear 0.1s 0s infinite",shudder:"display:inline-block;animation:harlowe-4-shudder linear 0.1s 0s infinite",sway:"display:inline-block;animation:harlowe-4-sway 5s linear 0s infinite",buoy:"display:inline-block;animation:harlowe-4-buoy 5s linear 0s infinite",fidget:"display:inline-block;animation:harlowe-4-fidget 60s linear 0s infinite"},model=(e,a)=>{const t=Array.from(a[de]("[type=radio]:checked")).map((e=>e.value)).filter((e=>"none"!==e)).concat(Array.from(a[de]("[type=checkbox]:checked")).map((e=>e?.parentNode?.textContent||"")));e.changerNamed("text-style").push(...t.map((e=>oe(e)))),e.valid||=t.length>0};return folddownPanel({type:"preview",text:"Example text preview",update(a,t){t.firstChild.setAttribute("style",`position:relative;${a.changers["text-style"].map((a=>e[ne(a)])).join(";")}`)}},{type:"small",text:"This preview doesn't account for other modifications to this passage's text colour, font, or background, and is meant only for you to examine each of these styles."},{type:"checkboxes",name:"Font variants",capitalise:!0,bold:!0,options:["bold","italic","mark"],model},{type:"radios",name:"Underlines and strikes",capitalise:!0,bold:!0,options:["none","underline","double-underline","wavy-underline","strike","double-strike","wavy-strike"],model},{type:"radios",name:"Superscript and subscript",capitalise:!0,bold:!0,options:["none","superscript","subscript"],model},{type:"radios",name:"Outlines",capitalise:!0,bold:!0,options:["none","outline","shadow","emboss","blur","blurrier","smear"],model},{type:"radios",name:"Letter spacing",capitalise:!0,bold:!0,options:["none","condense","expand"],model},{type:"radios",name:"Flips and stretches",capitalise:!0,bold:!0,options:["none","mirror","upside-down","tall","flat"],model},{type:"radios",name:"Animations",capitalise:!0,bold:!0,options:["none","blink","fade-in-out","rumble","shudder","sway","buoy","fidget"],model},ye,{type:"confirm"})})(),borders:(()=>{function dropdownControls(e,a){return[el(`<div><b>${e}</b></div>`),{type:"inline-dropdown",text:"Style:",options:["none","","dotted","dashed","solid","double","groove","ridge","inset","outset"],model(e,t){const r=t[he]("select").value;e.changerNamed("b4r").push(oe(r||"none")),(e.borderEnabled||=[])[a]=!!r}},{type:"inline-number",text:"Size:",value:1,min:.1,max:20,step:.1,model(e,a){e.changerNamed("b4r-size").push(a[he]("input").value)}},{type:"inline-colour",text:"Colour:",value:"#ffffff",update(e,t){t.setAttribute("style",e.borderEnabled?.[a]?"":"display:none")},model(e,a){const t=a[he]("[type=color]").value,r=+a[he]("[type=range]").value;e.changerNamed("b4r-colour").push(toHarloweColour(t,r)),(e.borderColours||=[]).push(toCSSColour(t,r))}}]}return folddownPanel({type:"preview",text:"Example border preview",update(e,a){const t=e.suppressedChangers||e.changers;a.firstChild.setAttribute("style",`border-style:${t.b4r?`${t.b4r.map(ne).join(" ")};`:""}${t["b4r-size"]?`border-width:${t["b4r-size"].reduce(((e,a)=>`${e} ${2*+a}px`),"")};`:""}${t["b4r-colour"]?`border-color:${e.borderColours.join(" ")};`:""}`)}},...dropdownControls("Top",0),...dropdownControls("Right",1),...dropdownControls("Bottom",2),...dropdownControls("Left",3),{type:"radios",name:"Affect:",options:["The attached hook","The remainder of the passage or hook.","The entire passage."],model(e,a){const t=a[he]("input:checked"),r=Array.from(a[de]("label")).indexOf(t.parentNode);r>=2&&Object.keys(e.changers).length?(e.suppressedChangers=e.changers,e.changers={}):1===r&&(e.wrapStart="[=\n",e.wrapEnd="")}},{type:"confirm",model(e){e.valid=!0;const a=e.suppressedChangers||e.changers;[["b4r",e=>"none"===ne(e)],["b4r-size",e=>1==+e],["b4r-colour",e=>"transparent"===e]].forEach((([t,r])=>{a[t]=function reduce4ValueProp(e){return 4===e.length&&e[3]===e[1]&&e.pop(),3===e.length&&e[2]===e[0]&&e.pop(),2===e.length&&e[1]===e[0]&&e.pop(),e}(a[t]),a[t].every(r)&&(delete a[t],"b4r"===t&&(e.valid=!1))})),e.valid&&e.suppressedChangers&&(e.wrapStart=`(enchant:?passage,${Object.entries(a).map((([e,a])=>`(${e}:${a.join(",")})`)).join("+")})`,e.wrapEnd="")}})})(),textcolor:folddownPanel({type:"preview",text:"Example text preview",update(e,a){const t=e.suppressedChangers||e.changers;a.firstChild.setAttribute("style",`${t["text-colour"]?`color:${e.textColour};`:""}${e.stops?`background:linear-gradient(${e.angle}deg, ${e.stops.map((e=>`${e.getAttribute("data-colour")} ${100*+e.getAttribute("data-pos")}%`))})`:t.bg?`background:${e.backgroundColour}`:""}`)}},{type:"small",text:"This preview doesn't account for other modifications to this passage's text colour or background, and is meant only for you to examine the selected colours."},el("<div><b>Text colour</b></div>"),{type:"radiorows",name:"txtcolor",options:[[{type:"inline-text",text:"Default text colour"}],[new Text("Flat colour"),{type:"colour",text:"",value:"#ffffff",model(e,a){const t=a[he]("[type=color]").value,r=a[he]("[type=range]").value;e.changerNamed("text-colour").push(toHarloweColour(t,+r)),e.textColour=toCSSColour(t,r)}}]]},el("<div><b>Background</b></div>"),{type:"radiorows",name:"bgcolor",options:[[{type:"inline-text",text:"Default background",model(e){e.valid=!0}}],[new Text("Flat colour"),{type:"colour",text:"",value:"#000000",model(e,a){const t=a[he]("[type=color]").value,r=a[he]("[type=range]").value;e.changerNamed("bg").push(toHarloweColour(t,+r)),e.backgroundColour=toCSSColour(t,r),e.valid=!0}}],[new Text("Linear gradient"),{type:"gradient",model(e,a){const t=Array.from(a[de](".harlowe-4-colourStop")).sort(((e,a)=>+e.getAttribute("data-pos")-+a.getAttribute("data-pos")));t.length>1&&(e.valid=!0,e.changerNamed("bg").push(`(gradient: $deg, ${t.map((e=>`${fourDecimals(+e.getAttribute("data-pos"))},${e.getAttribute("data-harlowe-colour")||e.getAttribute("data-colour")}`))})`),e.stops=t,e.angle=0)}},el(`<br style="height:${G?1:4}rem">`),{type:"inline-range",text:"Angle (deg):",value:0,min:0,max:359,step:1,model(e,a){if(e.valid){const t=e.changerNamed("bg");e.angle=+a[he]("input").value,t[0]=t[0].replace("$deg",`${e.angle}`)}}}]]},{type:"radios",name:"Affect:",options:["The attached hook","The remainder of the passage or hook.","The entire passage.","The entire page."],model(e,a){const t=a[he]("input:checked"),r=Array.from(a[de]("label")).indexOf(t.parentNode),o=Object.entries(e.changers);r>=2&&o.length?(e.wrapStart=`(enchant:?pa${2===r?"ssa":""}ge,${o.map((([e,a])=>`(${e}:${a.join(",")})`)).join("+")})`,e.wrapEnd="",e.suppressedChangers=e.changers,e.changers={}):1===r&&(e.wrapStart="[=\n",e.wrapEnd="")}},{type:"confirm"}),passagelink:(()=>{const passageT8nPreviews=()=>[el("<br>"),{type:"inline-dropdown",text:"Departing transition: ",options:ge,model(e,a){const{value:t}=a[he]("select");""!==t&&e.changerNamed("t8n-depart").push(oe(t))}},{type:"inline-dropdown",text:"Arriving transition: ",options:ge,model(e,a){const{value:t}=a[he]("select");""!==t&&e.changerNamed("t8n-arrive").push(oe(t))}},el("<br>"),{type:"inline-number",text:"Transition time (sec): ",value:.8,min:0,max:999,step:.1,model(e,a){const t=a[he]("input").value;.8!=+t&&e.changerNamed("t8n-time").push(`${t}s`)}},{type:"t8n-preview",text:"Departing Text",text2:"Arriving Text",update(e,a){if(e.initiator&&!["select","div","span"].some((a=>a===e.initiator.tagName.toLowerCase())))return;const t=`harlowe-4-${ue[e.changers["t8n-depart"]?ne(e.changers["t8n-depart"][0]):"default"](!0)}`,r=`harlowe-4-${ue[e.changers["t8n-arrive"]?ne(e.changers["t8n-arrive"][0]):"default"](!1)}`,o=e.changers["t8n-time"]?e.changers["t8n-time"][0]:"0.8s",n=a.firstChild,s=a.lastChild;n.setAttribute("style",`animation:${t} reverse ${o} 1;`),s.setAttribute("style",`animation:${r} ${o} 1;`),n.remove(),s.remove(),setTimeout((()=>a.append(n,s)))}}];return folddownPanel({type:"radiorows",name:"whichclick",options:[[{type:"inline-textarea",text:"Create a hyperlink, with this text:",placeholder:"Link text (can't be empty)",useSelection:!0,width:"50%",model(e,a){const t=a[he]("input").value;t.length>0&&(e.linkText=t,e.valid=!0)}}],[{type:"inline-text",text:"Allow the entire page to be clicked.",model(e){e.changerNamed("click").push("?page"),e.clickPage=!0,e.valid=!0}},{type:"text",text:"This will place a faint blue border around the edges of the page, and change the mouse cursor to the hand pointer, until it is clicked."}]]},{type:"text",text:"<b>When it is clicked, perform this action:</b>"},{type:"radiorows",name:"passagelink",update(e,a){a.lastChild.firstChild[(e.clickPage?"set":"remove")+"Attribute"]("disabled",""),e.clickPage&&a.lastChild.firstChild.checked&&a.firstChild.firstChild.click()},options:[[{type:"inline-passage-textarea",text:"Go to this passage:",width:"70%",placeholder:"Passage name",model(e,a){const t=a[he]("input").value;t.length||(e.valid=!1),"click"in e.changers?(delete e.changers.click,e.wrapStart=`(click-goto:?page,${oe(t)})`,e.wrapEnd=""):["]]","->","<-"].some((a=>t.includes(a)||e.linkText?.includes(a)))?(e.wrapStart=`(link-goto:${oe(e.linkText)},`,e.wrapEnd=`${oe(t)})`):(e.wrapStart=`[[${e.linkText}`,e.wrapEnd=`->${t}]]`),e.innerText=""}},...passageT8nPreviews()],[{type:"inline-text",text:"Undo the current turn, returning to the previous passage.",model(e){"click"in e.changers?(e.wrapStart=`(click-undo:${e.changers.click})`,e.wrapEnd="",delete e.changers.click):(e.changerNamed("link-undo").push(oe(e.linkText)),e.wrapStart="",e.wrapEnd="")}},...passageT8nPreviews()],[{type:"inline-dropdown",text:"Reveal ",options:["an attached hook.","the remainder of the passage."],model(e,a){a[he]("select").value&&(e.wrapStart="[=\n",e.wrapEnd="")}},el("<br>"),{type:"text",text:`(${be})`},{type:"inline-dropdown",text:"Revealed text transition: ",options:ge,model(e,a){const{value:t}=a[he]("select");""!==t&&e.changerNamed("t8n").push(oe(t))}},{type:"inline-number",text:"Transition time (sec): ",value:.8,min:0,max:999,step:.1,model(e,a){const t=a[he]("input").value;.8!=+t&&e.changerNamed("t8n-time").push(`${t}s`)}},{type:"t8n-preview",text2:"Revealed Text",update(e,a){if(e.initiator&&!["select","div","span"].some((a=>a===e.initiator.tagName.toLowerCase())))return;const t=`harlowe-4-${ue[e.changers.t8n?ne(e.changers.t8n[0]):"default"](!1)}`,r=e.changers["t8n-time"]?e.changers["t8n-time"][0]:"0.8s",o=a.lastChild;o.setAttribute("style",`animation:${t} ${r} 1;`),o.remove(),setTimeout((()=>a.append(o)))}},{type:"radiorows",name:"linkReveal",update(e,a){a[de]("input").forEach((a=>a[(e.clickPage?"set":"remove")+"Attribute"]("disabled","")))},options:[[{type:"inline-text",text:"Then remove the link's own text.",model(e){e.clickPage||e.changerNamed("link").push(oe(e.linkText))}}],[{type:"inline-text",text:"Then unlink the link's own text.",model(e){e.clickPage||e.changerNamed("link-reveal").push(oe(e.linkText))}}],[{type:"inline-text",text:"Re-run the hook each time the link is clicked.",model(e){e.clickPage||e.changerNamed("link-rerun").push(oe(e.linkText))}}],[{type:"inline-text",text:"Repeat the hook each time the link is clicked.",model(e){e.clickPage||e.changerNamed("link-repeat").push(oe(e.linkText))}}]]}],[{type:"inline-text",text:"Cycle the link's text to the next alternative in a list."},el("<br>"),{type:"textarea-rows",nonZeroRows:!0,placeholder:"Link text (can't be empty)",model(e,a){const t=[e.linkText].concat(Array.from(a[de]("input")).map((e=>e.value)));!e.clickPage&&t.every(Boolean)?(e.wrapStart=`(cycling-link:${t.map((e=>JSON.stringify(e)))})`,e.wrapEnd="",e.innerText=""):a.parentNode.firstChild.checked&&(e.valid=!1)}},{type:"radios",name:"Upon reaching the end:",options:["Loop to the start.","Remove the link.","Unlink the link."],model(e,a){if(!e.valid)return;const{value:t}=a[he]("[type=radio]:checked");t.startsWith("U")?e.wrapStart=e.wrapStart.replace(/^\(cycling/,"(seq"):t.startsWith("R")&&(e.wrapStart=e.wrapStart.replace(/\)$/,',"")'))}}]]},{type:"confirm"})})(),if:folddownPanel({type:"text",text:"<b>Only show a section of the passage if this condition is met:</b>"},{type:"radiorows",name:"if",options:[[{type:"inline-dropdown",text:"The player visited this passage",options:["exactly","at most","at least","anything but","a multiple of"],model(e,a){e.changerNamed("if").push(`visits${{"":" is ","at most":" <= ","at least":" >= ","anything but":" is not ","a multiple of":" % "}[a[he]("select").value]}`)}},{type:"inline-number",text:"",value:0,min:0,max:999,model(e,a){const t=e.changerNamed("if");t[0]+=a[he]("input").value,t[0].includes(" % ")&&(t[0]+=" is 0",t[0]=t[0].replace(" % 2 is 0"," is an even")),e.valid=!0}},new Text(" times.")],[{type:"inline-dropdown",text:"The player has now visited this passage an",options:["even","odd"],model(e,a){e.changerNamed("if").push("odd"===a[he]("select").value?"visits is an odd":"visits is an even"),e.valid=!0}},new Text(" number of times.")],[{type:"inline-number",text:"",value:2,min:1,max:999,model(e,a){e.changerNamed("after").push(`${a[he]("input").value}s`),e.valid=!0}},new Text(" seconds have passed since this passage was entered.")],[{type:"inline-textarea",width:"20%",text:"The passage ",placeholder:"Passage name",model(e,a){const t=a[he]("input").value;t&&(e.changerNamed("if").push(`(history: where its name contains ${oe(t)})'s length`),e.valid=!0)}},{type:"inline-dropdown",text:"was visited ",options:["exactly","at most","at least","anything but","a multiple of"],model(e,a){e.changerNamed("if")[0]+={"":" is ","at most":" <= ","at least":" >= ","anything but":" is not ","a multiple of":" % "}[a[he]("select").value]}},{type:"inline-number",text:"",value:1,min:1,max:999,model(e,a){const t=e.changerNamed("if");t[0]+=a[he]("input").value,t[0].includes(" % ")&&(t[0]+=" is 0",t[0]=t[0].replace(" % 2 is 0"," is even"))}},new Text(" times.")],[{type:"inline-textarea",width:"15%",text:"Passages tagged ",placeholder:"Tag name",model(e,a){const t=a[he]("input").value;t&&(e.changerNamed("if").push(`(history: where (passage:it)'s tags contains ${oe(t)})'s length`),e.valid=!0)}},{type:"inline-dropdown",text:"were visited ",options:["exactly","at most","at least","anything but","a multiple of"],model(e,a){const t=a[he]("select").value;e.changerNamed("if")[0]+={"":" is ","at most":" <= ","at least":" >= ","anything but":" is not ","a multiple of":" % "}[t]}},{type:"inline-number",text:"",value:1,min:1,max:999,model(e,a){const t=e.changerNamed("if");t[0]+=a[he]("input").value,t[0].includes(" % ")&&(t[0]+=" is 0",t[0]=t[0].replace(" % 2 is 0"," is even"))}},new Text(" times.")],[{type:"inline-text",text:"There are no more interactable elements in the passage.",model(e){e.changerNamed("more"),e.valid=!0}},{type:"text",text:"Interactable elements are link, mouseover, or mouseout areas. If you're using links that reveal additional lines of prose and then remove or unlink themselves, this will reveal the attached text when all of those are gone."}],[{type:"inline-dropdown",text:"The variable ",options:["$","_"],model(e,a){e.variable=a[he]("select").value?"_":"$"}},{type:"inline-textarea",width:"25%",text:"",placeholder:"Variable name",model(e,a){const t=a[he]("input").value;t&&RegExp(`^${I.validPropertyName}$`).exec(t)&&!RegExp(/^\d/).exec(t)&&(e.variable+=t)}},{type:"inline-dropdown",text:"",options:["is","is not","is greater than","is less than","contains","is in"],model(e,a){const t=a[he]("select").value;e.operator={"is greater than":">","is less than":"<","":"is"}[t]||t}},new Text("a value."),el("<br>"),dataValueRow(),{type:"text",text:"",model(e){void 0!==e.expression&&""!==e.expression&&e.operator&&e.variable&&!e.invalidSubrow&&(e.changerNamed("if").push(`${e.variable} ${e.operator} ${e.expression}`),e.valid=!0)}}]]},{type:"checkbox",text:"Also, only if the previous (if:), (else-if:) or (unless:) hook's condition wasn't fulfilled.",model(e,a){a[he](":checked")&&("if"in e.changers?(e.changerNamed("else-if").push(...e.changerNamed("if")),delete e.changers.if):e.changerNamed("else"))}},ye,{type:"confirm"}),hook:folddownPanel({type:"text",text:`${be} The main purpose of hooks is that they can be visually or textually altered by special data values called <b>changers</b>. Changers are usually placed in front of hooks to change them.`,model(e){e.wrapStart="[",e.wrapEnd="]",e.valid=!0}},{type:"textarea",width:"25%",text:"Hook name (letters, numbers and underscores only):",placeholder:"Hook name",model(e,a){const t=a[he]("input").value;t&&(RegExp(`^${I.validPropertyName}$`).exec(t)?(e.wrapStart=`|${t}>[`,e.hookName=t):e.valid=!1)}},{type:"text",text:"",update(e,a){const t=(e.hookName||"").toLowerCase();t?["link","page","passage","sidebar"].includes(t)?a.innerHTML=`The hook name <b><code>?${t}</code></b> is <b>reserved</b> by Harlowe. It refers to <b>${"link"===t?"all of the links in the passage":"page"===t?"the entire HTML page":"passage"===t?"the element that contains the current passage's text":"sidebar"===t?"the passage's sidebar, containing the undo/redo icons":"unknown"}</b>.`:a.innerHTML=`You can refer to this hook (and every other one with this name) using the code <b><code>?${t}</code></b>.`:a.innerHTML="Hook names are optional, but giving a hook a nametag allows it to be remotely altered using macros like <code>(click:)</code>, <code>(replace:)</code>, or <code>(enchant:)</code>. You can use these macros elsewhere in the passage, keeping your prose uncluttered."}},{type:"confirm"}),align:folddownPanel({type:"preview",text:"You can apply left, center and right alignment to your passage text, as well as adjust the margins and width.",update(e,a){a.setAttribute("style","width:100%;height:6em;overflow-y:hidden;");let t=`width:${100*e.width}%;margin-left:${100*e.left}%;margin-right:${100*e.right}%;`;"center"!==e.align&&(t+=`text-align:${e.align};`),a.firstChild.setAttribute("style",`display:block;${t}`)}},{type:"inline-range",text:"Placement: ",value:0,min:0,max:10,step:1,model(e,a){e.placement=+a[he]("input").value/10}},{type:"inline-range",text:"Width: ",value:5,min:1,max:10,step:1,model(e,a){e.width=+a[he]("input").value/10;const t=1-e.width;e.left=t*e.placement,e.right=t*(1-e.placement)}},{type:"radios",name:"Alignment",capitalise:!0,options:["left","center","justify","right"],model(e,a){e.align=a[he]("input:checked").value}},{type:"checkbox",text:"Affect the entire remainder of the passage",model(e,a){const t=!!a[he](":checked");if(e.width===("center"===e.align?.5:1)&&(!e.left||!e.right)==("center"!==e.align&&"justify"!==e.align)){const a=se(10*e.left),r=se(10*e.right),o=GCD(a,r),n="left"===e.align?"<==":"right"===e.align?"==>":"=".repeat(a/o)+(a?">":"")+(r?"<":"")+"=".repeat(r/o);t?(e.wrapStart=`${n}\n`,e.wrapEnd=""):e.changerNamed("align").push(oe(n))}else{const a=se(100*e.left),r=se(100*e.width),o=se(100*e.right),n=GCD(r,GCD(a,o));e.changerNamed("align").push(oe("left"===e.align?"<==":"right"===e.align?"==>":"justify"===e.align?"<==>":"=><=")),e.changerNamed("box").push(oe("=".repeat(a/n)+"X".repeat(r/n)+"=".repeat(o/n))),t&&(e.wrapStart="[=\n",e.wrapEnd="")}e.valid=!0}},{type:"confirm"}),rotate:folddownPanel({type:"preview",text:"Rotated text preview",update(e,a){a.setAttribute("style","height:6em;");const t=a[he]("span"),{changers:r}=e,o=r["text-rotate-x"],n=r["text-rotate-y"],s=r["text-rotate-z"];let i="margin-top:2em;transform:";(o||n)&&(i+="perspective(50vw) "),o&&(i+=`rotateX(${o}deg) `),n&&(i+=`rotateY(${n}deg) `),s&&(i+=`rotateZ(${s}deg)`),t.setAttribute("style",i)}},{type:"range",text:"Rotation (X axis):",value:0,min:0,max:359,step:1,model(e,a){const{value:t}=a[he]("input");+t&&(e.changerNamed("text-rotate-x").push(t),e.valid=!0)}},{type:"range",text:"Rotation (Y axis):",value:0,min:0,max:359,step:1,model(e,a){const{value:t}=a[he]("input");+t&&(e.changerNamed("text-rotate-y").push(t),e.valid=!0)}},{type:"range",text:"Rotation (Z axis):",value:0,min:0,max:359,step:1,model(e,a){const{value:t}=a[he]("input");+t&&(e.changerNamed("text-rotate-z").push(t),e.valid=!0)}},ye,{type:"confirm"}),columns:folddownPanel({type:"preview",text:"Use columns to lay out two or more spans of prose alongside each other. Each column has its own margins and can occupy a different amount of horizontal space.",update(e,a){a.setAttribute("style","width:90%;display:flex;justify-content:space-between;height:5em;overflow-y:hidden;");const t=e.columns||[],r=Array.from(a[de]("span"));for(let e=0;e<Math.max(t.length,r.length);e+=1)e>=t.length?r[e].remove():e>=r.length&&a.append(el(`<span>${r[0].textContent}</span>`));const o=t.reduce(((e,a)=>e+a.width),0);Array.from(a[de]("span")).forEach(((e,a)=>e.setAttribute("style",`position:relative; font-size:50%; width:${t[a].width/o*100}%;margin-left:${t[a].left}em;margin-right:${t[a].right}em`)))}},{type:"inline-dropdown",text:"Columns:",options:["1","2","3","4","5","6"],model(e,a){e.columns=[...Array(+a[he]("select").value||1)].map((()=>({left:1,width:1,right:1}))),e.wrapStart="",e.innerText="",e.wrapEnd=e.columns.length>1?"\n|==|":"",e.valid=!0},update(e,a){Array.from(a.parentNode[de](".harlowe-4-labeledInput")).forEach((e=>e.removeAttribute("style"))),Array.from(a.parentNode[de](`p:nth-of-type(${e.columns.length}) ~ .harlowe-4-labeledInput`)).forEach((e=>e.setAttribute("style","display:none")))}},el("<br>"),...[0,1,2,3,4,5].reduce(((e,a)=>e.concat({type:"inline-number",text:`Column ${a+1} left margin:`,value:1,min:0,max:9,step:1,model(e,t){e.columns[a]&&(e.columns[a].left=+t[he]("input").value)}},{type:"inline-number",text:"Width:",value:1,min:1,max:9,step:1,model(e,t){e.columns[a]&&(e.columns[a].width=+t[he]("input").value)}},{type:"inline-number",text:"Right margin:",value:1,min:0,max:9,step:1,model(e,t){const r=e.columns[a];r&&(r.right=+t[he]("input").value,e.wrapStart+=`\n${"=".repeat(r.left)}${"|".repeat(r.width)}${"=".repeat(r.right)}\nColumn ${a+1}`)}},el("<p>"))),[]),{type:"confirm"}),collapse:folddownPanel({type:"inline-dropdown",text:"Collapse the whitespace within ",options:["a section of the passage.","the remainder of the passage."],model(e,a){a[he]("select").value?(e.wrapStart="{=\n",e.wrapEnd=""):(e.wrapStart="{",e.wrapEnd="}"),e.valid=!0}},{type:"text",text:"The <b>collapsing markup</b> hides line breaks and reduces sequences of consecutive spaces to just a single space."},{type:"text",text:"If you wish to include whitespace that's exempt from this, you may include <b>HTML &lt;br&gt; tags</b>, or use the verbatim (Vb) markup."},{type:"confirm"}),basicValue:folddownPanel({type:"text",text:"Use <b>variables</b> to store <b>data values</b>, either across your story or within a passage.<br>That data can then be used in the passage, or in other macro calls, by using the variable's name in place of that value."},{type:"textarea",width:"25%",text:"Variable name (letters, numbers and underscores only):",placeholder:"Variable name",model(e,a){const t=a[he]("input").value;t&&RegExp(`^${I.validPropertyName}$`).exec(t)&&!RegExp(/^\d/).exec(t)&&(e.variableName=t)}},dataValueRow(),{type:"checkbox",text:"Temp variable (the variable only exists in this passage and hook).",model(e,a){e.sigil=a[he]("input").checked?"_":"$",e.variableName&&e.expression&&!e.invalidSubrow?(e.wrapStart=`(set: ${e.sigil}${e.variableName} to ${e.expression})`,e.wrapEnd=e.innerText="",e.valid=!0):e.valid=!1}},{type:"text",text:"",update(e,a){const t=e.valid?`${e.sigil}${e.variableName}`:"";a.innerHTML=e.valid?`<p>You can refer to this variable using the code <b><code>${t}</code></b>.</p><p>Some types of data values (arrays, datamaps, datasets, strings, colours, gradients, custom macros, and typedvars) are storage containers for other values.<br>You can access a specific value stored in them using that value's <b>data name</b> (or a string or number value in brackets) by writing <b><code>${t}'s</code></b> <i>name</i>, or <i>name</i> <b><code>of ${t}</code></b>.</p><p>(If you want to display that stored value in the passage, you'll need to give it to a macro, such as <code>(print: ${t}'s </code> <i>name</i><code>)</code>.)</p>`:""}},{type:"confirm"}),input:folddownPanel({type:"radiorows",name:"inputelement",options:[[new Text("Create a text input box."),el("<br>"),{type:"preview",tagName:"textarea",text:"You can type sample text into this preview box.",update(e,a){a.setAttribute("style","width:100%;height:6em;"),a.firstChild.setAttribute("style",`display:block;resize:none;font-family:Georgia,serif;border-style:solid;border-color:#fff;color:#fff;width:${100*e.width}%;margin-left:${100*e.left}%;margin-right:${100*e.right}%;`),a.firstChild.setAttribute("rows",`${e.rows||3}`)},model(e){e.wrapStart=e=>{const a=se(100*e.left),t=se(100*e.width),r=se(100*e.right),o=GCD(t,GCD(a,r));return`(${"forcedText"in e?"force-":""}input-box:${e.variable?`2bind ${e.variable},`:""}${oe("=".repeat(a/o)+"X".repeat(t/o)+"=".repeat(r/o))}${3!==e.rows?`,${e.rows}`:""}${"forcedText"in e?`,${oe(e.forcedText)}`:e.initialText?`,${oe(e.initialText)}`:""})`},e.wrapEnd=e.innerText="",e.valid=!0}},{type:"inline-range",text:"Placement: ",value:5,min:0,max:10,step:1,width:"25%",model(e,a){e.placement=+a[he]("input").value/10}},{type:"inline-range",text:"Width: ",value:5,min:1,max:10,step:1,width:"25%",model(e,a){e.width=+a[he]("input").value/10;const t=1-e.width;e.left=t*e.placement,e.right=t*(1-e.placement)}},{type:"inline-number",text:"Rows:",value:3,min:1,max:9,step:1,model(e,a){e.rows=+a[he]("input").value}},{type:"radiorows",name:"inputboxtype",options:[[{type:"inline-textarea",width:"50%",text:"The box initially contains this text:",placeholder:"Initial text",model(e,a){e.initialText=a[he]("input").value||""}}],[{type:"inline-textarea",width:"50%",text:"Force the player to type this text:",placeholder:"Text to display",model(e,a){e.forcedText=a[he]("input").value||""}},el("<div>Instead of being a normal input box, this will instead slowly write the above text into the box as the player presses keys.</div>")]]}],[new Text("Create a dropdown menu."),el("<br>"),{type:"inline-text",text:"Dropdown options (leave blank to make a separator):"},{type:"textarea-rows",nonZeroRows:!0,placeholder:"Option text (leave blank to make a separator)",model(e,a){const t=Array.from(a[de]("input")).map((e=>e.value));t.some(Boolean)&&(e.wrapStart=e=>`(dropdown: ${e.variable?`2bind ${e.variable},`:""}${t.map((e=>oe(e)))})`,e.wrapEnd=e.innerText="",e.valid=!0)}}],[new Text("Create a checkbox."),el("<br>"),{type:"inline-textarea",width:"50%",text:"Checkbox label:",placeholder:"Label text",model(e,a){const t=a[he]("input").value||"";t&&(e.wrapStart=e=>`(checkbox: ${e.variable?`2bind ${e.variable},`:""}${oe(t)})`,e.wrapEnd=e.innerText="",e.valid=!0),e.needsVariable=!0}}],[new Text("Show a dialog box."),el("<br>"),el("<div>This dialog box will appear as soon as the macro is displayed. This is best used inside a hook that's only shown if a condition is met.</div>"),{type:"textarea",width:"80%",text:"Text:",placeholder:"Your text here",model(e,a){const t=a[he]("input").value||"";e.wrapStart=e=>`(dialog: ${e.variable?`bind ${e.variable},`:""}${oe(t)}, ${e.links.map((e=>oe(e)))})`,e.wrapEnd=e.innerText=""}},{type:"inline-text",text:"Link options:"},{type:"textarea-rows",nonZeroRows:!0,placeholder:"Link text (can't be blank)",model(e,a){const t=Array.from(a[de]("input")).map((e=>e.value));t.every(Boolean)&&(e.links=t,e.valid=!0)}}]]},{type:"checkboxrow",text:"",update(e,a){const t=a[he]("input");e.needsVariable?(t.setAttribute("disabled","true"),t.checked=!0):t.removeAttribute("disabled")},model(e,a){e.needsVariable&&!a[he]("input:checked")&&(e.valid=!1)},subrow:[{type:"inline-dropdown",text:"Bind this input element to the variable",options:["$","_"],model(e,a){e.variable=a[he]("select").value?"_":"$"}},{type:"inline-textarea",width:"25%",text:"",placeholder:"Variable name",model(e,a){const t=a[he]("input").value;t&&RegExp(`^${I.validPropertyName}$`).exec(t)&&!RegExp(/^\d/).exec(t)?e.variable+=t:e.valid=!1}}]},{type:"confirm"}),prefs:folddownPanel({type:"text",text:'<b style="font-size:1rem;height:var(--control-height);display:block;padding:var(--grid-size)">Harlowe editor toolbar preferences</b>'},{type:"checkboxes",name:"Show text completion tooltips when you type:",capitalise:!0,bold:!1,options:["macro names","keywords"],checked:e=>!1!==getPrefs()[e?"completionsForKeywords":"completionsForMacros"],update(e,a){const[t,r]=a[de]("[type=checkbox]");t.checked=!1!==getPrefs().completionsForMacros,r.checked=!1!==getPrefs().completionsForKeywords},model(e,a){const[t,r]=a[de]("[type=checkbox]");setPref("completionsForMacros",t.checked),setPref("completionsForKeywords",r.checked)}},{type:"checkboxes",name:"Other preferences:",capitalise:!1,bold:!1,bottomBorder:!1,options:["Macro code uses the Code Editor Font instead of the Passage Editor Font"],checked:e=>!1!==getPrefs()[e?"":"codeUsesCodeFont"],update(e,a){const[t]=a[de]("[type=checkbox]");t.checked=!1!==getPrefs().codeUsesCodeFont},model(e,a){const[t]=a[de]("[type=checkbox]");setPref("codeUsesCodeFont",t.checked)}},doneRow()),macro:folddownPanel({type:"text",text:"<b>Macros</b> are code used for programming and styling your story. The vast majority of Harlowe's features are available through macros.<br>All of the built-in Harlowe macros are listed here. For more details, click their signatures to open the documentation."},{type:"macro-list",model(e,a){const t=a[he]("input:checked");t&&(e.wrapStart=`(${t.value}:`,e.wrapEnd=")",e.innerText="Your Code Here",e.valid=!0)}},{type:"confirm"}),find:(()=>{let updateButton=(e,a)=>a.setAttribute("style",!e.query||e.matches<=0?X:"");return folddownPanel({type:"scroll-wrapper",contents:[el('<div><span style="width:50%;display:inline-block;margin-left:0.5rem">Find in This Passage</span><span style="display:inline-block;">Replace With</span></div>'),{type:"inline-textarea",multiline:!0,width:"calc(50% - 1rem)",text:"",placeholder:"",persist:!0,model(e,a){e.query=a[he]("textarea").value}},{type:"inline-textarea",multiline:!0,width:"calc(50% - 1rem)",text:"",placeholder:"",persist:!0},el("<br>"),{type:"buttons",buttons:[{title:"Previous Result",html:'<b style="font-size:150%">↑</b>',onClick:()=>ie.constructor.signal(ie,"harlowe-4-findNext",-1),update:updateButton},{title:"Next Result",html:'<b style="font-size:150%">↓</b>',onClick:()=>ie.constructor.signal(ie,"harlowe-4-findNext",1),update:updateButton}]},{type:"inline-dropdown",text:"",options:["Everywhere","Only in prose","Only in code","Only in selection"],persist:!0,model(e,a){e.onlyIn=a[he]("select").value}},{type:"inline-checkbox",text:"Match Case&nbsp;",persist:!0,model(e,a){e.matchCase=a?.[he]("input").checked,ie.constructor.signal(ie,"harlowe-4-find",e)}},{type:"inline-checkbox",text:"Use Regular Expressions",persist:!0,model(e,a){e.useRegExp=a?.[he]("input").checked,ie.constructor.signal(ie,"harlowe-4-find",e)}},el("<br>"),{type:"text",text:"",update(e,a){a.innerHTML=e.useRegExp?'You can use <code>$1</code>, <code>$2</code>, <code>$3</code>, etc. in the "Replace With" text to access capturing groups.':""}},{type:"buttons",buttons:[{title:"Replace",html:"Replace",onClick:({target:e})=>ie.constructor.signal(ie,"harlowe-4-replace",e.parentNode.childNodes[2].lastChild.value,!1),update:updateButton},{title:"Replace All",html:"Replace All",danger:!0,onClick:({target:e})=>ie.constructor.signal(ie,"harlowe-4-replace",e.parentNode.childNodes[2].lastChild.value,!0),update:updateButton}]},{type:"text",text:"",update:function update(e,a){e.query&&e.matches>0?(a.textContent=`${e.matchIndex+1} of ${e.matches} result${1!==e.matches?"s":""}`,a.setAttribute("style","display:inline-block; margin-left:calc(var(--grid-size) * 2);")):(a.textContent="",a.setAttribute("style","display:none")),e.updateResultsDisplay||=()=>update(e,a)}}]},doneRow())})(),default:G?folddownPanel({type:"buttons",buttons:[{title:"Bold",html:"<div style='font-family:serif;font-weight:bold'>B</div>",onClick:()=>wrapSelection("''","''","Bold Text")},{title:"Italic",html:"<div style='font-family:serif;font-style:italic'>I</div>",onClick:()=>wrapSelection("//","//","Italic Text")},{title:"Strikethrough",html:"<div style='font-family:serif;text-decoration:line-through'>S</div>",onClick:()=>wrapSelection("~~","~~","Strikethrough Text")},{title:"Superscript",html:"<div style='font-family:serif'>X<sup>2</sup></div>",onClick:()=>wrapSelection("^^","^^","Superscript Text")},{title:"Text and background colour",html:"<div class='harlowe-4-bgColourButton'>",onClick:()=>switchPanel("textcolor")},{title:"Borders",html:fontIcon("border-style"),onClick:()=>switchPanel("borders")},{title:"Rotated text",html:'<div style="transform:rotate(-30deg);font-family:serif;font-weight:bold">R</div>',onClick:()=>switchPanel("rotate")},{title:"Special text style",html:"Styles…",onClick:()=>switchPanel("textstyle")},el('<span class="harlowe-4-toolbarBullet">'),{title:"Heading",html:"<div style='font-family:serif;font-weight:bold'>H</div>",onClick:()=>wrapSelection("\n#","","Heading Text")},{title:"Bulleted list item",html:fontIcon("list-ul"),onClick:()=>wrapSelection("\n* ","")},{title:"Numbered list item",html:fontIcon("list-ol"),onClick:()=>wrapSelection("\n0. ","")},{title:"Horizontal rule",html:"<b>—</b>",onClick:()=>wrapSelection("\n---\n","")},{title:"Alignment",html:fontIcon("align-right"),onClick:()=>switchPanel("align")},{title:"Columns",html:fontIcon("columns"),onClick:()=>switchPanel("columns")},el('<span class="harlowe-4-toolbarBullet">'),{title:"Collapse whitespace (in-game)",html:"<b>{}</b>",onClick:()=>switchPanel("collapse")},{title:"Verbatim (ignore all markup)",html:"Vb",onClick(){const e=(ie.doc.getSelection().match(/`+/g)||[]).reduce(((e,a)=>Math.max(a.length,e)),0);wrapSelection("`".repeat(e+1),"`".repeat(e+1),"Verbatim Text")}},{title:"Comments",html:"<b>--[</b>",onClick:()=>wrapSelection("--[","]","Comment Hook (ignore all contents)")},el('<span class="harlowe-4-toolbarBullet">'),{title:"Link element",html:"Link…",onClick:()=>switchPanel("passagelink")},{title:"Only show a portion of text if a condition is met",html:"If…",onClick:()=>switchPanel("if")},{title:"Input element",html:"Input…",onClick:()=>switchPanel("input")},{title:"Hook (named section of the passage)",html:"Hook…",onClick:()=>switchPanel("hook")},{title:"Set a variable with a data value",html:"Var…",onClick:()=>switchPanel("basicValue")},{title:"Peruse a list of all built-in macros",html:"Macro…",onClick:()=>switchPanel("macro")},el('<span class="harlowe-4-toolbarBullet">'),{title:"Proofreading view (dim all code except strings)",html:fontIcon("eye"),onClick:({target:e})=>{ie.display.wrapper.classList.toggle("harlowe-4-hideCode"),"svg"===e.tagName.toLowerCase()&&(e=e.parentNode),e.classList.toggle("active")}},{title:"Coding tooltips (show a tooltip when the cursor rests on code structures)",html:fontIcon("comment"),active:!0,onClick:({target:e})=>{ie.display.wrapper.classList.toggle("harlowe-4-hideHelpTooltip"),"svg"===e.tagName.toLowerCase()&&(e=e.parentNode),e.classList.toggle("active")}},el('<span class="harlowe-4-toolbarBullet">'),{title:"Find and replace",html:fontIcon("search"),onClick:()=>{switchPanel("find");const e=ie.doc.getSelection(),a=document[he](".harlowe-4-toolbarPanel textarea");a&&(a.focus(),e&&(a.value=e,a.dispatchEvent(new Event("input"))))}},{title:"Open the Harlowe documentation",html:"<div style='font-weight:bold'>?</div>",onClick:()=>window.open("https://twine2.neocities.org/","Harlowe Documentation","noopener,noreferrer")},(()=>{const e=el(`<button style="position:absolute;right:0em;margin-top:-2em">${fontIcon("chevron-up")}</button>`);return e[me]("click",(()=>{pe.classList.toggle("harlowe-4-minimised");const a=e.firstElementChild?.classList;a?.toggle("fa-chevron-down"),a?.toggle("fa-chevron-up")})),e})()]}):folddownPanel()},switchPanel();const fe="data:image/svg+xml,",svgURI=e=>`${fe}${window.escape(`<svg viewBox='0 0 14 14' width='80' height='80' xmlns='http://www.w3.org/2000/svg'>${e}</svg>`)}`,t24Icon=(e,a,t,r)=>svgURI(`<text y='${a}' x='${e}' fill='currentColor' style='/*harlowe-4*/${t}'>${r}</text>`),fontIconURI=e=>`${fe}${window.escape(fontIcon(e))}`,we=navigator.userAgent.includes("Macintosh")?"Cmd-":"Ctrl-",ke={},ve={name:"harlowe-4-keymap",[`${we}G`](){"parentNode"in le.find&&le.find.parentNode&&ie.constructor.signal(ie,"harlowe-4-findNext",1)},[`Shift-${we}G`](){"parentNode"in le.find&&le.find.parentNode&&ie.constructor.signal(ie,"harlowe-4-findNext",-1)},[`${we}H`](){if("parentNode"in le.find&&le.find.parentNode){const e=le.find[de]("textarea")[1];ie.constructor.signal(ie,"harlowe-4-replace",e.value,!1)}else switchPanel("find")}};let xe,Te;const $e=navigator.userAgent.includes("Macintosh")?"⌘":"Ctrl+",Ce=G?[]:[{type:"menu",label:"Styles",iconOnly:!0,icon:svgURI("<text y='11' x='-3' fill='currentColor' style='/*harlowe-4*/font-weight:bold;font-size:80%'>B</text><text y='8' x='4' fill='currentColor' style='/*harlowe-4*/font-style:italic;font-size:80%'>I</text><text y='13' x='7' fill='currentColor' style='/*harlowe-4*/text-decoration:line-through;font-size:80%'>S</text>").replace("%2780%27","%27108%27"),items:[{type:"button",key:`${we}B`,command(){wrapSelection("''","''","Bold Text")},label:`Bold [${$e}B]`},{type:"button",key:`${we}I`,command(){wrapSelection("//","//","Italic Text")},label:`Italic [${$e}I]`},{type:"button",key:`${we}-`,command(){wrapSelection("~~","~~","Strikethrough Text")},label:`Strikethrough [${$e}-]`},{type:"button",key:`${we}.`,command(){wrapSelection("^^","^^","Superscript Text")},label:`Superscript [${$e}.]`},{type:"separator"},{type:"button",command(){switchPanel("textstyle")},label:"More Styles…"}]},{type:"button",command(){switchPanel("textcolor")},label:"Colours",iconOnly:!0,icon:svgURI('<defs><linearGradient id="X"><stop offset="0%" stop-color="hsla(0,100%,50%,0.5)"/><stop offset="16%" stop-color="hsla(30,100%,50%,0.5)"/><stop offset="33%" stop-color="hsla(60,100%,50%,0.5)"/><stop offset="50%" stop-color="hsla(120,100%,50%,0.5)"/><stop offset="66%" stop-color="hsla(180,100%,50%,0.5)"/><stop offset="83%" stop-color="hsla(240,100%,50%,0.5)"/><stop offset="100%" stop-color="hsla(320,100%,50%,0.5)"/></linearGradient></defs><circle cx="8" cy="8" r="6" fill="url(\'#X\')"/>')},{type:"button",command(){switchPanel("borders")},label:"Borders",iconOnly:!0,icon:fontIconURI("border-style")},{type:"button",command(){switchPanel("rotate")},label:"Rotated text",iconOnly:!0,icon:t24Icon(-3,14,"transform:rotate(-30deg);font-family:serif;","R")},{type:"menu",icon:fontIconURI("list-ul"),label:"List and line items",iconOnly:!0,items:[{type:"button",command(){wrapSelection("\n* ","")},label:"Bulleted List Item"},{type:"button",command(){wrapSelection("\n0. ","")},label:"Numbered List Item"},{type:"separator"},{type:"button",command(){wrapSelection("\n#","","Heading Text")},label:"Heading"},{type:"button",command(){wrapSelection("\n---\n","")},label:"Horizontal Rule"}]},{type:"menu",icon:fontIconURI("align-center"),label:"Alignment and columns",iconOnly:!0,items:[{type:"button",command(){switchPanel("align")},label:"Alignment"},{type:"button",command(){switchPanel("columns")},label:"Columns"}]},{type:"button",command(){switchPanel("collapse")},label:"Collapse Whitespace (In-Game)",iconOnly:!0,icon:t24Icon(0,10,"font-weight:bold;font-size:12px","{ }")},{type:"button",command(){const e=(ie.doc.getSelection().match(/`+/g)||[]).reduce(((e,a)=>Math.max(a.length,e)),0);wrapSelection("`".repeat(e+1),"`".repeat(e+1),"Verbatim Text")},label:"Verbatim (Ignore All Markup Inside)",iconOnly:!0,icon:t24Icon(1,12,"font-size:11px","Vb")},{type:"button",command(){wrapSelection("--[","--","Comment Text")},label:"Comment Hook (Ignore All Contents)",iconOnly:!0,icon:t24Icon(-1,11,"font-weight:bold;font-size:13px","--[")},{type:"menu",label:"(Macro:)",items:[{type:"button",command(){switchPanel("passagelink")},label:"Link…",icon:""},{type:"button",command(){switchPanel("if")},label:"If…",icon:""},{type:"button",command(){switchPanel("input")},label:"Input…",icon:""},{type:"button",command(){switchPanel("hook")},label:"Hook…",icon:""},{type:"button",command(){switchPanel("basicValue")},label:"Value…",icon:""},{type:"separator"},{type:"button",command(){switchPanel("macro")},label:"List All Macros…",icon:""}]},xe={type:"button",command(){ie.display.wrapper.classList.toggle("harlowe-4-hideCode"),ie.constructor.signal(ie,"cursorActivity")},label:"Proofreading View (dim all code except strings)",iconOnly:!0,icon:fontIconURI("eye")},Te={type:"button",command(){const{wrapper:e}=ie.display;e.classList.toggle("harlowe-4-hideHelpTooltip"),e.classList.toggle("harlowe-4-showHelpTooltip"),ce=e.classList.contains("harlowe-4-showHelpTooltip"),setPref("tooltips",ce),ie.constructor.signal(ie,"cursorActivity")},label:"Coding Tooltips (when the cursor rests on code structures)",iconOnly:!0,icon:fontIconURI("comment")},{type:"button",key:`${we}F`,command(){switchPanel("find");const e=ie.doc.getSelection(),a=le.find[he](".harlowe-4-toolbarPanel textarea");a&&(a.focus(),e&&(a.value=e,a.dispatchEvent(new Event("input"))))},label:`Find and Replace [${$e}F]`,iconOnly:!0,icon:fontIconURI("search")},{type:"button",command(){window.open("https://twine2.neocities.org/","Harlowe Documentation","noopener,noreferrer")},label:"Show Manual (opens a new tab)",iconOnly:!0,icon:t24Icon(3,14,"font-weight:bold;font-size:19px;","?")},{type:"button",command(){switchPanel("prefs")},label:"Editor Preferences",iconOnly:!0,icon:fontIconURI("gear")}].map((function recur(e,a){if("button"===e.type){const{command:t}=e;ke[a]=e=>{ie=e,t()},e.key&&(ve[e.key]=t),e.command=`${a}`}return"menu"===e.type&&(e.items=e.items.map(((e,t)=>recur(e,`${a}.${t}`)))),e}));function Toolbar(e,{foregroundColor:a}){const t=document[de](".story-format-toolbar"),r=t[t.length-1]||document[he](".editor .passageTags");return r&&r.nextElementSibling!==pe&&r[G?"after":"before"](pe),ie=e,G||(ie.addKeyMap(ve),ie.display.wrapper.className.match(/harlowe-4-....HelpTooltip/)||ie.display.wrapper.classList.toggle(`harlowe-4-${ce?"show":"hide"}HelpTooltip`)),Ce.forEach((e=>{let t=a;(e===xe&&ie.display.wrapper.classList.contains("harlowe-4-hideCode")||e===Te&&!ie.display.wrapper.classList.contains("harlowe-4-hideHelpTooltip"))&&(t="#0a60c2"),e.icon&&=e.icon.replace(/fill%3D%27[^']+?%27/g,`fill%3D%27${window.escape(t)}%27`)})),Ce}const docsURL=(e,a)=>`<a href="https://twine2.neocities.org/#${e}" target="_blank" rel="noopener noreferrer">${a}</a>`,Se="This markup gives the enclosed text ",producesBooleanTrueIf=e=>`The <b>"${e}" operator</b> produces the boolean value \`true\` if `,Ne=" Otherwise, it produces `false`.",Ae="If they contain strings, numbers, commands or changers, you can place them directly in your prose to display the value, run the command, or apply the changer.",lambdaClause=e=>`The keyword <b>"${e}"</b> makes the code on the right into a <b>"${e}" lambda clause</b>. `,specialHookName=(e,a)=>`<br><br>Additionally, because it uses the special name "\`${e}\`", it also refers to <b>${a}</b>, and can be used to apply changers to ${a}.`,_e="Only matches ",insideMacro=e=>e.reduce(((e,a)=>void 0===e?"macro"===a.type||"hook"!==a.type&&e:e),void 0),Oe={num:`${_e}numbers.`,str:`${_e}strings.`,bool:`${_e}booleans.`,array:`${_e}arrays.`,dm:`${_e}datamaps.`,ds:`${_e}datasets.`,command:`${_e}commands.`,changer:`${_e}changers.`,color:`${_e}colours.`,gradient:`${_e}gradients.`,lambda:`${_e}lambdas.`,macro:`${_e}custom macros.`,datatype:`${_e}other datatypes.`,codehook:`${_e}code hooks.`,even:`${_e}even numbers.`,odd:`${_e}odd numbers.`,int:`${_e}whole numbers (numbers with no fractional component, and which are positive or negative).`,empty:`${_e}these empty structures: <code>""</code> (the empty string), <code>(a:)</code>, <code>(dm:)</code> and <code>(ds:)</code>.`,whitespace:`${_e}a single character of whitespace (spaces, newlines, and other kinds of space).`,lowercase:`${_e}a single lowercase character. Lowercase characters are characters that change when put through <code>(uppercase:)</code>.`,uppercase:`${_e}a single uppercase character. Uppercase characters are characters that change when put through <code>(lowercase:)</code>.`,anycase:"This matches any character which is case-sensitive - that is, where its <code>(lowercase:)</code> form doesn't match its <code>(uppercase:)</code> form.",alnum:`${_e}a single alphanumeric character (letters and numbers).`,digit:`${_e}a string consisting of exactly one of the characters '0', '1', '2', '3', '4', '5', '6', '7', '8', and '9'.`,newline:`${_e}a line break character (also known as a "newline" character).`,const:"Matches nothing; Use this only with <code>(set:)</code> to make constants.",any:"Matches anything; Use this with <code>(macro:)</code> to make variables that accept any storable type, or with <code>(set:)</code> inside data structure patterns."};Object.assign(Oe,{number:Oe.num,string:Oe.str,boolean:Oe.bool,datamap:Oe.dm,dataset:Oe.ds,colour:Oe.color,integer:Oe.int,alphanumeric:Oe.alnum,linebreak:Oe.newline});const He={hr:"This is a <b>horizontal rule</b>. It extends across the entire passage width (or the column width, if it's in a column).",bulleted:"The `*` at the start of this line makes this a <b>bulleted list item</b>.",numbered:"The `0.` at the start of this line makes this a <b>numbered list item</b>.",heading:({depth:e})=>`This is a <b>level ${e} ${1===e?"(largest) ":""}heading</b> mark.`,align:({align:e})=>`This is an <b>aligner</b> mark. The text after this is ${"justify"===e?"justified (spaced out to touch both edges)":`aligned to the ${e}`}. Write \`<==\` for left alignment, \`==>\` for right alignment, \`=><=\` for centering, and \`<==>\` for justified alignment.`,column:({text:e,width:a,marginRight:t,marginLeft:r})=>e.trim().startsWith("|")&&e.trim().endsWith("|")?"This mark ends all of the preceding columns. The text after this is not in a column.":`The text after this mark is in a <b>column</b> with width multiplier ${a}x, a left margin of ${r}em, and a right margin of ${t}em. Write more consecutive \`|\` marks to increase the width, and place \`=\` to the left and right to increase the margin on that side.`,em:`${Se}<b>emphasis style</b>. This is visually the same as italic style by default.`,strong:`${Se}<b>strong emphasis style</b>. This is visually the same as bold style by default.`,bold:`${Se}<b>bold style</b>.`,italic:`${Se}<b>italic style</b>.`,strike:`${Se}<b>strikethrough style</b>.`,sup:`${Se}<b>superscript style</b>.`,comment:'This is a <b>comment</b>. Whatever is just to the right of the `--` is being ignored ("commented out") by Harlowe. If that is a hook or a macro call, then its entire contents is ignored. Use comments to add private notes and marginalia to a passage, or remove macro calls or code elements for testing purposes.',htmlComment:"This is a <b>HTML comment</b>. Everything inside it will be ignored by Harlowe.",scriptStyleTag:()=>He.tag,tag:"This is a <b>HTML tag</b>. Harlowe supports raw HTML in passage code.",hook:({type:e,name:a,tagPosition:t},r)=>"hook"===e&&insideMacro(r.slice(1))?"These square brackets and their contents are a <b>code hook</b>, a hook that's being used as a data value inside a macro call.<br><br>Think of code hooks as being similar to strings, but with syntax highlighting of their contents in this editor. If you want to store some text inside a variable and print it later, for instance, a code hook is usually more suitable than a string.":`${"hook"===e?"These square brackets and their contents are a <b>hook</b>, enclosing this section of passage markup.":""} Changer values can be attached to the left of hooks.${a?`<br>This hook has a <b>nametag</b> on the ${"prepended"===t?"left":"right"}. This allows the hook to be referred to in macro calls using the hook name <code>?${a}</code>.`:""}`,unclosedHook:(e,a)=>`This marks all of the remaining code in the passage as being inside a <b>hook</b>.${He.hook(e,a)}`,verbatim:"This is <b>verbatim markup</b>. Place text between matching pairs and amounts of <code>`</code> marks, and Harlowe will ignore the markup within, instead displaying it as-is.",unclosedCollapsed:e=>He.collapsed(e),collapsed:({type:e})=>`This is <b>${"unclosedCollapsed"===e?"unclosed ":""}collapsed whitespace</b> markup. All sequences of consecutive whitespace within ${"unclosedCollapsed"===e?"the remainder of the passage ":"the <code>{</code> and <code>}</code> marks"} will be replaced with a single space. You can use this to space out your code and keep your passage readable.<br>To include a line break within this markup that will be preserved, use a HTML <code>&lt;br&gt;</code> tag.`,escapedLine:"This is an <b>escaped line break</b> mark. This removes the line break before or after it from the displayed passage.",twineLink:({passage:e})=>`This is a <b>link to the passage "${e}"</b>. Links, like hooks and commands, can have changer values attached to the left.`,br:"",url:"",variable:`This is a <b>story-wide variable</b>. After this has been set to a data value, it can be used anywhere else in the story. Use these to store data values related to your story's game state, or changers that are commonly used. ${Ae}`,tempVariable:`This is a <b>temp variable</b>. It can only be used in the same passage and hook (plus any nested hooks therein) in which it's first set to a data value. Use these to store values temporarily, or that won't be needed elsewhere. ${Ae}`,macroName:(e,[,a])=>He.macro(a),grouping:"Use these <b>grouping brackets</b> to ensure operations are performed in a certain order. Code in brackets will be computed before the code adjacent to it.",property:({type:e,name:a})=>(a?`This retrieves the data stored at <b>the \`${a}\` ${a.match(/^\d+(?:th|nd|st|rd)(?:last)?(?:to\d+(?:nth|nd|st|rd)(?:last)?)?$/g)?"position"+(a.includes("to")?"s":""):"name"}</b> of the container value on the ${e.startsWith("belonging")?"right":"left"}.<br><br>`:"")+"Some types of data values (arrays, datamaps, datasets, strings, colours, gradients, custom macros, and typedvars) are also storage containers for other values. You can access a specific value stored in them using that value's <b>data name</b> (or a string, number, or array value in brackets) by writing <i>value</i> `'s` <i>name</i>, or <i>name</i> `of` <i>value</i>.",possessiveOperator:e=>He.property(e),itsProperty:e=>He.property(e),itsOperator:e=>He.identifier(e),belongingItProperty:e=>He.property(e),belongingItOperator:e=>He.property(e),belongingProperty:e=>He.property(e),belongingOperator:e=>He.property(e),escapedStringChar:"",string:'This is <b>string data</b>. Strings are sequences of text data enclosed in matching " or \' marks. Use a `\\` inside a string to "escape" the next character. Escaped " or \' marks don\'t count as the end of the string.<br><br>If a string matches a passage name, it will be <span class="cm-harlowe-4-passageString">underlined</span>. If it matches a tag name, it will be <span class="cm-harlowe-4-tagString">dotted</span>.',hookName:({name:e})=>`This <b>hook name</b> refers to all hooks named "\`${e=e.toLowerCase()}\`" in this passage.${"page"===e?specialHookName("page","the entire HTML page"):"passage"===e?specialHookName("passage","the entire passage"):"link"===e?specialHookName("link","every link in the passage"):"sidebar"===e?specialHookName("sidebar","the sidebar"):""}`,cssMeasure:({value:e,unit:a})=>"ms"===a||"s"===a?`This is <b>number data</b> in CSS time format. Harlowe automatically converts this to a number of milliseconds, so this is identical to ${e}.`:"This is <b>measurement data</b>, representing a CSS measurement of distance. It consists of a number immediately followed by a unit suffix. Certain Harlowe macros use these to decide how to position or size certain elements.",datatype:({text:e})=>(e=e.toLowerCase(),`This is the name of a <b>datatype</b>. Use these names to check what kind of data a data value is, using the \`matches\` or \`is a\` operators.<br>You can also use them in a \`(set:)\` or \`(put:)\` to restrict that variable's data for error-checking purposes. (See ${docsURL("type_datatype","the documentation")} for details.)${e in Oe?`<code class='harlowe-4-tooltipMacroSignature cm-harlowe-4-datatype'>${e}</code>${Oe[e]}`:""}`),colour:({text:e})=>"This is a "+(e.startsWith("#")?"<b>HTML colour value</b>. Harlowe can use this as colour data.":"built-in Harlowe <b>colour value</b>. The built-in colours are `red`, `orange`, `yellow`, `lime`, `green`, `cyan` (alias `aqua`), `blue`, `navy`, `purple`, `fuchsia` (alias `magenta`), `white`, `gray` (alias `grey`), `black`, and `transparent`."),number:"This is <b>number data</b>. Harlowe supports whole numbers (like `2`), negative numbers (like `-2`), and numbers with a decimal fraction component (like `2.2`).",inequality:({operator:e,negate:a})=>{const t=`${(e=a?{">":"<=","<":">=",">=":"<","<=":">"}[e]:e).startsWith(">")?"greater ":"less "}than${e.endsWith("=")?" or equal to":""}`;return`${producesBooleanTrueIf(t)} the number value on the left is ${t} the number value on the right.${Ne}`},identifier:({text:e})=>(e=insensitiveName(e)).startsWith("it")?"The keyword <b>it</b> is a shorthand for the leftmost part of an operation. You can write `(if: $candles < 2 and it > 5)` instead of `(if: $candles < 2 and $candles > 5)` or `(set: $candles to it + 3)` instead of `(set: $candles to $candles + 3)`. When accessing a data value from it, you can write it as <b>its</b>, such as in `its length > 0`.":"time"===e?"The keyword <b>time</b> equals the number of milliseconds passed since the passage was displayed.":e.startsWith("exit")?'The keyword <b>exits</b> or <b>exit</b> equals the number of currently available "exits" in a passage - the number of link, mouseover, and mouseout elements that are still active on the page, which could lead to new content and progress.':e.startsWith("user")?'The keyword <b>user</b> equals a datamap containing information about the player\'s browser preferences. `user\'s width` is the width of the browser window in pixels, `user\'s height` is its height, `user\'s orientation` is either `"portrait"` or `"landscape"`, `user\'s motion` is either `"any"` or `"reduced"`, `"contrast"` is either `"any"`, `"more"` or `"less"`, and `user\'s hover` is  `true` if their device supports hovering, and `false` otherwise.':e.startsWith("visit")?"The keyword <b>visits</b> or <b>visit</b> equals the number of times the current passage has been visited this game, including the current visit. In `(storylet:)` macros, when Harlowe decides whether this passage is available to `(open-storylets:)`, this will often be 0, but when actually visiting the passage, it will be at least 1.":"pos"===e?'The keyword <b>pos</b> should ONLY be used within a "where" or "via" lambda clause. It refers to the position of the current data value that this lambda is processing.':"",whitespace:"<b>Whitespace</b> within macro calls is simply used to separate syntax elements. You can use as much or as little as you like to make your code more readable.",error:(e,[{message:a,explanation:t}])=>a+(t?`<br>${t}`:""),boolean:"The keywords <b>true</b> or <b>false</b> are the two <b>boolean values</b>. They are produced by comparison operators (`<`, `>`, `is`, etc.) and other macros.",is:`The <b>"is" operator</b> produces the boolean value \`true\` if the values on each sides of it are exactly the same.${Ne}`,to:'Use the <b>"to" operator</b> only inside a `(set:)` macro call. Place it to the left of the data, and right of the variable to set the data to.',into:'Use the <b>"into" operator</b> only inside a `(put:)`, `(move:)` or `(unpack:)` macro call. Place it to the right of the data, and left of the destination to put the data.',where:`${lambdaClause("where")}This lambda will search for input values <i>where</i> the right side, once computed, produces \`true\`.`,when:`${lambdaClause("when")}This lambda will cause the macro (if it accepts "when" lambdas) to only do something <i>when</i> the right side, once computed, produces \`true\`.`,via:`${lambdaClause("via")}This lambda is used to convert input values into new values <i>via</i> computing the expression to the right.`,making:`${lambdaClause("making")}This is used only by the \`(folded:)\` macro. The lambda <i>makes</i> the temp variable on the right, which becomes the final value of the \`(folded:)\` call.`,each:`${lambdaClause("each")}This causes the macro (if it accepts lambdas) to, for <i>each</i> input value, place that value in the temp variable on the right, before running the other lambda clauses adjacent to this one (if any).`,and:`${producesBooleanTrueIf("and")}the values on each side of it are both \`true\`.${Ne}`,or:`${producesBooleanTrueIf("or")}the values on each side of it are both \`false\`.${Ne}`,not:'The <b>"not" operator</b> inverts the boolean value to its right, turning `true` to `false` and vice-versa.',isNot:`${producesBooleanTrueIf("is not")}the values on each sides of it are NOT exactly the same.${Ne}`,contains:`${producesBooleanTrueIf("contains")}the array, string, or dataset on the left contains the data on the right, or if the datamap on the left has the data name on the right.${Ne}`,doesNotContain:`${producesBooleanTrueIf("does not contain")}the array, string, or dataset on the left does NOT contain the data on the right, or if the datamap on the left does NOT have the data name on the right.${Ne}`,isIn:`${producesBooleanTrueIf("is in")}the data on the left is in the array, string, datamap or dataset on the right.${Ne}`,isA:`${producesBooleanTrueIf("is a")}the data on the left matches the datatype on the right.${Ne}`,isNotA:`${producesBooleanTrueIf("is not a")}the data on the left does NOT match the datatype on the right.${Ne}`,isNotIn:`${producesBooleanTrueIf("is not in")}the data on the left is NOT in the array, string, datamap or dataset on the right.${Ne}`,matches:`${producesBooleanTrueIf("matches")}one side describes the other - that is, if one side is a datatype that describes the other, or both sides are arrays, datamaps, or datasets, with data in positions that matches those in the other, or if both sides are equal.${Ne}`,doesNotMatch:`${producesBooleanTrueIf("does not match")}one side does NOT describe the other.${Ne}`,bind:'The <b>bind</b> or <b>2bind</b> keyword specifies that the variable to the right should be "bound" to an interactable element. This is used only by certain command macros, like `(dialog:)` or `(cycling-link:)`.',comma:"Use <b>commas</b> to separate the values that you give to macro calls.",spread:"This is a <b>spreader</b>. These spread out the values in the array, string or dataset to the right of it, as if each value was individually placed in the call and separated with commas.<br><br>Alternatively, if a datatype is to the right of it, that datatype becomes a <b>spread datatype</b> that matches zero or more of itself.",typeSignature:"The <b>-type</b> suffix is used to restrict the variable on the right to only holding data that matches the data pattern on the left. Variables restricted in this way are called <b>typed variables</b>.",addition:"Use the <b>addition operator</b> to add two numbers together, as well as join two strings or two arrays, and combine two datamaps, two datasets, two changers, or two colours. This operator can also combine two hook names, creating a hook name that applies to both sets of hooks.",subtraction:"Use the <b>subtraction operator</b> to subtract two numbers, as well as create a copy of the array or dataset on the left that doesn't contain values of the array or dataset on the right.",multiplication:"Use the <b>multiplication operator</b> to multiply two numbers.",division:({text:e})=>("/"===e?"Use the <b>division operator</b> to divide":"Use the <b>modulo operator</b> to get the remainder (modulo) from dividing")+" two numbers. Dividing a number by 0 produces an error.",macro:({name:e})=>{if(void 0===e)return"This macro call is incomplete or erroneously written. Macro calls should consist of `(`, the name (which is case-insensitive and dash-insensitive), `:`, zero or more expressions separated by commas, then `)`, in that order.";if(e.startsWith("_")||e.startsWith("$"))return`This is a <b>call to a custom macro stored in the ${e} variable</b>. Custom macros are created with the \`(macro:)\` macro, and must be stored in variables in order to be used.`;const a=j.Macro[insensitiveName(e)];if(!a)return"This is a call to a nonexistent or misspelled macro. This will cause an error.";const t=a.returnType.toLowerCase();return`This is a <b>call to the \`(${a.name}:)\` macro</b>. ${"metadata"===t?"Metadata macros like this should be placed at the very top of the passage, before all other macros.":"instant"===t||"command"===t?'It produces a <span class="cm-harlowe-4-macroName-command">command</span>, so it should appear in passage code without being connected to a hook.':"changer"===t?'It produces a <span class="cm-harlowe-4-macroName-changer">changer</span>, which can be placed to the left of a hook or a command (passage links are commands), or combined with other changers.':"any"===t||"string"===t?"":`Since it produces a <span class="cm-harlowe-4-macroName-${t}">${t}</span>, it should be nested inside another macro call that can use ${t} (or any) data, or modified with an operator like \`is\` or \`is in\`.${"array"===t||"dataset"===t?" You may also use it in a macro call which can accept any number of values, and spread its contents out using the spreader `...` syntax.":""}`}${"command"===t||"changer"===t?" You may also put it in a variable to reuse it multiple times, like other kinds of data.":""}<code class='harlowe-4-tooltipMacroSignature'>${docsURL(a.anchor,`(${a.name}: ${a.sig}) -> ${a.returnType}`)}</code>${a.aka.length?`<div><i>Also known as: ${a.aka.map((e=>`<code>(${e}:)</code>`)).join(", ")}</i>`:""}</div><div>${a.abstract}</div>`},text:({text:e},a)=>{if(e.trim()&&insideMacro(a))return"This doesn't seem to be valid code.<br>Note that inside macro calls, only other macro calls, data, operators and whitespace are permitted."}},Le=document.createElement("div");Le.className="harlowe-4-tooltip";let Me=0,Pe=0,Ie=4,Ee=0,Re=0,Fe=Object;function tooltipAppear(){Me<1?(Le.style.display="",Pe=10):(Me-=1,requestAnimationFrame(tooltipAppear))}const ze={Up(){updateTooltipMenuCursor(Math.max(0,Ee-1))},Down(){updateTooltipMenuCursor(Math.min(Re-1,Ee+1))},PageUp(){updateTooltipMenuCursor(0)},PageDown(){updateTooltipMenuCursor(Re-1)},Home(){updateTooltipMenuCursor(0)},End(){updateTooltipMenuCursor(Re-1)},Enter(){Fe(Ee)},Tab(){Fe(Ee)}};function tooltipClear(e){e.removeKeyMap(ze),Ee=0,Fe=Object,Le.setAttribute("style","display:none")}const docCursorPlus=(e,a)=>e.posFromIndex(e.indexFromPos(e.getCursor())+a);function positionTooltip(e,a,t=!1){Le.removeAttribute("style");const{width:r}=Le.getBoundingClientRect(),o=e.display.wrapper,{width:n}=o.getBoundingClientRect(),s=e.charCoords(a,"local"),i=G?30:0,l=Math.min(n-r,Math.max((0|s.left)+i-(t?r/2:0),i));Le.setAttribute("style",`left:${l}px; top:${(0|s.top)+(t?30:24)-o.querySelector(".CodeMirror-scroll").scrollTop}px;`),t&&Le.lastElementChild?.setAttribute("style",`left:${s.right-l+(G?(s.right-s.left)/2+6:-12)}px; top:-24px`),o.addEventListener("keydown",(a=>{"display:none"!==Le.getAttribute("style")&&"Escape"===a.key&&(tooltipClear(e),a.stopPropagation())}))}function makeHelpTooltip(e,a,t){if(t.display.wrapper.classList.contains("harlowe-4-hideHelpTooltip")||t.doc.somethingSelected())return!1;const[r]=e,o=e.some(((e,a,t)=>{let r=t[a+1]?.children;return"comment"===r?.[r?.indexOf(e)-1]?.type}));let n=He[o?"comment":r.type];return"function"==typeof n&&(n=n(r,e)),!!n&&(n=n.replace(/`([^`]+)`/g,((e,a)=>`<code>${a}</code>`)),Le.innerHTML=n+(Ie>0?(Ie--,`<br><br><i>Use the ${document.querySelector('[aria-label^="Coding tooltips"],[title^="Coding tooltips"]')?.innerHTML||"tooltip"} toolbar button to toggle these popups!</i>`):"")+"<div class=harlowe-4-tooltipTail>",Le.className="harlowe-4-tooltip harlowe-4-helpTooltip",positionTooltip(t,a,!0),Le.style.display="none",Me=50,!0)}const Be=Object.values(j?.Macro||{}).reduce(((e,{name:a,returnType:t,aka:r})=>e.find((e=>e.name===a))?e:e.concat({name:a,returnType:t}).concat(r.map((e=>({name:e,returnType:t}))))),[]);const We=[..."exit,exits,it,pos,time,turn,turns,visit,visits".split(",").map((e=>({name:e,type:"identifier"}))),..."where,when,each,via,making".split(",").map((e=>({name:e,type:"lambda",label:"lambda keyword"}))),..."number,num,string,str,boolean,bool,array,datamap,dm,dataset,ds,command,changer,color,colour,gradient,lambda,macro,datatype,codehook".split(",").map((e=>({name:e,type:"datatype"}))),..."even,odd,integer,int,empty,whitespace,lowercase,uppercase,anycase,alphanumeric,alnum,digit,linebreak,newline,const,any".split(",").map((e=>({name:e,type:"datatype",label:"specific datatype"}))),..."red,orange,yellow,lime,green,cyan,aqua,blue,navy,purple,fuchsia,magenta,white,gray,grey,black,transparent".split(",").map((e=>({name:e,type:"colour"}))),..."is,is not,contains,does not contain,is in,is not in,is a,is not a,matches,does not match,and,or,not".split(",").map((e=>({name:e,type:"boolean",label:"boolean operator"}))),..."to,into,bind,2bind,-type".split(",").map((e=>({name:e,type:"operator"}))),{name:"true",type:"boolean"},{name:"false",type:"boolean"}];function updateTooltipMenuCursor(e){Ee=e,Le.querySelector(".harlowe-4-tooltipItemSelected")?.classList.remove("harlowe-4-tooltipItemSelected");const a=Le.querySelectorAll(".harlowe-4-tooltipItem")[e];a&&(a.classList.add("harlowe-4-tooltipItemSelected"),a.scrollIntoView({block:"center"}))}function makeCompletion(e,a,t){const r=e[e.length-1],{doc:o}=t,n=r.text.slice(0,o.indexFromPos(o.getCursor())),s=function macroCompletion(e,a,t){if(!1===getPrefs().completionsForMacros)return;if(t.some((e=>"string"===e.type)))return;let[,r]=/\(([\w_-]+)$/.exec(a)||[];if(!r)return;const o=insensitiveName(r),n=Be.filter((({name:e})=>insensitiveName(e).startsWith(o))).sort(((e,a)=>e.name.length-a.name.length));return n.length?(Fe=a=>{e.replaceRange(`(${n[a].name}:)`,docCursorPlus(e,-(r.length+1)),e.getCursor()),e.setCursor(docCursorPlus(e,-1))},Ee=0,Re=n.length,n.map(((e,a)=>`<div class='cm-harlowe-4-macro cm-harlowe-4-root harlowe-4-tooltipItem${a?"":" harlowe-4-tooltipItemSelected"}'>(<span class="cm-harlowe-4-macroName-${e.returnType.toLowerCase()}">${e.name}</span>:)</div>`)).join("")):void 0}(o,n,e)||function keywordCompletion(e,a,t){if(!1===getPrefs().completionsForKeywords)return;if(!t.reduce(((e,a)=>void 0===e?"macro"===a.type||"hook"!==a.type&&"string"!==a.type&&e:e),void 0))return;let[,r]=/[^$\w?]([-2]?[a-zA-Z ]+)$/.exec(a)||[];if(!r||"-"===r||""===r[r.length-1].trim())return;const o=r.trimLeft().toLowerCase(),n=We.filter((({name:e})=>e.startsWith(o))).sort(((e,a)=>e.name.length-a.name.length));return n.length?(Fe=a=>{e.replaceRange(n[a].name,docCursorPlus(e,-r.length),e.getCursor())},Ee=0,Re=n.length,n.map(((e,a)=>`<div style='display:flex;justify-content:space-between' class="harlowe-4-tooltipItem${a?"":" harlowe-4-tooltipItemSelected"}"><span class='cm-harlowe-4-${e.type} cm-harlowe-4-root'>${e.name}</span><i style="display:inline-block;margin-left:2em;">${e.label||e.type}</i></div>`)).join("")):void 0}(o,n,e);if(s)return Le.innerHTML=s,Le.className="harlowe-4-tooltip harlowe-4-completion",positionTooltip(t,a,!1),Me=0,t.addKeyMap(ze),Ee=0,!0}function Tooltips(e,a){const{tree:t,lastAction:r}=a,{cm:o}=e;tooltipClear(o);const n=o.display.wrapper;Le.parentNode!==n&&(n.append(Le),n.addEventListener("mousemove",(()=>{"none"===Le.style.display||n.querySelector(".harlowe-4-tooltip:hover")?Me>0&&(Me+=1):(Pe-=1,Pe<=0&&tooltipClear(o))})));const s=e.getCursor(),i=t.pathAt(Math.min(t.text.length-1,e.indexFromPos(s)));if(!i.length)return void(Me=0);const l=Me>0;("change"===r?makeCompletion:makeHelpTooltip)(i,s,o)&&(l||tooltipAppear())}let{lex:qe}=D;const De=Object.entries(j.Macro).reduce(((e,[a,t])=>([a,...t.aka].forEach((a=>e[a]=t)),e)),{}),mode=()=>{let e,a,t;const r=new WeakMap,docData=e=>(r.has(e)||refreshTree(e),r.get(e));function lexTreePostProcess(e,r,o,n){if("variable"!==r.type&&"tempVariable"!==r.type&&"hook"!==r.type&&"hookName"!==r.type||e.referenceTokens[r.type].push(r),"string"===r.type&&(r.children=[]),"comment"===o?.type)return void(e.cssClasses[r.start]=e.cssClasses[o.start]);let s={},i="";for(let e=-1;e<n.length;e+=1){const{type:o,text:l}=-1===e?r:n[e];"verbatim"!==o&&"htmlComment"!==o||(i="");let c=`harlowe-4-${o}`;switch(s[c]=(s[c]||0)+1,s[c]>1&&(c+=`-${s[c]}`),o){case"string":{const e=l.slice(1,-1);a.has(e)?c+=" harlowe-4-passageString":t.has(e)&&(c+=" harlowe-4-tagString");break}case"text":if(l.trim()){n.slice(e+1).reduce(((e,a)=>void 0===e?"macro"===a.type||"hook"!==a.type&&e:e),void 0)&&(c+=" harlowe-4-error")}break;case"macroName":{const e=l[0];if("_"===e||"$"===e){c+=` harlowe-4-customMacro harlowe-4-${"_"===e?"tempV":"v"}ariable`;break}const a=insensitiveName(l.slice(0,-1));Object.hasOwn(De,a)?c+=`-${De[a].returnType.toLowerCase()}`:c+=" harlowe-4-error";break}}i+=`${c} `}e.cssClasses[r.start]=i,r.children?.length&&(e.cssClasses[r.children[r.children.length-1].end]=i);for(let a=0;a<r.children.length;a+=1)lexTreePostProcess(e,r.children[a],r.children[a-1],[r].concat(n))}function refreshTree(e){let a;r.has(e)?a=r.get(e):(a={tooltipsEnabled:!0,lastAction:""},r.set(e,a)),a.tree=qe(e.getValue()),a.referenceTokens={variable:[],tempVariable:[],hook:[],hookName:[]},a.cssClasses=Object.create(null),a.cursorMarks?.forEach((e=>e.clear())),a.cursorMarks=[];for(let e=0;e<a.tree.children.length;e+=1)lexTreePostProcess(a,a.tree.children[e],a.tree.children[e-1],[a.tree])}let o,n,s=[],i=-1;const l={token(e){const{line:a}=e.lineOracle,t=e.pos;for(let r=0;r<s.length;r+=1){const{start:n,end:i}=s[r];if(!(n.line>a||i.line<a)&&(n.line<=a&&i.line>=a)){if((n.line<a||n.ch<=t)&&(i.line>a||i.ch>t))return i.line>a?e.skipToEnd():e.pos=i.ch,o===r?"harlowe-4-findResultCurrent":"harlowe-4-findResult";if(n.line===a&&n.ch>t)return void(e.pos=n.ch)}}e.skipToEnd()}};function harlowe4Find(a){if(e.removeOverlay(l),s=[],o=-1,a.matches=void 0,!a.query)return void(n=void 0);n=a;const{doc:t}=e,r=i>-1?i:Math.max(0,t.indexFromPos(t.getCursor())-1);try{a.regExp=new RegExp(a.useRegExp?a.query:a.query.replace(/[-[\]/{}()*+?.\\^$|]/gm,"\\$&"),a.matchCase?"g":"gi")}catch(e){return void(n=void 0)}const c=t.getValue(),h=docData(t).tree,{onlyIn:d}=a;let m;e:for(;m=a.regExp.exec(c);){const a=m[0].length;if(!a)break;const{index:n}=m,l=m.slice(1);if("Only in prose"===d||"Only in code"===d){let e=h.pathAt(n),t=e[0];for(let r=n;r<n+a;r+=1){let a;for(r>t.end&&(e=h.pathAt(r),t=e[0]),a=0;a<e.length;a+=1){const{type:t}=e[a];if("text"===t||"string"===t){if("Only in code"===d)continue e;break}}if(a===e.length&&"Only in prose"===d)continue e}}else if("Only in selection"===d){const e=t.listSelections();let r=!1;for(let o=0;o<e.length&&!r;o+=1){const s=t.indexFromPos(e[o].anchor),i=t.indexFromPos(e[o].head);n>=Math.min(s,i)&&n+a<Math.max(s,i)&&(r=!0)}if(!r)continue e}const c=t.posFromIndex(n),p=t.posFromIndex(n+a);s.push({start:c,end:p,groups:l.length?l:void 0}),-1===o&&(n>r&&(o=s.length-1),i||e.scrollIntoView(c,e.display.wrapper.offsetHeight/2))}-1===o&&(o=0),e.addOverlay(l),a.matches=s.length,a.matchIndex=o,a.updateResultsDisplay?.(),i=-1}function harlowe4FindNext(a){o=(o+a)%s.length,o<0&&(o+=s.length),s[o]&&e.scrollIntoView(s[o].start,e.display.wrapper.offsetHeight/2),e.removeOverlay(l),e.addOverlay(l),n.matchIndex=o,n.updateResultsDisplay?.()}function harlowe4Replace(a,t){const{doc:r}=e,l=s[o];if(!t&&l)l.groups?.length&&(a=a.replace(/\$(\d+)/g,((e,a)=>l.groups[+a-1]||`$${a}`))),i=r.indexFromPos(l.start)+a.length-1,r.replaceRange(a,l.start,l.end);else if(s.length){const e=s[0].start,t=s[s.length-1].end;r.replaceRange(r.getValue().slice(r.indexFromPos(e),r.indexFromPos(t)).replace(n.regExp,a),e,t)}}const on=(e,a,t)=>(!e._handlers||!(e._handlers[a]||[]).some((e=>e.name===t.name)))&&e.on(a,t);let init=r=>{e||(e=r.cm,window===this&&(e.setOption("lineNumbers",!0),e.setOption("lineNumberFormatter",(()=>"•")))),G&&Toolbar?.(e,{foregroundColor:"#888"}),(()=>{let e;a=new Set,t=new Set;try{e=localStorage.getItem("twine-stories").split(",")}catch(e){return}let r,o=0;for(let a of e)try{const e=JSON.parse(localStorage.getItem(`twine-stories-${a}`)),t=Date.parse(e.lastUpdate);t>o&&document.title.includes(e.name)&&(r=e,o=t)}catch(e){continue}if(r)try{for(let e of localStorage.getItem("twine-passages")?.split(",")||[]){let o=JSON.parse(localStorage.getItem(`twine-passages-${e}`));if(o.story===r.id){a.add(o.name);for(let e of o.tags)t.add(e)}}}catch(e){return}})(),setOptionalStyles(getPrefs()),refreshTree(r),on(r,"beforeChange",(function harlowe4beforeChange(e,a){if(!r.cm.display.wrapper.parentNode)return;!function forceFullChange(e,a){if(!e.update)return;const t=e.from.line;let r=a.split("\n").slice(0,e.from.line+1);return r[t]=r[t].slice(0,e.from.ch)+e.text[0],r=r.concat(e.text.slice(1)),e.update({line:0,ch:0},e.to,r),r.join("\n")}(a,r.getValue())})),on(r,"change",(function harlowe4Change(){r.cm.display.wrapper.parentNode&&(docData(r).lastAction="changing",refreshTree(r),n&&s[o]&&(-1===i&&(i=r.indexFromPos(s[o].start)-1),harlowe4Find(n)))})),on(r,"cursorActivity",(function harlowe4CursorActivity(){!function cursorMarking(e){const a=docData(e);let{tree:t,cursorMarks:r,referenceTokens:o}=a;r.length&&(r.forEach((e=>e.clear())),r=a.cursorMarks=[]);const n=t.tokenAt(e.indexFromPos(e.getCursor()));n&&(r.push(e.markText(e.posFromIndex(n.start),e.posFromIndex(n.end),{className:"cm-harlowe-4-cursor"})),("variable"===n.type||"tempVariable"===n.type||"hookName"===n.type||"hook"===n.type)&&o["hook"===n.type?"hookName":n.type].forEach((a=>{a!==n&&"name"in a&&a.name===n.name&&r.push(e.markText(e.posFromIndex(a.start),e.posFromIndex(a.end),{className:"cm-harlowe-4-variableOccurrence"}))})),"hookName"!==n.type&&"hook"!==n.type||o.hook.forEach((a=>{if(a!==n&&a.name&&a.name===n.name){const t="tagPosition"in a&&"appended"===a.tagPosition?a.end-a.name.length-1:a.start+1;r.push(e.markText(e.posFromIndex(t),e.posFromIndex(t+a.name.length),{className:"cm-harlowe-4-hookOccurrence"}))}})))}(r);const e=docData(r);e.lastAction="changing"===e.lastAction?"change":"cursorActivity",Tooltips?.(r,e)})),on(e,"renderLine",(function harlowe4RenderLine(e,a,t){Array.from(t.querySelectorAll(".cm-harlowe-4-colour")).forEach((e=>{const{colour:a}=qe(e.textContent,"","macro").tokenAt(0);e.setAttribute("style",`background:linear-gradient(to bottom,transparent,transparent 80%,${a} 80.1%,${a})`)}))})),on(e,"scroll",(function harlowe4Scroll(){const e=document.querySelector(".harlowe-4-tooltip");e?.remove()})),on(e,"harlowe-4-find",harlowe4Find),on(e,"harlowe-4-findNext",harlowe4FindNext),on(e,"harlowe-4-replace",harlowe4Replace),on(e,"harlowe-4-findDone",(function harlowe4FindDone(){e.removeOverlay(l)})),init=null};return{startState:()=>({pos:0,disconnected:null,styleBeforeNewline:""}),blankLine(e){e.pos++},token(e,a){const{doc:t}=e.lineOracle;if(null===a.disconnected?a.disconnected=!t.cm.display.wrapper.parentNode:a.disconnected)return a.pos++,e.next(),null;init?.(t);const{cssClasses:r}=docData(t),o=r[a.pos]||a.styleBeforeNewline||null;do{a.pos++,e.next()}while(!(r[a.pos]!==o&&a.pos in r||e.eol()));return e.eol()?(a.styleBeforeNewline=o,a.pos++):a.styleBeforeNewline="",o}}};"CodeMirror"in window?window.CodeMirror.defineMode("harlowe-4",mode):this.editorExtensions={twine:{2:{codeMirror:{mode,toolbar:Toolbar,commands:ke}}}};let Ve=document.querySelector("style#cm-harlowe-4");Ve||(Ve=document.createElement("style"),Ve.setAttribute("id","cm-harlowe-4"),document.head.appendChild(Ve)),Ve.innerHTML=".cm-harlowe-4-cursor:not([class^='cm-harlowe-4-verbatim']):not([class^='cm-harlowe-4-text cm-harlowe-4-root']) { border-bottom: 2px solid darkgray; }.cm-harlowe-4-findResult { background-color: hsla(280,100%,70%,0.4) !important; } .cm-harlowe-4-findResultCurrent { background-color: hsla(320,100%,70%,0.6) !important; }.cm-harlowe-4-root .cm-tab { text-decoration: line-through dotted #888; border-right: dotted 1px #888; }.CodeMirror {padding: 0 !important}.CodeMirror-linenumber {color: hsla(0,0%,80%,1.0);}.CodeMirror-gutters {left: 0px !important;}.cm-harlowe-4-root{box-sizing:border-box;}.cm-harlowe-4-hook{background-color: hsla(40,100%,50%,0.05);}.theme-dark .cm-harlowe-4-hook{background-color: hsla(40,100%,50%,0.05);}[data-app-theme=dark] .cm-harlowe-4-hook{background-color: hsla(40,100%,50%,0.05);}.cm-harlowe-4-hook-2{background-color: hsla(40,100%,50%,0.1);}.theme-dark .cm-harlowe-4-hook-2{background-color: hsla(40,100%,50%,0.1);}[data-app-theme=dark] .cm-harlowe-4-hook-2{background-color: hsla(40,100%,50%,0.1);}.cm-harlowe-4-hook-3{background-color: hsla(40,100%,50%,0.15);}.theme-dark .cm-harlowe-4-hook-3{background-color: hsla(40,100%,50%,0.15);}[data-app-theme=dark] .cm-harlowe-4-hook-3{background-color: hsla(40,100%,50%,0.15);}.cm-harlowe-4-hook-4{background-color: hsla(40,100%,50%,0.2);}.theme-dark .cm-harlowe-4-hook-4{background-color: hsla(40,100%,50%,0.2);}[data-app-theme=dark] .cm-harlowe-4-hook-4{background-color: hsla(40,100%,50%,0.2);}.cm-harlowe-4-hook-5{background-color: hsla(40,100%,50%,0.25);}.theme-dark .cm-harlowe-4-hook-5{background-color: hsla(40,100%,50%,0.25);}[data-app-theme=dark] .cm-harlowe-4-hook-5{background-color: hsla(40,100%,50%,0.25);}.cm-harlowe-4-hook-6{background-color: hsla(40,100%,50%,0.3);}.theme-dark .cm-harlowe-4-hook-6{background-color: hsla(40,100%,50%,0.3);}[data-app-theme=dark] .cm-harlowe-4-hook-6{background-color: hsla(40,100%,50%,0.3);}.cm-harlowe-4-hook-7{background-color: hsla(40,100%,50%,0.35);}.theme-dark .cm-harlowe-4-hook-7{background-color: hsla(40,100%,50%,0.35);}[data-app-theme=dark] .cm-harlowe-4-hook-7{background-color: hsla(40,100%,50%,0.35);}.cm-harlowe-4-hook-8{background-color: hsla(40,100%,50%,0.4);}.theme-dark .cm-harlowe-4-hook-8{background-color: hsla(40,100%,50%,0.4);}[data-app-theme=dark] .cm-harlowe-4-hook-8{background-color: hsla(40,100%,50%,0.4);}[class^='cm-harlowe-4-hook '], [class^='cm-harlowe-4-hook-']{font-weight:bold;}.cm-harlowe-4-unclosedHook{background-color: hsla(40,100%,50%,0.05);font-weight:bold;}.theme-dark .cm-harlowe-4-unclosedHook{background-color: hsla(40,100%,50%,0.05);font-weight:bold;}[data-app-theme=dark] .cm-harlowe-4-unclosedHook{background-color: hsla(40,100%,50%,0.05);font-weight:bold;}.cm-harlowe-4-error:not([class*='cm-harlowe-4-string']){background-color: hsla(17,100%,50%,0.5) !important;}.theme-dark .cm-harlowe-4-error:not([class*='cm-harlowe-4-string']){background-color: hsla(17,100%,50%,0.5) !important;}[data-app-theme=dark] .cm-harlowe-4-error:not([class*='cm-harlowe-4-string']){background-color: hsla(17,100%,50%,0.5) !important;}[class^='cm-harlowe-4-macroName']{font-style:italic;}.cm-harlowe-4-macroName-boolean{color:hsla(0,0%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-boolean{color:hsla(0,0%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-boolean{color:hsla(0,0%,70%,1.0)}.cm-harlowe-4-macroName-array{color:hsla(0,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-array{color:hsla(0,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-array{color:hsla(0,100%,70%,1.0)}.cm-harlowe-4-macroName-dataset{color:hsla(30,100%,40%,1.0)}.theme-dark .cm-harlowe-4-macroName-dataset{color:hsla(30,100%,60%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-dataset{color:hsla(30,100%,60%,1.0)}.cm-harlowe-4-macroName-datatype{color:hsla(220,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-datatype{color:hsla(220,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-datatype{color:hsla(220,100%,70%,1.0)}.cm-harlowe-4-macroName-number{color:hsla(30,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-number{color:hsla(30,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-number{color:hsla(30,100%,70%,1.0)}.cm-harlowe-4-macroName-datamap{color:hsla(60,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-datamap{color:hsla(60,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-datamap{color:hsla(60,100%,70%,1.0)}.cm-harlowe-4-macroName-changer{color:hsla(90,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-changer{color:hsla(90,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-changer{color:hsla(90,100%,70%,1.0)}.cm-harlowe-4-macroName-string{color:hsla(180,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-string{color:hsla(180,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-string{color:hsla(180,100%,70%,1.0)}.cm-harlowe-4-macroName-colour, .cm-harlowe-4-macroName-gradient, .cm-harlowe-4-macroName-image{color:hsla(280,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-colour, .theme-dark .cm-harlowe-4-macroName-gradient, .theme-dark .cm-harlowe-4-macroName-image{color:hsla(280,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-colour, [data-app-theme=dark] .cm-harlowe-4-macroName-gradient, [data-app-theme=dark] .cm-harlowe-4-macroName-image{color:hsla(280,100%,70%,1.0)}.cm-harlowe-4-macroName-command, .cm-harlowe-4-macroName-instant, .cm-harlowe-4-macroName-metadata{color:hsla(240,100%,20%,1.0)}.theme-dark .cm-harlowe-4-macroName-command, .theme-dark .cm-harlowe-4-macroName-instant, .theme-dark .cm-harlowe-4-macroName-metadata{color:hsla(240,100%,80%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-command, [data-app-theme=dark] .cm-harlowe-4-macroName-instant, [data-app-theme=dark] .cm-harlowe-4-macroName-metadata{color:hsla(240,100%,80%,1.0)}.cm-harlowe-4-macroName-custommacro, .cm-harlowe-4-macroName-macro, .cm-harlowe-4-macroName-any{color:hsla(320,80%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-custommacro, .theme-dark .cm-harlowe-4-macroName-macro, .theme-dark .cm-harlowe-4-macroName-any{color:hsla(320,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-custommacro, [data-app-theme=dark] .cm-harlowe-4-macroName-macro, [data-app-theme=dark] .cm-harlowe-4-macroName-any{color:hsla(320,100%,70%,1.0)}[class^='cm-harlowe-4-macro ']{font-weight:bold;color:hsla(320,80%,30%,1.0)}.theme-dark [class^='cm-harlowe-4-macro ']{font-weight:bold;color:hsla(320,100%,70%,1.0)}[data-app-theme=dark] [class^='cm-harlowe-4-macro ']{font-weight:bold;color:hsla(320,100%,70%,1.0)}.cm-harlowe-4-comma, .cm-harlowe-4-spread{color:hsla(320,80%,30%,1.0)}.theme-dark .cm-harlowe-4-comma, .theme-dark .cm-harlowe-4-spread{color:hsla(320,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-comma, [data-app-theme=dark] .cm-harlowe-4-spread{color:hsla(320,100%,70%,1.0)}.cm-harlowe-4-addition{color:hsla(320,80%,30%,1.0)}.theme-dark .cm-harlowe-4-addition{color:hsla(320,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-addition{color:hsla(320,100%,70%,1.0)}.cm-harlowe-4-subtraction, .cm-harlowe-4-multiplication, .cm-harlowe-4-division{color:hsla(30,100%,30%,1.0)}.theme-dark .cm-harlowe-4-subtraction, .theme-dark .cm-harlowe-4-multiplication, .theme-dark .cm-harlowe-4-division{color:hsla(30,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-subtraction, [data-app-theme=dark] .cm-harlowe-4-multiplication, [data-app-theme=dark] .cm-harlowe-4-division{color:hsla(30,100%,70%,1.0)}.cm-harlowe-4-is, .cm-harlowe-4-and, .cm-harlowe-4-or, .cm-harlowe-4-not, .cm-harlowe-4-isNot, .cm-harlowe-4-contains, .cm-harlowe-4-doesNotContain, .cm-harlowe-4-isIn, .cm-harlowe-4-isA, .cm-harlowe-4-isNotA, .cm-harlowe-4-isNotIn, .cm-harlowe-4-matches, .cm-harlowe-4-doesNotMatch{color:hsla(0,0%,30%,1.0)}.theme-dark .cm-harlowe-4-is, .theme-dark .cm-harlowe-4-and, .theme-dark .cm-harlowe-4-or, .theme-dark .cm-harlowe-4-not, .theme-dark .cm-harlowe-4-isNot, .theme-dark .cm-harlowe-4-contains, .theme-dark .cm-harlowe-4-doesNotContain, .theme-dark .cm-harlowe-4-isIn, .theme-dark .cm-harlowe-4-isA, .theme-dark .cm-harlowe-4-isNotA, .theme-dark .cm-harlowe-4-isNotIn, .theme-dark .cm-harlowe-4-matches, .theme-dark .cm-harlowe-4-doesNotMatch{color:hsla(0,0%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-is, [data-app-theme=dark] .cm-harlowe-4-and, [data-app-theme=dark] .cm-harlowe-4-or, [data-app-theme=dark] .cm-harlowe-4-not, [data-app-theme=dark] .cm-harlowe-4-isNot, [data-app-theme=dark] .cm-harlowe-4-contains, [data-app-theme=dark] .cm-harlowe-4-doesNotContain, [data-app-theme=dark] .cm-harlowe-4-isIn, [data-app-theme=dark] .cm-harlowe-4-isA, [data-app-theme=dark] .cm-harlowe-4-isNotA, [data-app-theme=dark] .cm-harlowe-4-isNotIn, [data-app-theme=dark] .cm-harlowe-4-matches, [data-app-theme=dark] .cm-harlowe-4-doesNotMatch{color:hsla(0,0%,70%,1.0)}.cm-harlowe-4-bold, .cm-harlowe-4-strong{font-weight:bold;}.cm-harlowe-4-italic, .cm-harlowe-4-em{font-style:italic;}.cm-harlowe-4-sup{vertical-align: super;font-size:0.8em;}.cm-harlowe-4-strike{text-decoration: line-through;}.cm-harlowe-4-verbatim{background-color: hsla(0,0%,50%,0.25); font:var(--font-monospaced)}.theme-dark .cm-harlowe-4-verbatim{background-color: hsla(0,0%,50%,0.25); font:var(--font-monospaced)}[data-app-theme=dark] .cm-harlowe-4-verbatim{background-color: hsla(0,0%,50%,0.25); font:var(--font-monospaced)}.cm-harlowe-4-comment{color: hsla(120, 80%, 40%, 1); font-style:italic;}[class^='cm-harlowe-4-bold'], [class^='cm-harlowe-4-strong'], [class^='cm-harlowe-4-italic'], [class^='cm-harlowe-4-em'], [class^='cm-harlowe-4-sup'], [class^='cm-harlowe-4-verbatim'], [class^='cm-harlowe-4-strike']{font-weight:100; color: hsla(0,0%,0%,0.5)}.theme-dark [class^='cm-harlowe-4-bold'], .theme-dark [class^='cm-harlowe-4-strong'], .theme-dark [class^='cm-harlowe-4-italic'], .theme-dark [class^='cm-harlowe-4-em'], .theme-dark [class^='cm-harlowe-4-sup'], .theme-dark [class^='cm-harlowe-4-verbatim'], .theme-dark [class^='cm-harlowe-4-strike']{font-weight:100; color: hsla(0,0%,100%,0.5)}[data-app-theme=dark] [class^='cm-harlowe-4-bold'], [data-app-theme=dark] [class^='cm-harlowe-4-strong'], [data-app-theme=dark] [class^='cm-harlowe-4-italic'], [data-app-theme=dark] [class^='cm-harlowe-4-em'], [data-app-theme=dark] [class^='cm-harlowe-4-sup'], [data-app-theme=dark] [class^='cm-harlowe-4-verbatim'], [data-app-theme=dark] [class^='cm-harlowe-4-strike']{font-weight:100; color: hsla(0,0%,100%,0.5)}[class^='cm-harlowe-4-collapsed']{font-weight:bold; color: hsla(201,100%,30%,1.0);}.theme-dark [class^='cm-harlowe-4-collapsed']{font-weight:bold; color: hsla(201,100%,70%,1.0);}[data-app-theme=dark] [class^='cm-harlowe-4-collapsed']{font-weight:bold; color: hsla(201,100%,70%,1.0);}.cm-harlowe-4-unclosedCollapsed{background-color: hsla(220,100%,50%,0.025);font-weight:bold; color: hsla(201,100%,30%,1.0);}.theme-dark .cm-harlowe-4-unclosedCollapsed{background-color: hsla(220,100%,50%,0.025);font-weight:bold; color: hsla(201,100%,70%,1.0);}[data-app-theme=dark] .cm-harlowe-4-unclosedCollapsed{background-color: hsla(220,100%,50%,0.025);font-weight:bold; color: hsla(201,100%,70%,1.0);}.cm-harlowe-4-collapsed{background-color: hsla(220,100%,50%,0.025);}.theme-dark .cm-harlowe-4-collapsed{background-color: hsla(220,100%,50%,0.025);}[data-app-theme=dark] .cm-harlowe-4-collapsed{background-color: hsla(220,100%,50%,0.025);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook{background-color: hsla(220,100%,50%,0.05);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook{background-color: hsla(220,100%,50%,0.05);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook{background-color: hsla(220,100%,50%,0.05);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-2{background-color: hsla(220,100%,50%,0.1);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-2{background-color: hsla(220,100%,50%,0.1);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-2{background-color: hsla(220,100%,50%,0.1);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-3{background-color: hsla(220,100%,50%,0.15);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-3{background-color: hsla(220,100%,50%,0.15);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-3{background-color: hsla(220,100%,50%,0.15);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-4{background-color: hsla(220,100%,50%,0.2);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-4{background-color: hsla(220,100%,50%,0.2);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-4{background-color: hsla(220,100%,50%,0.2);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-5{background-color: hsla(220,100%,50%,0.25);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-5{background-color: hsla(220,100%,50%,0.25);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-5{background-color: hsla(220,100%,50%,0.25);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-6{background-color: hsla(220,100%,50%,0.3);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-6{background-color: hsla(220,100%,50%,0.3);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-6{background-color: hsla(220,100%,50%,0.3);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-7{background-color: hsla(220,100%,50%,0.35);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-7{background-color: hsla(220,100%,50%,0.35);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-7{background-color: hsla(220,100%,50%,0.35);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-8{background-color: hsla(220,100%,50%,0.4);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-8{background-color: hsla(220,100%,50%,0.4);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-8{background-color: hsla(220,100%,50%,0.4);}.cm-harlowe-4-twineLink:not(.cm-harlowe-4-text){color:hsla(240,100%,20%,1.0)}.theme-dark .cm-harlowe-4-twineLink:not(.cm-harlowe-4-text){color:hsla(240,100%,80%,1.0)}[data-app-theme=dark] .cm-harlowe-4-twineLink:not(.cm-harlowe-4-text){color:hsla(240,100%,80%,1.0)}.cm-harlowe-4-tag, .cm-harlowe-4-scriptStyleTag, .cm-harlowe-4-htmlComment{color: hsla(240,34%,25%,1.0);}.theme-dark .cm-harlowe-4-tag, .theme-dark .cm-harlowe-4-scriptStyleTag, .theme-dark .cm-harlowe-4-htmlComment{color: hsla(240,51%,75%,1.0);}[data-app-theme=dark] .cm-harlowe-4-tag, [data-app-theme=dark] .cm-harlowe-4-scriptStyleTag, [data-app-theme=dark] .cm-harlowe-4-htmlComment{color: hsla(240,51%,75%,1.0);}.cm-harlowe-4-boolean{color:hsla(0,0%,30%,1.0)}.theme-dark .cm-harlowe-4-boolean{color:hsla(0,0%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-boolean{color:hsla(0,0%,70%,1.0)}.cm-harlowe-4-string{color:hsla(180,100%,30%,1.0)}.theme-dark .cm-harlowe-4-string{color:hsla(180,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-string{color:hsla(180,100%,70%,1.0)}.cm-harlowe-4-number{color:hsla(30,100%,30%,1.0)}.theme-dark .cm-harlowe-4-number{color:hsla(30,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-number{color:hsla(30,100%,70%,1.0)}.cm-harlowe-4-variable{color:hsla(200,100%,30%,1.0)}.theme-dark .cm-harlowe-4-variable{color:hsla(200,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-variable{color:hsla(200,100%,70%,1.0)}.cm-harlowe-4-tempVariable{color:hsla(200,70%,20%,1.0)}.theme-dark .cm-harlowe-4-tempVariable{color:hsla(200,100%,80%,1.0)}[data-app-theme=dark] .cm-harlowe-4-tempVariable{color:hsla(200,100%,80%,1.0)}.cm-harlowe-4-hookName{color:hsla(160,100%,30%,1.0)}.theme-dark .cm-harlowe-4-hookName{color:hsla(160,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-hookName{color:hsla(160,100%,70%,1.0)}.cm-harlowe-4-datatype{color:hsla(220,100%,30%,1.0)}.theme-dark .cm-harlowe-4-datatype{color:hsla(220,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-datatype{color:hsla(220,100%,70%,1.0)}.cm-harlowe-4-colour{color:hsla(280,100%,30%,1.0)}.theme-dark .cm-harlowe-4-colour{color:hsla(280,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-colour{color:hsla(280,100%,70%,1.0)}.cm-harlowe-4-cssTime{color:hsla(30,100%,30%,1.0)}.theme-dark .cm-harlowe-4-cssTime{color:hsla(30,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-cssTime{color:hsla(30,100%,70%,1.0)}.cm-harlowe-4-passageString{color:hsla(200,100%,30%,1.0);text-decoration:underline 1px;}.theme-dark .cm-harlowe-4-passageString{color:hsla(200,100%,70%,1.0);text-decoration:underline 1px;}[data-app-theme=dark] .cm-harlowe-4-passageString{color:hsla(200,100%,70%,1.0);text-decoration:underline 1px;}.cm-harlowe-4-tagString{color:hsla(200,100%,30%,1.0);text-decoration:underline 1px dotted;}.theme-dark .cm-harlowe-4-tagString{color:hsla(200,100%,70%,1.0);text-decoration:underline 1px dotted;}[data-app-theme=dark] .cm-harlowe-4-tagString{color:hsla(200,100%,70%,1.0);text-decoration:underline 1px dotted;}.cm-harlowe-4-variableOccurrence, .cm-harlowe-4-hookOccurrence{background: hsla(159,50%,75%,1.0) !important;}.theme-dark .cm-harlowe-4-variableOccurrence, .theme-dark .cm-harlowe-4-hookOccurrence{background: hsla(159,75%,25%,1.0) !important;}[data-app-theme=dark] .cm-harlowe-4-variableOccurrence, [data-app-theme=dark] .cm-harlowe-4-hookOccurrence{background: hsla(159,75%,25%,1.0) !important;}[class^='cm-harlowe-4-where'], [class^='cm-harlowe-4-via'], [class^='cm-harlowe-4-with'], [class^='cm-harlowe-4-making'], [class^='cm-harlowe-4-each'], [class^='cm-harlowe-4-when']{color:hsla(120,100%,40%,1.0); font-style:italic;}.theme-dark [class^='cm-harlowe-4-where'], .theme-dark [class^='cm-harlowe-4-via'], .theme-dark [class^='cm-harlowe-4-with'], .theme-dark [class^='cm-harlowe-4-making'], .theme-dark [class^='cm-harlowe-4-each'], .theme-dark [class^='cm-harlowe-4-when']{color:hsla(120,100%,60%,1.0); font-style:italic;}[data-app-theme=dark] [class^='cm-harlowe-4-where'], [data-app-theme=dark] [class^='cm-harlowe-4-via'], [data-app-theme=dark] [class^='cm-harlowe-4-with'], [data-app-theme=dark] [class^='cm-harlowe-4-making'], [data-app-theme=dark] [class^='cm-harlowe-4-each'], [data-app-theme=dark] [class^='cm-harlowe-4-when']{color:hsla(120,100%,60%,1.0); font-style:italic;}.cm-harlowe-4-heading{font-weight:bold;}.cm-harlowe-4-hr{background-image: linear-gradient(0deg, transparent, transparent 45%, hsla(0,0%,75%,1.0) 45%, transparent 55%, transparent);}.theme-dark .cm-harlowe-4-hr{background-image: linear-gradient(0deg, transparent, transparent 45%, hsla(0,0%,25%,1.0) 45%, transparent 55%, transparent);}[data-app-theme=dark] .cm-harlowe-4-hr{background-image: linear-gradient(0deg, transparent, transparent 45%, hsla(0,0%,25%,1.0) 45%, transparent 55%, transparent);}.cm-harlowe-4-align{color: hsla(14,99%,37%,1.0); background-color: hsla(14,99%,87%,0.1);}.theme-dark .cm-harlowe-4-align{color: hsla(14,100%,63%,1.0); background-color: hsla(14,100%,13%,0.1);}[data-app-theme=dark] .cm-harlowe-4-align{color: hsla(14,100%,63%,1.0); background-color: hsla(14,100%,13%,0.1);}.cm-harlowe-4-column{color: hsla(204,99%,37%,1.0); background-color: hsla(204,99%,87%,0.1);}.theme-dark .cm-harlowe-4-column{color: hsla(204,100%,63%,1.0); background-color: hsla(204,100%,13%,0.1);}[data-app-theme=dark] .cm-harlowe-4-column{color: hsla(204,100%,63%,1.0); background-color: hsla(204,100%,13%,0.1);}.cm-harlowe-4-escapedLine{font-weight:bold; color: hsla(51,100%,30%,1.0);}.theme-dark .cm-harlowe-4-escapedLine{font-weight:bold; color: hsla(51,100%,70%,1.0);}[data-app-theme=dark] .cm-harlowe-4-escapedLine{font-weight:bold; color: hsla(51,100%,70%,1.0);}.cm-harlowe-4-identifier, .cm-harlowe-4-property, .cm-harlowe-4-belongingProperty, .cm-harlowe-4-itsProperty, .cm-harlowe-4-belongingItProperty, .cm-harlowe-4-belongingItOperator, .cm-harlowe-4-possessiveOperator, .cm-harlowe-4-belongingOperator{color:hsla(200,80%,40%,1.0)}.theme-dark .cm-harlowe-4-identifier, .theme-dark .cm-harlowe-4-property, .theme-dark .cm-harlowe-4-belongingProperty, .theme-dark .cm-harlowe-4-itsProperty, .theme-dark .cm-harlowe-4-belongingItProperty, .theme-dark .cm-harlowe-4-belongingItOperator, .theme-dark .cm-harlowe-4-possessiveOperator, .theme-dark .cm-harlowe-4-belongingOperator{color:hsla(200,100%,60%,1.0)}[data-app-theme=dark] .cm-harlowe-4-identifier, [data-app-theme=dark] .cm-harlowe-4-property, [data-app-theme=dark] .cm-harlowe-4-belongingProperty, [data-app-theme=dark] .cm-harlowe-4-itsProperty, [data-app-theme=dark] .cm-harlowe-4-belongingItProperty, [data-app-theme=dark] .cm-harlowe-4-belongingItOperator, [data-app-theme=dark] .cm-harlowe-4-possessiveOperator, [data-app-theme=dark] .cm-harlowe-4-belongingOperator{color:hsla(200,100%,60%,1.0)}@keyframes harlowe-4-appear{0%{opacity:0}to{opacity:1}}@keyframes harlowe-4-fade-in-out{0%,to{opacity:0}50%{opacity:1}}@keyframes harlowe-4-rumble{25%{top:-0.1em}75%{top:.1em}0%,to{top:0px}}@keyframes harlowe-4-shudder{25%{left:.1em}75%{left:-0.1em}0%,to{left:0px}}@keyframes harlowe-4-buoy{25%{top:.25em}75%{top:-0.25em}0%,to{top:0px}}@keyframes harlowe-4-sway{25%{left:.25em}75%{left:-0.25em}0%,to{left:0px}}@keyframes harlowe-4-pulse{0%{transform:scale(0, 0)}20%{transform:scale(1.2, 1.2)}40%{transform:scale(0.9, 0.9)}60%{transform:scale(1.05, 1.05)}80%{transform:scale(0.925, 0.925)}to{transform:scale(1, 1)}}@keyframes harlowe-4-zoom-in{0%{transform:scale(0, 0)}to{transform:scale(1, 1)}}@keyframes harlowe-4-shudder-in{0%,to{transform:translateX(0em)}5%,25%,45%{transform:translateX(-1em)}15%,35%,55%{transform:translateX(1em)}65%{transform:translateX(-0.6em)}75%{transform:translateX(0.6em)}85%{transform:translateX(-0.2em)}95%{transform:translateX(0.2em)}}@keyframes harlowe-4-rumble-in{0%,to{transform:translateY(0em)}5%,25%,45%{transform:translateY(-1em)}15%,35%,55%{transform:translateY(1em)}65%{transform:translateY(-0.6em)}75%{transform:translateY(0.6em)}85%{transform:translateY(-0.2em)}95%{transform:translateY(0.2em)}}@keyframes harlowe-4-fidget{0%,8.1%,82.1%,31.1%,38.1%,44.1%,40.1%,47.1%,74.1%,16.1%,27.1%,72.1%,24.1%,95.1%,6.1%,36.1%,20.1%,4.1%,91.1%,14.1%,87.1%,to{left:0px;top:0px}8%,82%,31%,38%,44%{left:-1px}40%,47%,74%,16%,27%{left:1px}72%,24%,95%,6%,36%{top:-1px}20%,4%,91%,14%,87%{top:1px}}@keyframes harlowe-4-slide-right{0%{transform:translateX(-100vw)}}@keyframes harlowe-4-slide-left{0%{transform:translateX(100vw)}}@keyframes harlowe-4-slide-up{0%{transform:translateY(100vh)}}@keyframes harlowe-4-slide-down{0%{transform:translateY(-100vh)}}@keyframes harlowe-4-fade-right{0%{opacity:0;transform:translateX(-1em)}to{opacity:1}}@keyframes harlowe-4-fade-left{0%{opacity:0;transform:translateX(1em)}to{opacity:1}}@keyframes harlowe-4-fade-up{0%{opacity:0;transform:translateY(1em)}to{opacity:1}}@keyframes harlowe-4-fade-down{0%{opacity:0;transform:translateY(-1em)}to{opacity:1}}@keyframes harlowe-4-flicker{0%,29%,31%,63%,65%,77%,79%,86%,88%,91%,93%{opacity:0}30%{opacity:.2}64%{opacity:.4}78%{opacity:.6}87%{opacity:.8}92%,to{opacity:1}}@keyframes harlowe-4-blur{0%{filter:blur(2rem);opacity:0}25%{opacity:1}to{filter:blur(0rem);opacity:1}}\n.harlowe-4-toolbarPanel{transition:max-height .8s;overflow-y:auto;margin-bottom:4px}.harlowe-4-minimised .harlowe-4-toolbarPanel>:not(:last-child){display:none}.harlowe-4-toolbarPanel code:not(:empty){font-size:1rem;border:1px dotted hsl(0, 0%, 50%)}.harlowe-4-toolbarPanel [type=radio][disabled]~*{opacity:.5}.harlowe-4-stylePreview{text-align:center;user-select:none;background:black;color:white;font-family:\"Georgia\",serif;padding:8px;font-size:1.5rem;margin:8px auto;width:60%;position:sticky;top:0;z-index:1}.harlowe-4-stylePreview textarea{background:black;color:white}.harlowe-4-stylePreview>span{display:inline-block}.harlowe-4-stylePreview>span:first-child{position:absolute}.harlowe-4-stylePreview>span:last-child{position:relative}.harlowe-4-toolbarPanel>button{border-radius:.8rem;margin:0px 2px;padding:0px 4px;height:36px;font-size:1.2rem;min-width:28px}.harlowe-4-toolbarPanel>button:not(:active):not(.active):not(:last-child){border:1px solid hsla(0, 0%, 50%, 0.5);border-top:none;border-left:none}.harlowe-4-toolbarCheckboxes{border-bottom:1px solid hsla(0, 0%, 50%, 0.5);position:relative;padding-bottom:8px;margin-bottom:8px}.harlowe-4-toolbarPanel label:not(.harlowe-4-radioRow){white-space:nowrap}.harlowe-4-toolbarCheckboxes>label{min-width:20%;display:inline-block}.harlowe-4-swatch{width:24px;height:24px;display:inline-block;cursor:pointer;border-bottom:1px solid hsla(0, 0%, 50%, 0.5);border-right:1px solid hsla(0, 0%, 50%, 0.5)}.harlowe-4-labeledInput{position:relative;padding-bottom:8px}.harlowe-4-labeledInput>input[type=text]{display:inline-block;font-size:1rem}.harlowe-4-labeledInput>input[type=range]{vertical-align:middle}.harlowe-4-labeledInput>input[type=number]{box-shadow:0 1px 0 hsla(0, 0%, 50%, 0.5);background:transparent;color:inherit;border:none;font-family:\"Source Code Pro\",monospace;font-family:var(--font-monospaced);width:4rem;margin:0 .5rem;display:inline-block;font-size:1rem}.harlowe-4-radioRow{margin:8px 0px;display:block}.harlowe-4-radioRow .harlowe-4-radioRow{margin-left:2rem}.harlowe-4-toolbarPanel>*>.harlowe-4-radioRow{border-bottom:1px solid hsla(0, 0%, 50%, 0.5);padding-bottom:8px}.harlowe-4-confirmButtons>span{display:inline-block;align-items:center}.harlowe-4-resultCode{max-width:50%;overflow-x:auto;white-space:pre;display:inline-block;padding:1px 0px}.harlowe-4-resultCode *{white-space:nowrap}.harlowe-4-toolbarBullet{padding:0px 2px;color:hsla(0, 0%, 50%, 0.5)}.harlowe-4-toolbarBullet::before{content:\"•\"}.harlowe-4-bgColourButton{display:inline-block;border-radius:8px;width:16px;height:16px;margin-bottom:-2px;background:linear-gradient(to right, hsla(0, 100%, 50%, 0.5), hsla(30, 100%, 50%, 0.5), hsla(60, 100%, 50%, 0.5), hsla(120, 100%, 50%, 0.5), hsla(180, 100%, 50%, 0.5), hsla(240, 100%, 50%, 0.5), hsla(300, 100%, 50%, 0.5), hsla(320, 100%, 50%, 0.5))}.harlowe-4-gradientBar{display:inline-block;position:relative;width:75%;height:32px;margin:12px 8px 96px 40px;border:1px solid hsla(0, 0%, 50%, 0.5);border-radius:5px}.harlowe-4-gradientBar+button{position:absolute;top:8px;right:8px}.harlowe-4-colourStop{position:absolute;height:48px;width:16px;background:hsla(0, 0%, 50%, 0.5);border-radius:5px;cursor:grab}.harlowe-4-colourStop:active{cursor:grabbing}.harlowe-4-colourStopButtons{display:none;position:relative;top:64px;width:540px;background:hsla(0, 0%, 50%, 0.5);padding:8px;cursor:auto}.harlowe-4-colourStop[selected]{border-bottom-right-radius:0px;border-bottom-left-radius:0px;height:64px}.harlowe-4-colourStop[selected]>.harlowe-4-colourStopButtons{display:block}.harlowe-4-singleColourPicker{display:inline-block}.harlowe-4-singleColourPicker select{position:relative;top:-4px;font-size:1rem;margin-left:8px}.harlowe-4-directionPicker{width:48px;height:48px;border-radius:24px;border:1px solid hsla(0, 0%, 50%, 0.5);display:inline-block}.harlowe-4-hideCode .cm-harlowe-4-root:not(.cm-harlowe-4-text):not(.cm-harlowe-4-string):not(.cm-harlowe-4-verbatim){opacity:.25}.harlowe-4-hideHelpTooltip .harlowe-4-helpTooltip{display:none}.harlowe-4-tooltip{font-family:var(--font-system);max-width:20vw;position:absolute;border:1px solid hsla(0, 0%, 50%, 0.5);padding:8px;display:block;z-index:8}[data-version^=\"2.3\"] .harlowe-4-tooltip{font-family:\"Source Sans Pro\",sans-serif}.theme-light .harlowe-4-tooltip,[data-app-theme=light] .harlowe-4-tooltip{background:white}.theme-dark .harlowe-4-tooltip,[data-app-theme=dark] .harlowe-4-tooltip{background:black}.harlowe-4-tooltipMacroSignature{display:block;padding-top:.5em;margin-top:.5em;border-top:1px solid hsla(0, 0%, 50%, 0.5)}.harlowe-4-tooltipTail{position:absolute;height:0;width:0;border:12px solid transparent;border-bottom-color:hsla(0, 0%, 50%, 0.5)}.harlowe-4-tooltipTail::after{content:\"\";position:absolute;height:0;width:0;left:-12px;top:-10px;border:12px solid transparent}.harlowe-4-completion{max-height:12em;overflow-y:scroll}.harlowe-4-tooltipItemSelected{background-color:#888;background-color:var(--light-gray-translucent)}.theme-light .harlowe-4-tooltipTail::after,[data-app-theme=light] .harlowe-4-tooltipTail::after{border-bottom-color:white}.theme-dark .harlowe-4-tooltipTail::after,[data-app-theme=dark] .harlowe-4-tooltipTail::after{border-bottom-color:black}.harlowe-4-dataEmptyRow:not(:last-child){display:none}.harlowe-4-dataRow .harlowe-4-dropdownRowLabel{font-family:\"Source Code Pro\",monospace;font-family:var(--font-monospaced)}.harlowe-4-textareaRows{margin-bottom:.5em}.harlowe-4-nonZeroRows>:first-child>.harlowe-4-rowMinus{display:none}.harlowe-4-datavalueRows{margin-left:6px;padding-left:6px;border-left:1px solid hsla(0, 0%, 50%, 0.5)}.harlowe-4-toolbarPanel [invalid]::after{display:block;position:absolute;content:attr(invalid);background-color:hsla(17, 100%, 50%, 0.5);right:0px;bottom:8px}.harlowe-4-datavalueRows .harlowe-4-datavalueRows .harlowe-4-datavalueRowHint{display:none}.story-format-toolbar .icon>img:only-child{margin-right:0px}.harlowe-4-toolbarPanel .harlowe-4-confirmButtons{display:flex;justify-content:end}.passage-edit-dialog.collapsed .harlowe-4-toolbarPanel{display:none}.harlowe-4-scrollWrapper{overflow:hidden auto;max-height:60vh}.harlowe-4-toolbarPanel a[href]{color:var(--dark-blue);font-weight:bold}.harlowe-4-toolbarPanel.card{position:absolute;width:576px;height:auto;top:0px;padding:8px}.story-format-toolbar+.harlowe-4-toolbarPanel .harlowe-4-confirmButtons{justify-content:start;flex-flow:row-reverse}.harlowe-4-toolbarPanel textarea,.harlowe-4-toolbarPanel [type=text]{background:var(--white-translucent);border-radius:var(--corner-round);border:1px solid var(--faint-gray);color:var(--dark-gray)}html:not([data-version^=\"2.3\"]) .harlowe-4-toolbarPanel [type=checkbox]{background:transparent;border:2px solid var(--dark-gray);width:16px;height:16px;appearance:none;position:relative;border-radius:2px;margin:0px 6px;vertical-align:middle}html:not([data-version^=\"2.3\"]) .harlowe-4-toolbarPanel [type=checkbox]:checked::before{content:\"✔\";position:absolute;right:-2px;top:-4px;margin-right:3px}select>option{background-color:var(--light-gray);color:var(--dark-gray) !important}.harlowe-4-radioRow{padding-left:0px;padding-right:0px;user-select:none;position:relative}.harlowe-4-radioRow>:first-child,.harlowe-4-radioRow>:nth-child(2){cursor:pointer}.harlowe-4-radioRow>div{padding:var(--grid-size)}.harlowe-4-toolbarPanel select{padding:var(--grid-size)}.harloweToolbar+.story-format-toolbar button{padding:calc(var(--grid-size) - 1px)}#root>.dialogs>:not(.passag-edit-stack){z-index:-1}\n";
},"hydrate":"function escape(e){return e&&\"object\"==typeof e?(Object.keys(e).forEach((a=>{e[a]=escape(e[a])})),e):`${e}`.replace(/[-[\\]/{}()*+?.\\\\^$|]/g,\"\\\\$&\")}function makeWrapper(e){return(...a)=>`(${e}${a.join(\"|\")})`}const e=makeWrapper(\"?:\"),a=makeWrapper(\"?!\"),t=makeWrapper(\"?=\"),r=\"[ \\\\f\\\\t\\\\v\\\\u00a0\\\\u2000-\\\\u200a\\\\u2028\\\\u2029\\\\u202f\\\\u205f\\\\u3000]*\",o=r.replace(\"*\",\"+\"),n=\"\\\\b\",s=\"[\\\\w\\\\-\\\\u00c0-\\\\u00de\\\\u00df-\\\\u00ff\\\\u0150\\\\u0170\\\\u0151\\\\u0171\\\\uD800-\\\\uDFFF]\",i=s.replace(\"\\\\-\",\"\"),l=e(\"\\\\n\",\"$\"),c=`${r}(\\\\*+)${o}`,h=`${r}((?:0\\\\.)+)${o}`,d=`${r}-{3,}${r}${l}`,m=`${r}(#{1,6})${r}`,p=`${r}(==+>|<=+|=+><=+|<==+>)${r}${l}`,u=`${r}(=+\\\\|+|\\\\|+=+|=+\\\\|+=+|\\\\|=+\\\\|)${r}${l}`,g={opener:\"\\\\[\\\\[(?!\\\\[)\",main:void 0,text:`(${function notChars(...e){return`[^${e.map(escape).join(\"\")}]*`}(\"]\")})`,rightSeparator:e(\"\\\\->\",\"\\\\|\"),leftSeparator:\"<\\\\-\",closer:\"\\\\]\\\\]\",legacySeparator:\"\\\\|\",legacyText:`(${e(\"[^\\\\|\\\\]]\",`\\\\]${a(\"\\\\]\")}`)}+)`},y=`${i}*${i.replace(\"\\\\w\",\"a-zA-Z\")}${i}*`,b=`\\\\$(${y})`,f=`_(${y})`,w=`${r}'s${o}${a(\"_\")}(${y})`,k=`(${y})${o}of${n}${a(`it${n}`)}`,v=`'s${o}`,x=`of${n}`,T=e(\"it\",\"time\",\"turns?\",\"visits?\",\"exits?\",\"user\",\"pos\")+n,$=`its${o}(${y})`,C=`its${n}`,S=`(${y})${o}of${o}it${n}`,N=`of${o}it${n}`,A={opener:\"\\\\(\",name:`(${e(\"\\\\$\",\"_\")}?${s}+):${a(\"\\\\/\")}`,closer:\"\\\\)\"},_=e(\"=<\",\"=>\",`[gl]te?${n}`,`n?eq${n}`,`isnot${n}`,`are${n}`,`x${n}`,`isa${n}`,`or${o}a${n}`),O=\"[a-zA-Z][\\\\w\\\\-]*\",H=\"(?:\\\"[^\\\"]*\\\"|'[^']*'|[^'\\\">])*?\",L=`\\\\|(${s}+)(>|\\\\))`,M=`(<|\\\\()(${s}+)\\\\|`,P=`((?:\\\\b\\\\d+(?:\\\\.\\\\d+)?|\\\\.\\\\d+)(?:[eE][+\\\\-]?\\\\d+)?)${a(\"m?s\")}${n}`;g.main=g.opener+e(g.text+g.rightSeparator,g.text.replace(\"*\",\"*?\")+g.leftSeparator)+g.text;const I={upperLetter:\"[A-Z\\\\u00c0-\\\\u00de\\\\u0150\\\\u0170]\",lowerLetter:\"[a-z0-9_\\\\-\\\\u00df-\\\\u00ff\\\\u0151\\\\u0171]\",anyLetter:s,anyLetterStrict:i,whitespace:o.replace(\"[\",\"[\\\\n\\\\r\"),comment:\"\\\\-\\\\-\",escapedLine:\"\\\\\\\\\\\\n\\\\\\\\?|\\\\n\\\\\\\\\",br:\"\\\\n(?!\\\\\\\\)\",tag:`<\\\\/?${O}${H}>`,scriptStyleTag:`<(${e(\"script\",\"style\",\"textarea\")})${H}>[^]*?<\\\\/\\\\1>`,scriptStyleTagOpener:\"<\",url:`(${e(\"https?\",\"mailto\",\"javascript\",\"ftp\",\"data\")}:\\\\/\\\\/[^\\\\s<]+[^<.,:;\"')\\\\]\\\\s])`,bullet:\"\\\\*\",hr:d,heading:m,align:p,column:u,bulleted:c,numbered:h,verbatimOpener:\"`+\",hookAppendedFront:`\\\\[${a(\"=+\")}`,hookPrependedFront:`${L}\\\\[${a(\"=+\")}`,hookFront:`\\\\[${a(\"=+\")}`,hookBack:`\\\\]${a(M)}`,hookAppendedBack:`\\\\]${M}`,unclosedHook:\"\\\\[=+\",unclosedHookPrepended:`${L}\\\\[=+`,unclosedCollapsed:\"\\\\{=+\",passageLink:g.main+g.closer,legacyLink:g.opener+g.legacyText+g.legacySeparator+g.legacyText+g.closer,simpleLink:g.opener+g.legacyText+g.closer,macroFront:A.opener+t(A.name),macroName:A.name,groupingFront:`\\\\(${a(A.name)}`,twine1Macro:\"<<[^>\\\\s]+\\\\s*(?:\\\\\\\\.|'(?:[^'\\\\\\\\]*\\\\\\\\.)*[^'\\\\\\\\]*'|\\\"(?:[^\\\"\\\\\\\\]*\\\\\\\\.)*[^\\\"\\\\\\\\]*\\\"|[^'\\\"\\\\\\\\>]|>(?!>))*>>\",validPropertyName:y,property:w,belongingProperty:k,possessiveOperator:v,belongingOperator:x,itsOperator:C,belongingItOperator:N,variable:b,tempVariable:f,hookName:`\\\\?(${s}+)\\\\b`,cssMeasure:`(\\\\-?\\\\d+\\\\.?\\\\d*|\\\\d*\\\\.?\\\\d+)(m?s|px|r?em|w|l?h)${n}`,colour:e(e(\"Red\",\"Orange\",\"Yellow\",\"Lime\",\"Green\",\"Cyan\",\"Aqua\",\"Blue\",\"Navy\",\"Purple\",\"Fuchsia\",\"Magenta\",\"White\",\"Gray\",\"Grey\",\"Black\",\"Transparent\"),\"#[\\\\dA-Fa-f]{3}(?:[\\\\dA-Fa-f]{3})?\"),datatype:e(\"alnum\",\"alphanumeric\",\"any(?:case)?\",\"array\",\"bool(?:ean)?\",\"changer\",\"codehook\",\"colou?r\",\"const\",\"command\",\"dm\",`data${e(\"map\",\"type\",\"set\")}`,\"ds\",\"digit\",\"gradient\",\"empty\",\"even\",\"image\",`int${a(\"o\")}(?:eger)?`,\"lambda\",\"lowercase\",\"macro\",\"measure\",\"linebreak\",\"newline\",\"num(?:ber)?\",\"odd\",\"str(?:ing)?\",\"uppercase\",\"whitespace\")+n,number:P,boolean:e(\"true\",\"false\")+n,identifier:T,itsProperty:$,belongingItProperty:S,escapedStringChar:\"\\\\\\\\[^\\\\n]\",singleStringOpener:\"'\",doubleStringOpener:'\"',singleStringCloser:\"'\",doubleStringCloser:'\"',is:`is${a(`${o}not${n}`,`${o}an?${n}`,`${o}in${n}`,`${o}<`,`${o}>`)}${n}`,isNot:`is${o}not${a(o+e(\"an?\",\"in\")+n)}${n}`,isA:`is${o}an?${n}`,isNotA:`is${o}not${o}an?${n}`,matches:`matches${n}`,doesNotMatch:`does${o}not${o}match${n}`,and:`and${n}`,or:`or${n}`,not:`not${n}`,inequality:`((?:is(?:${o}not)?${r})*)(${e(\"<(?!=)\",\"<=\",\">(?!=)\",\">=\")})`,isIn:`is${o}in${n}`,contains:`contains${n}`,doesNotContain:`does${o}not${o}contain${n}`,isNotIn:`is${o}not${o}in${n}`,addition:escape(\"+\")+a(\"=\"),subtraction:escape(\"-\")+a(\"=\",\"type\"),multiplication:escape(\"*\")+a(\"=\"),division:e(\"/\",\"%\")+a(\"=\"),spread:`\\\\.\\\\.\\\\.${a(\"\\\\.\")}`,to:e(`to${n}`,\"=\"),into:`into${n}`,making:`making${n}`,where:`where${n}`,when:`when${n}`,via:`via${n}`,each:`each${n}`,bind:`2?bind${n}`,typeSignature:escape(\"-type\")+n,incorrectOperator:_,PlainCompare:{comma:\",\",htmlCommentFront:\"\\x3c!--\",htmlCommentBack:\"--\\x3e\",strikeOpener:\"~~\",italicOpener:\"//\",boldOpener:\"''\",supOpener:\"^^\",strongFront:\"**\",strongBack:\"**\",emFront:\"*\",emBack:\"*\",collapsedFront:\"{\",collapsedBack:\"}\",groupingBack:\")\"}},{assign:E}=Object,R={};class Token{start=0;end=0;children=[];innerText=\"\";constructor(e){E(this,e)}addChild(e){const a=this.lastChildEnd()||0,t=new Token(e);return t.start=a,t.end=a+e.text?.length||0,t.place=this.place,t.children=[],t.innerText&&lex$2(t),this.children.push(t),t}lastChildEnd(){const e=this.children&&this.children[this.children.length-1]||null;return e?e.end:this.start+Math.max(0,this.text.indexOf(this.innerText))}tokenAt(e){if(e<this.start||e>=this.end)return null;if(this.children.length)for(let a=0;a<this.children.length;a+=1)if(e>=this.children[a].start&&e<this.children[a].end){const t=this.children[a].tokenAt(e);if(t)return t}return this}pathAt(e){if(e<this.start||e>=this.end)return[];let a=[];if(this.children.length)for(let t=0;t<this.children.length;t+=1)if(e>=this.children[t].start&&e<this.children[t].end){const r=this.children[t].pathAt(e);if(r.length){a=a.concat(r);break}}return a.concat(this)}nearestTokenAt(e){return e<this.start||e>=this.end?null:this.children?this.children.reduce(((a,t)=>a||(e>=t.start&&e<t.end?t:null)),null):this}everyLeaf(e){return this.children&&0!==this.children.length?this.children.reduce(((a,t)=>a&&t.everyLeaf(e)),!0):!!e(this)}demote(){this.type=\"text\"}debugRender(e=0){return`${\"\\t\".repeat(e)}• ${this.type}\\n${this.children.map((a=>a.debugRender(e+1))).join(\"\")}`}error(e){this.type=\"error\",this.message=e}toString(){let e=`${this.type}(${this.start}→${this.end})`;return this.children&&this.children.length>0&&(e+=`[${this.children}]`),e}copy(){const e=new Token(this);return e.children=e.children.slice(),e}foldChildren(){let e=[];const a=this.children.slice();for(let t=0;t<a.length;t+=1){const r=a[t];let o=!1;if(r.matches)for(let a=0;a<e.length;a+=1){let{type:t}=e[a];t in r.matches&&(foldTokens(this,r,e[a]),e=e.slice(a+1),o=!0)}!o&&r.isFront&&e.unshift(r)}}}function lex$2(e,a){const t=e.innerText;let r=null,o=0,n=o,s=t.length,i=null;for(;o<s;){const s=t.slice(o);let l=(r?.length?r[0]:e).innerMode,c=0,h=l.length;for(;c<h;c+=1){const h=R[l[c]];if(h.constraint&&!h.constraint(i)||h.cannotFollowText&&(\"text\"===i?.type||n<o)||(h.plainCompare?!s.startsWith(h.pattern):!h.pattern.test(s)))continue;const d=h.fn(h.plainCompare?h.pattern:h.pattern.exec(s)||\"\");let m=!1,p=0;if(d.matches){for(;r&&p<r.length;p+=1){let{type:e,aka:a}=r[p];if(e in d.matches){m=!0;break}a&&(e=a),d.cannotCross?.includes(e)&&(p=r.length-1)}if((!r||p>=r.length)&&!d.isFront)continue}n<o&&e.addChild({type:\"text\",text:t.slice(n,o),innerMode:l}),i=e.addChild(d),o+=i.text.length,n=o;let u=!1;m&&r&&(a&&foldTokens(e,i,r[p]),r=r.slice(p+1),u=!0),!u&&i.isFront&&(r?r.unshift(i):r=[i]);break}c===h&&(o+=1,null===i&&(i=new Token({type:\"text\",text:\"\",innerMode:l})))}for(n<o&&e.addChild({type:\"text\",text:t.slice(n,o),innerMode:(r?.length?r[0]:e).innerMode});r?.length;)r.shift()?.demote();return e}function foldTokens(e,a,t){const r=e.children.indexOf(a),o=e.children.indexOf(t);if(a.children=e.children.splice(o+1,r-(o+1)),!a.matches?.[t.type])throw Error(`Couldn't fold backToken ${a.type} to match frontToken ${t.type}`);a.type=a.matches[t.type]||\"\",a.innerText=\"\";for(let e=0,t=a.children.length;e<t;e++)a.innerText+=a.children[e].text;a.start=t.start,a.text=t.text+a.innerText+a.text;for(let e in t)e in t&&!(e in a)&&(a[e]=t[e]);e.children.splice(o,1)}const F={lex:(e,a=\"\",t=\"start\",r=!1)=>lex$2(new Token({type:\"root\",place:a,start:0,end:e.length,text:e,innerText:e,children:[],innerMode:F.modes[t]}),!r),rules:R,modes:{}},z=[\"boolean\",\"is\",\"to\",\"into\",\"where\",\"when\",\"via\",\"making\",\"each\",\"and\",\"or\",\"not\",\"isNot\",\"contains\",\"doesNotContain\",\"isIn\",\"isA\",\"isNotA\",\"isNotIn\",\"matches\",\"doesNotMatch\",\"typifies\",\"untypifies\",\"bind\"],B=[\"comma\",\"spread\",\"typeSignature\",\"addition\",\"subtraction\",\"multiplication\",\"division\"],{keys:W,assign:q}=Object;let D=Object.freeze({lex:function rules(e){function textTokenFn(e){return e||=\"innerText\",a=>({[e]:\"string\"==typeof a?a:a.reduceRight(((e,a,t)=>e||(t?a:\"\")),\"\")})}function openerFn(e,a){const t={};return t[e]=a,()=>({isFront:!0,matches:t,cannotCross:[\"verbatimOpener\"]})}const a=Object.bind(0,null);function setupRules(e,a){for(let t of W(a)){let r=a[t];if(!r)continue;const o=r.fn;r.fn=a=>{const r=o(a);return r.text||(r.text=\"string\"==typeof a?a:a[0]),r.type||(r.type=t),r.innerMode||(r.innerMode=e),r}}return a}const t=[],r=[],o=[],n=setupRules(t,{hr:{fn:a},bulleted:{fn:e=>({depth:e[1].length})},numbered:{fn:e=>({depth:e[1].length/2})},heading:{fn:e=>({depth:e[1].length})},align:{fn(e){let a;const t=e[1],r=t.indexOf(\"><\");return~r?(a=Math.round(r/(t.length-2)*50),25===a&&(a=\"center\")):t.startsWith(\"<\")&&t.endsWith(\">\")?a=\"justify\":t.indexOf(\">\")>-1?a=\"right\":t.indexOf(\"<\")>-1&&(a=\"left\"),{align:a}}},column:{fn(e){let a;const t=e[1],r=t.indexOf(\"|\");return a=r&&r<t.length-1?\"center\":t.startsWith(\"|\")&&t.endsWith(\"|\")?\"none\":r===t.length-1?\"right\":\"left\",{column:a,width:/\\|+/.exec(t)?.[0].length,marginLeft:/^=*/.exec(t)?.[0].length,marginRight:/=*$/.exec(t)?.[0].length}}}}),blockRuleConstraint=e=>{switch(e?e.type:e){case null:case\"br\":case\"hr\":case\"bulleted\":case\"numbered\":case\"heading\":case\"align\":case\"column\":case\"escapedLine\":return!0}return!1};for(const e in n){const a=n[e];a&&(a.constraint=blockRuleConstraint),a&&(a.cannotFollowText=!0)}const s=setupRules(t,{twine1Macro:{fn:()=>({type:\"error\",message:\"Harlowe macros use a different syntax to Twine 1, SugarCube, and Yarn macros.\"})},emBack:{fn:()=>({matches:{emFront:\"em\"},cannotCross:[\"verbatimOpener\"]})},strongBack:{fn:()=>({matches:{strongFront:\"strong\"},cannotCross:[\"verbatimOpener\"]})},strongFront:{fn:()=>({isFront:!0})},emFront:{fn:()=>({isFront:!0})},boldOpener:{fn:openerFn(\"boldOpener\",\"bold\")},italicOpener:{fn:openerFn(\"italicOpener\",\"italic\")},strikeOpener:{fn:openerFn(\"strikeOpener\",\"strike\")},supOpener:{fn:openerFn(\"supOpener\",\"sup\")},comment:{fn:a},htmlCommentFront:{fn:()=>({isFront:!0})},htmlCommentBack:{fn:()=>({matches:{htmlCommentFront:\"htmlComment\"}})},scriptStyleTag:{fn:a},tag:{fn:a},url:{fn:a},hookPrependedFront:{fn:e=>({name:e[1],hidden:\")\"===e[2],isFront:!0,tagPosition:\"prepended\"})},hookFront:{fn:()=>({isFront:!0})},hookBack:{fn:()=>({matches:{hookPrependedFront:\"hook\",hookFront:\"hook\"},cannotCross:[\"verbatimOpener\"]})},hookAppendedBack:{fn:e=>({name:e[2],hidden:\"(\"===e[1],tagPosition:\"appended\",matches:{hookFront:\"hook\"},cannotCross:[\"verbatimOpener\"]})},unclosedHook:{fn:a},unclosedHookPrepended:{fn:e=>({type:\"unclosedHook\",name:e[1],hidden:\")\"===e[2]})},verbatimOpener:{fn(e){let a=e[0].length,t={};return t[`verbatim${a}`]=\"verbatim\",{type:`verbatim${a}`,isFront:!0,matches:t,aka:\"verbatimOpener\"}}},unclosedCollapsed:{fn:a},collapsedFront:{fn:()=>({isFront:!0})},collapsedBack:{fn:()=>({matches:{collapsedFront:\"collapsed\"},cannotCross:[\"verbatimOpener\"]})},escapedLine:{fn:a},legacyLink:{fn:e=>({type:\"twineLink\",innerText:e[1],passage:e[2],innerMode:t})},br:{fn:a}}),i=q(setupRules(r,{macroFront:{fn:e=>({isFront:!0,name:e[1]})},groupingBack:{fn:()=>({matches:{groupingFront:\"grouping\",macroFront:\"macro\"},cannotCross:[\"singleStringOpener\",\"doubleStringOpener\",\"hookFront\"]})},passageLink:{fn(e){const a=e[1]||\"\",r=e[2]||\"\",o=e[3]||\"\";return{type:\"twineLink\",innerText:r?o:a,passage:a?o:r,innerMode:t}}},simpleLink:{fn:e=>({type:\"twineLink\",innerText:e[1]||\"\",passage:e[1]||\"\",innerMode:t})},variable:{constraint:e=>!e||\"macroFront\"!==e.type,fn:textTokenFn(\"name\")},tempVariable:{constraint:e=>!e||\"macroFront\"!==e.type,fn:textTokenFn(\"name\")}}),{hookFront:s.hookFront,hookBack:s.hookBack}),l=setupRules(r,{htmlCommentBack:{fn:()=>({matches:{htmlCommentFront:\"htmlComment\"}})},comment:{fn:a},macroName:{constraint:e=>!!e&&\"macroFront\"===e.type,fn:textTokenFn(\"name\")},groupingFront:{fn:()=>({isFront:!0})},property:{fn:textTokenFn(\"name\"),constraint(e){if(e)switch(e.type){case\"variable\":case\"hookName\":case\"property\":case\"tempVariable\":case\"colour\":case\"itsProperty\":case\"belongingItProperty\":case\"macro\":case\"grouping\":case\"string\":case\"datatype\":case\"hook\":case\"boolean\":case\"number\":return!0;case\"identifier\":{let a=e.text?.toLowerCase();return\"user\"===a||\"it\"===a}}return!1}},possessiveOperator:{fn:a},itsProperty:{cannotFollowText:!0,fn:textTokenFn(\"name\")},itsOperator:{cannotFollowText:!0,fn:a},belongingItProperty:{cannotFollowText:!0,fn:textTokenFn(\"name\")},belongingItOperator:{cannotFollowText:!0,fn:a},belongingProperty:{cannotFollowText:!0,fn:textTokenFn(\"name\")},belongingOperator:{cannotFollowText:!0,fn:a},escapedStringChar:{fn:()=>({type:\"text\"})},singleStringOpener:{fn:()=>({isFront:!0,matches:{singleStringOpener:\"string\"},innerMode:o})},doubleStringOpener:{fn:()=>({isFront:!0,matches:{doubleStringOpener:\"string\"},innerMode:o})},hookName:{fn:textTokenFn(\"name\")},cssMeasure:{fn(e){let a=e[2].toLowerCase();return\"ms\"===a||\"s\"===a?{unit:a,value:+e[1]*(\"s\"===a?1e3:1)}:{unit:a,value:+e[1]}}},datatype:{cannotFollowText:!0,fn:e=>({name:e[0].toLowerCase()})},colour:{cannotFollowText:!0,fn(e){let a,t=e[0].toLowerCase();const r={red:\"e61919\",orange:\"e68019\",yellow:\"e5e619\",lime:\"80e619\",green:\"19e619\",cyan:\"19e5e6\",aqua:\"19e5e6\",blue:\"197fe6\",navy:\"1919e6\",purple:\"7f19e6\",fuchsia:\"e619e5\",magenta:\"e619e5\",white:\"fff\",black:\"000\",gray:\"888\",grey:\"888\"};return a=t in r?`#${r[t]}`:t,{colour:a}}},number:{fn:e=>({value:parseFloat(e[0])})},inequality:{fn:e=>({operator:e[2],negate:e[1].indexOf(\"not\")>-1})},identifier:{fn:textTokenFn(\"name\"),cannotFollowText:!0},whitespace:{fn:a,cannotFollowText:!0},incorrectOperator:{fn:e=>{const a={\"=>\":\">=\",\"=<\":\"<=\",gte:\">=\",lte:\"<=\",gt:\">\",lt:\"<\",eq:\"is\",isnot:\"is not\",neq:\"is not\",isa:\"is a\",are:\"is\",x:\"*\",\"or a\":\"or\"}[e[0].toLowerCase().replace(/\\s+/g,\" \")];return{type:\"error\",message:`Please say ${a?`'${a}'`:\"something else\"} instead of '${e[0]}'.`,explanation:\"In the interests of readability, I want certain operators to be in a specific form.\"}},cannotFollowText:!0},...z.reduce(((e,t)=>(e[t]={fn:a,cannotFollowText:!0},e)),{}),...B.reduce(((e,t)=>(e[t]={fn:a},e)),{})}),c=setupRules(o,{singleStringCloser:l.singleStringOpener,doubleStringCloser:l.doubleStringOpener,escapedStringChar:l.escapedStringChar});t.push(...W(n),...W(i),...W(s)),r.push(...W(i),...W(l)),o.push(...W(c));const h={...n,...s,...i,...l,...c};for(const e in h){const a=h[e];a&&(e in I.PlainCompare?(a.pattern=I.PlainCompare[e],a.plainCompare=!0):a.pattern=RegExp(`^(?:${I[e]})`,\"i\"))}q(e.rules,h);const{modes:d}=e;return d.start=d.markup=t,d.macro=r,d.string=o,e}(F).lex,Patterns:I});const{round:V}=Math,insensitiveName=e=>`${e}`.toLowerCase().replace(/-|_/g,\"\"),j={Macro:{set:{name:\"set\",sig:\" ...VariableToValue\",returnType:\"Command\",aka:[],abstract:\"Stores data values in variables, optionally allowing you to permanently restrict the variable to a single datatype. The variable's contents can be changed throughout the story, as long as the optional datatype restriction is obeyed.  \",anchor:\"macro_set\",category:\"basics\",categoryOrder:\"1\"},put:{name:\"put\",sig:\" ...VariableToValue\",returnType:\"Command\",aka:[],abstract:\"A left-to-right version of (set:) that requires the word `into` rather than `to`.  \",anchor:\"macro_put\",category:\"basics\",categoryOrder:\"2\"},unpack:{name:\"unpack\",sig:\" ...VariableToValue\",returnType:\"Command\",aka:[],abstract:'A specialised variation of (put:) that lets you extract multiple values from an array, datamap or string, at once, and put them into multiple variables, by placing a matching data structure on the right of `into` containing variables at the positions of those values. For instance, `(unpack: (a: 1, 2, 3) into (a: $x, 2, $y))` sets $x to 1 and $y to 3, and `(unpack: (dm: \"B\", 3, \"A\", 1) into (dm: \"A\", $x, \"B\", $y))` sets $x to 1 and $y to 3.   ',anchor:\"macro_unpack\",category:\"data structure\"},move:{name:\"move\",sig:\" ...VariableToValue\",returnType:\"Command\",aka:[],abstract:\"A variant of (put:) that, if transferring data from a data structure, deletes the source value after copying it - in effect moving the value from the source to the destination.  \",anchor:\"macro_move\",category:\"basics\",categoryOrder:\"3\"},display:{name:\"display\",sig:\" String\",returnType:\"Command\",aka:[],abstract:\"This command writes out the contents of the passage with the given string name. If a passage of that name does not exist, this produces an error.  \",anchor:\"macro_display\",category:\"basics\",categoryOrder:\"5\"},print:{name:\"print\",sig:\" Any\",returnType:\"Command\",aka:[],abstract:\"This command prints out any data provided to it, as text.  \",anchor:\"macro_print\",category:\"basics\",categoryOrder:\"4\"},verbatimprint:{name:\"verbatim-print\",sig:\" Any\",returnType:\"Command\",aka:[\"v6m-print\"],abstract:\"A convenient combination of (verbatim:) and (print:), this prints out any single argument given to it, as text, but without rendering the resulting text as markup.  \",anchor:\"macro_verbatim-print\",category:\"basics\",categoryOrder:\"16\"},v6mprint:{name:\"verbatim-print\",sig:\" Any\",returnType:\"Command\",aka:[\"v6m-print\"],abstract:\"A convenient combination of (verbatim:) and (print:), this prints out any single argument given to it, as text, but without rendering the resulting text as markup.  \",anchor:\"macro_verbatim-print\",category:\"basics\",categoryOrder:\"16\"},verbatimsource:{name:\"verbatim-source\",sig:\" Any\",returnType:\"Command\",aka:[\"v6m-source\"],abstract:\"A convenient combination of (verbatim-print:) and (source:), this prints out the Harlowe source code of any value given to it.  \",anchor:\"macro_verbatim-source\",category:\"debugging\"},v6msource:{name:\"verbatim-source\",sig:\" Any\",returnType:\"Command\",aka:[\"v6m-source\"],abstract:\"A convenient combination of (verbatim-print:) and (source:), this prints out the Harlowe source code of any value given to it.  \",anchor:\"macro_verbatim-source\",category:\"debugging\"},goto:{name:\"go-to\",sig:\" String\",returnType:\"Command\",aka:[],abstract:\"This command stops passage code and sends the player to a new passage, starting a new turn as if a passage link was clicked. If the passage named by the string does not exist, this produces an error.  \",anchor:\"macro_go-to\",category:\"navigation\",categoryOrder:\"1\"},redirect:{name:\"redirect\",sig:\" String\",returnType:\"Command\",aka:[],abstract:\"This command sends the player to a new passage. However, unlike (goto:), this does *not* start a new turn - undoing after this will send the player to the turn before the redirect occurred.  \",anchor:\"macro_redirect\",category:\"navigation\",categoryOrder:\"2\"},undo:{name:\"undo\",sig:\" [String]\",returnType:\"Command\",aka:[],abstract:'This command stops passage code and \"undoes\" the current turn, sending the player to the previous visited passage and forgetting any variable changes that occurred in this passage. You may provide an optional string to display if undos aren\\'t available.  ',anchor:\"macro_undo\",category:\"navigation\",categoryOrder:\"3\"},debug:{name:\"debug\",sig:\"\",returnType:\"Command\",aka:[],abstract:\"This command, which takes no values, opens the Debug Mode panel if it wasn't open already. This can be used even if the story didn't begin in Debug Mode initially.  \",anchor:\"macro_debug\",category:\"debugging\"},iconundo:{name:\"icon-undo\",sig:\" [String], [String]\",returnType:\"Command\",aka:[],abstract:\"Creates an icon, similar to those in the sidebar, that, if visible and clicked, undoes the current turn, returning to the previous passage, as if by (undo:). It is not visible if undos aren't available.  \",anchor:\"macro_icon-undo\",category:\"sidebar\",categoryOrder:\"2\"},iconredo:{name:\"icon-redo\",sig:\" [String], [String]\",returnType:\"Command\",aka:[],abstract:'Creates an icon, similar to those in the sidebar, that, if visible and clicked, \"re-does\" a turn that was undone. It is only visible if a turn has been undone.  ',anchor:\"macro_icon-redo\",category:\"sidebar\",categoryOrder:\"3\"},iconfullscreen:{name:\"icon-fullscreen\",sig:\" [String], [String]\",returnType:\"Command\",aka:[],abstract:\"Creates an icon, similar to those in the sidebar, that, if visible and clicked, toggles fullscreen mode on or off.  \",anchor:\"macro_icon-fullscreen\",category:\"sidebar\",categoryOrder:\"4\"},iconrestart:{name:\"icon-restart\",sig:\" [String]\",returnType:\"Command\",aka:[],abstract:\"Creates an icon, similar to those in the sidebar, that, if visible and clicked, reloads the whole page, restarting the story from the beginning.  \",anchor:\"macro_icon-restart\",category:\"sidebar\",categoryOrder:\"5\"},iconcounter:{name:\"icon-counter\",sig:\" Bind, String, [String]\",returnType:\"Command\",aka:[],abstract:\"A command that creates a numeric counter element with a text label, designed to fit in the sidebar, displaying the contents of a number variable (rounded to a whole number as if by (trunc:)), and updating it whenever another macro changes it.  \",anchor:\"macro_icon-counter\",category:\"sidebar\",categoryOrder:\"6\"},meter:{name:\"meter\",sig:\" Bind, Number, String, [String], [Colour or Gradient]\",returnType:\"Command\",aka:[],abstract:\"A command that creates a horizontal bar-graph meter, showing the current value of a number variable, relative to a maximum value (the number), and updating it whenever that variable changes.  \",anchor:\"macro_meter\",category:\"input and interface\"},cyclinglink:{name:\"cycling-link\",sig:\" [Bind], ...String\",returnType:\"Command\",aka:[],abstract:\"A command that, when evaluated, creates a cycling link - a link which does not go anywhere, but changes its own text to the next in a looping sequence of strings, and sets the optional bound variable to match the string value of the text.  \",anchor:\"macro_cycling-link\",category:\"input and interface\",categoryOrder:\"1\"},seqlink:{name:\"seq-link\",sig:\" [Bind], ...String\",returnType:\"Command\",aka:[\"sequence-link\"],abstract:\"A command that creates a link that does not go anywhere, but changes its own text to the next in a sequence of strings, becoming plain text once the final string is reached, and setting the optional bound variable to match the text at all times.  \",anchor:\"macro_seq-link\",category:\"input and interface\",categoryOrder:\"2\"},sequencelink:{name:\"seq-link\",sig:\" [Bind], ...String\",returnType:\"Command\",aka:[\"sequence-link\"],abstract:\"A command that creates a link that does not go anywhere, but changes its own text to the next in a sequence of strings, becoming plain text once the final string is reached, and setting the optional bound variable to match the text at all times.  \",anchor:\"macro_seq-link\",category:\"input and interface\",categoryOrder:\"2\"},pic:{name:\"pic\",sig:\" Image\",returnType:\"Command\",aka:[\"picture\"],abstract:\"A basic command to show an image as a picture in your story's prose. The image appears as if by a HTML `<img>` tag.  \",anchor:\"macro_pic\",category:\"basics\"},picture:{name:\"pic\",sig:\" Image\",returnType:\"Command\",aka:[\"picture\"],abstract:\"A basic command to show an image as a picture in your story's prose. The image appears as if by a HTML `<img>` tag.  \",anchor:\"macro_pic\",category:\"basics\"},dropdown:{name:\"dropdown\",sig:\" Bind, ...String\",returnType:\"Command\",aka:[],abstract:\"A command that, when evaluated, creates a dropdown menu with the given strings as options. When one option is selected, the bound variable is set to match the string value of the text.  \",anchor:\"macro_dropdown\",category:\"input and interface\"},checkbox:{name:\"checkbox\",sig:\" Bind, String\",returnType:\"Command\",aka:[],abstract:\"A command that creates a checkbox input, which sets the given bound variable to `true` or `false`, depending on its state.  \",anchor:\"macro_checkbox\",category:\"input and interface\",categoryOrder:\"7\"},checkboxfullscreen:{name:\"checkbox-fullscreen\",sig:\" String\",returnType:\"Command\",aka:[],abstract:\"A command that creates a checkbox input, which toggles the browser's fullscreen mode and windowed mode. The checkbox will automatically update to match the browser's fullscreen status. If fullscreen mode cannot be entered, the checkbox will be disabled.  \",anchor:\"macro_checkbox-fullscreen\",category:\"input and interface\",categoryOrder:\"8\"},input:{name:\"input\",sig:\" [Bind], [String], [String]\",returnType:\"Command\",aka:[],abstract:\"A command macro that creates a single-line text input element, allowing the player to input any amount of text without newlines, which can optionally be automatically stored in a variable. The first string specifies the horizontal position and width, and the second string specifies an initial default value to fill the element with.  \",anchor:\"macro_input\",category:\"input and interface\",categoryOrder:\"3\"},forceinput:{name:\"force-input\",sig:\" [Bind], [String], String\",returnType:\"Command\",aka:[],abstract:\"A command macro that creates a single-line text input element which appears to offer the player a means to input text, but instead replaces every keypress inside it with characters from a pre-set string that's relevant to the story.  \",anchor:\"macro_force-input\",category:\"input and interface\",categoryOrder:\"4\"},inputbox:{name:\"input-box\",sig:\" [Bind], [String], [Measurement], [String]\",returnType:\"Command\",aka:[],abstract:\"A command macro that creates a multi-line text input box of the given position, width (specified by the first, optional string) and height (specified by the optional measurement), allowing the player to input any amount of text, which can optionally be automatically stored in a variable. The final optional string specifies an initial default value to fill the box with.  \",anchor:\"macro_input-box\",category:\"input and interface\",categoryOrder:\"5\"},forceinputbox:{name:\"force-input-box\",sig:\" [Bind], [String], [Measurement], String\",returnType:\"Command\",aka:[],abstract:\"A command macro that creates an empty text input box of the given position, width (specified by the first, optional string) and height (specified by the optional measurement), which appears to offer the player a means to input text, but instead replaces every keypress inside it with characters from a pre-set string that's relevant to the story.  \",anchor:\"macro_force-input-box\",category:\"input and interface\",categoryOrder:\"6\"},show:{name:\"show\",sig:\" ...HookName\",returnType:\"Command\",aka:[],abstract:\"Reveals hidden hooks, running the code within if it's not been shown yet.  \",anchor:\"macro_show\",category:\"showing and hiding\"},rerun:{name:\"rerun\",sig:\" ...HookName\",returnType:\"Command\",aka:[],abstract:\"Reruns hooks, restoring them to their original contents, and running the macros within them an additional time.  \",anchor:\"macro_rerun\",category:\"revision\"},hide:{name:\"hide\",sig:\" ...HookName\",returnType:\"Command\",aka:[],abstract:\"Hides a hook, or hooks, that were already visible, without fully erasing them or their contained macro calls.  \",anchor:\"macro_hide\",category:\"showing and hiding\"},scrollto:{name:\"scroll-to\",sig:\" HookName, Measurement or HookName\",returnType:\"Command\",aka:[\"scroll\"],abstract:\"This command, when given a HookName, followed by a measurement, will change the scroll position of every hook with that name to the height signified by the measurement, measured from the top. You may alternatively give another HookName instead, which, if a hook of that name is inside the first hook, will scroll the first hook and each containing hook such that the second hook is visible.  \",anchor:\"macro_scroll-to\",category:\"window\"},scroll:{name:\"scroll-to\",sig:\" HookName, Measurement or HookName\",returnType:\"Command\",aka:[\"scroll\"],abstract:\"This command, when given a HookName, followed by a measurement, will change the scroll position of every hook with that name to the height signified by the measurement, measured from the top. You may alternatively give another HookName instead, which, if a hook of that name is inside the first hook, will scroll the first hook and each containing hook such that the second hook is visible.  \",anchor:\"macro_scroll-to\",category:\"window\"},scrollby:{name:\"scroll-by\",sig:\" HookName, Measurement\",returnType:\"Command\",aka:[],abstract:\"This command, when given a HookName, followed by a measurement, will vertically scroll every hook with that name by the distance specified by that measurement.  \",anchor:\"macro_scroll-by\",category:\"window\"},stop:{name:\"stop\",sig:\"\",returnType:\"Command\",aka:[],abstract:\"This macro, which accepts no arguments, creates a (stop:) command, which is not configurable.  \",anchor:\"macro_stop\",category:\"live\",categoryOrder:\"2\"},loadgame:{name:\"load-game\",sig:\" String\",returnType:\"Command\",aka:[],abstract:\"This command attempts to load a saved game from the given slot, ending the current game and replacing it with the loaded one. This causes the passage to change.  \",anchor:\"macro_load-game\",category:\"saving\"},forgetundos:{name:\"forget-undos\",sig:\" Number\",returnType:\"Command\",aka:[],abstract:'This macro, when used, \"forgets\" previous turns, preventing the player from using undo features (like (link-undo:)) to return to them. Providing a positive number will forget that many turns from the start of the game, and providing a negative number will forget all the turns up to that point from the end.  ',anchor:\"macro_forget-undos\",category:\"game state\",categoryOrder:\"6\"},forgetvisits:{name:\"forget-visits\",sig:\" Number\",returnType:\"Command\",aka:[],abstract:'This macro \"forgets\" all visits that occurred before the given turn number - any passage visits that occurred on those turns are treated as if they didn\\'t happen. This causes (history:) to no longer list those passages at the start of the array, the `visits` identifier to report a different number for those passages, and (if the only visit to a passage was erased) the (visited:) macro to no longer regard a passage as visited.  ',anchor:\"macro_forget-visits\",category:\"game state\",categoryOrder:\"5\"},mockvisits:{name:\"mock-visits\",sig:\" ...String\",returnType:\"Command\",aka:[],abstract:'A macro that can only be used in debug mode, this allows you to mark various passages as \"visited\", even though the player actually hasn\\'t. This allows you to quickly test passages that use the `visits` keyword, or the `(history:)` datamap, without having to play through the whole game from the start.  ',anchor:\"macro_mock-visits\",category:\"debugging\"},mockturns:{name:\"mock-turns\",sig:\" Number\",returnType:\"Command\",aka:[],abstract:\"A macro that can only be used in debug mode, this allows you to artificially increase the number that the `visits` keyword evaluates to, without having to play through that many turns yourself.  \",anchor:\"macro_mock-turns\",category:\"debugging\"},seed:{name:\"seed\",sig:\" String\",returnType:\"Command\",aka:[],abstract:'A command that \"fixes\" Harlowe\\'s random number generator, causing all random macros and features to output predetermined values based on the given \"seed\" string.  ',anchor:\"macro_seed\",category:\"game state\"},dialog:{name:\"dialog\",sig:\" [Bind], String or CodeHook, ...String\",returnType:\"Command\",aka:[\"alert\"],abstract:\"A command that, when used, displays a pop-up dialog box with the given string or codehook displayed, and a number of button-shaped links labeled with the remaining other strings. If an optional bound variable is provided, that variable is updated to match the pressed button.  \",anchor:\"macro_dialog\",category:\"popup\",categoryOrder:\"1\"},alert:{name:\"dialog\",sig:\" [Bind], String or CodeHook, ...String\",returnType:\"Command\",aka:[\"alert\"],abstract:\"A command that, when used, displays a pop-up dialog box with the given string or codehook displayed, and a number of button-shaped links labeled with the remaining other strings. If an optional bound variable is provided, that variable is updated to match the pressed button.  \",anchor:\"macro_dialog\",category:\"popup\",categoryOrder:\"1\"},openurl:{name:\"open-url\",sig:\" String\",returnType:\"Command\",aka:[],abstract:\"When this macro is evaluated, the player's browser attempts to open a new tab with the given URL. This will usually require confirmation from the player, as most browsers block Javascript programs such as Harlowe from opening tabs by default.  \",anchor:\"macro_open-url\",category:\"window\"},restart:{name:\"restart\",sig:\"\",returnType:\"Command\",aka:[\"reload\"],abstract:\"When this command is used, the player's browser will immediately attempt to reload the page, in effect restarting the entire story.  \",anchor:\"macro_restart\",category:\"navigation\"},reload:{name:\"restart\",sig:\"\",returnType:\"Command\",aka:[\"reload\"],abstract:\"When this command is used, the player's browser will immediately attempt to reload the page, in effect restarting the entire story.  \",anchor:\"macro_restart\",category:\"navigation\"},gotourl:{name:\"goto-url\",sig:\" String\",returnType:\"Command\",aka:[],abstract:\"When this command is used, the player's browser will immediately attempt to leave the story's page, and navigate to the given URL in the same tab. If this succeeds, then the story session will \\\"end\\\".  \",anchor:\"macro_goto-url\",category:\"window\"},ignore:{name:\"ignore\",sig:\" [...Any]\",returnType:\"Command\",aka:[],abstract:\"If you want to test your passage while ignoring a specific command macro in it, temporarily change that command macro's name to (ignore:), and it will ignore all of the data given to it.  \",anchor:\"macro_ignore\",category:\"debugging\",categoryOrder:\"1\"},assertexists:{name:\"assert-exists\",sig:\" HookName or String\",returnType:\"Command\",aka:[],abstract:\"A debugging macro that confirms whether a hook with the given name, or passage text matching the given string, is present in the passage. If not, it will produce a helpful error. Use this to test whether enchantment macros like (click:), (enchant:) or (show:) are working properly.  \",anchor:\"macro_assert-exists\",category:\"debugging\",categoryOrder:\"5\"},assert:{name:\"assert\",sig:\" Boolean\",returnType:\"Command\",aka:[],abstract:\"A debugging macro that produces a helpful error whenever the expression given to it produces Boolean false. Use this when testing your story to help ensure that certain facts about the game state are true or not.  \",anchor:\"macro_assert\",category:\"debugging\",categoryOrder:\"4\"},savegame:{name:\"save-game\",sig:\" String, [String]\",returnType:\"Boolean\",aka:[],abstract:\"This macro saves the current game's state in browser storage, in the given save slot, and including a special filename. It can then be restored using (load-game:).  \",anchor:\"macro_save-game\",category:\"saving\"},prompt:{name:\"prompt\",sig:\" String or CodeHook, String, [String], [String]\",returnType:\"String\",aka:[],abstract:'When this macro is evaluated, a browser pop-up dialog box is shown with the first string displayed, a text entry box containing the second string (as a default value), a confirm link and a cancel link. If the confirm link is clicked, it evaluates to the string in the text entry box. If \"Cancel\" is clicked, it evaluates to the default value regardless of the entry box\\'s contents.  ',anchor:\"macro_prompt\",category:\"popup\"},confirm:{name:\"confirm\",sig:\" String or CodeHook, [String], [String]\",returnType:\"Boolean\",aka:[],abstract:\"When this macro is evaluated, a pop-up dialog box is shown with the given string displayed, as well as two links (whose text can also be provided) to confirm or cancel whatever action or fact the string tells the player. When it is submitted, it evaluates to the boolean `true` if the confirm link had been clicked, and `false` if the cancel link had.  \",anchor:\"macro_confirm\",category:\"popup\"},pageurl:{name:\"page-url\",sig:\"\",returnType:\"String\",aka:[],abstract:\"This macro produces the full URL of the story's HTML page, as it is in the player's browser.  \",anchor:\"macro_page-url\",category:\"window\"},macro:{name:\"macro\",sig:\" [...TypedVar], CodeHook\",returnType:\"CustomMacro\",aka:[],abstract:\"Use this macro to construct your own custom macros, which you can (define:) or (set:) into variables and call as easily as a built-in macro.  \",anchor:\"macro_macro\",category:\"custom macros\",categoryOrder:\"1\"},outputdata:{name:\"output-data\",sig:\" Any\",returnType:\"Instant\",aka:[\"out-data\"],abstract:\"Use this macro inside a (macro:)'s CodeHook to output the value that the macro produces.  \",anchor:\"macro_output-data\",category:\"custom macros\",categoryOrder:\"3\"},outdata:{name:\"output-data\",sig:\" Any\",returnType:\"Instant\",aka:[\"out-data\"],abstract:\"Use this macro inside a (macro:)'s CodeHook to output the value that the macro produces.  \",anchor:\"macro_output-data\",category:\"custom macros\",categoryOrder:\"3\"},output:{name:\"output\",sig:\"\",returnType:\"Changer\",aka:[\"out\"],abstract:\"Use this macro inside a (macro:)'s CodeHook to output a command that, when run, renders the attached hook.  \",anchor:\"macro_output\",category:\"custom macros\",categoryOrder:\"2\"},out:{name:\"output\",sig:\"\",returnType:\"Changer\",aka:[\"out\"],abstract:\"Use this macro inside a (macro:)'s CodeHook to output a command that, when run, renders the attached hook.  \",anchor:\"macro_output\",category:\"custom macros\",categoryOrder:\"2\"},error:{name:\"error\",sig:\" String\",returnType:\"Instant\",aka:[],abstract:\"Designed for use in custom macros, this causes the custom macro to immediately produce an error, with the given message string, and ceases running any further code in the CodeHook.  \",anchor:\"macro_error\",category:\"custom macros\",categoryOrder:\"4\"},partial:{name:\"partial\",sig:\" String or CustomMacro, [...Any]\",returnType:\"CustomMacro\",aka:[],abstract:\"When given either the string name of a built-in macro, or a custom macro, followed by various values, this creates a custom macro that serves as a shorthand for calling the given macro with those values, plus any additional values.  \",anchor:\"macro_partial\",category:\"custom macros\"},a:{name:\"a\",sig:\" [...Any]\",returnType:\"Array\",aka:[\"array\"],abstract:\"Creates an array, which is an ordered collection of values.  \",anchor:\"macro_a\",category:\"data structure\",categoryOrder:\"1\"},array:{name:\"a\",sig:\" [...Any]\",returnType:\"Array\",aka:[\"array\"],abstract:\"Creates an array, which is an ordered collection of values.  \",anchor:\"macro_a\",category:\"data structure\",categoryOrder:\"1\"},range:{name:\"range\",sig:\" Number, Number\",returnType:\"Array\",aka:[],abstract:\"Produces an array containing an inclusive range of whole numbers from a to b, in ascending order.  \",anchor:\"macro_range\",category:\"data structure\"},subarray:{name:\"subarray\",sig:\" Array, Number, Number\",returnType:\"Array\",aka:[],abstract:\"When given an array, this returns a new array containing only the elements whose positions are between the two numbers, inclusively.  \",anchor:\"macro_subarray\",category:\"data structure\"},reversed:{name:\"reversed\",sig:\" [...Any]\",returnType:\"Array\",aka:[],abstract:\"Similar to (a:), except that it creates an array containing the elements in reverse order.  \",anchor:\"macro_reversed\",category:\"data structure\"},shuffled:{name:\"shuffled\",sig:\" ...Any\",returnType:\"Array\",aka:[],abstract:\"Similar to (a:), this produces an array of the given values, except that it randomly rearranges the elements instead of placing them in the given order.  \",anchor:\"macro_shuffled\",category:\"data structure\"},sorted:{name:\"sorted\",sig:\" [Lambda], ...Any\",returnType:\"Array\",aka:[],abstract:'This macro produces an array in which the values are sorted in English alphanumeric sort order. If any of the values are not numbers or strings, a \"via\" lambda must be given first, which is used to translate the value into a number or string that it should be sorted by.  ',anchor:\"macro_sorted\",category:\"data structure\"},rotated:{name:\"rotated\",sig:\" Number, ...Any\",returnType:\"Array\",aka:[],abstract:\"Similar to the (a:) macro, but it also takes a number at the start, and moves each item forward by that number, wrapping back to the start if they pass the end of the array.  \",anchor:\"macro_rotated\",category:\"data structure\"},rotatedto:{name:\"rotated-to\",sig:\" Lambda, [...Any]\",returnType:\"Array\",aka:[],abstract:'Similar to the (a:) macro, but it also takes a \"where\" lambda at the start, and cycles the order of the subsequent values so that the first value to match the lambda is placed at the start.  ',anchor:\"macro_rotated-to\",category:\"data structure\"},repeated:{name:\"repeated\",sig:\" Number, ...Any\",returnType:\"Array\",aka:[],abstract:\"When given a number and a sequence of values, this macro produces an array containing those values repeated, in order, by the given number of times.  \",anchor:\"macro_repeated\",category:\"data structure\"},interlaced:{name:\"interlaced\",sig:\" Array, ...Array\",returnType:\"Array\",aka:[],abstract:\"Takes multiple arrays, and pairs up each value in those arrays: it creates an array containing each array's first value followed by each array's second value, and so forth. If some values have no matching pair (i.e. one array is longer than the other) then those values are ignored.  \",anchor:\"macro_interlaced\",category:\"data structure\"},permutations:{name:\"permutations\",sig:\" ...Any\",returnType:\"Array\",aka:[],abstract:\"When given a sequence of values, this produces an array containing each permutation of the order of those values, as arrays.  \",anchor:\"macro_permutations\",category:\"data structure\"},unique:{name:\"unique\",sig:\" ...Any\",returnType:\"Array\",aka:[],abstract:\"When given a sequence of values, this produces an array containing each unique value once, in the order that they appeared.  \",anchor:\"macro_unique\",category:\"data structure\"},altered:{name:\"altered\",sig:\" Lambda, [...Any]\",returnType:\"Array\",aka:[],abstract:'This takes a \"via\" lambda and a sequence of values, and creates a new array with the same values in the same order, but altered via the operation in the lambda\\'s \"via\" clause. An optional \"where\" clause can also be provided, which, if its condition is false, causes that particular value to be unchanged.  ',anchor:\"macro_altered\",category:\"data structure\"},find:{name:\"find\",sig:\" Lambda, [...Any]\",returnType:\"Array\",aka:[],abstract:\"This searches through the given values, and produces an array of those which match the given search test (which is expressed using a temp variable, the `where` keyword, and a boolean condition). If none match, an empty array is produced.  \",anchor:\"macro_find\",category:\"data structure\"},allpass:{name:\"all-pass\",sig:\" Lambda, [...Any]\",returnType:\"Boolean\",aka:[\"pass\"],abstract:'This takes a \"where\" lambda and a series of values, and evaluates to true if the lambda, when run using each value, never evaluated to false.  ',anchor:\"macro_all-pass\",category:\"data structure\"},pass:{name:\"all-pass\",sig:\" Lambda, [...Any]\",returnType:\"Boolean\",aka:[\"pass\"],abstract:'This takes a \"where\" lambda and a series of values, and evaluates to true if the lambda, when run using each value, never evaluated to false.  ',anchor:\"macro_all-pass\",category:\"data structure\"},somepass:{name:\"some-pass\",sig:\" Lambda, ...Any\",returnType:\"Boolean\",aka:[],abstract:\"This is similar to (all-pass:), but produces true if one or more value, when given to the lambda, evaluated to true. It can be thought of as shorthand for putting `not` in front of (none-pass:). If zero values are given to (all-pass:), then it will return false by default. For more information, consult the description of (all-pass:).  \",anchor:\"macro_some-pass\",category:\"data structure\"},nonepass:{name:\"none-pass\",sig:\" Lambda, ...Any\",returnType:\"Boolean\",aka:[],abstract:\"This can be thought of as the opposite of (all-pass:): it produces true if every value, when given to the lambda, never evaluated to true. If zero values are given to (none-pass:), then it will return true by default, just like (all-pass:). For more information, consult the description of (all-pass:).  \",anchor:\"macro_none-pass\",category:\"data structure\"},folded:{name:\"folded\",sig:\" Lambda, ...Any\",returnType:\"Any\",aka:[],abstract:'This takes a \"making\" lambda and a sequence of values, and creates a new value (the \"total\") by feeding every value in the sequence to the lambda, akin to folding a long strip of paper into a single square. The first value after the lambda is put into the total (which is the variable inside the lambda\\'s \"making\" clause) before running the lambda on the remaining values.  ',anchor:\"macro_folded\",category:\"data structure\"},dmnames:{name:\"dm-names\",sig:\" Datamap\",returnType:\"Array\",aka:[\"data-names\",\"datamap-names\"],abstract:\"This takes a datamap, and returns a sorted array of its data names, sorted alphabetically.  \",anchor:\"macro_dm-names\",category:\"data structure\"},datanames:{name:\"dm-names\",sig:\" Datamap\",returnType:\"Array\",aka:[\"data-names\",\"datamap-names\"],abstract:\"This takes a datamap, and returns a sorted array of its data names, sorted alphabetically.  \",anchor:\"macro_dm-names\",category:\"data structure\"},datamapnames:{name:\"dm-names\",sig:\" Datamap\",returnType:\"Array\",aka:[\"data-names\",\"datamap-names\"],abstract:\"This takes a datamap, and returns a sorted array of its data names, sorted alphabetically.  \",anchor:\"macro_dm-names\",category:\"data structure\"},dmvalues:{name:\"dm-values\",sig:\" Datamap\",returnType:\"Array\",aka:[\"data-values\",\"datamap-values\"],abstract:\"This takes a datamap, and returns an array of its values, sorted alphabetically by their name.  \",anchor:\"macro_dm-values\",category:\"data structure\"},datavalues:{name:\"dm-values\",sig:\" Datamap\",returnType:\"Array\",aka:[\"data-values\",\"datamap-values\"],abstract:\"This takes a datamap, and returns an array of its values, sorted alphabetically by their name.  \",anchor:\"macro_dm-values\",category:\"data structure\"},datamapvalues:{name:\"dm-values\",sig:\" Datamap\",returnType:\"Array\",aka:[\"data-values\",\"datamap-values\"],abstract:\"This takes a datamap, and returns an array of its values, sorted alphabetically by their name.  \",anchor:\"macro_dm-values\",category:\"data structure\"},dmentries:{name:\"dm-entries\",sig:\" Datamap\",returnType:\"Array\",aka:[\"data-entries\",\"datamap-entries\"],abstract:'This takes a datamap, and returns an array of its name/value pairs. Each pair is a datamap that only has \"name\" and \"value\" data. The pairs are ordered by their name.  ',anchor:\"macro_dm-entries\",category:\"data structure\"},dataentries:{name:\"dm-entries\",sig:\" Datamap\",returnType:\"Array\",aka:[\"data-entries\",\"datamap-entries\"],abstract:'This takes a datamap, and returns an array of its name/value pairs. Each pair is a datamap that only has \"name\" and \"value\" data. The pairs are ordered by their name.  ',anchor:\"macro_dm-entries\",category:\"data structure\"},datamapentries:{name:\"dm-entries\",sig:\" Datamap\",returnType:\"Array\",aka:[\"data-entries\",\"datamap-entries\"],abstract:'This takes a datamap, and returns an array of its name/value pairs. Each pair is a datamap that only has \"name\" and \"value\" data. The pairs are ordered by their name.  ',anchor:\"macro_dm-entries\",category:\"data structure\"},dmaltered:{name:\"dm-altered\",sig:\" Lambda, Datamap\",returnType:\"Datamap\",aka:[\"datamap-altered\"],abstract:\"This is a variant of (altered:) which takes a \\\"via\\\" lambda and a single datamap, and creates a new datamap with the same datanames, but with the values changed by the 'via' lambda. The 'via' lambda is given a datamap with 'name' and 'value' datanames (identical to those in the array produced by (data-entries:)), so that the name of each data value can be used in the lambda, but it must produce a single data value. An optional \\\"where\\\" clause can also be provided, which, if its condition is false, causes that particular value to be unchanged.  \",anchor:\"macro_dm-altered\",category:\"data structure\"},datamapaltered:{name:\"dm-altered\",sig:\" Lambda, Datamap\",returnType:\"Datamap\",aka:[\"datamap-altered\"],abstract:\"This is a variant of (altered:) which takes a \\\"via\\\" lambda and a single datamap, and creates a new datamap with the same datanames, but with the values changed by the 'via' lambda. The 'via' lambda is given a datamap with 'name' and 'value' datanames (identical to those in the array produced by (data-entries:)), so that the name of each data value can be used in the lambda, but it must produce a single data value. An optional \\\"where\\\" clause can also be provided, which, if its condition is false, causes that particular value to be unchanged.  \",anchor:\"macro_dm-altered\",category:\"data structure\"},history:{name:\"history\",sig:\" [Lambda]\",returnType:\"Array\",aka:[],abstract:\"This returns an array containing the string names of all of the passages the player has previously visited up to now, in the order that the player visited them. An optional lambda can filter the passages, by checking the (passage:) datamap of each. The (mock-visits:) macro can, during debugging, artifically add values to this array to simulate having visited various passages.  \",anchor:\"macro_history\",category:\"game state\",categoryOrder:\"1\"},visited:{name:\"visited\",sig:\" String or Lambda\",returnType:\"Boolean\",aka:[],abstract:'When given a string, this macro produces true if the passage has ever been visited during this game, and false otherwise. When given a \"where\" lambda, this returns true if any passage matching the lambda has ever been visited during this game. The (mock-visits:) macro can, during debugging, make this macro return true in cases where it would otherwise be false.  ',anchor:\"macro_visited\",category:\"game state\",categoryOrder:\"2\"},passage:{name:\"passage\",sig:\" [String]\",returnType:\"Datamap\",aka:[],abstract:\"When given a passage string name, this provides a datamap containing information about that passage. If no name was provided, then it provides information about the current passage.  \",anchor:\"macro_passage\",category:\"game state\",categoryOrder:\"3\"},passages:{name:\"passages\",sig:\" [Lambda]\",returnType:\"Array\",aka:[],abstract:\"This returns an array containing datamaps of information for the passages in the story, sorted by passage name, and using the optional search test to only include certain types of passages.  \",anchor:\"macro_passages\",category:\"game state\",categoryOrder:\"4\"},openstorylets:{name:\"open-storylets\",sig:\" [Lambda]\",returnType:\"Array\",aka:[],abstract:'Checks all of the (storylet:) macros in every passage, and provides an array of datamaps for every passage whose (storylet:) lambda produced true, sorted by their \"urgency\" metadata value, then by passage name. If a lambda was provided, the storylets are filtered using it as a search test.  ',anchor:\"macro_open-storylets\",category:\"storylet\",categoryOrder:\"2\"},savedgames:{name:\"saved-games\",sig:\"\",returnType:\"Datamap\",aka:[],abstract:\"This returns a datamap containing the names of currently occupied save game slots.  \",anchor:\"macro_saved-games\",category:\"saving\"},dm:{name:\"dm\",sig:\" [...Any]\",returnType:\"Datamap\",aka:[\"datamap\"],abstract:\"Creates a datamap, which is a data structure that pairs string names with data values. You should provide a string name, followed by the value paired with it, and then another string name, another value, and so on, for as many as you'd like.  \",anchor:\"macro_dm\",category:\"data structure\",categoryOrder:\"2\"},datamap:{name:\"dm\",sig:\" [...Any]\",returnType:\"Datamap\",aka:[\"datamap\"],abstract:\"Creates a datamap, which is a data structure that pairs string names with data values. You should provide a string name, followed by the value paired with it, and then another string name, another value, and so on, for as many as you'd like.  \",anchor:\"macro_dm\",category:\"data structure\",categoryOrder:\"2\"},ds:{name:\"ds\",sig:\" [...Any]\",returnType:\"Dataset\",aka:[\"dataset\"],abstract:\"Creates a dataset, which is an unordered collection of unique values.  \",anchor:\"macro_ds\",category:\"data structure\",categoryOrder:\"3\"},dataset:{name:\"ds\",sig:\" [...Any]\",returnType:\"Dataset\",aka:[\"dataset\"],abstract:\"Creates a dataset, which is an unordered collection of unique values.  \",anchor:\"macro_ds\",category:\"data structure\",categoryOrder:\"3\"},count:{name:\"count\",sig:\" Array or String, ...Any\",returnType:\"Number\",aka:[],abstract:\"Accepts a string or array, followed by a value, and produces the number of times any of the values are inside the string or array.  \",anchor:\"macro_count\",category:\"data structure\"},change:{name:\"change\",sig:\" HookName or String, Changer or Lambda\",returnType:\"Command\",aka:[],abstract:'Applies a changer (or a \"via\" lambda producing a changer) to every occurrence of a hook or string in a passage, once.  ',anchor:\"macro_change\",category:\"basics\",categoryOrder:\"17\"},enchant:{name:\"enchant\",sig:\" HookName or String, Changer or Lambda\",returnType:\"Command\",aka:[],abstract:'Applies a changer (or a \"via\" lambda producing a changer) to every occurrence of a hook or string in a passage, and continues applying that changer to any further occurrences that are made to appear in the same passage later.  ',anchor:\"macro_enchant\",category:\"basics\",categoryOrder:\"18\"},enchantin:{name:\"enchant-in\",sig:\" HookName or String, Changer or Lambda\",returnType:\"Changer\",aka:[],abstract:\"A variation of (enchant:) and (change:), this applies a changer to every occurrence of a hook or string within just the attached hook, rather than the whole passage. As with (enchant:), the changer will be applied to every additional occurrence inserted into the attached hook.  \",anchor:\"macro_enchant-in\",category:\"basics\",categoryOrder:\"19\"},linkstyle:{name:\"link-style\",sig:\" Changer or Lambda\",returnType:\"Changer\",aka:[],abstract:\"When attached to a hook, this causes all of the links inside the hook to be styled using the specified changer. This is equivalent to using (enchant-in:) with `?link`.  \",anchor:\"macro_link-style\",category:\"styling\"},linestyle:{name:\"line-style\",sig:\" Changer or Lambda\",returnType:\"Changer\",aka:[],abstract:\"When attached to a hook, this causes all of the lines of prose inside the hook (identical to those that would be selected by `?page's lines`) to be styled using the specified changer.  \",anchor:\"macro_line-style\",category:\"styling\"},charstyle:{name:\"char-style\",sig:\" Changer or Lambda\",returnType:\"Changer\",aka:[],abstract:\"When attached to a hook, this causes all of the individual non-whitespace characters inside the hook (identical to those that would be selected by `?page's chars`) to be styled using the specified changer.  \",anchor:\"macro_char-style\",category:\"styling\"},replace:{name:\"replace\",sig:\" ...HookName or String\",returnType:\"Changer\",aka:[],abstract:\"Creates a command which you can attach to a hook, and replace target destinations with the hook's contents. The targets are either text strings within the current passage, or hook references.  Not to be confused with (str-replaced:).  \",anchor:\"macro_replace\",category:\"revision\",categoryOrder:\"1\"},replacewith:{name:\"replace-with\",sig:\" String or CodeHook\",returnType:\"Changer\",aka:[],abstract:\"A counterpart to (append-with:) and (prepend-with:), this replaces the entirety of the attached hook with the contents of the given string (or code hook).  \",anchor:\"macro_replace-with\",category:\"revision\",categoryOrder:\"4\"},append:{name:\"append\",sig:\" ...HookName or String\",returnType:\"Changer\",aka:[],abstract:\"A variation of (replace:) which adds the attached hook's contents to the end of each target, rather than replacing it entirely.  \",anchor:\"macro_append\",category:\"revision\",categoryOrder:\"2\"},appendwith:{name:\"append-with\",sig:\" String or CodeHook\",returnType:\"Changer\",aka:[],abstract:\"Creates a changer that, when attached to a hook, adds the contents of the given string (or code hook) to the end of the hook.  \",anchor:\"macro_append-with\",category:\"revision\",categoryOrder:\"5\"},prepend:{name:\"prepend\",sig:\" ...HookName or String\",returnType:\"Changer\",aka:[],abstract:\"A variation of (replace:) which adds the attached hook's contents to the beginning of each target, rather than replacing it entirely.  \",anchor:\"macro_prepend\",category:\"revision\",categoryOrder:\"3\"},prependwith:{name:\"prepend-with\",sig:\" String or CodeHook\",returnType:\"Changer\",aka:[],abstract:\"Creates a changer that, when attached to a hook, adds the contents of a given string (or code hook) to the start of the hook.  \",anchor:\"macro_prepend-with\",category:\"revision\",categoryOrder:\"6\"},click:{name:\"click\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"Produces a changer which, when attached to a hook, hides it and enchants the specified target, such that it visually resembles a link, and that clicking it causes the attached hook to be revealed.  \",anchor:\"macro_click\",category:\"links\",categoryOrder:\"9\"},clickrerun:{name:\"click-rerun\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"A special version of the (click:) macro which allows the enchanted hook or text (specified by the first value) to be activated multiple times to re-run the attached hook.  \",anchor:\"macro_click-rerun\",category:\"links\",categoryOrder:\"10\"},mouseover:{name:\"mouseover\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"\",anchor:\"macro_mouseover\",category:\"deprecated\"},mouseout:{name:\"mouseout\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"\",anchor:\"macro_mouseout\",category:\"deprecated\"},clickreplace:{name:\"click-replace\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"A special shorthand combination of the (click:) and (replace:) macros, this allows you to make a hook replace its own text with that of the attached hook whenever it's clicked. `(click: ?1)[(replace:?1)[...]]` can be rewritten as `(click-replace: ?1)[...]`.  \",anchor:\"macro_click-replace\",category:\"links\",categoryOrder:\"10\"},clickappend:{name:\"click-append\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"A special shorthand combination of the (click:) and (append:) macros, this allows you to append text to a hook or string when it's clicked. `(click: ?1)[(append:?1)[...]]` can be rewritten as `(click-append: ?1)[...]`.  \",anchor:\"macro_click-append\",category:\"links\",categoryOrder:\"11\"},clickprepend:{name:\"click-prepend\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"A special shorthand combination of the (click:) and (prepend:) macros, this allows you to prepend text to a hook or string when it's clicked. `(click: ?1)[(prepend:?1)[...]]` can be rewritten as `(click-prepend: ?1)[...]`.  \",anchor:\"macro_click-prepend\",category:\"links\",categoryOrder:\"12\"},mouseoverreplace:{name:\"mouseover-replace\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"\",anchor:\"macro_mouseover-replace\",category:\"deprecated\"},mouseoverappend:{name:\"mouseover-append\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"\",anchor:\"macro_mouseover-append\",category:\"deprecated\"},mouseoverprepend:{name:\"mouseover-prepend\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"\",anchor:\"macro_mouseover-prepend\",category:\"deprecated\"},mouseoutreplace:{name:\"mouseout-replace\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"\",anchor:\"macro_mouseout-replace\",category:\"deprecated\"},mouseoutappend:{name:\"mouseout-append\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"\",anchor:\"macro_mouseout-append\",category:\"deprecated\"},mouseoutprepend:{name:\"mouseout-prepend\",sig:\" HookName or String, [Changer or Lambda]\",returnType:\"Changer\",aka:[],abstract:\"\",anchor:\"macro_mouseout-prepend\",category:\"deprecated\"},clickgoto:{name:\"click-goto\",sig:\" HookName or String, String\",returnType:\"Command\",aka:[],abstract:\"A special shorthand combination of the (click:) and (go-to:) macros, this allows you to make a hook or bit of text into a passage link. `(click-goto: ?1, 'Passage Name')` is equivalent to `(click: ?1)[(goto:'Passage Name')]`  \",anchor:\"macro_click-goto\",category:\"links\",categoryOrder:\"11\"},mouseovergoto:{name:\"mouseover-goto\",sig:\" HookName or String, String\",returnType:\"Command\",aka:[],abstract:\"\",anchor:\"macro_mouseover-goto\",category:\"deprecated\"},mouseoutgoto:{name:\"mouseout-goto\",sig:\" HookName or String, String\",returnType:\"Command\",aka:[],abstract:\"\",anchor:\"macro_mouseout-goto\",category:\"deprecated\"},clickundo:{name:\"click-undo\",sig:\" HookName or String\",returnType:\"Command\",aka:[],abstract:\"A special shorthand combination of the (click:) and (undo:) macros, this allows you to make a hook or bit of text into a passage link. `(click-undo: ?1)` is equivalent to `(click: ?1)[(undo: )]`  \",anchor:\"macro_click-undo\",category:\"links\",categoryOrder:\"11\"},mouseoverundo:{name:\"mouseover-undo\",sig:\" HookName or String, String\",returnType:\"Command\",aka:[],abstract:\"\",anchor:\"macro_mouseover-undo\",category:\"deprecated\"},mouseoutundo:{name:\"mouseout-undo\",sig:\" HookName or String, String\",returnType:\"Command\",aka:[],abstract:\"\",anchor:\"macro_mouseout-undo\",category:\"deprecated\"},link:{name:\"link\",sig:\" String, [Changer]\",returnType:\"Changer\",aka:[\"link-replace\"],abstract:\"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, vanishes and reveals the hook. An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  \",anchor:\"macro_link\",category:\"links\",categoryOrder:\"1\"},linkreplace:{name:\"link\",sig:\" String, [Changer]\",returnType:\"Changer\",aka:[\"link-replace\"],abstract:\"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, vanishes and reveals the hook. An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  \",anchor:\"macro_link\",category:\"links\",categoryOrder:\"1\"},linkreveal:{name:\"link-reveal\",sig:\" String, [Changer]\",returnType:\"Changer\",aka:[\"link-append\"],abstract:\"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, reveals the hook and becomes plain, unstyled text. An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  \",anchor:\"macro_link-reveal\",category:\"links\",categoryOrder:\"2\"},linkappend:{name:\"link-reveal\",sig:\" String, [Changer]\",returnType:\"Changer\",aka:[\"link-append\"],abstract:\"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, reveals the hook and becomes plain, unstyled text. An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  \",anchor:\"macro_link-reveal\",category:\"links\",categoryOrder:\"2\"},linkrepeat:{name:\"link-repeat\",sig:\" String, [Changer]\",returnType:\"Changer\",aka:[],abstract:\"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, reveals the hook. Further clicks will cause the hook to repeat itself - a copy of the hook's code will be run, and the result appended to it, in a manner similar to (for:). An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  \",anchor:\"macro_link-repeat\",category:\"links\",categoryOrder:\"3\"},linkrerun:{name:\"link-rerun\",sig:\" String, [Changer]\",returnType:\"Changer\",aka:[],abstract:\"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, reveals the hook. Further clicks will cause the hook to rerun itself, as if by the effect of (rerun:). An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  \",anchor:\"macro_link-rerun\",category:\"links\",categoryOrder:\"4\"},linkgoto:{name:\"link-goto\",sig:\" String, [String]\",returnType:\"Command\",aka:[],abstract:\"Takes a string of link text, and an optional destination passage name, and makes a command to create a link that takes the player to another passage. The link functions identically to a standard link.  \",anchor:\"macro_link-goto\",category:\"links\",categoryOrder:\"5\"},linkstorylet:{name:\"link-storylet\",sig:\" [String], Number or Lambda, [String]\",returnType:\"Command\",aka:[],abstract:\"If there are storylets (storylets are passages containing a (storylet:) call) in this story, this will create a link to the first open storylet that matches the passed-in 'where' lambda, or, if a number **n** was passed in, the **n**th (or, if negative, **n**thlast) open storylet. An optional first string can provide the link text - otherwise, the link text is the passage name of the storylet. An optional final string can provide text to display when no such storylet is open currently.  \",anchor:\"macro_link-storylet\",category:\"links\",categoryOrder:\"8\"},linkundo:{name:\"link-undo\",sig:\" String, [String]\",returnType:\"Command\",aka:[],abstract:\"Takes a string of link text, and produces a link that, when clicked, undoes the current turn and sends the player back to the previously visited passage. The link appears identical to a typical passage link. An optional second string can be provided, which is shown instead of the link if it's not possible to undo.  \",anchor:\"macro_link-undo\",category:\"links\",categoryOrder:\"7\"},linkshow:{name:\"link-show\",sig:\" String, ...HookName\",returnType:\"Command\",aka:[],abstract:\"Creates a link that, when clicked, shows the given hidden hooks, running the code within.  \",anchor:\"macro_link-show\",category:\"links\",categoryOrder:\"8\"},linkfullscreen:{name:\"link-fullscreen\",sig:\" String, String, [String]\",returnType:\"Command\",aka:[],abstract:\"Creates a link that, when clicked, toggles the browser's fullscreen mode and windowed mode. The first string is used as its link text if the browser is currently in windowed mode, and the second string if it's currently in fullscreen mode. The link will automatically update (re-rendering the link text) to match the browser's current fullscreen state. The optional third string is used when fullscreen mode isn't allowed by the browser - if it's absent or an empty string, the link won't be displayed at all in that situation.  \",anchor:\"macro_link-fullscreen\",category:\"links\",categoryOrder:\"8\"},linkrevealgoto:{name:\"link-reveal-goto\",sig:\" String, [String], [Changer]\",returnType:\"Changer\",aka:[],abstract:\"This is a convenient combination of the (link-reveal:) and (go-to:) macros, designed to let you run commands like (set:) just before going to another passage. The first string is the link text, and the second is the passage name. An optional changer, with which to style the link, can also be provided.  \",anchor:\"macro_link-reveal-goto\",category:\"links\",categoryOrder:\"6\"},storylet:{name:\"storylet\",sig:\" Lambda\",returnType:\"Metadata\",aka:[],abstract:\"When placed in a passage, it marks that passage as the beginning of a storylet, using the lambda as the condition upon which it's available to the player, so that other macros, like (open-storylets:), can see and select the passage.  \",anchor:\"macro_storylet\",category:\"storylet\",categoryOrder:\"1\"},urgency:{name:\"urgency\",sig:\" Number\",returnType:\"Metadata\",aka:[],abstract:'When placed in a passage that also has a (storylet:) call, it marks that passage as being more or less \"urgent\", meaning that (open-storylets:) will sort it earlier or later than other passages.  ',anchor:\"macro_urgency\",category:\"storylet\",categoryOrder:\"4\"},exclusivity:{name:\"exclusivity\",sig:\" Number\",returnType:\"Metadata\",aka:[],abstract:'When placed in a passage that also has a (storylet:) call, it marks that passage as being more or less \"exclusive\", meaning that if it\\'s open, it will prevent storylets with lesser exclusivity from appearing in (open-storylets:).  ',anchor:\"macro_exclusivity\",category:\"storylet\",categoryOrder:\"3\"},metadata:{name:\"metadata\",sig:\" [...Any]\",returnType:\"Metadata\",aka:[],abstract:\"When placed in a passage, this adds the given names and values to the (passage:) datamap for this passage.  \",anchor:\"macro_metadata\",category:\"game state\"},define:{name:\"define\",sig:\" ...VariableToValue\",returnType:\"Metadata\",aka:[],abstract:'Stores data in a variable permanently, and make it available from the very start of the story, regardless of which passage this macro call appears in. It \"defines\" the variable to always mean that given data.  ',anchor:\"macro_define\",category:\"basics\",categoryOrder:\"3\"},p:{name:\"p\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern\"],abstract:\"Creates a string pattern, a special kind of datatype that can match complex string structures. The pattern matches the entire sequence of strings or datatypes given, in order.  \",anchor:\"macro_p\",category:\"patterns\",categoryOrder:\"1\"},pattern:{name:\"p\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern\"],abstract:\"Creates a string pattern, a special kind of datatype that can match complex string structures. The pattern matches the entire sequence of strings or datatypes given, in order.  \",anchor:\"macro_p\",category:\"patterns\",categoryOrder:\"1\"},peither:{name:\"p-either\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-either\"],abstract:\"Creates a string pattern that matches either of the single strings or datatypes given.  \",anchor:\"macro_p-either\",category:\"patterns\",categoryOrder:\"2\"},patterneither:{name:\"p-either\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-either\"],abstract:\"Creates a string pattern that matches either of the single strings or datatypes given.  \",anchor:\"macro_p-either\",category:\"patterns\",categoryOrder:\"2\"},popt:{name:\"p-opt\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-opt\",\"p-optional\",\"pattern-optional\"],abstract:\"Creates a string pattern that either matches the sequence of strings or datatypes given, or matches the empty string.  \",anchor:\"macro_p-opt\",category:\"patterns\",categoryOrder:\"3\"},patternopt:{name:\"p-opt\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-opt\",\"p-optional\",\"pattern-optional\"],abstract:\"Creates a string pattern that either matches the sequence of strings or datatypes given, or matches the empty string.  \",anchor:\"macro_p-opt\",category:\"patterns\",categoryOrder:\"3\"},poptional:{name:\"p-opt\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-opt\",\"p-optional\",\"pattern-optional\"],abstract:\"Creates a string pattern that either matches the sequence of strings or datatypes given, or matches the empty string.  \",anchor:\"macro_p-opt\",category:\"patterns\",categoryOrder:\"3\"},patternoptional:{name:\"p-opt\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-opt\",\"p-optional\",\"pattern-optional\"],abstract:\"Creates a string pattern that either matches the sequence of strings or datatypes given, or matches the empty string.  \",anchor:\"macro_p-opt\",category:\"patterns\",categoryOrder:\"3\"},pnot:{name:\"p-not\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-not\"],abstract:\"Given any number of single characters or non-spread datatypes, this creates a string pattern that matches any one character that doesn't match any of those values.  \",anchor:\"macro_p-not\",category:\"patterns\",categoryOrder:\"6\"},patternnot:{name:\"p-not\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-not\"],abstract:\"Given any number of single characters or non-spread datatypes, this creates a string pattern that matches any one character that doesn't match any of those values.  \",anchor:\"macro_p-not\",category:\"patterns\",categoryOrder:\"6\"},pnotbefore:{name:\"p-not-before\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-not-before\"],abstract:'Creates a string pattern that matches the empty string, *unless* it is followed by the given sequence of strings or datatypes. This is best used inside another pattern macro like (p:), alongside a pattern to match, where it serves as an extra restriction on that pattern (making it match only if it\\'s \"not before\" something).  ',anchor:\"macro_p-not-before\",category:\"patterns\",categoryOrder:\"8\"},patternnotbefore:{name:\"p-not-before\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-not-before\"],abstract:'Creates a string pattern that matches the empty string, *unless* it is followed by the given sequence of strings or datatypes. This is best used inside another pattern macro like (p:), alongside a pattern to match, where it serves as an extra restriction on that pattern (making it match only if it\\'s \"not before\" something).  ',anchor:\"macro_p-not-before\",category:\"patterns\",categoryOrder:\"8\"},pbefore:{name:\"p-before\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-before\"],abstract:'Creates a string pattern that matches the empty string, *only* it is followed by the given sequence of strings or datatypes. This is best used inside another pattern macro like (p:), alongside a pattern to match, where it serves as an extra restriction on that pattern (making it match only if it\\'s \"not before\" something).  ',anchor:\"macro_p-before\",category:\"patterns\",categoryOrder:\"7\"},patternbefore:{name:\"p-before\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-before\"],abstract:'Creates a string pattern that matches the empty string, *only* it is followed by the given sequence of strings or datatypes. This is best used inside another pattern macro like (p:), alongside a pattern to match, where it serves as an extra restriction on that pattern (making it match only if it\\'s \"not before\" something).  ',anchor:\"macro_p-before\",category:\"patterns\",categoryOrder:\"7\"},pstart:{name:\"p-start\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-start\"],abstract:\"Identical to (p:), except that when used with macros that search for substrings in strings, like (str-find:), (str-replaced:) and (trimmed:), this only matches if the given strings or datatypes appear at the very start of the string.  \",anchor:\"macro_p-start\",category:\"patterns\",categoryOrder:\"9\"},patternstart:{name:\"p-end\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-start\"],abstract:\"Identical to (p:), except that when used with macros that search for substrings in strings, like (str-find:), (str-replaced:) and (trimmed:), this only matches if the given strings or datatypes appear at the very end of the string.  \",anchor:\"macro_p-end\",category:\"patterns\",categoryOrder:\"10\"},pend:{name:\"p-end\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-start\"],abstract:\"Identical to (p:), except that when used with macros that search for substrings in strings, like (str-find:), (str-replaced:) and (trimmed:), this only matches if the given strings or datatypes appear at the very end of the string.  \",anchor:\"macro_p-end\",category:\"patterns\",categoryOrder:\"10\"},pmany:{name:\"p-many\",sig:\" [Number], [Number], ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-many\"],abstract:\"Creates a string pattern that matches the given sequence of strings and datatypes, repeated a given minimum and maximum number of times - or, if these aren't provided, repeated any number of times.  \",anchor:\"macro_p-many\",category:\"patterns\",categoryOrder:\"4\"},patternmany:{name:\"p-many\",sig:\" [Number], [Number], ...String or Datatype\",returnType:\"Datatype\",aka:[\"pattern-many\"],abstract:\"Creates a string pattern that matches the given sequence of strings and datatypes, repeated a given minimum and maximum number of times - or, if these aren't provided, repeated any number of times.  \",anchor:\"macro_p-many\",category:\"patterns\",categoryOrder:\"4\"},pins:{name:\"p-ins\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"p-insensitive\",\"pattern-ins\",\"pattern-insensitive\"],abstract:\"Creates a string pattern that matches the sequence of strings or datatypes given, case-insensitively.  \",anchor:\"macro_p-ins\",category:\"patterns\",categoryOrder:\"10\"},pinsensitive:{name:\"p-ins\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"p-insensitive\",\"pattern-ins\",\"pattern-insensitive\"],abstract:\"Creates a string pattern that matches the sequence of strings or datatypes given, case-insensitively.  \",anchor:\"macro_p-ins\",category:\"patterns\",categoryOrder:\"10\"},patternins:{name:\"p-ins\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"p-insensitive\",\"pattern-ins\",\"pattern-insensitive\"],abstract:\"Creates a string pattern that matches the sequence of strings or datatypes given, case-insensitively.  \",anchor:\"macro_p-ins\",category:\"patterns\",categoryOrder:\"10\"},patterninsensitive:{name:\"p-ins\",sig:\" ...String or Datatype\",returnType:\"Datatype\",aka:[\"p-insensitive\",\"pattern-ins\",\"pattern-insensitive\"],abstract:\"Creates a string pattern that matches the sequence of strings or datatypes given, case-insensitively.  \",anchor:\"macro_p-ins\",category:\"patterns\",categoryOrder:\"10\"},split:{name:\"split\",sig:\" String or Datatype, String\",returnType:\"Array\",aka:[\"splitted\"],abstract:\"This splits up the second value given to it into an array of substrings, after finding and removing each occurrence of the first string or pattern (which is used as a separator value).  \",anchor:\"macro_split\",category:\"string\"},splitted:{name:\"split\",sig:\" String or Datatype, String\",returnType:\"Array\",aka:[\"splitted\"],abstract:\"This splits up the second value given to it into an array of substrings, after finding and removing each occurrence of the first string or pattern (which is used as a separator value).  \",anchor:\"macro_split\",category:\"string\"},trimmed:{name:\"trimmed\",sig:\" [String or Datatype], String\",returnType:\"String\",aka:[],abstract:\"This macro takes one string (the last value), and produces a copy with every character matching the given pattern (the first value) removed from the start and end of it. If no pattern is given, it defaults to removing whitespace, as if `whitespace` was the first argument.  \",anchor:\"macro_trimmed\",category:\"string\"},strfind:{name:\"str-find\",sig:\" Datatype, String\",returnType:\"Array\",aka:[\"string-find\"],abstract:'Also known as: (string-find:)  When given a string pattern and a string, this produces an array of each substring within the string that the pattern matched. If typed variables were in the pattern, this instead produces an array of datamaps, each of which has data names matching the variables, and data values matching the portions of the string matched by those typed variables, as well as a \"match\" data name for the full substring.  ',anchor:\"macro_str-find\",category:\"string\"},stringfind:{name:\"str-find\",sig:\" Datatype, String\",returnType:\"Array\",aka:[\"string-find\"],abstract:'Also known as: (string-find:)  When given a string pattern and a string, this produces an array of each substring within the string that the pattern matched. If typed variables were in the pattern, this instead produces an array of datamaps, each of which has data names matching the variables, and data values matching the portions of the string matched by those typed variables, as well as a \"match\" data name for the full substring.  ',anchor:\"macro_str-find\",category:\"string\"},strreplaced:{name:\"str-replaced\",sig:\" [Number], String or Datatype, String or Lambda, String\",returnType:\"String\",aka:[\"string-replaced\",\"replaced\"],abstract:'Also known as: (string-replaced:), (replaced:)  This macro produces a copy of the content string (the last string given), with all instances of a certain search string (or pattern) replaced using a given string (or a \"via\" lambda that constructs a replacement string). Giving an optional number N lets you only replace the first N instances. If a pattern is given, TypedVars may be used inside it, and they will be accessible in the \"via\" lambda.  ',anchor:\"macro_str-replaced\",category:\"string\"},stringreplaced:{name:\"str-replaced\",sig:\" [Number], String or Datatype, String or Lambda, String\",returnType:\"String\",aka:[\"string-replaced\",\"replaced\"],abstract:'Also known as: (string-replaced:), (replaced:)  This macro produces a copy of the content string (the last string given), with all instances of a certain search string (or pattern) replaced using a given string (or a \"via\" lambda that constructs a replacement string). Giving an optional number N lets you only replace the first N instances. If a pattern is given, TypedVars may be used inside it, and they will be accessible in the \"via\" lambda.  ',anchor:\"macro_str-replaced\",category:\"string\"},replaced:{name:\"str-replaced\",sig:\" [Number], String or Datatype, String or Lambda, String\",returnType:\"String\",aka:[\"string-replaced\",\"replaced\"],abstract:'Also known as: (string-replaced:), (replaced:)  This macro produces a copy of the content string (the last string given), with all instances of a certain search string (or pattern) replaced using a given string (or a \"via\" lambda that constructs a replacement string). Giving an optional number N lets you only replace the first N instances. If a pattern is given, TypedVars may be used inside it, and they will be accessible in the \"via\" lambda.  ',anchor:\"macro_str-replaced\",category:\"string\"},if:{name:\"if\",sig:\" Boolean\",returnType:\"Changer\",aka:[],abstract:'This macro accepts only booleans (variables with `true` or `false`, or expressions using `is`, `contains`, or another such operator), and produces a changer that can be attached to hooks to hide them \"if\" the value was false.  ',anchor:\"macro_if\",category:\"basics\",categoryOrder:\"6\"},unless:{name:\"unless\",sig:\" Boolean\",returnType:\"Changer\",aka:[],abstract:'This macro is the negated form of (if:): it accepts only booleans, and returns a changer that can be attached hooks to hide them \"if\" the value was true.  For more information, see the documentation of (if:).  ',anchor:\"macro_unless\",category:\"basics\",categoryOrder:\"7\"},elseif:{name:\"else-if\",sig:\" Boolean\",returnType:\"Changer\",aka:[],abstract:\"This macro's result changes depending on whether the previous hook in the passage was shown or hidden. If the previous hook was shown, then this changer hides the attached hook. Otherwise, it acts like (if:), showing the attached hook if it's true, and hiding it if it's false. If there was no preceding hook before this, then an error message will be printed.  \",anchor:\"macro_else-if\",category:\"basics\",categoryOrder:\"8\"},else:{name:\"else\",sig:\"\",returnType:\"Changer\",aka:[],abstract:\"This is a convenient limited variant of the (else-if:) macro. It will simply show the attached hook if the preceding hook was hidden, and hide it otherwise. If there was no preceding hook before this, then an error message will be printed.  \",anchor:\"macro_else\",category:\"basics\",categoryOrder:\"9\"},hidden:{name:\"hidden\",sig:\"\",returnType:\"Changer\",aka:[],abstract:\"Produces a changer that can be attached to hooks to hide them.  \",anchor:\"macro_hidden\",category:\"showing and hiding\"},verbatim:{name:\"verbatim\",sig:\"\",returnType:\"Changer\",aka:[\"v6m\"],abstract:\"When attached to a hook or command, the markup inside that would normally be rendered into HTML is instead presented as plain text, as if the verbatim markup was used on it.  \",anchor:\"macro_verbatim\",category:\"basics\",categoryOrder:\"15\"},v6m:{name:\"verbatim\",sig:\"\",returnType:\"Changer\",aka:[\"v6m\"],abstract:\"When attached to a hook or command, the markup inside that would normally be rendered into HTML is instead presented as plain text, as if the verbatim markup was used on it.  \",anchor:\"macro_verbatim\",category:\"basics\",categoryOrder:\"15\"},live:{name:\"live\",sig:\" [Number]\",returnType:\"Changer\",aka:[],abstract:'When you attach this changer to a hook, the hook becomes \"live\", which means that it\\'s repeatedly re-run every certain number of milliseconds, replacing the source inside of the hook with a newly computed version.  ',anchor:\"macro_live\",category:\"live\",categoryOrder:\"1\"},event:{name:\"event\",sig:\" Lambda\",returnType:\"Changer\",aka:[],abstract:\"Hooks that have this changer attached will only be run when the given condition becomes true.  \",anchor:\"macro_event\",category:\"live\",categoryOrder:\"3\"},more:{name:\"more\",sig:\"\",returnType:\"Changer\",aka:[],abstract:'Hooks that have this changer attached will only be run once no other exits - links and (click:)-enchanted areas - are remaining in the passage, and will reveal \"more\" prose.  ',anchor:\"macro_more\",category:\"live\",categoryOrder:\"5\"},after:{name:\"after\",sig:\" Number, [Number]\",returnType:\"Changer\",aka:[],abstract:\"Hooks that have this changer attached will only be run once the given amount of time has passed since the passage was rendered. An optional second number specifies that the player can speed up the delay by holding down a keyboard key or mouse button, or by touching the touch device.  \",anchor:\"macro_after\",category:\"live\",categoryOrder:\"4\"},aftererror:{name:\"after-error\",sig:\"\",returnType:\"Changer\",aka:[],abstract:\"A bug-specific event macro, this hides the hook and only causes it to run once an error occurs.  \",anchor:\"macro_after-error\",category:\"live\",categoryOrder:\"5\"},hook:{name:\"hook\",sig:\" String\",returnType:\"Changer\",aka:[],abstract:\"A changer that allows the author to give a hook a computed tag name.  \",anchor:\"macro_hook\",category:\"styling\"},for:{name:\"for\",sig:\" Lambda, [...Any]\",returnType:\"Changer\",aka:[\"loop\"],abstract:\"When attached to a hook, this repeats the attached hook, setting a temporary variable to a different value on each repeat.  \",anchor:\"macro_for\",category:\"basics\",categoryOrder:\"10\"},loop:{name:\"for\",sig:\" Lambda, [...Any]\",returnType:\"Changer\",aka:[\"loop\"],abstract:\"When attached to a hook, this repeats the attached hook, setting a temporary variable to a different value on each repeat.  \",anchor:\"macro_for\",category:\"basics\",categoryOrder:\"10\"},transition:{name:\"transition\",sig:\" String\",returnType:\"Changer\",aka:[\"t8n\"],abstract:'A changer that applies a built-in CSS transition to a hook as it appears. Give this macro one of these strings (capitalisation and hyphens ignored): `\"instant\"`, `\"dissolve\"`, `\"fade\"`, `\"rumble\"`, `\"shudder\"`, `\"pulse\"`, `\"zoom\"`, `\"flicker\"`, `\"slide-left\"`, `\"slide-right\"`, `\"slide-up\"`, `\"slide-down\"`, `\"fade-left\"`, `\"fade-right\"`, `\"fade-up\"` and `\"fade-down\"`.  ',anchor:\"macro_transition\",category:\"transitions\",categoryOrder:\"1\"},t8n:{name:\"transition\",sig:\" String\",returnType:\"Changer\",aka:[\"t8n\"],abstract:'A changer that applies a built-in CSS transition to a hook as it appears. Give this macro one of these strings (capitalisation and hyphens ignored): `\"instant\"`, `\"dissolve\"`, `\"fade\"`, `\"rumble\"`, `\"shudder\"`, `\"pulse\"`, `\"zoom\"`, `\"flicker\"`, `\"slide-left\"`, `\"slide-right\"`, `\"slide-up\"`, `\"slide-down\"`, `\"fade-left\"`, `\"fade-right\"`, `\"fade-up\"` and `\"fade-down\"`.  ',anchor:\"macro_transition\",category:\"transitions\",categoryOrder:\"1\"},transitiontime:{name:\"transition-time\",sig:\" Number\",returnType:\"Changer\",aka:[\"t8n-time\"],abstract:\"A changer that, when added to a (transition:) changer, adjusts the time of the transition.  \",anchor:\"macro_transition-time\",category:\"transitions\",categoryOrder:\"2\"},t8ntime:{name:\"transition-time\",sig:\" Number\",returnType:\"Changer\",aka:[\"t8n-time\"],abstract:\"A changer that, when added to a (transition:) changer, adjusts the time of the transition.  \",anchor:\"macro_transition-time\",category:\"transitions\",categoryOrder:\"2\"},transitiondelay:{name:\"transition-delay\",sig:\" Number\",returnType:\"Changer\",aka:[\"t8n-delay\"],abstract:\"A changer that, when added to a (transition:) changer, delays the start of the transition by a given time.  \",anchor:\"macro_transition-delay\",category:\"transitions\",categoryOrder:\"2\"},t8ndelay:{name:\"transition-delay\",sig:\" Number\",returnType:\"Changer\",aka:[\"t8n-delay\"],abstract:\"A changer that, when added to a (transition:) changer, delays the start of the transition by a given time.  \",anchor:\"macro_transition-delay\",category:\"transitions\",categoryOrder:\"2\"},transitionskip:{name:\"transition-skip\",sig:\" Number\",returnType:\"Changer\",aka:[\"t8n-skip\"],abstract:\"A changer that, when added to a (transition:) changer, allows the player to skip or accelerate the transition by holding down a keyboard key or mouse button, or by touching the touch device.  \",anchor:\"macro_transition-skip\",category:\"transitions\",categoryOrder:\"6\"},t8nskip:{name:\"transition-skip\",sig:\" Number\",returnType:\"Changer\",aka:[\"t8n-skip\"],abstract:\"A changer that, when added to a (transition:) changer, allows the player to skip or accelerate the transition by holding down a keyboard key or mouse button, or by touching the touch device.  \",anchor:\"macro_transition-skip\",category:\"transitions\",categoryOrder:\"6\"},transitiondepart:{name:\"transition-depart\",sig:\" String\",returnType:\"Changer\",aka:[\"t8n-depart\"],abstract:\"A changer that alters passage links, (link-goto:)s, and most every other kind of link, changing which passage fade-out animation the link uses.  \",anchor:\"macro_transition-depart\",category:\"transitions\",categoryOrder:\"4\"},t8ndepart:{name:\"transition-depart\",sig:\" String\",returnType:\"Changer\",aka:[\"t8n-depart\"],abstract:\"A changer that alters passage links, (link-goto:)s, and most every other kind of link, changing which passage fade-out animation the link uses.  \",anchor:\"macro_transition-depart\",category:\"transitions\",categoryOrder:\"4\"},transitionarrive:{name:\"transition-arrive\",sig:\" String\",returnType:\"Changer\",aka:[\"t8n-arrive\"],abstract:\"A changer that alters passage links, (link-goto:)s, and most every other kind of link, changing which passage fade-in animation the link uses.  \",anchor:\"macro_transition-arrive\",category:\"transitions\",categoryOrder:\"5\"},t8narrive:{name:\"transition-arrive\",sig:\" String\",returnType:\"Changer\",aka:[\"t8n-arrive\"],abstract:\"A changer that alters passage links, (link-goto:)s, and most every other kind of link, changing which passage fade-in animation the link uses.  \",anchor:\"macro_transition-arrive\",category:\"transitions\",categoryOrder:\"5\"},button:{name:\"button\",sig:\" [String]\",returnType:\"Changer\",aka:[],abstract:\"When applied to a link, this changer styles it so that it resembles a button, and makes it take up the entire passage width. The optional sizing string lets you specify width and horizontal margins for the button. It is not recommended that this be used on non-link hooks.  \",anchor:\"macro_button\",category:\"styling\"},action:{name:\"action\",sig:\" String\",returnType:\"Changer\",aka:[],abstract:\"When attached to a link command, or given to a link changer macro as the second value, this changer turns the link into a different kind of interaction element with a different appearance - one that is either activated by hovering the mouse pointer over it, hoving the mouse pointer off of it, or double-clicking it. This does nothing when attached or supplied to a non-link hook.  \",anchor:\"macro_action\",category:\"links\",categoryOrder:\"99\"},border:{name:\"border\",sig:\" String, [String], [String], [String]\",returnType:\"Changer\",aka:[\"b4r\"],abstract:\"A changer macro that applies a CSS border to the hook.  \",anchor:\"macro_border\",category:\"borders\",categoryOrder:\"1\"},b4r:{name:\"border\",sig:\" String, [String], [String], [String]\",returnType:\"Changer\",aka:[\"b4r\"],abstract:\"A changer macro that applies a CSS border to the hook.  \",anchor:\"macro_border\",category:\"borders\",categoryOrder:\"1\"},bordersize:{name:\"border-size\",sig:\" Measurement, [Measurement], [Measurement], [Measurement]\",returnType:\"Changer\",aka:[\"b4r-size\"],abstract:\"When applied to a hook being changed by the (border:) changer, this multiplies the size of the border by the given size measurement. This can accept any measurement unit except `w`, `h`, and `lh`.  \",anchor:\"macro_border-size\",category:\"borders\",categoryOrder:\"3\"},b4rsize:{name:\"border-size\",sig:\" Measurement, [Measurement], [Measurement], [Measurement]\",returnType:\"Changer\",aka:[\"b4r-size\"],abstract:\"When applied to a hook being changed by the (border:) changer, this multiplies the size of the border by the given size measurement. This can accept any measurement unit except `w`, `h`, and `lh`.  \",anchor:\"macro_border-size\",category:\"borders\",categoryOrder:\"3\"},cornerradius:{name:\"corner-radius\",sig:\" Measurement, [Measurement], [Measurement], [Measurement]\",returnType:\"Changer\",aka:[],abstract:\"When applied to a hook, this rounds the corners by the given measurements, causing the hook to become increasingly round or button-like.  \",anchor:\"macro_corner-radius\",category:\"borders\",categoryOrder:\"4\"},bordercolour:{name:\"border-colour\",sig:\" String or Colour, [String or Colour], [String or Colour], [String or Colour]\",returnType:\"Changer\",aka:[\"b4r-colour\",\"border-color\",\"b4r-color\"],abstract:\"When applied to a hook being changed by the (border:) changer, this changes the border's colour.  \",anchor:\"macro_border-colour\",category:\"borders\",categoryOrder:\"2\"},b4rcolour:{name:\"border-colour\",sig:\" String or Colour, [String or Colour], [String or Colour], [String or Colour]\",returnType:\"Changer\",aka:[\"b4r-colour\",\"border-color\",\"b4r-color\"],abstract:\"When applied to a hook being changed by the (border:) changer, this changes the border's colour.  \",anchor:\"macro_border-colour\",category:\"borders\",categoryOrder:\"2\"},bordercolor:{name:\"border-colour\",sig:\" String or Colour, [String or Colour], [String or Colour], [String or Colour]\",returnType:\"Changer\",aka:[\"b4r-colour\",\"border-color\",\"b4r-color\"],abstract:\"When applied to a hook being changed by the (border:) changer, this changes the border's colour.  \",anchor:\"macro_border-colour\",category:\"borders\",categoryOrder:\"2\"},b4rcolor:{name:\"border-colour\",sig:\" String or Colour, [String or Colour], [String or Colour], [String or Colour]\",returnType:\"Changer\",aka:[\"b4r-colour\",\"border-color\",\"b4r-color\"],abstract:\"When applied to a hook being changed by the (border:) changer, this changes the border's colour.  \",anchor:\"macro_border-colour\",category:\"borders\",categoryOrder:\"2\"},opacity:{name:\"opacity\",sig:\" Number\",returnType:\"Changer\",aka:[],abstract:\"This styling changer changes how opaque the attached hook is, using a value from 0 to 1. Reducing the value makes it more transparent. An opacity of 0 makes the hook invisible.  \",anchor:\"macro_opacity\",category:\"styling\"},font:{name:\"font\",sig:\" String\",returnType:\"Changer\",aka:[],abstract:'This styling changer changes the font used to display the text of the attached hook. Provide the font\\'s family name (such as \"Helvetica Neue\" or \"Courier\") as a string.  ',anchor:\"macro_font\",category:\"styling\"},align:{name:\"align\",sig:\" String\",returnType:\"Changer\",aka:[],abstract:\"This styling changer changes the alignment of text in the attached hook, as if the `===>`~ arrow syntax was used. In fact, these same arrows (`==>`~, `=><=`~, `<==>`~, `====><=`~ etc.) should be supplied as a string to specify the degree of alignment.  \",anchor:\"macro_align\",category:\"styling\"},textcolour:{name:\"text-colour\",sig:\" String or Colour\",returnType:\"Changer\",aka:[\"colour\",\"text-color\",\"color\"],abstract:\"This styling changer changes the colour used by the text in the attached hook. You can supply either a string with a CSS-style colour (a colour name or RGB number supported by CSS), or a built-in colour object.  \",anchor:\"macro_text-colour\",category:\"styling\"},colour:{name:\"text-colour\",sig:\" String or Colour\",returnType:\"Changer\",aka:[\"colour\",\"text-color\",\"color\"],abstract:\"This styling changer changes the colour used by the text in the attached hook. You can supply either a string with a CSS-style colour (a colour name or RGB number supported by CSS), or a built-in colour object.  \",anchor:\"macro_text-colour\",category:\"styling\"},textcolor:{name:\"text-colour\",sig:\" String or Colour\",returnType:\"Changer\",aka:[\"colour\",\"text-color\",\"color\"],abstract:\"This styling changer changes the colour used by the text in the attached hook. You can supply either a string with a CSS-style colour (a colour name or RGB number supported by CSS), or a built-in colour object.  \",anchor:\"macro_text-colour\",category:\"styling\"},color:{name:\"text-colour\",sig:\" String or Colour\",returnType:\"Changer\",aka:[\"colour\",\"text-color\",\"color\"],abstract:\"This styling changer changes the colour used by the text in the attached hook. You can supply either a string with a CSS-style colour (a colour name or RGB number supported by CSS), or a built-in colour object.  \",anchor:\"macro_text-colour\",category:\"styling\"},textsize:{name:\"text-size\",sig:\" Measurement, [Measurement]\",returnType:\"Changer\",aka:[\"size\"],abstract:\"When given a positive measurement (such as `20px`), this changes the text size of the attached hook. The optional second value determines the line height of the text (the distance between each line). If none is given, then this defaults to the first measurement multiplied by 1.5.  \",anchor:\"macro_text-size\",category:\"styling\"},size:{name:\"text-size\",sig:\" Measurement, [Measurement]\",returnType:\"Changer\",aka:[\"size\"],abstract:\"When given a positive measurement (such as `20px`), this changes the text size of the attached hook. The optional second value determines the line height of the text (the distance between each line). If none is given, then this defaults to the first measurement multiplied by 1.5.  \",anchor:\"macro_text-size\",category:\"styling\"},textindent:{name:\"text-indent\",sig:\" Measurement\",returnType:\"Changer\",aka:[],abstract:\"This styling changer causes the attached hook to be indented by the given measurement.  \",anchor:\"macro_text-indent\",category:\"styling\"},textrotatez:{name:\"text-rotate-z\",sig:\" Number\",returnType:\"Changer\",aka:[\"text-rotate\"],abstract:\"This styling changer visually rotates the attached hook clockwise by a given number of degrees. The rotational axis is in the centre of the hook.  \",anchor:\"macro_text-rotate-z\",category:\"styling\"},textrotate:{name:\"text-rotate-z\",sig:\" Number\",returnType:\"Changer\",aka:[\"text-rotate\"],abstract:\"This styling changer visually rotates the attached hook clockwise by a given number of degrees. The rotational axis is in the centre of the hook.  \",anchor:\"macro_text-rotate-z\",category:\"styling\"},textrotatey:{name:\"text-rotate-y\",sig:\" Number\",returnType:\"Changer\",aka:[],abstract:\"This styling changer visually rotates the attached hook clockwise, around the Y axis (vertical), by a given number of degrees, making it appear to lean into the page. The rotational axis is in the centre of the hook.  \",anchor:\"macro_text-rotate-y\",category:\"styling\"},textrotatex:{name:\"text-rotate-x\",sig:\" Number\",returnType:\"Changer\",aka:[],abstract:\"This styling changer visually rotates the attached hook clockwise, around the X axis (horizontal), by a given number of degrees, making it appear to lean into the page. The rotational axis is in the centre of the hook.  \",anchor:\"macro_text-rotate-x\",category:\"styling\"},bg:{name:\"bg\",sig:\" Colour or String or Gradient or Image\",returnType:\"Changer\",aka:[\"background\"],abstract:'This styling changer alters the background colour or background image of the attached hook. Supplying a gradient (produced by (gradient:)) will set the background to that gradient. Supplying a colour (produced by (rgb:), (hsl:), (lch:) or another such macro), a built-in colour value like `red`, or a bare colour value like #FA9138) will set the background to a flat colour. CSS strings that resemble HTML hex colours (like \"#FA9138\") will also provide flat colour. Other strings will be interpreted as an image URL, and the background will be set to it.  ',anchor:\"macro_bg\",category:\"styling\"},background:{name:\"bg\",sig:\" Colour or String or Gradient or Image\",returnType:\"Changer\",aka:[\"background\"],abstract:'This styling changer alters the background colour or background image of the attached hook. Supplying a gradient (produced by (gradient:)) will set the background to that gradient. Supplying a colour (produced by (rgb:), (hsl:), (lch:) or another such macro), a built-in colour value like `red`, or a bare colour value like #FA9138) will set the background to a flat colour. CSS strings that resemble HTML hex colours (like \"#FA9138\") will also provide flat colour. Other strings will be interpreted as an image URL, and the background will be set to it.  ',anchor:\"macro_bg\",category:\"styling\"},textstyle:{name:\"text-style\",sig:\" ...String\",returnType:\"Changer\",aka:[],abstract:'This applies one or more selected built-in text styles to the hook\\'s text. Give this macro one of these strings (capitalisation and hyphens ignored): `\"none\"`, `\"bold\"`, `\"italic\"`, `\"underline\"`, `\"double-underline\"`, `\"wavy-underline\"`, `\"strike\"`, `\"double-strike\"`, `\"wavy-strike\"`, `\"superscript\"`, `\"subscript\"`, `\"blink\"`, `\"shudder\"`, `\"mark\"`, `\"condense\"`, `\"expand\"`, `\"outline\"`, `\"shadow\"`, `\"emboss\"`, `\"smear\"`, `\"blur\"`, `\"blurrier\"`, `\"mirror\"`, `\"upside-down\"`, `\"tall\"`, `\"flat\"`, `\"fade-in-out\"`, `\"rumble\"`, `\"sway\"`, `\"buoy\"` or `\"fidget\"`.  ',anchor:\"macro_text-style\",category:\"styling\"},scrollbar:{name:\"scrollbar\",sig:\" String\",returnType:\"Changer\",aka:[\"scrollbar-y\"],abstract:'When attached to a hook that can scroll, such as one with (box:) also attached, this changes whether the vertical scroll bar is present on the hook, allowing the player to scroll it freely. This accepts the strings \"auto\" (the default), \"on\", \"off\" and \"never\".  ',anchor:\"macro_scrollbar\",category:\"window\"},scrollbary:{name:\"scrollbar\",sig:\" String\",returnType:\"Changer\",aka:[\"scrollbar-y\"],abstract:'When attached to a hook that can scroll, such as one with (box:) also attached, this changes whether the vertical scroll bar is present on the hook, allowing the player to scroll it freely. This accepts the strings \"auto\" (the default), \"on\", \"off\" and \"never\".  ',anchor:\"macro_scrollbar\",category:\"window\"},scrollbarx:{name:\"scrollbar-x\",sig:\" String\",returnType:\"Changer\",aka:[],abstract:\"\",anchor:\"macro_scrollbar-x\",category:\"window\"},collapse:{name:\"collapse\",sig:\"\",returnType:\"Changer\",aka:[],abstract:\"When attached to a hook, this collapses the whitespace within the hook, in the same manner as the collapsing whitespace markup.  \",anchor:\"macro_collapse\",category:\"styling\"},hoverstyle:{name:\"hover-style\",sig:\" Changer\",returnType:\"Changer\",aka:[],abstract:\"Given a style-altering changer, it makes a changer which only applies when the hook or command is hovered over with the mouse pointer, and is removed when hovering off.  \",anchor:\"macro_hover-style\",category:\"styling\"},css:{name:\"css\",sig:\" String\",returnType:\"Changer\",aka:[],abstract:'This takes a string of inline CSS, and applies it to the hook, as if it were a HTML \"style\" property.  ',anchor:\"macro_css\",category:\"styling\"},testtrue:{name:\"test-true\",sig:\" [...Any]\",returnType:\"Changer\",aka:[],abstract:\"If you want to test your passage, while ignoring a specific changer macro in it, temporarily change that changer macro's name to (test-true:), and it will ignore all of the data given to it, while enabling the hook.  \",anchor:\"macro_test-true\",category:\"debugging\",categoryOrder:\"2\"},testfalse:{name:\"test-false\",sig:\" [...Any]\",returnType:\"Changer\",aka:[],abstract:\"If you want to test your passage in order to see what would happen if an (if:), (unless:) or (else-if:) macro would hide the hook it's attached to, you can temporarily change the name of the macro to (test-false:), which causes it to ignore the data given to it and act as if it was given `false`.  \",anchor:\"macro_test-false\",category:\"debugging\",categoryOrder:\"3\"},animate:{name:\"animate\",sig:\" HookName, String, [Number]\",returnType:\"Command\",aka:[],abstract:\"A command that causes a hook to briefly animate, as if a (transition:) was applied to it. The length of time that the animation plays can be optionally altered by providing a number.  \",anchor:\"macro_animate\",category:\"transitions\"},box:{name:\"box\",sig:\" String, [Measurement]\",returnType:\"Changer\",aka:[],abstract:'When attached to a hook, it becomes a \"box\", with a given width proportional to the containing element\\'s width, an optional number of lines tall, and a scroll bar if its contained text is longer than its height can contain.  ',anchor:\"macro_box\",category:\"styling\"},floatbox:{name:\"float-box\",sig:\" String, String\",returnType:\"Changer\",aka:[],abstract:'When attached to a hook, it becomes a \"floating box\", placed at a given portion of the window, sized proportionally to the window\\'s dimensions, and with a scroll bar if its contained text is longer than its height can contain.  ',anchor:\"macro_float-box\",category:\"styling\"},str:{name:\"str\",sig:\" ...[Number or String or Boolean or Array]\",returnType:\"String\",aka:[\"string\",\"text\"],abstract:\"(str:) accepts any amount of values and tries to convert them all to a single String.  \",anchor:\"macro_str\",category:\"string\",categoryOrder:\"1\"},string:{name:\"str\",sig:\" ...[Number or String or Boolean or Array]\",returnType:\"String\",aka:[\"string\",\"text\"],abstract:\"(str:) accepts any amount of values and tries to convert them all to a single String.  \",anchor:\"macro_str\",category:\"string\",categoryOrder:\"1\"},text:{name:\"str\",sig:\" ...[Number or String or Boolean or Array]\",returnType:\"String\",aka:[\"string\",\"text\"],abstract:\"(str:) accepts any amount of values and tries to convert them all to a single String.  \",anchor:\"macro_str\",category:\"string\",categoryOrder:\"1\"},source:{name:\"source\",sig:\" Any\",returnType:\"String\",aka:[],abstract:\"When given almost any data value, this will produce a string representation of Harlowe source code that can, when run, create that value exactly.  \",anchor:\"macro_source\",category:\"string\"},substring:{name:\"substring\",sig:\" String, Number, Number\",returnType:\"String\",aka:[],abstract:\"This macro produces a substring of the given string, cut from two inclusive number positions.  \",anchor:\"macro_substring\",category:\"string\"},lowercase:{name:\"lowercase\",sig:\" String\",returnType:\"String\",aka:[],abstract:\"This macro produces a lowercase version of the given string.  \",anchor:\"macro_lowercase\",category:\"string\"},uppercase:{name:\"uppercase\",sig:\" String\",returnType:\"String\",aka:[],abstract:\"This macro produces an uppercase version of the given string.  \",anchor:\"macro_uppercase\",category:\"string\"},lowerfirst:{name:\"lowerfirst\",sig:\" String\",returnType:\"String\",aka:[],abstract:\"This macro produces a version of the given string, where the first alphanumeric character is lowercase, and other characters are left as-is.  \",anchor:\"macro_lowerfirst\",category:\"string\"},upperfirst:{name:\"upperfirst\",sig:\" String\",returnType:\"String\",aka:[],abstract:\"This macro produces a version of the given string, where the first alphanumeric character is uppercase, and other characters are left as-is.  \",anchor:\"macro_upperfirst\",category:\"string\"},words:{name:\"words\",sig:\" String\",returnType:\"Array\",aka:[],abstract:'This macro takes a string and creates an array of each word (\"word\" meaning a sequence of non-whitespace characters) in the string.  ',anchor:\"macro_words\",category:\"string\"},strrepeated:{name:\"str-repeated\",sig:\" Number, String\",returnType:\"String\",aka:[\"string-repeated\"],abstract:\"A special shorthand combination of the (str:) and (repeated:) macros, this accepts a single string and duplicates it the given number of times.  \",anchor:\"macro_str-repeated\",category:\"string\"},stringrepeated:{name:\"str-repeated\",sig:\" Number, String\",returnType:\"String\",aka:[\"string-repeated\"],abstract:\"A special shorthand combination of the (str:) and (repeated:) macros, this accepts a single string and duplicates it the given number of times.  \",anchor:\"macro_str-repeated\",category:\"string\"},strreversed:{name:\"str-reversed\",sig:\" String\",returnType:\"String\",aka:[\"string-reversed\"],abstract:\"A special shorthand combination of the (str:) and (reversed:) macros, this accepts a single string and reverses it.  \",anchor:\"macro_str-reversed\",category:\"string\"},stringreversed:{name:\"str-reversed\",sig:\" String\",returnType:\"String\",aka:[\"string-reversed\"],abstract:\"A special shorthand combination of the (str:) and (reversed:) macros, this accepts a single string and reverses it.  \",anchor:\"macro_str-reversed\",category:\"string\"},joined:{name:\"joined\",sig:\" ...String\",returnType:\"String\",aka:[],abstract:\"Using the first string as a separator value, this macro takes all of the other strings given to it, and joins them into a single string.  \",anchor:\"macro_joined\",category:\"string\"},plural:{name:\"plural\",sig:\" Number, String, [String]\",returnType:\"String\",aka:[],abstract:'This macro takes a whole number and a string, then converts the number to a string, joins them up with a space character, and pluralises the string if the number wasn\\'t 1 or -1. By default, this pluralisation is done by adding \"s\", as in some English plurals. An optional extra string can specify a different plural word to use instead.  ',anchor:\"macro_plural\",category:\"string\"},strnth:{name:\"str-nth\",sig:\" Number\",returnType:\"String\",aka:[\"string-nth\"],abstract:'This macro takes a whole number, and converts it to a string comprising an English ordinal abbreviation (of the form \"nth\", such as \"1st\", \"22nd\", etc.).  ',anchor:\"macro_str-nth\",category:\"string\"},stringnth:{name:\"str-nth\",sig:\" Number\",returnType:\"String\",aka:[\"string-nth\"],abstract:'This macro takes a whole number, and converts it to a string comprising an English ordinal abbreviation (of the form \"nth\", such as \"1st\", \"22nd\", etc.).  ',anchor:\"macro_str-nth\",category:\"string\"},digitformat:{name:\"digit-format\",sig:\" String, Number\",returnType:\"String\",aka:[],abstract:\"\",anchor:\"macro_digit-format\",category:\"string\"},num:{name:\"num\",sig:\" String\",returnType:\"Number\",aka:[\"number\"],abstract:\"This macro converts strings to numbers by reading the digits in the entire string. It can handle decimal fractions and negative numbers. If any letters or other unusual characters appear in the number, it will result in an error.  \",anchor:\"macro_num\",category:\"number\"},number:{name:\"num\",sig:\" String\",returnType:\"Number\",aka:[\"number\"],abstract:\"This macro converts strings to numbers by reading the digits in the entire string. It can handle decimal fractions and negative numbers. If any letters or other unusual characters appear in the number, it will result in an error.  \",anchor:\"macro_num\",category:\"number\"},datatype:{name:\"datatype\",sig:\" Any\",returnType:\"Datatype\",aka:[],abstract:\"This macro takes any storeable value, and produces a datatype that matches it.  \",anchor:\"macro_datatype\",category:\"custom macros\",categoryOrder:\"5\"},datapattern:{name:\"datapattern\",sig:\" Any\",returnType:\"Any\",aka:[],abstract:\"This takes any storeable value, and produces a datatype that matches it, in a manner similar to (datatype:). However, when given an array or datamap, it creates an array or datamap with its values replaced with their datatypes, which can be used as a more accurate pattern with `matches` or (set:) elsewhere.  \",anchor:\"macro_datapattern\",category:\"custom macros\",categoryOrder:\"6\"},rgb:{name:\"rgb\",sig:\" Number, Number, Number, [Number]\",returnType:\"Colour\",aka:[\"rgba\"],abstract:\"This macro creates a colour using the three red (r), green (g) and blue (b) values provided, whose values are numbers between 0 and 255, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  \",anchor:\"macro_rgb\",category:\"colour\",categoryOrder:\"2\"},rgba:{name:\"rgb\",sig:\" Number, Number, Number, [Number]\",returnType:\"Colour\",aka:[\"rgba\"],abstract:\"This macro creates a colour using the three red (r), green (g) and blue (b) values provided, whose values are numbers between 0 and 255, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  \",anchor:\"macro_rgb\",category:\"colour\",categoryOrder:\"2\"},hsl:{name:\"hsl\",sig:\" Number, Number, Number, [Number]\",returnType:\"Colour\",aka:[\"hsla\"],abstract:\"This macro creates a colour using the given hue (h) angle in degrees, as well as the given saturation (s) and lightness (l) percentages, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  \",anchor:\"macro_hsl\",category:\"colour\",categoryOrder:\"1\"},hsla:{name:\"hsl\",sig:\" Number, Number, Number, [Number]\",returnType:\"Colour\",aka:[\"hsla\"],abstract:\"This macro creates a colour using the given hue (h) angle in degrees, as well as the given saturation (s) and lightness (l) percentages, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  \",anchor:\"macro_hsl\",category:\"colour\",categoryOrder:\"1\"},oklch:{name:\"oklch\",sig:\" Number, Number, Number, [Number]\",returnType:\"Colour\",aka:[\"oklcha\"],abstract:\"This macro creates a colour using three values in the OKLCH colour model - a lightness (L) percentage, a chroma (C) value between 0 and 1, and a hue (H) angle in degrees, and, optionally, the transparency (alpha, or A) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  \",anchor:\"macro_oklch\",category:\"colour\",categoryOrder:\"3\"},oklcha:{name:\"oklch\",sig:\" Number, Number, Number, [Number]\",returnType:\"Colour\",aka:[\"oklcha\"],abstract:\"This macro creates a colour using three values in the OKLCH colour model - a lightness (L) percentage, a chroma (C) value between 0 and 1, and a hue (H) angle in degrees, and, optionally, the transparency (alpha, or A) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  \",anchor:\"macro_oklch\",category:\"colour\",categoryOrder:\"3\"},lch:{name:\"lch\",sig:\" Number, Number, Number, [Number]\",returnType:\"Colour\",aka:[\"lcha\"],abstract:\"This macro creates a colour using three values in the CIELAB colour model - a lightness (L) percentage, a chroma (C) value, and a hue (H) angle in degrees, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Note that the C value is *not* the same as that given to (oklch:)! (oklch:) accepts a C value between 0 and 1, whereas this accepts a C value between 0 and 150.  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  \",anchor:\"macro_lch\",category:\"colour\",categoryOrder:\"3\"},lcha:{name:\"lch\",sig:\" Number, Number, Number, [Number]\",returnType:\"Colour\",aka:[\"lcha\"],abstract:\"This macro creates a colour using three values in the CIELAB colour model - a lightness (L) percentage, a chroma (C) value, and a hue (H) angle in degrees, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Note that the C value is *not* the same as that given to (oklch:)! (oklch:) accepts a C value between 0 and 1, whereas this accepts a C value between 0 and 150.  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  \",anchor:\"macro_lch\",category:\"colour\",categoryOrder:\"3\"},complement:{name:\"complement\",sig:\" Colour\",returnType:\"Colour\",aka:[],abstract:\"When given a colour, this provides a complement to that colour in the OKLCH colour model.  \",anchor:\"macro_complement\",category:\"colour\",categoryOrder:\"4\"},mix:{name:\"mix\",sig:\" [String], Number, Colour, Number, Colour\",returnType:\"Colour\",aka:[],abstract:'When given two pairs of values - each a number from 0 to 1 and a colour - this macro produces a mix of the two colours, using the numbers as ratios of each colour. The colours are mixed using the given colour model specified by a string (either \"oklch\", \"lch\", \"hsl\" or \"rgb\"), or the (oklch:) colour model if no string is given.  ',anchor:\"macro_mix\",category:\"colour\"},palette:{name:\"palette\",sig:\" String, Colour\",returnType:\"Array\",aka:[],abstract:\"When given a string specifying a palette type, and a colour, this macro produces an array containing the given colour followed by three additional colours that together form a palette, for use with (text-colour:), (bg:), and other macros.  \",anchor:\"macro_palette\",category:\"colour\",categoryOrder:\"5\"},gradient:{name:\"gradient\",sig:\" Number, ...Number or Colour\",returnType:\"Gradient\",aka:[],abstract:'When given a degree angle, followed by any number of number-colour pairs called \"colour stops\", this macro produces a gradient that fades between those colours in the direction of the angle.  ',anchor:\"macro_gradient\",category:\"colour\",categoryOrder:\"6\"},stripes:{name:\"stripes\",sig:\" Number, Measurement, Colour, Colour\",returnType:\"Gradient\",aka:[],abstract:\"When given a degree angle, a `px` measurement, and two or more colours, this macro produces a gradient that draws a striped background, with each stripe as wide as the measurement, and alternating through the given colours.  \",anchor:\"macro_stripes\",category:\"colour\",categoryOrder:\"7\"},image:{name:\"image\",sig:\" ...String, [Gradient or Colour]\",returnType:\"Image\",aka:[],abstract:\"This macro is used to access image files and use them as assets in your story. It takes one or more URL strings (relative or absolute), and Harlowe tries downloading from each, in turn, until one succeeds. It produces an image value, which *can only be stored in a variable with (define:)* - but that variable can be used with other macros, such as (bg:). If none of the URLs load, then the optional fallback gradient or colour (if given) will be used whenever you try to display the image.  \",anchor:\"macro_image\",category:\"images\"},hooksnamed:{name:\"hooks-named\",sig:\" String\",returnType:\"HookName\",aka:[],abstract:\"When given a string, this creates a HookName from it. This can be used to dynamically create HookNames.  \",anchor:\"macro_hooks-named\",category:\"basics\"},cond:{name:\"cond\",sig:\" Boolean, Any, ...Any\",returnType:\"Any\",aka:[],abstract:'When given a sequence of booleans (the \"conditions\") paired with values, this provides the first value that was paired with a `true` condition. This can give you one value or another based on a quick check.  ',anchor:\"macro_cond\",category:\"basics\",categoryOrder:\"12\"},weekday:{name:\"weekday\",sig:\"\",returnType:\"String\",aka:[],abstract:'This date/time macro produces one of the strings \"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\" or \"Saturday\", based on the weekday on the current player\\'s system clock.  ',anchor:\"macro_weekday\",category:\"date and time\"},monthday:{name:\"monthday\",sig:\"\",returnType:\"Number\",aka:[],abstract:\"This date/time macro produces a number corresponding to the day of the month on the current player's system clock. This should be between 1 (on the 1st of the month) and 31, inclusive.  \",anchor:\"macro_monthday\",category:\"date and time\"},currenttime:{name:\"current-time\",sig:\"\",returnType:\"String\",aka:[],abstract:'This date/time macro produces a string of the current 12-hour time on the current player\\'s system clock, in the format \"12:00 AM\".  ',anchor:\"macro_current-time\",category:\"date and time\"},currentdate:{name:\"current-date\",sig:\"\",returnType:\"String\",aka:[],abstract:'This date/time macro produces a string of the current date the current player\\'s system clock, in the format \"Thu Jan 01 1970\".  ',anchor:\"macro_current-date\",category:\"date and time\"},min:{name:\"min\",sig:\" ...Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro accepts numbers, and evaluates to the lowest valued number.  \",anchor:\"macro_min\",category:\"maths\"},max:{name:\"max\",sig:\" ...Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro accepts numbers, and evaluates to the highest valued number.  \",anchor:\"macro_max\",category:\"maths\"},abs:{name:\"abs\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro finds the absolute value of a number (without the sign).  \",anchor:\"macro_abs\",category:\"maths\"},sign:{name:\"sign\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro produces -1 when given a negative number, 0 when given 0, and 1 when given a positive number.  \",anchor:\"macro_sign\",category:\"maths\"},sin:{name:\"sin\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro computes the sine of the given number of radians.  \",anchor:\"macro_sin\",category:\"maths\"},cos:{name:\"cos\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro computes the cosine of the given number of radians.  \",anchor:\"macro_cos\",category:\"maths\"},tan:{name:\"tan\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro computes the tangent of the given number of radians.  \",anchor:\"macro_tan\",category:\"maths\"},floor:{name:\"floor\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This macro rounds the given number downward to a whole number. If a whole number is provided, it returns the number as-is.  \",anchor:\"macro_floor\",category:\"number\"},round:{name:\"round\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This macro rounds the given number to the nearest whole number - downward if its decimals are smaller than 0.5, and upward otherwise. If a whole number is provided, it returns the number as-is.  \",anchor:\"macro_round\",category:\"number\"},trunc:{name:\"trunc\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:'This macro rounds the given number towards zero. This \"truncates\" the fractional portion of the number, removing it and leaving just the whole portion.  ',anchor:\"macro_trunc\",category:\"number\"},ceil:{name:\"ceil\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This macro rounds the given number upward to a whole number. If a whole number is provided, it returns the number as-is.  \",anchor:\"macro_ceil\",category:\"number\"},pow:{name:\"pow\",sig:\" Number, Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro raises the first number to the power of the second number, and provides the result.  \",anchor:\"macro_pow\",category:\"maths\"},exp:{name:\"exp\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro raises Euler's number to the power of the given number, and provides the result.  \",anchor:\"macro_exp\",category:\"maths\"},sqrt:{name:\"sqrt\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro produces the square root of the given number.  \",anchor:\"macro_sqrt\",category:\"maths\"},log:{name:\"log\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro produces the natural logarithm (the base-e logarithm) of the given number.  \",anchor:\"macro_log\",category:\"maths\"},log10:{name:\"log10\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro produces the base-10 logarithm of the given number.  \",anchor:\"macro_log10\",category:\"maths\"},log2:{name:\"log2\",sig:\" Number\",returnType:\"Number\",aka:[],abstract:\"This maths macro produces the base-2 logarithm of the given number.  \",anchor:\"macro_log2\",category:\"maths\"},random:{name:\"random\",sig:\" Number, [Number]\",returnType:\"Number\",aka:[],abstract:\"This macro produces a whole number randomly selected between the two whole numbers, inclusive (or, if the second number is absent, then between 0 and the first number, inclusive).  \",anchor:\"macro_random\",category:\"number\"},either:{name:\"either\",sig:\" ...Any\",returnType:\"Any\",aka:[],abstract:\"Give this macro several values, separated by commas, and it will pick and return one of them randomly.  \",anchor:\"macro_either\",category:\"basics\",categoryOrder:\"11\"},nth:{name:\"nth\",sig:\" Number, ...Any\",returnType:\"Any\",aka:[],abstract:\"Given a positive whole number and a sequence of values, this selects the nth value in the sequence, where n is the number. If n is larger than the number of items in the sequence, the selection loops around to the start.  \",anchor:\"macro_nth\",category:\"basics\",categoryOrder:\"13\"}}};if(!Object.keys(j).length)throw Error(\"ShortDefs wasn't inserted at build time\");const Y={\"#e61919\":\"red\",\"#e68019\":\"orange\",\"#e5e619\":\"yellow\",\"#80e619\":\"lime\",\"#19e619\":\"green\",\"#19e5e6\":\"cyan\",\"#197fe6\":\"blue\",\"#1919e6\":\"navy\",\"#7f19e6\":\"purple\",\"#e619e5\":\"magenta\",\"#ffffff\":\"white\",\"#000000\":\"black\",\"#888888\":\"grey\"},fontIcon=(e,a=20,t=20)=>`<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 576 512\" width=\"${a}\" height=\"${t}\"><path fill='currentColor' d=\"${{search:\"M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z\",\"align-center\":\"M432 160H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0 256H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM108.1 96h231.81A12.09 12.09 0 0 0 352 83.9V44.09A12.09 12.09 0 0 0 339.91 32H108.1A12.09 12.09 0 0 0 96 44.09V83.9A12.1 12.1 0 0 0 108.1 96zm231.81 256A12.09 12.09 0 0 0 352 339.9v-39.81A12.09 12.09 0 0 0 339.91 288H108.1A12.09 12.09 0 0 0 96 300.09v39.81a12.1 12.1 0 0 0 12.1 12.1z\",\"align-right\":\"M16 224h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16zm416 192H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm3.17-384H172.83A12.82 12.82 0 0 0 160 44.83v38.34A12.82 12.82 0 0 0 172.83 96h262.34A12.82 12.82 0 0 0 448 83.17V44.83A12.82 12.82 0 0 0 435.17 32zm0 256H172.83A12.82 12.82 0 0 0 160 300.83v38.34A12.82 12.82 0 0 0 172.83 352h262.34A12.82 12.82 0 0 0 448 339.17v-38.34A12.82 12.82 0 0 0 435.17 288z\",\"list-ol\":\"M48 48a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm448 16H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z\",\"list-ul\":\"M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z\",\"border-style\":\"M240 416h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm-96 0h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm192 0h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm96-192h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0 96h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0 96h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-288h-32a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-96H32A32 32 0 0 0 0 64v400a16 16 0 0 0 16 16h32a16 16 0 0 0 16-16V96h368a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z\",columns:\"M464 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V80c0-26.51-21.49-48-48-48zM224 416H64V160h160v256zm224 0H288V160h160v256z\",eye:\"M288 144a110.94 110.94 0 0 0-31.24 5 55.4 55.4 0 0 1 7.24 27 56 56 0 0 1-56 56 55.4 55.4 0 0 1-27-7.24A111.71 111.71 0 1 0 288 144zm284.52 97.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400c-98.65 0-189.09-55-237.93-144C98.91 167 189.34 112 288 112s189.09 55 237.93 144C477.1 345 386.66 400 288 400z\",comment:\"M256 32C114.6 32 0 125.1 0 240c0 49.6 21.4 95 57 130.7C44.5 421.1 2.7 466 2.2 466.5c-2.2 2.3-2.8 5.7-1.5 8.7S4.8 480 8 480c66.3 0 116-31.8 140.6-51.4 32.7 12.3 69 19.4 107.4 19.4 141.4 0 256-93.1 256-208S397.4 32 256 32z\",plus:\"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z\",minus:\"M416 208H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z\",times:\"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z\",check:\"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z\",\"chevron-up\":\"M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z\",gear:\"M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336c44.2 0 80-35.8 80-80s-35.8-80-80-80s-80 35.8-80 80s35.8 80 80 80z\"}[e]}\"/></svg>`,GCD=(e,a)=>e?a?e>a?GCD(e-a,a):GCD(e,a-e):e:a,fourDecimals=e=>V(1e4*e)/1e4;function toHarloweColour(e,a){let t=e;return t=t.toLowerCase(),0==+a?\"transparent\":+a<1?(t=function hexToHSL(e){e=e.slice(1);const a=parseInt(e.slice(0,2),16)/255,t=parseInt(e.slice(2,4),16)/255,r=parseInt(e.slice(4,6),16)/255,o=Math.max(a,t,r),n=Math.min(a,t,r),s=(o+n)/2,i=o-n;if(o===n)return{h:0,s:0,l:s};let l;switch(o){case a:l=(t-r)/i+(t<r?6:0);break;case t:l=(r-a)/i+2;break;case r:l=(a-t)/i+4}return l=Math.round(60*l),{h:l,s:s>.5?i/(2-o-n):i/(o+n),l:s}}(t),`(hsl:${fourDecimals(t.h)},${fourDecimals(t.s)},${fourDecimals(t.l)},${fourDecimals(a)})`):t in Y?Y[t]:t[1]===t[2]&&t[3]===t[4]&&t[5]===t[6]?`#${t[1]}${t[3]}${t[5]}`:t}function toCSSColour(e,a){if(0==+a)return\"transparent\";if(+a<1){e=e.slice(1);return`rgba(${parseInt(e.slice(0,2),16)},${parseInt(e.slice(2,4),16)},${parseInt(e.slice(4,6),16)},${a})`}return e}function setOptionalStyles({codeUsesCodeFont:e=!0}){const a=\"cm-harlowe-4-\";let t=document.querySelector(`style#${a}optionalStyles`);t||(t=document.createElement(\"style\"),t.setAttribute(\"id\",`${a}optionalStyles`),document.head.appendChild(t));let r=\"\",o=1;if(e)try{for(let e of localStorage.getItem(\"twine-prefs\")?.split(\",\")||[]){let{name:a,value:t}=JSON.parse(localStorage.getItem(`twine-prefs-${e}`));\"codeEditorFontFamily\"===a?r=t.includes(\" \")?`\"${t}\"`:t:\"codeEditorFontScale\"===a&&(o=t)}}catch(e){}t.innerHTML=e?`.${a}root:not([class^='${a}text']):not([class^='${a}verbatim']) { ${r?`font-family:${r}`:\"\"}; ${o?`font-size:${100*o}%`:\"\"}`:\"\"}function getPrefs(){try{return JSON.parse(localStorage.getItem(\"harlowe-prefs\"))||{}}catch(e){return{}}}function setPref(e,a){try{const t=getPrefs();t[e]=a,localStorage.setItem(\"harlowe-prefs\",JSON.stringify(t)),setOptionalStyles(t)}catch(e){return{}}}const U=document.createElement(\"p\");function el(e){return U.innerHTML=e,U.firstChild}const G=!!document.querySelector('html[data-version^=\"2.3.\"]'),buttonClass=e=>G?\" \":`icon-button variant-${e?\"primary\":\"secondary\"} `,X=\"opacity:0.5;pointer-events:none\",{stringify:Z}=JSON;let{lex:J}=D,K={};const Q=\"querySelector\",ee=`${Q}All`,ae=\"addEventListener\",te=\"removeEventListener\",re=[[\"#f8f9fa\",\"#fff5f5\",\"#fff0f6\",\"#f8f0fc\",\"#f3f0ff\",\"#edf2ff\",\"#e7f5ff\",\"#e3fafc\",\"#e6fcf5\",\"#ebfbee\",\"#f4fce3\",\"#fff9db\",\"#fff4e6\"],[\"#f1f3f5\",\"#ffe3e3\",\"#ffdeeb\",\"#f3d9fa\",\"#e5dbff\",\"#dbe4ff\",\"#d0ebff\",\"#c5f6fa\",\"#c3fae8\",\"#d3f9d8\",\"#e9fac8\",\"#fff3bf\",\"#ffe8cc\"],[\"#e9ecef\",\"#ffc9c9\",\"#fcc2d7\",\"#eebefa\",\"#d0bfff\",\"#bac8ff\",\"#a5d8ff\",\"#99e9f2\",\"#96f2d7\",\"#b2f2bb\",\"#d8f5a2\",\"#ffec99\",\"#ffd8a8\"],[\"#dee2e6\",\"#ffa8a8\",\"#faa2c1\",\"#e599f7\",\"#b197fc\",\"#91a7ff\",\"#74c0fc\",\"#66d9e8\",\"#63e6be\",\"#8ce99a\",\"#c0eb75\",\"#ffe066\",\"#ffc078\"],[\"#ced4da\",\"#ff8787\",\"#f783ac\",\"#da77f2\",\"#9775fa\",\"#748ffc\",\"#4dabf7\",\"#3bc9db\",\"#38d9a9\",\"#69db7c\",\"#a9e34b\",\"#ffd43b\",\"#ffa94d\"],[\"#adb5bd\",\"#ff6b6b\",\"#f06595\",\"#cc5de8\",\"#845ef7\",\"#5c7cfa\",\"#339af0\",\"#22b8cf\",\"#20c997\",\"#51cf66\",\"#94d82d\",\"#fcc419\",\"#ff922b\"],[\"#868e96\",\"#fa5252\",\"#e64980\",\"#be4bdb\",\"#7950f2\",\"#4c6ef5\",\"#228be6\",\"#15aabf\",\"#12b886\",\"#40c057\",\"#82c91e\",\"#fab005\",\"#fd7e14\"],[\"#495057\",\"#f03e3e\",\"#d6336c\",\"#ae3ec9\",\"#7048e8\",\"#4263eb\",\"#1c7ed6\",\"#1098ad\",\"#0ca678\",\"#37b24d\",\"#74b816\",\"#f59f00\",\"#f76707\"],[\"#343a40\",\"#e03131\",\"#c2255c\",\"#9c36b5\",\"#6741d9\",\"#3b5bdb\",\"#1971c2\",\"#0c8599\",\"#099268\",\"#2f9e44\",\"#66a80f\",\"#f08c00\",\"#e8590c\"],[\"#212529\",\"#c92a2a\",\"#a61e4d\",\"#862e9c\",\"#5f3dc4\",\"#364fc7\",\"#1864ab\",\"#0b7285\",\"#087f5b\",\"#2b8a3e\",\"#5c940d\",\"#e67700\",\"#d9480f\"]],dataValueRow=(e=((e,a)=>{e.expression=a}),a,t=!1)=>({type:\"inline-dropdown-rows\",text:\"Value: \",name:\"variable-datatype\",width:\"16%\",options:[[\"text string\",{type:\"inline-string-textarea\",width:\"55%\",text:\"\",placeholder:\"Text\",modelCallback:e,modelRegistry:a}],[\"number\",{type:\"inline-number-textarea\",width:\"20%\",text:\"\",modelCallback:e,modelRegistry:a}],[\"Boolean value\",{type:\"inline-dropdown\",text:\"\",options:[\"false\",\"true\"],model(a,t){e(a,`${!!t[Q](\"select\").value}`)},modelRegistry:a}],[\"colour\",{type:\"inline-colour\",text:\"\",value:\"#ffffff\",model(a,t){const r=t[Q](\"[type=color]\").value,o=+t[Q](\"[type=range]\").value;e(a,toHarloweColour(r,o))},modelRegistry:a}],[\"array\",{type:\"datavalue-rows\",text:\"<div class='harlowe-4-datavalueRowHint'>An <b>array</b> is a sequence of ordered datavalues that can be used without having to create separate variables for each. Use it to store similar values whose order and position matter, or to store an ever-changing quantity of similar values.</div>\",modelRows(a,t){e(a,`(a:${t})`)},renumber(e,a){const t=`${a+=1}`.slice(-1);e.textContent=a+(\"1\"===t?\"st\":\"2\"===t?\"nd\":\"3\"===t?\"rd\":\"th\")+\": \"},modelRegistry:a}],[\"datamap\",{type:\"datavalue-map\",text:\"<div class='harlowe-4-datavalueRowHint'>A <b>datamap</b> is a value that holds any number of other values, each of which is \\\"mapped\\\" to a unique name. Use it to store data values that represent parts of a larger game entity, or rows of a table.</div>\",modelRows(a,t){t.every(((e,a)=>a%2!=0||'\"\"'!==e&&\"''\"!==e))||(a.invalidSubrow=!0),e(a,`(dm:${t})`)},renumber(e){e.textContent=\":\"},modelRegistry:a}],[],[\"randomly chosen value\",{type:\"datavalue-rows\",text:\"<div class='harlowe-4-datavalueRowHint'>One of the following values is randomly chosen <b>each time the macro is run</b>.</div>\",modelRows(a,t){t.length||(a.invalidSubrow=!0),e(a,`(either:${t})`)},renumber(e){e.textContent=\"•\",e.style.marginRight=\"0.5em\"},modelRegistry:a}],[\"random number\",el(\"<div class='harlowe-4-datavalueRowHint'>A number between these two values is randomly chosen <b>each time the macro is run</b>.</div>\"),{type:\"inline-number-textarea\",width:\"20%\",text:\"From\",model(){},modelRegistry:a},{type:\"inline-number-textarea\",width:\"20%\",text:\"to\",model(a,t){e(a,`(random:${+t.previousElementSibling[Q](\"input\").value||0},${+t[Q](\"input\").value||0})`)},modelRegistry:a}],...t?[]:[[],[\"itself + value\",{type:\"datavalue-inner\",text:\"<div class='harlowe-4-datavalueRowHint'>The following value is added to the existing value in the variable. NOTE: if the values aren't the same type of data, an error will result.</div>\",modelRows(a,t){1!==t.length&&(a.invalidSubrow=!0),e(a,`it + ${t}`)},renumber(e){e&&(e.textContent=\"it + \")},modelRegistry:a}],[\"variable + value\",{type:\"inline-dropdown\",text:\" Other variable: \",options:[\"$\",\"_\"],model(e,a){e.innerVariable=a[Q](\"select\").value?\"_\":\"$\"}},{type:\"inline-textarea\",width:\"25%\",text:\"\",placeholder:\"Variable name\",model(e,a){const t=a[Q](\"input\").value;t&&RegExp(`^${I.validPropertyName}$`).exec(t)&&!RegExp(/^\\d/).exec(t)&&(e.innerVariable+=t)}},{type:\"datavalue-inner\",text:\"<div class='harlowe-4-datavalueRowHint'>The above variable's value and the value below are added together. NOTE: if the values aren't the same type of data, an error will result.</div>\",modelRows(a,t){1!==t.length&&(a.invalidSubrow=!0),e(a,`${a.innerVariable} + ${t}`)},renumber(e){e&&(e.textContent=\"\")},modelRegistry:a}]],[],[\"coded expression\",{type:\"expression-textarea\",width:\"90%\",text:\"<div>Write a Harlowe code expression that should be computed to produce the desired value.</div>\",placeholder:\"Code\",modelCallback:e,modelRegistry:a}]]}),folddownPanel=(...e)=>()=>{if(!e.length)return el(\"<div>\");const a=[],t=[];function output(){return Object.entries(this.changers).map((([e,a])=>`(${e}:${a.join(\",\")})`)).join(\"+\")}function changerNamed(e){return this.changers[e]||=[]}const model=e=>a.reduce(((e,a)=>(a(e),e)),{changers:{},wrapStart:\"[\",wrapEnd:\"]\",wrapStringify:!1,innerText:void 0,valid:!1,output,changerNamed,initiator:e});function update({target:e}={target:null}){const a=model(e??void 0);t.forEach((e=>e(a)))}const r=el(`<div class=\"harlowe-4-toolbarPanel${G?\"\":\" card floating\"}\" style=\"transition:max-height 0.8s;overflow-y:auto\">`),makeColourPicker=e=>{const makeSwatchRow=(e,a,t)=>el(`<span class=harlowe-4-swatchRow data-index=\"${a}\" ${t?\"\":'style=\"display:none\"'}>${e.map((e=>`<span class=harlowe-4-swatch style=\"background-color:${e}\"></span>`)).join(\"\")}</span>`),a=el(`<div class=harlowe-4-singleColourPicker><input style=\"width:48px;margin-right:8px\" type=color value=\"${e}\"></div>`),t=el(`<span class=\"text-select-control\"><select ${G?\"\":'style=\"max-width: 9em;\"'}><option value=\"\" selected>Harlowe built-ins</option></select></span>`),r=t[Q](\"select\");return a.append(makeSwatchRow(Object.keys(Y),\"\",!0)),re.forEach(((e,t)=>{a.append(makeSwatchRow(e,t)),r?.append(el(`<option value=${t}>OpenColor ${t}</option>`))})),r?.[ae](\"change\",(()=>{a[ee](\"[data-index]\").forEach((e=>e.style.display=\"none\")),a[Q](`[data-index=\"${r.value}\"]`).style.display=\"inline-block\"})),a.append(t,el(\"<br>\"),new Text(\"Opacity: \"),el('<input type=range style=\"width:64px;top:8px;position:relative\" value=1 min=0 max=1 step=0.05>')),a[ae](\"click\",(({target:e})=>{if(e instanceof HTMLElement&&e.classList.contains(\"harlowe-4-swatch\")){const t=a[Q](\"input\");t&&(t.value=e?.getAttribute(\"style\")?.slice(-7)||\"\",t.dispatchEvent(new Event(\"change\")))}})),a},o=e.reduce((function reducer(e,r){let o,n;const s=e instanceof HTMLElement&&\"label\"===e.tagName.toLowerCase();if(r instanceof Node)return e.append(r),e;if(n=r.type.startsWith(\"inline\"),e instanceof HTMLElement)switch(r.type){case\"text\":case\"inline-text\":o=el(`<${n?\"span\":\"div\"}>${r.text}</${n?\"span\":\"div\"}>`);break;case\"notice\":case\"small\":o=el(`<small style=\"display:block\">${r.text}</small>`);break;case\"buttons\":e.append(...r.buttons.map((e=>{if(\"tagName\"in e)return e;const a=el(`<button title=\"${e.title}\" class=\"${buttonClass()}${e.active?\" active\":\"\"}${e.danger?\" variant-danger\":\"\"}\">${e.html}</button>`);return e.onClick&&a[ae](\"click\",e.onClick),e.update&&t.push((t=>e.update(t,a))),a})));break;case\"preview\":case\"t8n-preview\":{const e=\"t8n-preview\"===r.type,a=r.tagName||\"span\";if(o=el(`<div class=\"harlowe-4-stylePreview\" style=\"${e?\"cursor:pointer;height: 2.6rem;\":\"\"}\" ${e?'alt=\"Click to preview the transition\"':\"\"}><${a}>${r.text||\"\"}</${a}>${e?`<${a}>${r.text2}</${a}>`:\"\"}</div>`),e){o[ae](\"mouseup\",update),o[ae](\"touchend\",update);const e=o[Q](\":first-child\");e[ae](\"animationend\",(()=>e.style.visibility=\"hidden\"))}}break;case\"checkbox\":case\"checkboxrow\":case\"inline-checkbox\":o=el(`<label${n?\"\":' style=\"display:block\"'} class=\"harlowe-4-checkboxRow\"><input type=\"checkbox\" ${\"persist\"in r&&r.persist?\"data-persist\":\"\"}></input>${r.text}</label>`),\"checkboxrow\"===r.type&&(r.subrow.reduce(reducer,o),r.subrow.forEach((a=>{if(a instanceof Node)return;const t=a.model;a.model=(a,r)=>!o[Q](\":scope > input:checked\")||s&&!e[Q](\":scope > input:checked\")?a:t(a,r)}))),o[ae](\"change\",update);break;case\"checkboxes\":o=el(`<div class=\"harlowe-4-toolbarCheckboxes\" ${!1===r.bottomBorder?' style=\"border:none\"':\"\"}><div${r.bold?' style=\"font-weight:bold\"':\"\"}>${r.name}</div></div>`),r.options.forEach(((e,a)=>{const t=el(`<label${r.capitalise?' style=\"text-transform:capitalize;\"':\"\"} class=\"${buttonClass()}\"><input type=\"checkbox\" ${r.persist?\"data-persist\":\"\"} ${r.checked?.(a)?\"checked\":\"\"}></input>${e}</label>`);t[ae](\"change\",update),o.append(t)}));break;case\"radios\":o=el(`<div class=\"harlowe-4-toolbarCheckboxes\"><div${r.bold?' style=\"font-weight:bold\"':\"\"}>${r.name}</div></div>`),r.options.forEach(((e,a)=>{const t=el(`<label${r.capitalise?' style=\"text-transform:capitalize;\"':\"\"} class=\"${buttonClass()}\"><input type=\"radio\" name=\"${r.name}\" value=\"${e}\" ${a?\"\":\"checked\"} ${r.persist?\"data-persist\":\"\"}></input>${e}</label>`);t[ae](\"change\",update),o.append(t)}));break;case\"textarea\":case\"inline-textarea\":case\"inline-string-textarea\":case\"inline-passage-textarea\":case\"inline-number-textarea\":case\"expression-textarea\":{let e=\"text\";const a=\"multiline\"in r&&r.multiline?\"textarea\":\"input\";\"expression-textarea\"===r.type&&(r.update=(e,t)=>{!e.expression&&t[Q](a).value?t.setAttribute(\"invalid\",\"This doesn't seem to be valid code.\"):t.removeAttribute(\"invalid\")},r.model=(e,t)=>{const o=(t[Q](a).value||\"\").trim();if(o){if(J(o,\"\",\"macro\").children.every((function recur(e){return\"text\"!==e.type&&\"error\"!==e.type&&(\"string\"===e.type||\"hook\"===e.type||e.children.every(recur))})))return void r.modelCallback(e,o);e.valid=!0}}),\"inline-string-textarea\"===r.type&&(r.model||=(e,t)=>{r.modelCallback(e,JSON.stringify(t[Q](a).value||\"\"))}),\"inline-number-textarea\"===r.type&&(e=\"number\",r.model||=(e,t)=>{r.modelCallback(e,+t[Q](a).value||0)}),o=el(`<${n?\"span\":\"div\"} class=\"harlowe-4-labeledInput\">${r.text}<${a} ${\"useSelection\"in r&&r.useSelection?\"data-use-selection\":\"\"}${r.type.includes(\"passage\")?'list=\"harlowe-4-passages\"':\"\"} style=\"width:${r.width};${\"multiline\"in r&&r.multiline?`max-width:${r.width};`:\"\"}padding:var(--grid-size);margin${n?\":2px 0.5rem 0 0.5rem\":\"-left:1rem\"};${\"multiline\"in r&&r.multiline&&n?\"display:inline-block;height:40px\":\"\"}\" type=${e} ${\"persist\"in r&&r.persist?\"data-persist\":\"\"} placeholder=\"${r.placeholder||\"\"}\"></${a}></${n?\"span\":\"div\"}>`),o[Q](a)[ae](\"input\",update)}break;case\"inline-number\":case\"range\":case\"inline-range\":o=el(`<${n?\"span\":\"div\"} class=\"harlowe-4-labeledInput\">${r.text}<input style=\"padding:var(--grid-size);${r.width?`width:${r.width}`:\"\"}\" type=${r.type.endsWith(\"range\")?\"range\":\"number\"} min=${r.min} max=${r.max} value=${r.value}${r.step?` step=${r.step}`:\"\"}></input></${n?\"span\":\"div\"}>`),o[Q](\"input\")[ae](r.type.endsWith(\"range\")?\"input\":\"change\",update);break;case\"inline-colour\":{o=el(`<${n?\"span\":\"div\"} class=\"harlowe-4-labeledInput\">${r.text}</${n?\"span\":\"div\"}>`);const e=makeColourPicker(r.value);o.append(e),o[ee](\"input\").forEach((e=>e[ae](\"change\",update)))}break;case\"gradient\":{o=el(`<div style='position:relative'><span class=harlowe-4-gradientBar></span><button class=\"${buttonClass()}\">${fontIcon(\"plus\")} Colour</button></div>`);const e=o[Q](\".harlowe-4-gradientBar\"),createColourStop=(a,t,r)=>{const o=el(`<div ${r?\"selected\":\"\"} data-colour=\"${t}\" data-pos=\"${a}\" class=harlowe-4-colourStop style=\"left:calc(${100*a}% - 8px); top:-8px\"><div class=harlowe-4-colourStopButtons style=\"left:${-(G?464:384)*a-(G?0:40)}px\"></div></div>`),n=makeColourPicker(t);n[ee](\"input\").forEach((e=>e[ae](\"change\",(()=>{const e=n[Q](\"input[type=range]\").value,a=n[Q](\"[type=color]\").value;o.setAttribute(\"data-colour\",toCSSColour(a,e)),+e<1&&o.setAttribute(\"data-harlowe-colour\",toHarloweColour(a,+e)),update()}))));const s=el(`<button class=\"${buttonClass()}\" style='float:right'>${fontIcon(\"times\")} Delete</button>`);s[ae](\"click\",(()=>{o.remove(),update()})),n.append(s),o.firstElementChild?.prepend(n),e.append(o),update()};setTimeout((()=>{createColourStop(0,\"#ffffff\"),createColourStop(.5,\"#000000\",!0),createColourStop(1,\"#ffffff\")})),o[Q](\"button\")[ae](\"click\",(()=>createColourStop(.5,\"#888888\")));const listener=({target:a})=>{if(a instanceof HTMLElement&&a.classList.contains(\"harlowe-4-colourStop\")){const t=document.documentElement,{left:r,right:o}=e.getBoundingClientRect(),n=o-r,onMouseMove=e=>{let t=\"pageX\"in e?e.pageX:e.touches[0].pageX;if(void 0===t)return;const o=Math.min(1,Math.max(0,(t-window.scrollX-r)/n));a.style.left=`calc(${100*o}% - 8px)`,a.firstChild.style.left=-(G?464:384)*o-(G?0:40)+\"px\",a.setAttribute(\"data-pos\",`${o}`),update()},onMouseUp=()=>{t[te](\"mousemove\",onMouseMove),t[te](\"mouseup\",onMouseUp),t[te](\"touchmove\",onMouseMove),t[te](\"touchend\",onMouseUp)};t[ae](\"mousemove\",onMouseMove),t[ae](\"mouseup\",onMouseUp),t[ae](\"touchmove\",onMouseMove),t[ae](\"touchend\",onMouseUp),Array.from(e[ee](\"[selected]\")).forEach((e=>e.removeAttribute(\"selected\"))),a.setAttribute(\"selected\",\"true\")}};o[ae](\"mousedown\",listener),o[ae](\"touchstart\",listener),t.push((()=>{e.style.background=`linear-gradient(to right, ${Array.from(e[ee](\".harlowe-4-colourStop\")).sort(((e,a)=>(+e.getAttribute(\"data-pos\")||0)-(+a.getAttribute(\"data-pos\")||0))).map((e=>`${e.getAttribute(\"data-colour\")} ${100*(+e.getAttribute(\"data-pos\")||0)}%`))})`}))}break;case\"dropdown\":case\"inline-dropdown\":{const e=el(`<${n?\"span\":\"div\"} style=\"white-space:nowrap;${n?\"\":\"width:50%;\"}position:relative;\">${r.text}<span class=\"text-select-control\"><select style=\"${n?\"margin:0.5rem;\":\"margin-left:1rem;\"}font-size:0.9rem;margin-top:4px\" ${r.persist?\"data-persist\":\"\"}></select></span></${n?\"span\":\"div\"}>`);r.options.forEach(((a,t)=>{e[Q](\"select\")?.append(el(`<option value=\"${t?a:\"\"}\"${a?t?\"\":\" selected\":\" disabled\"}>${a||\"───────\"}</select>`))})),e[Q](\"select\")?.[ae](\"change\",update),o=e}break;case\"radiorows\":o=el(\"<div>\"),r.options.forEach(((a,t)=>{if(a instanceof HTMLElement)return;const n=el(`<label class='harlowe-4-radioRow'><input type=\"radio\" name=\"${r.name}\" value=\"${t||\"none\"}\" ${t?\"\":\"checked\"}></input></label>`);o.append(a.reduce(reducer,n)),a.forEach((a=>{if(a instanceof Node)return;const{model:t}=a;t&&(a.model=(a,r)=>!n[Q](\":scope > input:checked\")||s&&!e[Q](\":scope > input:checked\")?a:t(a,r))})),n[Q](\"input\")?.[ae](\"change\",update)}));break;case\"macro-list\":{o=el('<div><div style=\"text-align:center\">Category: </div></div>');const e=el(\"<span class='text-select-control'><select></span>\");o.firstChild.append(e);const a=e[Q](\"select\"),t=el('<div style=\"margin-top:8px;border-top:1px solid hsla(0,0%,50%,0.5);max-height:40vh;overflow-y:scroll\">');o.append(t),a?.[ae](\"change\",(()=>{const e=t[Q](`[name=\"${a.value}\"]`);e?.scrollIntoView()})),Object.values(j.Macro).sort((({name:e,category:a,categoryOrder:t},{name:r,category:o,categoryOrder:n})=>a!==o?(a||\"\").localeCompare(o||\"\"):t!==n?isNaN(+t)?1:isNaN(+n)?-1:Math.sign(+t-+n):e.localeCompare(r))).forEach(((e,r,o)=>{if(0!==r&&e.category===o[r-1].category||(t.append(el(`<h3 style=\"text-transform:capitalize\" name=\"${e.category}\">${e.category}</h3>`)),a?.append(el(`<option value=\"${e.category}\">${e.category}</option>`))),r>0&&e.name===o[r-1].name)return;const n=el(`<label class='harlowe-4-radioRow'><input type=\"radio\" name=\"macro-list\" value=\"${e.name}\"></input><code><a href=\"https://twine2.neocities.org/#${e.anchor}\" target=\"_blank\" rel=\"noopener noreferrer\">(${e.name}: ${e.sig}) → ${e.returnType}</a></code>${e.aka.length?`<div><i>Also known as: ${e.aka.map((e=>`<code>(${e}:)</code>`)).join(\", \")}</i>`:\"\"}</div><div>${e.abstract.replace(/`([^`]+)`/g,((e,a)=>`<code>${a}</code>`))}</div></label>`);t.append(n),n[Q](\"input\")?.[ae](\"change\",update)}))}break;case\"inline-dropdown-rows\":{o=el(`<${n?\"span\":\"div\"}><span class=\"harlowe-4-dropdownRowLabel\">${r.text}</span><span class=\"text-select-control\"><select style=\"font-size:1rem;margin-top:4px;${r.width?`width:${r.width};text-overflow:ellipsis`:\"\"}\"></select></span><span class=\"harlowe-4-dropdownRows\"></span></${n?\"span\":\"div\"}>`);const a=o[Q](\"select\");r.options.forEach((([t,...r],n)=>{if(!t)return void a.append(el(\"<option disabled>───────</option>\"));a.append(el(`<option value=\"${t}\" ${n?\"\":\"selected\"}>${t}<option>`));const i=el(`<span data-value=\"${t}\" ${n?\"hidden\":\"\"}>`);o[Q](\".harlowe-4-dropdownRows\").append(r.reduce(reducer,i)),r.forEach((r=>{const{model:o}=r;o&&(r.model=(r,n)=>a.value!==t||s&&!e[Q](\":scope > input:checked\")?r:o(r,n))}))})),a[ae](\"change\",(()=>{const e=a.value;o[ee](\":scope > .harlowe-4-dropdownRows > span\").forEach((a=>{a[(a.getAttribute(\"data-value\")===e?\"remove\":\"set\")+\"Attribute\"](\"hidden\",\"\")})),update()}))}break;case\"textarea-rows\":{o=el(`<div class=\"harlowe-4-textareaRows ${r.nonZeroRows?\"harlowe-4-nonZeroRows\":\"\"}\">`);const makeRow=()=>{if(o.childNodes.length>100)return;const e=el(`<div class=\"harlowe-4-dataRow\"><input type=text style=\"width:80%;padding:var(--grid-size)\" placeholder=\"${r.placeholder}\"></input><button class=\"${buttonClass()} harlowe-4-rowMinus\">${fontIcon(\"minus\")}</button><button class=\"${buttonClass()} harlowe-4-rowPlus\">${fontIcon(\"plus\")}</button></div>`);e[Q](\"input\")?.[ae](\"input\",update),e[Q](\".harlowe-4-rowPlus\")?.[ae](\"click\",(()=>{makeRow(),update()})),e[Q](\".harlowe-4-rowMinus\")?.[ae](\"click\",(()=>{e.remove(),update()})),o.append(e)};makeRow()}break;case\"datavalue-inner\":{o=el(`<div class=\"harlowe-4-dataRow\" style='margin:0.2em 0px'>${r.text}</div>`);const e=[];let a=[];reducer(o,dataValueRow(((e,t)=>a.push(t)),e,!0));const t=r.modelRows;r.model=r=>{a=[],e.reduce(((e,a)=>(a(e),e)),r),t?.(r,a)},r.renumber(o[Q](\":scope > * > .harlowe-4-dropdownRowLabel\"))}break;case\"datavalue-rows\":case\"datavalue-map\":{o=el(`<div class=\"harlowe-4-datavalueRows\">${r.text||\"\"}<div class=\"harlowe-4-dataEmptyRow\"><i>No data</i></div><button class=\"${buttonClass()} harlowe-4-rowPlus\">${fontIcon(\"plus\")} Value</button></div>`);const e=o[Q](\".harlowe-4-rowPlus\"),a=new Set;let t=[];const renumber=()=>{Array.from(o[ee](\":scope > .harlowe-4-dataRow > * > .harlowe-4-dropdownRowLabel\")).forEach(r.renumber)},makeRow=()=>{if(o.childNodes.length>50)return;const n=el('<div class=\"harlowe-4-dataRow\">'),s=[];o.insertBefore([...r.type.endsWith(\"map\")?[{type:\"inline-textarea\",text:\"\",placeholder:\"Data name\",width:\"15%\",model(e,a){t.push(Z(a[Q](\"input\").value))},modelRegistry:s}]:[],dataValueRow(((e,a)=>{t.push(`${a}`)}),s,!0)].reduce(reducer,n),e),s.forEach((e=>a.add(e))),n.append(el(`<button class=\"${buttonClass()} harlowe-4-rowMinus\">${fontIcon(\"minus\")}</button>`)),n[Q](\":scope > .harlowe-4-rowMinus\")?.[ae](\"click\",(()=>{n.remove(),s.forEach((e=>a.delete(e))),0===o.childNodes.length&&makeRow(),update(),renumber()}))},{modelRows:n}=r;r.model=e=>{t=[],[...a].reduce(((e,a)=>(a(e),e)),e),n?.(e,t)},e[ae](\"click\",(()=>{makeRow(),update(),renumber()}))}break;case\"scroll-wrapper\":o=el('<div class=\"harlowe-4-scrollWrapper\"></div>'),r.contents.reduce(reducer,o);break;case\"confirm\":{if(!G){const a=el('<div class=\"harlowe-4-scrollWrapper\"></div>');a.append(...e.childNodes),e.append(a)}const a=el('<div class=\"harlowe-4-confirmButtons\" style=\"padding-bottom:8px;\"></div>'),r=el(`<button class=\"${buttonClass()}\">${fontIcon(\"times\")} Cancel</button>`),n=el(`<button class=\"${buttonClass(!0)} create\">${fontIcon(\"check\")} Add</button>`);n.setAttribute(\"style\",X),t.push((e=>{const a=e.valid?\"removeAttribute\":\"setAttribute\";n[a](\"style\",X),e.valid&&(\"function\"==typeof e.wrapStart&&(e.wrapStart=e.wrapStart(e)),\"function\"==typeof e.wrapEnd&&(e.wrapEnd=e.wrapEnd(e)))})),r[ae](\"click\",(()=>K.switchPanel())),n[ae](\"click\",(()=>{const e=model();\"function\"==typeof e.wrapStart&&(e.wrapStart=e.wrapStart(e)),\"function\"==typeof e.wrapEnd&&(e.wrapEnd=e.wrapEnd(e)),K.wrapSelection(e.output()+e.wrapStart,e.wrapEnd,\"\",e.innerText,e.wrapStringify),K.switchPanel()})),a.append(r,n),o=a}break;default:return console.error(`Invalid PanelRow type: ${r.type}`),e}if(s){const a=r.update;r.update=(t,r)=>{const o=e[Q](\":scope > input:checked\");Array.from(e[ee](\"div,br ~ *\")).forEach((e=>e[(o?\"remove\":\"set\")+\"Attribute\"](\"hidden\",\"\"))),Array.from(e[ee](\"input,select\")).slice(1).forEach((e=>e[(o?\"remove\":\"set\")+\"Attribute\"](\"disabled\",\"\"))),a?.(t,r)}}return r.model&&(\"modelRegistry\"in r&&r.modelRegistry||a).push((e=>r.model(e,o))),r.update&&t.push((e=>r.update(e,o))),o&&e.append(o),e.onreset=update,e}),r);return e.splice(0,e.length),o},{stringify:oe,parse:ne}=JSON,{round:se}=Math;let ie,le={},ce=getPrefs().tooltips;void 0===ce&&(ce=!0);const he=\"querySelector\",de=`${he}All`,me=\"addEventListener\",pe=el('<div class=\"harloweToolbar\">'),twine2KeymapOverride=e=>{pe[he](\".harlowe-4-toolbarPanel\")&&\"Escape\"===e.key&&(switchPanel(),e.stopPropagation())};function wrapSelection(e,a,t,r,o){if(0===(e+a).length)return;const n=void 0!==r?r:ie.doc.getSelection()||t||\"Your Text Here\";ie.doc.replaceSelection(e+(o||String)(n)+a,\"around\")}function switchPanel(e=\"default\"){if(!G&&\"default\"===e)return void pe[de](\".harlowe-4-toolbarPanel\").forEach((e=>e.remove()));Object.entries(le).forEach((([a,t])=>{if(\"function\"==typeof t){if(a!==e)return;t=le[a]=t()}t[de](\"[type=radio]:not([data-persist])\").forEach((e=>{e.checked=e.parentNode?.parentNode?.[he](\"label:first-of-type\")===e.parentNode})),t[de](\"[type=checkbox]:not([data-persist])\").forEach((e=>{e.checked=e.hasAttribute(\"checked\")})),t[de](\"[type=text]:not([data-persist])\").forEach((e=>{e.value=\"\"})),t[de](\"select:not([data-persist])\").forEach((e=>{e.value=e.firstElementChild?.getAttribute(\"value\")||\"\";const{nextElementSibling:a}=e;a?.className.includes(\"harlowe-4-dropdownRows\")&&Array.from(a.children).forEach((a=>{a[(a.getAttribute(\"data-value\")===e.value?\"remove\":\"set\")+\"Attribute\"](\"hidden\",\"\")}))})),\"onreset\"in t&&\"function\"==typeof t.onreset&&t.onreset()}));let a=le[e];if(!(a instanceof HTMLElement))return;const{height:t}=getComputedStyle(pe);pe[de](\".harlowe-4-toolbarPanel\").forEach((e=>e.remove())),G?(a.style.maxHeight=t,pe[de](\"[data-use-selection]\").forEach((e=>e.value=ie.doc.getSelection())),setTimeout((()=>a.style.maxHeight=\"70vh\"),100)):a.classList.add(\"card-button-card\",\"card\",\"floating\"),pe.append(a),pe.parentNode?.addEventListener(\"keydown\",twine2KeymapOverride),document.addEventListener(\"keydown\",twine2KeymapOverride)}K.wrapSelection=wrapSelection,K.switchPanel=switchPanel;const ue={default:e=>e?\"appear step-end\":\"appear\",dissolve:()=>\"appear\",shudder:()=>\"shudder-in\",rumble:()=>\"rumble-in\",zoom:()=>\"zoom-in\",\"slide-left\":e=>e?\"slide-right\":\"slide-left\",\"slide-right\":e=>e?\"slide-left\":\"slide-right\",\"slide-up\":e=>e?\"slide-down\":\"slide-up\",\"slide-down\":e=>e?\"slide-up\":\"slide-down\",flicker:()=>\"flicker\",pulse:()=>\"pulse\",instant:e=>\"appear step-\"+(e?\"end\":\"start\"),\"fade-right\":e=>e?\"fade-left\":\"fade-right\",\"fade-left\":e=>e?\"fade-right\":\"fade-left\",\"fade-up\":e=>e?\"fade-down\":\"fade-up\",\"fade-down\":e=>e?\"fade-up\":\"fade-down\",blur:()=>\"blur\"},ge=[\"default\",\"\",\"instant\",\"dissolve\",\"blur\",\"rumble\",\"shudder\",\"pulse\",\"zoom\",\"flicker\",\"slide-left\",\"slide-right\",\"slide-up\",\"slide-down\",\"fade-left\",\"fade-right\",\"fade-up\",\"fade-down\"],ye={type:\"checkbox\",text:\"Affect the entire remainder of the passage or hook\",model(e,a){a[he](\":checked\")&&(e.wrapStart=\"[=\\n\",e.wrapEnd=\"\")}},be=\"A <b>hook</b> is a section of passage prose enclosed in <code>[</code> or <code>]</code>, or preceded with <code>[=</code>.\",doneRow=()=>{const e=el(`<span style=\"${G?\"float:right;\":\"position:absolute;bottom:var(--grid-size);right:var(--grid-size);\"}\"><button class=\"variant-primary primary icon-button\">Done</button></span>`);return e?.firstChild?.[me](\"click\",(()=>{switchPanel(),ie.constructor.signal(ie,\"harlowe-4-findDone\")})),e};le={textstyle:(()=>{const e={bold:\"font-weight:bold\",italic:\"font-style:italic\",underline:\"text-decoration: underline\",\"double-underline\":\"text-decoration: underline;text-decoration-style:double\",\"wavy-underline\":\"text-decoration: underline;text-decoration-style:wavy\",strike:\"text-decoration: line-through\",\"double-strike\":\"text-decoration: line-through;text-decoration-style:double\",\"wavy-strike\":\"text-decoration: line-through;text-decoration-style:wavy\",superscript:\"vertical-align:super;font-size:.83em\",subscript:\"vertical-align:sub;font-size:.83em\",mark:\"background-color: hsla(60, 100%, 50%, 0.6)\",outline:\"color:black; text-shadow: -1px -1px 0 white, 1px -1px 0 white, -1px  1px 0 white, 1px  1px 0 white\",shadow:\"text-shadow: 0.08em 0.08em 0.08em white\",emboss:\"text-shadow: 0.04em 0.04em 0em white\",condense:\"letter-spacing:-0.08em\",expand:\"letter-spacing:0.1em\",blur:\"text-shadow: 0em 0em 0.08em white; color:transparent\",blurrier:\"text-shadow: 0em 0em 0.2em white; color:transparent\",smear:\"text-shadow: 0em 0em 0.02em white, -0.2em 0em 0.5em white, 0.2em 0em 0.5em white; color:transparent\",mirror:\"display:inline-block;transform:scaleX(-1)\",\"upside-down\":\"display:inline-block;transform:scaleY(-1)\",tall:\"display:inline-block;transform:scaleY(1.5) translateY(-0.25ex)\",flat:\"display:inline-block;transform:scaleY(0.5) translateY(0.25ex)\",blink:\"animation:harlowe-4-fade-in-out 1s steps(1,end) infinite alternate\",\"fade-in-out\":\"animation:harlowe-4-fade-in-out 2s ease-in-out infinite alternate\",rumble:\"display:inline-block;animation:harlowe-4-rumble linear 0.1s 0s infinite\",shudder:\"display:inline-block;animation:harlowe-4-shudder linear 0.1s 0s infinite\",sway:\"display:inline-block;animation:harlowe-4-sway 5s linear 0s infinite\",buoy:\"display:inline-block;animation:harlowe-4-buoy 5s linear 0s infinite\",fidget:\"display:inline-block;animation:harlowe-4-fidget 60s linear 0s infinite\"},model=(e,a)=>{const t=Array.from(a[de](\"[type=radio]:checked\")).map((e=>e.value)).filter((e=>\"none\"!==e)).concat(Array.from(a[de](\"[type=checkbox]:checked\")).map((e=>e?.parentNode?.textContent||\"\")));e.changerNamed(\"text-style\").push(...t.map((e=>oe(e)))),e.valid||=t.length>0};return folddownPanel({type:\"preview\",text:\"Example text preview\",update(a,t){t.firstChild.setAttribute(\"style\",`position:relative;${a.changers[\"text-style\"].map((a=>e[ne(a)])).join(\";\")}`)}},{type:\"small\",text:\"This preview doesn't account for other modifications to this passage's text colour, font, or background, and is meant only for you to examine each of these styles.\"},{type:\"checkboxes\",name:\"Font variants\",capitalise:!0,bold:!0,options:[\"bold\",\"italic\",\"mark\"],model},{type:\"radios\",name:\"Underlines and strikes\",capitalise:!0,bold:!0,options:[\"none\",\"underline\",\"double-underline\",\"wavy-underline\",\"strike\",\"double-strike\",\"wavy-strike\"],model},{type:\"radios\",name:\"Superscript and subscript\",capitalise:!0,bold:!0,options:[\"none\",\"superscript\",\"subscript\"],model},{type:\"radios\",name:\"Outlines\",capitalise:!0,bold:!0,options:[\"none\",\"outline\",\"shadow\",\"emboss\",\"blur\",\"blurrier\",\"smear\"],model},{type:\"radios\",name:\"Letter spacing\",capitalise:!0,bold:!0,options:[\"none\",\"condense\",\"expand\"],model},{type:\"radios\",name:\"Flips and stretches\",capitalise:!0,bold:!0,options:[\"none\",\"mirror\",\"upside-down\",\"tall\",\"flat\"],model},{type:\"radios\",name:\"Animations\",capitalise:!0,bold:!0,options:[\"none\",\"blink\",\"fade-in-out\",\"rumble\",\"shudder\",\"sway\",\"buoy\",\"fidget\"],model},ye,{type:\"confirm\"})})(),borders:(()=>{function dropdownControls(e,a){return[el(`<div><b>${e}</b></div>`),{type:\"inline-dropdown\",text:\"Style:\",options:[\"none\",\"\",\"dotted\",\"dashed\",\"solid\",\"double\",\"groove\",\"ridge\",\"inset\",\"outset\"],model(e,t){const r=t[he](\"select\").value;e.changerNamed(\"b4r\").push(oe(r||\"none\")),(e.borderEnabled||=[])[a]=!!r}},{type:\"inline-number\",text:\"Size:\",value:1,min:.1,max:20,step:.1,model(e,a){e.changerNamed(\"b4r-size\").push(a[he](\"input\").value)}},{type:\"inline-colour\",text:\"Colour:\",value:\"#ffffff\",update(e,t){t.setAttribute(\"style\",e.borderEnabled?.[a]?\"\":\"display:none\")},model(e,a){const t=a[he](\"[type=color]\").value,r=+a[he](\"[type=range]\").value;e.changerNamed(\"b4r-colour\").push(toHarloweColour(t,r)),(e.borderColours||=[]).push(toCSSColour(t,r))}}]}return folddownPanel({type:\"preview\",text:\"Example border preview\",update(e,a){const t=e.suppressedChangers||e.changers;a.firstChild.setAttribute(\"style\",`border-style:${t.b4r?`${t.b4r.map(ne).join(\" \")};`:\"\"}${t[\"b4r-size\"]?`border-width:${t[\"b4r-size\"].reduce(((e,a)=>`${e} ${2*+a}px`),\"\")};`:\"\"}${t[\"b4r-colour\"]?`border-color:${e.borderColours.join(\" \")};`:\"\"}`)}},...dropdownControls(\"Top\",0),...dropdownControls(\"Right\",1),...dropdownControls(\"Bottom\",2),...dropdownControls(\"Left\",3),{type:\"radios\",name:\"Affect:\",options:[\"The attached hook\",\"The remainder of the passage or hook.\",\"The entire passage.\"],model(e,a){const t=a[he](\"input:checked\"),r=Array.from(a[de](\"label\")).indexOf(t.parentNode);r>=2&&Object.keys(e.changers).length?(e.suppressedChangers=e.changers,e.changers={}):1===r&&(e.wrapStart=\"[=\\n\",e.wrapEnd=\"\")}},{type:\"confirm\",model(e){e.valid=!0;const a=e.suppressedChangers||e.changers;[[\"b4r\",e=>\"none\"===ne(e)],[\"b4r-size\",e=>1==+e],[\"b4r-colour\",e=>\"transparent\"===e]].forEach((([t,r])=>{a[t]=function reduce4ValueProp(e){return 4===e.length&&e[3]===e[1]&&e.pop(),3===e.length&&e[2]===e[0]&&e.pop(),2===e.length&&e[1]===e[0]&&e.pop(),e}(a[t]),a[t].every(r)&&(delete a[t],\"b4r\"===t&&(e.valid=!1))})),e.valid&&e.suppressedChangers&&(e.wrapStart=`(enchant:?passage,${Object.entries(a).map((([e,a])=>`(${e}:${a.join(\",\")})`)).join(\"+\")})`,e.wrapEnd=\"\")}})})(),textcolor:folddownPanel({type:\"preview\",text:\"Example text preview\",update(e,a){const t=e.suppressedChangers||e.changers;a.firstChild.setAttribute(\"style\",`${t[\"text-colour\"]?`color:${e.textColour};`:\"\"}${e.stops?`background:linear-gradient(${e.angle}deg, ${e.stops.map((e=>`${e.getAttribute(\"data-colour\")} ${100*+e.getAttribute(\"data-pos\")}%`))})`:t.bg?`background:${e.backgroundColour}`:\"\"}`)}},{type:\"small\",text:\"This preview doesn't account for other modifications to this passage's text colour or background, and is meant only for you to examine the selected colours.\"},el(\"<div><b>Text colour</b></div>\"),{type:\"radiorows\",name:\"txtcolor\",options:[[{type:\"inline-text\",text:\"Default text colour\"}],[new Text(\"Flat colour\"),{type:\"colour\",text:\"\",value:\"#ffffff\",model(e,a){const t=a[he](\"[type=color]\").value,r=a[he](\"[type=range]\").value;e.changerNamed(\"text-colour\").push(toHarloweColour(t,+r)),e.textColour=toCSSColour(t,r)}}]]},el(\"<div><b>Background</b></div>\"),{type:\"radiorows\",name:\"bgcolor\",options:[[{type:\"inline-text\",text:\"Default background\",model(e){e.valid=!0}}],[new Text(\"Flat colour\"),{type:\"colour\",text:\"\",value:\"#000000\",model(e,a){const t=a[he](\"[type=color]\").value,r=a[he](\"[type=range]\").value;e.changerNamed(\"bg\").push(toHarloweColour(t,+r)),e.backgroundColour=toCSSColour(t,r),e.valid=!0}}],[new Text(\"Linear gradient\"),{type:\"gradient\",model(e,a){const t=Array.from(a[de](\".harlowe-4-colourStop\")).sort(((e,a)=>+e.getAttribute(\"data-pos\")-+a.getAttribute(\"data-pos\")));t.length>1&&(e.valid=!0,e.changerNamed(\"bg\").push(`(gradient: $deg, ${t.map((e=>`${fourDecimals(+e.getAttribute(\"data-pos\"))},${e.getAttribute(\"data-harlowe-colour\")||e.getAttribute(\"data-colour\")}`))})`),e.stops=t,e.angle=0)}},el(`<br style=\"height:${G?1:4}rem\">`),{type:\"inline-range\",text:\"Angle (deg):\",value:0,min:0,max:359,step:1,model(e,a){if(e.valid){const t=e.changerNamed(\"bg\");e.angle=+a[he](\"input\").value,t[0]=t[0].replace(\"$deg\",`${e.angle}`)}}}]]},{type:\"radios\",name:\"Affect:\",options:[\"The attached hook\",\"The remainder of the passage or hook.\",\"The entire passage.\",\"The entire page.\"],model(e,a){const t=a[he](\"input:checked\"),r=Array.from(a[de](\"label\")).indexOf(t.parentNode),o=Object.entries(e.changers);r>=2&&o.length?(e.wrapStart=`(enchant:?pa${2===r?\"ssa\":\"\"}ge,${o.map((([e,a])=>`(${e}:${a.join(\",\")})`)).join(\"+\")})`,e.wrapEnd=\"\",e.suppressedChangers=e.changers,e.changers={}):1===r&&(e.wrapStart=\"[=\\n\",e.wrapEnd=\"\")}},{type:\"confirm\"}),passagelink:(()=>{const passageT8nPreviews=()=>[el(\"<br>\"),{type:\"inline-dropdown\",text:\"Departing transition: \",options:ge,model(e,a){const{value:t}=a[he](\"select\");\"\"!==t&&e.changerNamed(\"t8n-depart\").push(oe(t))}},{type:\"inline-dropdown\",text:\"Arriving transition: \",options:ge,model(e,a){const{value:t}=a[he](\"select\");\"\"!==t&&e.changerNamed(\"t8n-arrive\").push(oe(t))}},el(\"<br>\"),{type:\"inline-number\",text:\"Transition time (sec): \",value:.8,min:0,max:999,step:.1,model(e,a){const t=a[he](\"input\").value;.8!=+t&&e.changerNamed(\"t8n-time\").push(`${t}s`)}},{type:\"t8n-preview\",text:\"Departing Text\",text2:\"Arriving Text\",update(e,a){if(e.initiator&&![\"select\",\"div\",\"span\"].some((a=>a===e.initiator.tagName.toLowerCase())))return;const t=`harlowe-4-${ue[e.changers[\"t8n-depart\"]?ne(e.changers[\"t8n-depart\"][0]):\"default\"](!0)}`,r=`harlowe-4-${ue[e.changers[\"t8n-arrive\"]?ne(e.changers[\"t8n-arrive\"][0]):\"default\"](!1)}`,o=e.changers[\"t8n-time\"]?e.changers[\"t8n-time\"][0]:\"0.8s\",n=a.firstChild,s=a.lastChild;n.setAttribute(\"style\",`animation:${t} reverse ${o} 1;`),s.setAttribute(\"style\",`animation:${r} ${o} 1;`),n.remove(),s.remove(),setTimeout((()=>a.append(n,s)))}}];return folddownPanel({type:\"radiorows\",name:\"whichclick\",options:[[{type:\"inline-textarea\",text:\"Create a hyperlink, with this text:\",placeholder:\"Link text (can't be empty)\",useSelection:!0,width:\"50%\",model(e,a){const t=a[he](\"input\").value;t.length>0&&(e.linkText=t,e.valid=!0)}}],[{type:\"inline-text\",text:\"Allow the entire page to be clicked.\",model(e){e.changerNamed(\"click\").push(\"?page\"),e.clickPage=!0,e.valid=!0}},{type:\"text\",text:\"This will place a faint blue border around the edges of the page, and change the mouse cursor to the hand pointer, until it is clicked.\"}]]},{type:\"text\",text:\"<b>When it is clicked, perform this action:</b>\"},{type:\"radiorows\",name:\"passagelink\",update(e,a){a.lastChild.firstChild[(e.clickPage?\"set\":\"remove\")+\"Attribute\"](\"disabled\",\"\"),e.clickPage&&a.lastChild.firstChild.checked&&a.firstChild.firstChild.click()},options:[[{type:\"inline-passage-textarea\",text:\"Go to this passage:\",width:\"70%\",placeholder:\"Passage name\",model(e,a){const t=a[he](\"input\").value;t.length||(e.valid=!1),\"click\"in e.changers?(delete e.changers.click,e.wrapStart=`(click-goto:?page,${oe(t)})`,e.wrapEnd=\"\"):[\"]]\",\"->\",\"<-\"].some((a=>t.includes(a)||e.linkText?.includes(a)))?(e.wrapStart=`(link-goto:${oe(e.linkText)},`,e.wrapEnd=`${oe(t)})`):(e.wrapStart=`[[${e.linkText}`,e.wrapEnd=`->${t}]]`),e.innerText=\"\"}},...passageT8nPreviews()],[{type:\"inline-text\",text:\"Undo the current turn, returning to the previous passage.\",model(e){\"click\"in e.changers?(e.wrapStart=`(click-undo:${e.changers.click})`,e.wrapEnd=\"\",delete e.changers.click):(e.changerNamed(\"link-undo\").push(oe(e.linkText)),e.wrapStart=\"\",e.wrapEnd=\"\")}},...passageT8nPreviews()],[{type:\"inline-dropdown\",text:\"Reveal \",options:[\"an attached hook.\",\"the remainder of the passage.\"],model(e,a){a[he](\"select\").value&&(e.wrapStart=\"[=\\n\",e.wrapEnd=\"\")}},el(\"<br>\"),{type:\"text\",text:`(${be})`},{type:\"inline-dropdown\",text:\"Revealed text transition: \",options:ge,model(e,a){const{value:t}=a[he](\"select\");\"\"!==t&&e.changerNamed(\"t8n\").push(oe(t))}},{type:\"inline-number\",text:\"Transition time (sec): \",value:.8,min:0,max:999,step:.1,model(e,a){const t=a[he](\"input\").value;.8!=+t&&e.changerNamed(\"t8n-time\").push(`${t}s`)}},{type:\"t8n-preview\",text2:\"Revealed Text\",update(e,a){if(e.initiator&&![\"select\",\"div\",\"span\"].some((a=>a===e.initiator.tagName.toLowerCase())))return;const t=`harlowe-4-${ue[e.changers.t8n?ne(e.changers.t8n[0]):\"default\"](!1)}`,r=e.changers[\"t8n-time\"]?e.changers[\"t8n-time\"][0]:\"0.8s\",o=a.lastChild;o.setAttribute(\"style\",`animation:${t} ${r} 1;`),o.remove(),setTimeout((()=>a.append(o)))}},{type:\"radiorows\",name:\"linkReveal\",update(e,a){a[de](\"input\").forEach((a=>a[(e.clickPage?\"set\":\"remove\")+\"Attribute\"](\"disabled\",\"\")))},options:[[{type:\"inline-text\",text:\"Then remove the link's own text.\",model(e){e.clickPage||e.changerNamed(\"link\").push(oe(e.linkText))}}],[{type:\"inline-text\",text:\"Then unlink the link's own text.\",model(e){e.clickPage||e.changerNamed(\"link-reveal\").push(oe(e.linkText))}}],[{type:\"inline-text\",text:\"Re-run the hook each time the link is clicked.\",model(e){e.clickPage||e.changerNamed(\"link-rerun\").push(oe(e.linkText))}}],[{type:\"inline-text\",text:\"Repeat the hook each time the link is clicked.\",model(e){e.clickPage||e.changerNamed(\"link-repeat\").push(oe(e.linkText))}}]]}],[{type:\"inline-text\",text:\"Cycle the link's text to the next alternative in a list.\"},el(\"<br>\"),{type:\"textarea-rows\",nonZeroRows:!0,placeholder:\"Link text (can't be empty)\",model(e,a){const t=[e.linkText].concat(Array.from(a[de](\"input\")).map((e=>e.value)));!e.clickPage&&t.every(Boolean)?(e.wrapStart=`(cycling-link:${t.map((e=>JSON.stringify(e)))})`,e.wrapEnd=\"\",e.innerText=\"\"):a.parentNode.firstChild.checked&&(e.valid=!1)}},{type:\"radios\",name:\"Upon reaching the end:\",options:[\"Loop to the start.\",\"Remove the link.\",\"Unlink the link.\"],model(e,a){if(!e.valid)return;const{value:t}=a[he](\"[type=radio]:checked\");t.startsWith(\"U\")?e.wrapStart=e.wrapStart.replace(/^\\(cycling/,\"(seq\"):t.startsWith(\"R\")&&(e.wrapStart=e.wrapStart.replace(/\\)$/,',\"\")'))}}]]},{type:\"confirm\"})})(),if:folddownPanel({type:\"text\",text:\"<b>Only show a section of the passage if this condition is met:</b>\"},{type:\"radiorows\",name:\"if\",options:[[{type:\"inline-dropdown\",text:\"The player visited this passage\",options:[\"exactly\",\"at most\",\"at least\",\"anything but\",\"a multiple of\"],model(e,a){e.changerNamed(\"if\").push(`visits${{\"\":\" is \",\"at most\":\" <= \",\"at least\":\" >= \",\"anything but\":\" is not \",\"a multiple of\":\" % \"}[a[he](\"select\").value]}`)}},{type:\"inline-number\",text:\"\",value:0,min:0,max:999,model(e,a){const t=e.changerNamed(\"if\");t[0]+=a[he](\"input\").value,t[0].includes(\" % \")&&(t[0]+=\" is 0\",t[0]=t[0].replace(\" % 2 is 0\",\" is an even\")),e.valid=!0}},new Text(\" times.\")],[{type:\"inline-dropdown\",text:\"The player has now visited this passage an\",options:[\"even\",\"odd\"],model(e,a){e.changerNamed(\"if\").push(\"odd\"===a[he](\"select\").value?\"visits is an odd\":\"visits is an even\"),e.valid=!0}},new Text(\" number of times.\")],[{type:\"inline-number\",text:\"\",value:2,min:1,max:999,model(e,a){e.changerNamed(\"after\").push(`${a[he](\"input\").value}s`),e.valid=!0}},new Text(\" seconds have passed since this passage was entered.\")],[{type:\"inline-textarea\",width:\"20%\",text:\"The passage \",placeholder:\"Passage name\",model(e,a){const t=a[he](\"input\").value;t&&(e.changerNamed(\"if\").push(`(history: where its name contains ${oe(t)})'s length`),e.valid=!0)}},{type:\"inline-dropdown\",text:\"was visited \",options:[\"exactly\",\"at most\",\"at least\",\"anything but\",\"a multiple of\"],model(e,a){e.changerNamed(\"if\")[0]+={\"\":\" is \",\"at most\":\" <= \",\"at least\":\" >= \",\"anything but\":\" is not \",\"a multiple of\":\" % \"}[a[he](\"select\").value]}},{type:\"inline-number\",text:\"\",value:1,min:1,max:999,model(e,a){const t=e.changerNamed(\"if\");t[0]+=a[he](\"input\").value,t[0].includes(\" % \")&&(t[0]+=\" is 0\",t[0]=t[0].replace(\" % 2 is 0\",\" is even\"))}},new Text(\" times.\")],[{type:\"inline-textarea\",width:\"15%\",text:\"Passages tagged \",placeholder:\"Tag name\",model(e,a){const t=a[he](\"input\").value;t&&(e.changerNamed(\"if\").push(`(history: where (passage:it)'s tags contains ${oe(t)})'s length`),e.valid=!0)}},{type:\"inline-dropdown\",text:\"were visited \",options:[\"exactly\",\"at most\",\"at least\",\"anything but\",\"a multiple of\"],model(e,a){const t=a[he](\"select\").value;e.changerNamed(\"if\")[0]+={\"\":\" is \",\"at most\":\" <= \",\"at least\":\" >= \",\"anything but\":\" is not \",\"a multiple of\":\" % \"}[t]}},{type:\"inline-number\",text:\"\",value:1,min:1,max:999,model(e,a){const t=e.changerNamed(\"if\");t[0]+=a[he](\"input\").value,t[0].includes(\" % \")&&(t[0]+=\" is 0\",t[0]=t[0].replace(\" % 2 is 0\",\" is even\"))}},new Text(\" times.\")],[{type:\"inline-text\",text:\"There are no more interactable elements in the passage.\",model(e){e.changerNamed(\"more\"),e.valid=!0}},{type:\"text\",text:\"Interactable elements are link, mouseover, or mouseout areas. If you're using links that reveal additional lines of prose and then remove or unlink themselves, this will reveal the attached text when all of those are gone.\"}],[{type:\"inline-dropdown\",text:\"The variable \",options:[\"$\",\"_\"],model(e,a){e.variable=a[he](\"select\").value?\"_\":\"$\"}},{type:\"inline-textarea\",width:\"25%\",text:\"\",placeholder:\"Variable name\",model(e,a){const t=a[he](\"input\").value;t&&RegExp(`^${I.validPropertyName}$`).exec(t)&&!RegExp(/^\\d/).exec(t)&&(e.variable+=t)}},{type:\"inline-dropdown\",text:\"\",options:[\"is\",\"is not\",\"is greater than\",\"is less than\",\"contains\",\"is in\"],model(e,a){const t=a[he](\"select\").value;e.operator={\"is greater than\":\">\",\"is less than\":\"<\",\"\":\"is\"}[t]||t}},new Text(\"a value.\"),el(\"<br>\"),dataValueRow(),{type:\"text\",text:\"\",model(e){void 0!==e.expression&&\"\"!==e.expression&&e.operator&&e.variable&&!e.invalidSubrow&&(e.changerNamed(\"if\").push(`${e.variable} ${e.operator} ${e.expression}`),e.valid=!0)}}]]},{type:\"checkbox\",text:\"Also, only if the previous (if:), (else-if:) or (unless:) hook's condition wasn't fulfilled.\",model(e,a){a[he](\":checked\")&&(\"if\"in e.changers?(e.changerNamed(\"else-if\").push(...e.changerNamed(\"if\")),delete e.changers.if):e.changerNamed(\"else\"))}},ye,{type:\"confirm\"}),hook:folddownPanel({type:\"text\",text:`${be} The main purpose of hooks is that they can be visually or textually altered by special data values called <b>changers</b>. Changers are usually placed in front of hooks to change them.`,model(e){e.wrapStart=\"[\",e.wrapEnd=\"]\",e.valid=!0}},{type:\"textarea\",width:\"25%\",text:\"Hook name (letters, numbers and underscores only):\",placeholder:\"Hook name\",model(e,a){const t=a[he](\"input\").value;t&&(RegExp(`^${I.validPropertyName}$`).exec(t)?(e.wrapStart=`|${t}>[`,e.hookName=t):e.valid=!1)}},{type:\"text\",text:\"\",update(e,a){const t=(e.hookName||\"\").toLowerCase();t?[\"link\",\"page\",\"passage\",\"sidebar\"].includes(t)?a.innerHTML=`The hook name <b><code>?${t}</code></b> is <b>reserved</b> by Harlowe. It refers to <b>${\"link\"===t?\"all of the links in the passage\":\"page\"===t?\"the entire HTML page\":\"passage\"===t?\"the element that contains the current passage's text\":\"sidebar\"===t?\"the passage's sidebar, containing the undo/redo icons\":\"unknown\"}</b>.`:a.innerHTML=`You can refer to this hook (and every other one with this name) using the code <b><code>?${t}</code></b>.`:a.innerHTML=\"Hook names are optional, but giving a hook a nametag allows it to be remotely altered using macros like <code>(click:)</code>, <code>(replace:)</code>, or <code>(enchant:)</code>. You can use these macros elsewhere in the passage, keeping your prose uncluttered.\"}},{type:\"confirm\"}),align:folddownPanel({type:\"preview\",text:\"You can apply left, center and right alignment to your passage text, as well as adjust the margins and width.\",update(e,a){a.setAttribute(\"style\",\"width:100%;height:6em;overflow-y:hidden;\");let t=`width:${100*e.width}%;margin-left:${100*e.left}%;margin-right:${100*e.right}%;`;\"center\"!==e.align&&(t+=`text-align:${e.align};`),a.firstChild.setAttribute(\"style\",`display:block;${t}`)}},{type:\"inline-range\",text:\"Placement: \",value:0,min:0,max:10,step:1,model(e,a){e.placement=+a[he](\"input\").value/10}},{type:\"inline-range\",text:\"Width: \",value:5,min:1,max:10,step:1,model(e,a){e.width=+a[he](\"input\").value/10;const t=1-e.width;e.left=t*e.placement,e.right=t*(1-e.placement)}},{type:\"radios\",name:\"Alignment\",capitalise:!0,options:[\"left\",\"center\",\"justify\",\"right\"],model(e,a){e.align=a[he](\"input:checked\").value}},{type:\"checkbox\",text:\"Affect the entire remainder of the passage\",model(e,a){const t=!!a[he](\":checked\");if(e.width===(\"center\"===e.align?.5:1)&&(!e.left||!e.right)==(\"center\"!==e.align&&\"justify\"!==e.align)){const a=se(10*e.left),r=se(10*e.right),o=GCD(a,r),n=\"left\"===e.align?\"<==\":\"right\"===e.align?\"==>\":\"=\".repeat(a/o)+(a?\">\":\"\")+(r?\"<\":\"\")+\"=\".repeat(r/o);t?(e.wrapStart=`${n}\\n`,e.wrapEnd=\"\"):e.changerNamed(\"align\").push(oe(n))}else{const a=se(100*e.left),r=se(100*e.width),o=se(100*e.right),n=GCD(r,GCD(a,o));e.changerNamed(\"align\").push(oe(\"left\"===e.align?\"<==\":\"right\"===e.align?\"==>\":\"justify\"===e.align?\"<==>\":\"=><=\")),e.changerNamed(\"box\").push(oe(\"=\".repeat(a/n)+\"X\".repeat(r/n)+\"=\".repeat(o/n))),t&&(e.wrapStart=\"[=\\n\",e.wrapEnd=\"\")}e.valid=!0}},{type:\"confirm\"}),rotate:folddownPanel({type:\"preview\",text:\"Rotated text preview\",update(e,a){a.setAttribute(\"style\",\"height:6em;\");const t=a[he](\"span\"),{changers:r}=e,o=r[\"text-rotate-x\"],n=r[\"text-rotate-y\"],s=r[\"text-rotate-z\"];let i=\"margin-top:2em;transform:\";(o||n)&&(i+=\"perspective(50vw) \"),o&&(i+=`rotateX(${o}deg) `),n&&(i+=`rotateY(${n}deg) `),s&&(i+=`rotateZ(${s}deg)`),t.setAttribute(\"style\",i)}},{type:\"range\",text:\"Rotation (X axis):\",value:0,min:0,max:359,step:1,model(e,a){const{value:t}=a[he](\"input\");+t&&(e.changerNamed(\"text-rotate-x\").push(t),e.valid=!0)}},{type:\"range\",text:\"Rotation (Y axis):\",value:0,min:0,max:359,step:1,model(e,a){const{value:t}=a[he](\"input\");+t&&(e.changerNamed(\"text-rotate-y\").push(t),e.valid=!0)}},{type:\"range\",text:\"Rotation (Z axis):\",value:0,min:0,max:359,step:1,model(e,a){const{value:t}=a[he](\"input\");+t&&(e.changerNamed(\"text-rotate-z\").push(t),e.valid=!0)}},ye,{type:\"confirm\"}),columns:folddownPanel({type:\"preview\",text:\"Use columns to lay out two or more spans of prose alongside each other. Each column has its own margins and can occupy a different amount of horizontal space.\",update(e,a){a.setAttribute(\"style\",\"width:90%;display:flex;justify-content:space-between;height:5em;overflow-y:hidden;\");const t=e.columns||[],r=Array.from(a[de](\"span\"));for(let e=0;e<Math.max(t.length,r.length);e+=1)e>=t.length?r[e].remove():e>=r.length&&a.append(el(`<span>${r[0].textContent}</span>`));const o=t.reduce(((e,a)=>e+a.width),0);Array.from(a[de](\"span\")).forEach(((e,a)=>e.setAttribute(\"style\",`position:relative; font-size:50%; width:${t[a].width/o*100}%;margin-left:${t[a].left}em;margin-right:${t[a].right}em`)))}},{type:\"inline-dropdown\",text:\"Columns:\",options:[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\"],model(e,a){e.columns=[...Array(+a[he](\"select\").value||1)].map((()=>({left:1,width:1,right:1}))),e.wrapStart=\"\",e.innerText=\"\",e.wrapEnd=e.columns.length>1?\"\\n|==|\":\"\",e.valid=!0},update(e,a){Array.from(a.parentNode[de](\".harlowe-4-labeledInput\")).forEach((e=>e.removeAttribute(\"style\"))),Array.from(a.parentNode[de](`p:nth-of-type(${e.columns.length}) ~ .harlowe-4-labeledInput`)).forEach((e=>e.setAttribute(\"style\",\"display:none\")))}},el(\"<br>\"),...[0,1,2,3,4,5].reduce(((e,a)=>e.concat({type:\"inline-number\",text:`Column ${a+1} left margin:`,value:1,min:0,max:9,step:1,model(e,t){e.columns[a]&&(e.columns[a].left=+t[he](\"input\").value)}},{type:\"inline-number\",text:\"Width:\",value:1,min:1,max:9,step:1,model(e,t){e.columns[a]&&(e.columns[a].width=+t[he](\"input\").value)}},{type:\"inline-number\",text:\"Right margin:\",value:1,min:0,max:9,step:1,model(e,t){const r=e.columns[a];r&&(r.right=+t[he](\"input\").value,e.wrapStart+=`\\n${\"=\".repeat(r.left)}${\"|\".repeat(r.width)}${\"=\".repeat(r.right)}\\nColumn ${a+1}`)}},el(\"<p>\"))),[]),{type:\"confirm\"}),collapse:folddownPanel({type:\"inline-dropdown\",text:\"Collapse the whitespace within \",options:[\"a section of the passage.\",\"the remainder of the passage.\"],model(e,a){a[he](\"select\").value?(e.wrapStart=\"{=\\n\",e.wrapEnd=\"\"):(e.wrapStart=\"{\",e.wrapEnd=\"}\"),e.valid=!0}},{type:\"text\",text:\"The <b>collapsing markup</b> hides line breaks and reduces sequences of consecutive spaces to just a single space.\"},{type:\"text\",text:\"If you wish to include whitespace that's exempt from this, you may include <b>HTML &lt;br&gt; tags</b>, or use the verbatim (Vb) markup.\"},{type:\"confirm\"}),basicValue:folddownPanel({type:\"text\",text:\"Use <b>variables</b> to store <b>data values</b>, either across your story or within a passage.<br>That data can then be used in the passage, or in other macro calls, by using the variable's name in place of that value.\"},{type:\"textarea\",width:\"25%\",text:\"Variable name (letters, numbers and underscores only):\",placeholder:\"Variable name\",model(e,a){const t=a[he](\"input\").value;t&&RegExp(`^${I.validPropertyName}$`).exec(t)&&!RegExp(/^\\d/).exec(t)&&(e.variableName=t)}},dataValueRow(),{type:\"checkbox\",text:\"Temp variable (the variable only exists in this passage and hook).\",model(e,a){e.sigil=a[he](\"input\").checked?\"_\":\"$\",e.variableName&&e.expression&&!e.invalidSubrow?(e.wrapStart=`(set: ${e.sigil}${e.variableName} to ${e.expression})`,e.wrapEnd=e.innerText=\"\",e.valid=!0):e.valid=!1}},{type:\"text\",text:\"\",update(e,a){const t=e.valid?`${e.sigil}${e.variableName}`:\"\";a.innerHTML=e.valid?`<p>You can refer to this variable using the code <b><code>${t}</code></b>.</p><p>Some types of data values (arrays, datamaps, datasets, strings, colours, gradients, custom macros, and typedvars) are storage containers for other values.<br>You can access a specific value stored in them using that value's <b>data name</b> (or a string or number value in brackets) by writing <b><code>${t}'s</code></b> <i>name</i>, or <i>name</i> <b><code>of ${t}</code></b>.</p><p>(If you want to display that stored value in the passage, you'll need to give it to a macro, such as <code>(print: ${t}'s </code> <i>name</i><code>)</code>.)</p>`:\"\"}},{type:\"confirm\"}),input:folddownPanel({type:\"radiorows\",name:\"inputelement\",options:[[new Text(\"Create a text input box.\"),el(\"<br>\"),{type:\"preview\",tagName:\"textarea\",text:\"You can type sample text into this preview box.\",update(e,a){a.setAttribute(\"style\",\"width:100%;height:6em;\"),a.firstChild.setAttribute(\"style\",`display:block;resize:none;font-family:Georgia,serif;border-style:solid;border-color:#fff;color:#fff;width:${100*e.width}%;margin-left:${100*e.left}%;margin-right:${100*e.right}%;`),a.firstChild.setAttribute(\"rows\",`${e.rows||3}`)},model(e){e.wrapStart=e=>{const a=se(100*e.left),t=se(100*e.width),r=se(100*e.right),o=GCD(t,GCD(a,r));return`(${\"forcedText\"in e?\"force-\":\"\"}input-box:${e.variable?`2bind ${e.variable},`:\"\"}${oe(\"=\".repeat(a/o)+\"X\".repeat(t/o)+\"=\".repeat(r/o))}${3!==e.rows?`,${e.rows}`:\"\"}${\"forcedText\"in e?`,${oe(e.forcedText)}`:e.initialText?`,${oe(e.initialText)}`:\"\"})`},e.wrapEnd=e.innerText=\"\",e.valid=!0}},{type:\"inline-range\",text:\"Placement: \",value:5,min:0,max:10,step:1,width:\"25%\",model(e,a){e.placement=+a[he](\"input\").value/10}},{type:\"inline-range\",text:\"Width: \",value:5,min:1,max:10,step:1,width:\"25%\",model(e,a){e.width=+a[he](\"input\").value/10;const t=1-e.width;e.left=t*e.placement,e.right=t*(1-e.placement)}},{type:\"inline-number\",text:\"Rows:\",value:3,min:1,max:9,step:1,model(e,a){e.rows=+a[he](\"input\").value}},{type:\"radiorows\",name:\"inputboxtype\",options:[[{type:\"inline-textarea\",width:\"50%\",text:\"The box initially contains this text:\",placeholder:\"Initial text\",model(e,a){e.initialText=a[he](\"input\").value||\"\"}}],[{type:\"inline-textarea\",width:\"50%\",text:\"Force the player to type this text:\",placeholder:\"Text to display\",model(e,a){e.forcedText=a[he](\"input\").value||\"\"}},el(\"<div>Instead of being a normal input box, this will instead slowly write the above text into the box as the player presses keys.</div>\")]]}],[new Text(\"Create a dropdown menu.\"),el(\"<br>\"),{type:\"inline-text\",text:\"Dropdown options (leave blank to make a separator):\"},{type:\"textarea-rows\",nonZeroRows:!0,placeholder:\"Option text (leave blank to make a separator)\",model(e,a){const t=Array.from(a[de](\"input\")).map((e=>e.value));t.some(Boolean)&&(e.wrapStart=e=>`(dropdown: ${e.variable?`2bind ${e.variable},`:\"\"}${t.map((e=>oe(e)))})`,e.wrapEnd=e.innerText=\"\",e.valid=!0)}}],[new Text(\"Create a checkbox.\"),el(\"<br>\"),{type:\"inline-textarea\",width:\"50%\",text:\"Checkbox label:\",placeholder:\"Label text\",model(e,a){const t=a[he](\"input\").value||\"\";t&&(e.wrapStart=e=>`(checkbox: ${e.variable?`2bind ${e.variable},`:\"\"}${oe(t)})`,e.wrapEnd=e.innerText=\"\",e.valid=!0),e.needsVariable=!0}}],[new Text(\"Show a dialog box.\"),el(\"<br>\"),el(\"<div>This dialog box will appear as soon as the macro is displayed. This is best used inside a hook that's only shown if a condition is met.</div>\"),{type:\"textarea\",width:\"80%\",text:\"Text:\",placeholder:\"Your text here\",model(e,a){const t=a[he](\"input\").value||\"\";e.wrapStart=e=>`(dialog: ${e.variable?`bind ${e.variable},`:\"\"}${oe(t)}, ${e.links.map((e=>oe(e)))})`,e.wrapEnd=e.innerText=\"\"}},{type:\"inline-text\",text:\"Link options:\"},{type:\"textarea-rows\",nonZeroRows:!0,placeholder:\"Link text (can't be blank)\",model(e,a){const t=Array.from(a[de](\"input\")).map((e=>e.value));t.every(Boolean)&&(e.links=t,e.valid=!0)}}]]},{type:\"checkboxrow\",text:\"\",update(e,a){const t=a[he](\"input\");e.needsVariable?(t.setAttribute(\"disabled\",\"true\"),t.checked=!0):t.removeAttribute(\"disabled\")},model(e,a){e.needsVariable&&!a[he](\"input:checked\")&&(e.valid=!1)},subrow:[{type:\"inline-dropdown\",text:\"Bind this input element to the variable\",options:[\"$\",\"_\"],model(e,a){e.variable=a[he](\"select\").value?\"_\":\"$\"}},{type:\"inline-textarea\",width:\"25%\",text:\"\",placeholder:\"Variable name\",model(e,a){const t=a[he](\"input\").value;t&&RegExp(`^${I.validPropertyName}$`).exec(t)&&!RegExp(/^\\d/).exec(t)?e.variable+=t:e.valid=!1}}]},{type:\"confirm\"}),prefs:folddownPanel({type:\"text\",text:'<b style=\"font-size:1rem;height:var(--control-height);display:block;padding:var(--grid-size)\">Harlowe editor toolbar preferences</b>'},{type:\"checkboxes\",name:\"Show text completion tooltips when you type:\",capitalise:!0,bold:!1,options:[\"macro names\",\"keywords\"],checked:e=>!1!==getPrefs()[e?\"completionsForKeywords\":\"completionsForMacros\"],update(e,a){const[t,r]=a[de](\"[type=checkbox]\");t.checked=!1!==getPrefs().completionsForMacros,r.checked=!1!==getPrefs().completionsForKeywords},model(e,a){const[t,r]=a[de](\"[type=checkbox]\");setPref(\"completionsForMacros\",t.checked),setPref(\"completionsForKeywords\",r.checked)}},{type:\"checkboxes\",name:\"Other preferences:\",capitalise:!1,bold:!1,bottomBorder:!1,options:[\"Macro code uses the Code Editor Font instead of the Passage Editor Font\"],checked:e=>!1!==getPrefs()[e?\"\":\"codeUsesCodeFont\"],update(e,a){const[t]=a[de](\"[type=checkbox]\");t.checked=!1!==getPrefs().codeUsesCodeFont},model(e,a){const[t]=a[de](\"[type=checkbox]\");setPref(\"codeUsesCodeFont\",t.checked)}},doneRow()),macro:folddownPanel({type:\"text\",text:\"<b>Macros</b> are code used for programming and styling your story. The vast majority of Harlowe's features are available through macros.<br>All of the built-in Harlowe macros are listed here. For more details, click their signatures to open the documentation.\"},{type:\"macro-list\",model(e,a){const t=a[he](\"input:checked\");t&&(e.wrapStart=`(${t.value}:`,e.wrapEnd=\")\",e.innerText=\"Your Code Here\",e.valid=!0)}},{type:\"confirm\"}),find:(()=>{let updateButton=(e,a)=>a.setAttribute(\"style\",!e.query||e.matches<=0?X:\"\");return folddownPanel({type:\"scroll-wrapper\",contents:[el('<div><span style=\"width:50%;display:inline-block;margin-left:0.5rem\">Find in This Passage</span><span style=\"display:inline-block;\">Replace With</span></div>'),{type:\"inline-textarea\",multiline:!0,width:\"calc(50% - 1rem)\",text:\"\",placeholder:\"\",persist:!0,model(e,a){e.query=a[he](\"textarea\").value}},{type:\"inline-textarea\",multiline:!0,width:\"calc(50% - 1rem)\",text:\"\",placeholder:\"\",persist:!0},el(\"<br>\"),{type:\"buttons\",buttons:[{title:\"Previous Result\",html:'<b style=\"font-size:150%\">↑</b>',onClick:()=>ie.constructor.signal(ie,\"harlowe-4-findNext\",-1),update:updateButton},{title:\"Next Result\",html:'<b style=\"font-size:150%\">↓</b>',onClick:()=>ie.constructor.signal(ie,\"harlowe-4-findNext\",1),update:updateButton}]},{type:\"inline-dropdown\",text:\"\",options:[\"Everywhere\",\"Only in prose\",\"Only in code\",\"Only in selection\"],persist:!0,model(e,a){e.onlyIn=a[he](\"select\").value}},{type:\"inline-checkbox\",text:\"Match Case&nbsp;\",persist:!0,model(e,a){e.matchCase=a?.[he](\"input\").checked,ie.constructor.signal(ie,\"harlowe-4-find\",e)}},{type:\"inline-checkbox\",text:\"Use Regular Expressions\",persist:!0,model(e,a){e.useRegExp=a?.[he](\"input\").checked,ie.constructor.signal(ie,\"harlowe-4-find\",e)}},el(\"<br>\"),{type:\"text\",text:\"\",update(e,a){a.innerHTML=e.useRegExp?'You can use <code>$1</code>, <code>$2</code>, <code>$3</code>, etc. in the \"Replace With\" text to access capturing groups.':\"\"}},{type:\"buttons\",buttons:[{title:\"Replace\",html:\"Replace\",onClick:({target:e})=>ie.constructor.signal(ie,\"harlowe-4-replace\",e.parentNode.childNodes[2].lastChild.value,!1),update:updateButton},{title:\"Replace All\",html:\"Replace All\",danger:!0,onClick:({target:e})=>ie.constructor.signal(ie,\"harlowe-4-replace\",e.parentNode.childNodes[2].lastChild.value,!0),update:updateButton}]},{type:\"text\",text:\"\",update:function update(e,a){e.query&&e.matches>0?(a.textContent=`${e.matchIndex+1} of ${e.matches} result${1!==e.matches?\"s\":\"\"}`,a.setAttribute(\"style\",\"display:inline-block; margin-left:calc(var(--grid-size) * 2);\")):(a.textContent=\"\",a.setAttribute(\"style\",\"display:none\")),e.updateResultsDisplay||=()=>update(e,a)}}]},doneRow())})(),default:G?folddownPanel({type:\"buttons\",buttons:[{title:\"Bold\",html:\"<div style='font-family:serif;font-weight:bold'>B</div>\",onClick:()=>wrapSelection(\"''\",\"''\",\"Bold Text\")},{title:\"Italic\",html:\"<div style='font-family:serif;font-style:italic'>I</div>\",onClick:()=>wrapSelection(\"//\",\"//\",\"Italic Text\")},{title:\"Strikethrough\",html:\"<div style='font-family:serif;text-decoration:line-through'>S</div>\",onClick:()=>wrapSelection(\"~~\",\"~~\",\"Strikethrough Text\")},{title:\"Superscript\",html:\"<div style='font-family:serif'>X<sup>2</sup></div>\",onClick:()=>wrapSelection(\"^^\",\"^^\",\"Superscript Text\")},{title:\"Text and background colour\",html:\"<div class='harlowe-4-bgColourButton'>\",onClick:()=>switchPanel(\"textcolor\")},{title:\"Borders\",html:fontIcon(\"border-style\"),onClick:()=>switchPanel(\"borders\")},{title:\"Rotated text\",html:'<div style=\"transform:rotate(-30deg);font-family:serif;font-weight:bold\">R</div>',onClick:()=>switchPanel(\"rotate\")},{title:\"Special text style\",html:\"Styles…\",onClick:()=>switchPanel(\"textstyle\")},el('<span class=\"harlowe-4-toolbarBullet\">'),{title:\"Heading\",html:\"<div style='font-family:serif;font-weight:bold'>H</div>\",onClick:()=>wrapSelection(\"\\n#\",\"\",\"Heading Text\")},{title:\"Bulleted list item\",html:fontIcon(\"list-ul\"),onClick:()=>wrapSelection(\"\\n* \",\"\")},{title:\"Numbered list item\",html:fontIcon(\"list-ol\"),onClick:()=>wrapSelection(\"\\n0. \",\"\")},{title:\"Horizontal rule\",html:\"<b>—</b>\",onClick:()=>wrapSelection(\"\\n---\\n\",\"\")},{title:\"Alignment\",html:fontIcon(\"align-right\"),onClick:()=>switchPanel(\"align\")},{title:\"Columns\",html:fontIcon(\"columns\"),onClick:()=>switchPanel(\"columns\")},el('<span class=\"harlowe-4-toolbarBullet\">'),{title:\"Collapse whitespace (in-game)\",html:\"<b>{}</b>\",onClick:()=>switchPanel(\"collapse\")},{title:\"Verbatim (ignore all markup)\",html:\"Vb\",onClick(){const e=(ie.doc.getSelection().match(/`+/g)||[]).reduce(((e,a)=>Math.max(a.length,e)),0);wrapSelection(\"`\".repeat(e+1),\"`\".repeat(e+1),\"Verbatim Text\")}},{title:\"Comments\",html:\"<b>--[</b>\",onClick:()=>wrapSelection(\"--[\",\"]\",\"Comment Hook (ignore all contents)\")},el('<span class=\"harlowe-4-toolbarBullet\">'),{title:\"Link element\",html:\"Link…\",onClick:()=>switchPanel(\"passagelink\")},{title:\"Only show a portion of text if a condition is met\",html:\"If…\",onClick:()=>switchPanel(\"if\")},{title:\"Input element\",html:\"Input…\",onClick:()=>switchPanel(\"input\")},{title:\"Hook (named section of the passage)\",html:\"Hook…\",onClick:()=>switchPanel(\"hook\")},{title:\"Set a variable with a data value\",html:\"Var…\",onClick:()=>switchPanel(\"basicValue\")},{title:\"Peruse a list of all built-in macros\",html:\"Macro…\",onClick:()=>switchPanel(\"macro\")},el('<span class=\"harlowe-4-toolbarBullet\">'),{title:\"Proofreading view (dim all code except strings)\",html:fontIcon(\"eye\"),onClick:({target:e})=>{ie.display.wrapper.classList.toggle(\"harlowe-4-hideCode\"),\"svg\"===e.tagName.toLowerCase()&&(e=e.parentNode),e.classList.toggle(\"active\")}},{title:\"Coding tooltips (show a tooltip when the cursor rests on code structures)\",html:fontIcon(\"comment\"),active:!0,onClick:({target:e})=>{ie.display.wrapper.classList.toggle(\"harlowe-4-hideHelpTooltip\"),\"svg\"===e.tagName.toLowerCase()&&(e=e.parentNode),e.classList.toggle(\"active\")}},el('<span class=\"harlowe-4-toolbarBullet\">'),{title:\"Find and replace\",html:fontIcon(\"search\"),onClick:()=>{switchPanel(\"find\");const e=ie.doc.getSelection(),a=document[he](\".harlowe-4-toolbarPanel textarea\");a&&(a.focus(),e&&(a.value=e,a.dispatchEvent(new Event(\"input\"))))}},{title:\"Open the Harlowe documentation\",html:\"<div style='font-weight:bold'>?</div>\",onClick:()=>window.open(\"https://twine2.neocities.org/\",\"Harlowe Documentation\",\"noopener,noreferrer\")},(()=>{const e=el(`<button style=\"position:absolute;right:0em;margin-top:-2em\">${fontIcon(\"chevron-up\")}</button>`);return e[me](\"click\",(()=>{pe.classList.toggle(\"harlowe-4-minimised\");const a=e.firstElementChild?.classList;a?.toggle(\"fa-chevron-down\"),a?.toggle(\"fa-chevron-up\")})),e})()]}):folddownPanel()},switchPanel();const fe=\"data:image/svg+xml,\",svgURI=e=>`${fe}${window.escape(`<svg viewBox='0 0 14 14' width='80' height='80' xmlns='http://www.w3.org/2000/svg'>${e}</svg>`)}`,t24Icon=(e,a,t,r)=>svgURI(`<text y='${a}' x='${e}' fill='currentColor' style='/*harlowe-4*/${t}'>${r}</text>`),fontIconURI=e=>`${fe}${window.escape(fontIcon(e))}`,we=navigator.userAgent.includes(\"Macintosh\")?\"Cmd-\":\"Ctrl-\",ke={},ve={name:\"harlowe-4-keymap\",[`${we}G`](){\"parentNode\"in le.find&&le.find.parentNode&&ie.constructor.signal(ie,\"harlowe-4-findNext\",1)},[`Shift-${we}G`](){\"parentNode\"in le.find&&le.find.parentNode&&ie.constructor.signal(ie,\"harlowe-4-findNext\",-1)},[`${we}H`](){if(\"parentNode\"in le.find&&le.find.parentNode){const e=le.find[de](\"textarea\")[1];ie.constructor.signal(ie,\"harlowe-4-replace\",e.value,!1)}else switchPanel(\"find\")}};let xe,Te;const $e=navigator.userAgent.includes(\"Macintosh\")?\"⌘\":\"Ctrl+\",Ce=G?[]:[{type:\"menu\",label:\"Styles\",iconOnly:!0,icon:svgURI(\"<text y='11' x='-3' fill='currentColor' style='/*harlowe-4*/font-weight:bold;font-size:80%'>B</text><text y='8' x='4' fill='currentColor' style='/*harlowe-4*/font-style:italic;font-size:80%'>I</text><text y='13' x='7' fill='currentColor' style='/*harlowe-4*/text-decoration:line-through;font-size:80%'>S</text>\").replace(\"%2780%27\",\"%27108%27\"),items:[{type:\"button\",key:`${we}B`,command(){wrapSelection(\"''\",\"''\",\"Bold Text\")},label:`Bold [${$e}B]`},{type:\"button\",key:`${we}I`,command(){wrapSelection(\"//\",\"//\",\"Italic Text\")},label:`Italic [${$e}I]`},{type:\"button\",key:`${we}-`,command(){wrapSelection(\"~~\",\"~~\",\"Strikethrough Text\")},label:`Strikethrough [${$e}-]`},{type:\"button\",key:`${we}.`,command(){wrapSelection(\"^^\",\"^^\",\"Superscript Text\")},label:`Superscript [${$e}.]`},{type:\"separator\"},{type:\"button\",command(){switchPanel(\"textstyle\")},label:\"More Styles…\"}]},{type:\"button\",command(){switchPanel(\"textcolor\")},label:\"Colours\",iconOnly:!0,icon:svgURI('<defs><linearGradient id=\"X\"><stop offset=\"0%\" stop-color=\"hsla(0,100%,50%,0.5)\"/><stop offset=\"16%\" stop-color=\"hsla(30,100%,50%,0.5)\"/><stop offset=\"33%\" stop-color=\"hsla(60,100%,50%,0.5)\"/><stop offset=\"50%\" stop-color=\"hsla(120,100%,50%,0.5)\"/><stop offset=\"66%\" stop-color=\"hsla(180,100%,50%,0.5)\"/><stop offset=\"83%\" stop-color=\"hsla(240,100%,50%,0.5)\"/><stop offset=\"100%\" stop-color=\"hsla(320,100%,50%,0.5)\"/></linearGradient></defs><circle cx=\"8\" cy=\"8\" r=\"6\" fill=\"url(\\'#X\\')\"/>')},{type:\"button\",command(){switchPanel(\"borders\")},label:\"Borders\",iconOnly:!0,icon:fontIconURI(\"border-style\")},{type:\"button\",command(){switchPanel(\"rotate\")},label:\"Rotated text\",iconOnly:!0,icon:t24Icon(-3,14,\"transform:rotate(-30deg);font-family:serif;\",\"R\")},{type:\"menu\",icon:fontIconURI(\"list-ul\"),label:\"List and line items\",iconOnly:!0,items:[{type:\"button\",command(){wrapSelection(\"\\n* \",\"\")},label:\"Bulleted List Item\"},{type:\"button\",command(){wrapSelection(\"\\n0. \",\"\")},label:\"Numbered List Item\"},{type:\"separator\"},{type:\"button\",command(){wrapSelection(\"\\n#\",\"\",\"Heading Text\")},label:\"Heading\"},{type:\"button\",command(){wrapSelection(\"\\n---\\n\",\"\")},label:\"Horizontal Rule\"}]},{type:\"menu\",icon:fontIconURI(\"align-center\"),label:\"Alignment and columns\",iconOnly:!0,items:[{type:\"button\",command(){switchPanel(\"align\")},label:\"Alignment\"},{type:\"button\",command(){switchPanel(\"columns\")},label:\"Columns\"}]},{type:\"button\",command(){switchPanel(\"collapse\")},label:\"Collapse Whitespace (In-Game)\",iconOnly:!0,icon:t24Icon(0,10,\"font-weight:bold;font-size:12px\",\"{ }\")},{type:\"button\",command(){const e=(ie.doc.getSelection().match(/`+/g)||[]).reduce(((e,a)=>Math.max(a.length,e)),0);wrapSelection(\"`\".repeat(e+1),\"`\".repeat(e+1),\"Verbatim Text\")},label:\"Verbatim (Ignore All Markup Inside)\",iconOnly:!0,icon:t24Icon(1,12,\"font-size:11px\",\"Vb\")},{type:\"button\",command(){wrapSelection(\"--[\",\"--\",\"Comment Text\")},label:\"Comment Hook (Ignore All Contents)\",iconOnly:!0,icon:t24Icon(-1,11,\"font-weight:bold;font-size:13px\",\"--[\")},{type:\"menu\",label:\"(Macro:)\",items:[{type:\"button\",command(){switchPanel(\"passagelink\")},label:\"Link…\",icon:\"\"},{type:\"button\",command(){switchPanel(\"if\")},label:\"If…\",icon:\"\"},{type:\"button\",command(){switchPanel(\"input\")},label:\"Input…\",icon:\"\"},{type:\"button\",command(){switchPanel(\"hook\")},label:\"Hook…\",icon:\"\"},{type:\"button\",command(){switchPanel(\"basicValue\")},label:\"Value…\",icon:\"\"},{type:\"separator\"},{type:\"button\",command(){switchPanel(\"macro\")},label:\"List All Macros…\",icon:\"\"}]},xe={type:\"button\",command(){ie.display.wrapper.classList.toggle(\"harlowe-4-hideCode\"),ie.constructor.signal(ie,\"cursorActivity\")},label:\"Proofreading View (dim all code except strings)\",iconOnly:!0,icon:fontIconURI(\"eye\")},Te={type:\"button\",command(){const{wrapper:e}=ie.display;e.classList.toggle(\"harlowe-4-hideHelpTooltip\"),e.classList.toggle(\"harlowe-4-showHelpTooltip\"),ce=e.classList.contains(\"harlowe-4-showHelpTooltip\"),setPref(\"tooltips\",ce),ie.constructor.signal(ie,\"cursorActivity\")},label:\"Coding Tooltips (when the cursor rests on code structures)\",iconOnly:!0,icon:fontIconURI(\"comment\")},{type:\"button\",key:`${we}F`,command(){switchPanel(\"find\");const e=ie.doc.getSelection(),a=le.find[he](\".harlowe-4-toolbarPanel textarea\");a&&(a.focus(),e&&(a.value=e,a.dispatchEvent(new Event(\"input\"))))},label:`Find and Replace [${$e}F]`,iconOnly:!0,icon:fontIconURI(\"search\")},{type:\"button\",command(){window.open(\"https://twine2.neocities.org/\",\"Harlowe Documentation\",\"noopener,noreferrer\")},label:\"Show Manual (opens a new tab)\",iconOnly:!0,icon:t24Icon(3,14,\"font-weight:bold;font-size:19px;\",\"?\")},{type:\"button\",command(){switchPanel(\"prefs\")},label:\"Editor Preferences\",iconOnly:!0,icon:fontIconURI(\"gear\")}].map((function recur(e,a){if(\"button\"===e.type){const{command:t}=e;ke[a]=e=>{ie=e,t()},e.key&&(ve[e.key]=t),e.command=`${a}`}return\"menu\"===e.type&&(e.items=e.items.map(((e,t)=>recur(e,`${a}.${t}`)))),e}));function Toolbar(e,{foregroundColor:a}){const t=document[de](\".story-format-toolbar\"),r=t[t.length-1]||document[he](\".editor .passageTags\");return r&&r.nextElementSibling!==pe&&r[G?\"after\":\"before\"](pe),ie=e,G||(ie.addKeyMap(ve),ie.display.wrapper.className.match(/harlowe-4-....HelpTooltip/)||ie.display.wrapper.classList.toggle(`harlowe-4-${ce?\"show\":\"hide\"}HelpTooltip`)),Ce.forEach((e=>{let t=a;(e===xe&&ie.display.wrapper.classList.contains(\"harlowe-4-hideCode\")||e===Te&&!ie.display.wrapper.classList.contains(\"harlowe-4-hideHelpTooltip\"))&&(t=\"#0a60c2\"),e.icon&&=e.icon.replace(/fill%3D%27[^']+?%27/g,`fill%3D%27${window.escape(t)}%27`)})),Ce}const docsURL=(e,a)=>`<a href=\"https://twine2.neocities.org/#${e}\" target=\"_blank\" rel=\"noopener noreferrer\">${a}</a>`,Se=\"This markup gives the enclosed text \",producesBooleanTrueIf=e=>`The <b>\"${e}\" operator</b> produces the boolean value \\`true\\` if `,Ne=\" Otherwise, it produces `false`.\",Ae=\"If they contain strings, numbers, commands or changers, you can place them directly in your prose to display the value, run the command, or apply the changer.\",lambdaClause=e=>`The keyword <b>\"${e}\"</b> makes the code on the right into a <b>\"${e}\" lambda clause</b>. `,specialHookName=(e,a)=>`<br><br>Additionally, because it uses the special name \"\\`${e}\\`\", it also refers to <b>${a}</b>, and can be used to apply changers to ${a}.`,_e=\"Only matches \",insideMacro=e=>e.reduce(((e,a)=>void 0===e?\"macro\"===a.type||\"hook\"!==a.type&&e:e),void 0),Oe={num:`${_e}numbers.`,str:`${_e}strings.`,bool:`${_e}booleans.`,array:`${_e}arrays.`,dm:`${_e}datamaps.`,ds:`${_e}datasets.`,command:`${_e}commands.`,changer:`${_e}changers.`,color:`${_e}colours.`,gradient:`${_e}gradients.`,lambda:`${_e}lambdas.`,macro:`${_e}custom macros.`,datatype:`${_e}other datatypes.`,codehook:`${_e}code hooks.`,even:`${_e}even numbers.`,odd:`${_e}odd numbers.`,int:`${_e}whole numbers (numbers with no fractional component, and which are positive or negative).`,empty:`${_e}these empty structures: <code>\"\"</code> (the empty string), <code>(a:)</code>, <code>(dm:)</code> and <code>(ds:)</code>.`,whitespace:`${_e}a single character of whitespace (spaces, newlines, and other kinds of space).`,lowercase:`${_e}a single lowercase character. Lowercase characters are characters that change when put through <code>(uppercase:)</code>.`,uppercase:`${_e}a single uppercase character. Uppercase characters are characters that change when put through <code>(lowercase:)</code>.`,anycase:\"This matches any character which is case-sensitive - that is, where its <code>(lowercase:)</code> form doesn't match its <code>(uppercase:)</code> form.\",alnum:`${_e}a single alphanumeric character (letters and numbers).`,digit:`${_e}a string consisting of exactly one of the characters '0', '1', '2', '3', '4', '5', '6', '7', '8', and '9'.`,newline:`${_e}a line break character (also known as a \"newline\" character).`,const:\"Matches nothing; Use this only with <code>(set:)</code> to make constants.\",any:\"Matches anything; Use this with <code>(macro:)</code> to make variables that accept any storable type, or with <code>(set:)</code> inside data structure patterns.\"};Object.assign(Oe,{number:Oe.num,string:Oe.str,boolean:Oe.bool,datamap:Oe.dm,dataset:Oe.ds,colour:Oe.color,integer:Oe.int,alphanumeric:Oe.alnum,linebreak:Oe.newline});const He={hr:\"This is a <b>horizontal rule</b>. It extends across the entire passage width (or the column width, if it's in a column).\",bulleted:\"The `*` at the start of this line makes this a <b>bulleted list item</b>.\",numbered:\"The `0.` at the start of this line makes this a <b>numbered list item</b>.\",heading:({depth:e})=>`This is a <b>level ${e} ${1===e?\"(largest) \":\"\"}heading</b> mark.`,align:({align:e})=>`This is an <b>aligner</b> mark. The text after this is ${\"justify\"===e?\"justified (spaced out to touch both edges)\":`aligned to the ${e}`}. Write \\`<==\\` for left alignment, \\`==>\\` for right alignment, \\`=><=\\` for centering, and \\`<==>\\` for justified alignment.`,column:({text:e,width:a,marginRight:t,marginLeft:r})=>e.trim().startsWith(\"|\")&&e.trim().endsWith(\"|\")?\"This mark ends all of the preceding columns. The text after this is not in a column.\":`The text after this mark is in a <b>column</b> with width multiplier ${a}x, a left margin of ${r}em, and a right margin of ${t}em. Write more consecutive \\`|\\` marks to increase the width, and place \\`=\\` to the left and right to increase the margin on that side.`,em:`${Se}<b>emphasis style</b>. This is visually the same as italic style by default.`,strong:`${Se}<b>strong emphasis style</b>. This is visually the same as bold style by default.`,bold:`${Se}<b>bold style</b>.`,italic:`${Se}<b>italic style</b>.`,strike:`${Se}<b>strikethrough style</b>.`,sup:`${Se}<b>superscript style</b>.`,comment:'This is a <b>comment</b>. Whatever is just to the right of the `--` is being ignored (\"commented out\") by Harlowe. If that is a hook or a macro call, then its entire contents is ignored. Use comments to add private notes and marginalia to a passage, or remove macro calls or code elements for testing purposes.',htmlComment:\"This is a <b>HTML comment</b>. Everything inside it will be ignored by Harlowe.\",scriptStyleTag:()=>He.tag,tag:\"This is a <b>HTML tag</b>. Harlowe supports raw HTML in passage code.\",hook:({type:e,name:a,tagPosition:t},r)=>\"hook\"===e&&insideMacro(r.slice(1))?\"These square brackets and their contents are a <b>code hook</b>, a hook that's being used as a data value inside a macro call.<br><br>Think of code hooks as being similar to strings, but with syntax highlighting of their contents in this editor. If you want to store some text inside a variable and print it later, for instance, a code hook is usually more suitable than a string.\":`${\"hook\"===e?\"These square brackets and their contents are a <b>hook</b>, enclosing this section of passage markup.\":\"\"} Changer values can be attached to the left of hooks.${a?`<br>This hook has a <b>nametag</b> on the ${\"prepended\"===t?\"left\":\"right\"}. This allows the hook to be referred to in macro calls using the hook name <code>?${a}</code>.`:\"\"}`,unclosedHook:(e,a)=>`This marks all of the remaining code in the passage as being inside a <b>hook</b>.${He.hook(e,a)}`,verbatim:\"This is <b>verbatim markup</b>. Place text between matching pairs and amounts of <code>`</code> marks, and Harlowe will ignore the markup within, instead displaying it as-is.\",unclosedCollapsed:e=>He.collapsed(e),collapsed:({type:e})=>`This is <b>${\"unclosedCollapsed\"===e?\"unclosed \":\"\"}collapsed whitespace</b> markup. All sequences of consecutive whitespace within ${\"unclosedCollapsed\"===e?\"the remainder of the passage \":\"the <code>{</code> and <code>}</code> marks\"} will be replaced with a single space. You can use this to space out your code and keep your passage readable.<br>To include a line break within this markup that will be preserved, use a HTML <code>&lt;br&gt;</code> tag.`,escapedLine:\"This is an <b>escaped line break</b> mark. This removes the line break before or after it from the displayed passage.\",twineLink:({passage:e})=>`This is a <b>link to the passage \"${e}\"</b>. Links, like hooks and commands, can have changer values attached to the left.`,br:\"\",url:\"\",variable:`This is a <b>story-wide variable</b>. After this has been set to a data value, it can be used anywhere else in the story. Use these to store data values related to your story's game state, or changers that are commonly used. ${Ae}`,tempVariable:`This is a <b>temp variable</b>. It can only be used in the same passage and hook (plus any nested hooks therein) in which it's first set to a data value. Use these to store values temporarily, or that won't be needed elsewhere. ${Ae}`,macroName:(e,[,a])=>He.macro(a),grouping:\"Use these <b>grouping brackets</b> to ensure operations are performed in a certain order. Code in brackets will be computed before the code adjacent to it.\",property:({type:e,name:a})=>(a?`This retrieves the data stored at <b>the \\`${a}\\` ${a.match(/^\\d+(?:th|nd|st|rd)(?:last)?(?:to\\d+(?:nth|nd|st|rd)(?:last)?)?$/g)?\"position\"+(a.includes(\"to\")?\"s\":\"\"):\"name\"}</b> of the container value on the ${e.startsWith(\"belonging\")?\"right\":\"left\"}.<br><br>`:\"\")+\"Some types of data values (arrays, datamaps, datasets, strings, colours, gradients, custom macros, and typedvars) are also storage containers for other values. You can access a specific value stored in them using that value's <b>data name</b> (or a string, number, or array value in brackets) by writing <i>value</i> `'s` <i>name</i>, or <i>name</i> `of` <i>value</i>.\",possessiveOperator:e=>He.property(e),itsProperty:e=>He.property(e),itsOperator:e=>He.identifier(e),belongingItProperty:e=>He.property(e),belongingItOperator:e=>He.property(e),belongingProperty:e=>He.property(e),belongingOperator:e=>He.property(e),escapedStringChar:\"\",string:'This is <b>string data</b>. Strings are sequences of text data enclosed in matching \" or \\' marks. Use a `\\\\` inside a string to \"escape\" the next character. Escaped \" or \\' marks don\\'t count as the end of the string.<br><br>If a string matches a passage name, it will be <span class=\"cm-harlowe-4-passageString\">underlined</span>. If it matches a tag name, it will be <span class=\"cm-harlowe-4-tagString\">dotted</span>.',hookName:({name:e})=>`This <b>hook name</b> refers to all hooks named \"\\`${e=e.toLowerCase()}\\`\" in this passage.${\"page\"===e?specialHookName(\"page\",\"the entire HTML page\"):\"passage\"===e?specialHookName(\"passage\",\"the entire passage\"):\"link\"===e?specialHookName(\"link\",\"every link in the passage\"):\"sidebar\"===e?specialHookName(\"sidebar\",\"the sidebar\"):\"\"}`,cssMeasure:({value:e,unit:a})=>\"ms\"===a||\"s\"===a?`This is <b>number data</b> in CSS time format. Harlowe automatically converts this to a number of milliseconds, so this is identical to ${e}.`:\"This is <b>measurement data</b>, representing a CSS measurement of distance. It consists of a number immediately followed by a unit suffix. Certain Harlowe macros use these to decide how to position or size certain elements.\",datatype:({text:e})=>(e=e.toLowerCase(),`This is the name of a <b>datatype</b>. Use these names to check what kind of data a data value is, using the \\`matches\\` or \\`is a\\` operators.<br>You can also use them in a \\`(set:)\\` or \\`(put:)\\` to restrict that variable's data for error-checking purposes. (See ${docsURL(\"type_datatype\",\"the documentation\")} for details.)${e in Oe?`<code class='harlowe-4-tooltipMacroSignature cm-harlowe-4-datatype'>${e}</code>${Oe[e]}`:\"\"}`),colour:({text:e})=>\"This is a \"+(e.startsWith(\"#\")?\"<b>HTML colour value</b>. Harlowe can use this as colour data.\":\"built-in Harlowe <b>colour value</b>. The built-in colours are `red`, `orange`, `yellow`, `lime`, `green`, `cyan` (alias `aqua`), `blue`, `navy`, `purple`, `fuchsia` (alias `magenta`), `white`, `gray` (alias `grey`), `black`, and `transparent`.\"),number:\"This is <b>number data</b>. Harlowe supports whole numbers (like `2`), negative numbers (like `-2`), and numbers with a decimal fraction component (like `2.2`).\",inequality:({operator:e,negate:a})=>{const t=`${(e=a?{\">\":\"<=\",\"<\":\">=\",\">=\":\"<\",\"<=\":\">\"}[e]:e).startsWith(\">\")?\"greater \":\"less \"}than${e.endsWith(\"=\")?\" or equal to\":\"\"}`;return`${producesBooleanTrueIf(t)} the number value on the left is ${t} the number value on the right.${Ne}`},identifier:({text:e})=>(e=insensitiveName(e)).startsWith(\"it\")?\"The keyword <b>it</b> is a shorthand for the leftmost part of an operation. You can write `(if: $candles < 2 and it > 5)` instead of `(if: $candles < 2 and $candles > 5)` or `(set: $candles to it + 3)` instead of `(set: $candles to $candles + 3)`. When accessing a data value from it, you can write it as <b>its</b>, such as in `its length > 0`.\":\"time\"===e?\"The keyword <b>time</b> equals the number of milliseconds passed since the passage was displayed.\":e.startsWith(\"exit\")?'The keyword <b>exits</b> or <b>exit</b> equals the number of currently available \"exits\" in a passage - the number of link, mouseover, and mouseout elements that are still active on the page, which could lead to new content and progress.':e.startsWith(\"user\")?'The keyword <b>user</b> equals a datamap containing information about the player\\'s browser preferences. `user\\'s width` is the width of the browser window in pixels, `user\\'s height` is its height, `user\\'s orientation` is either `\"portrait\"` or `\"landscape\"`, `user\\'s motion` is either `\"any\"` or `\"reduced\"`, `\"contrast\"` is either `\"any\"`, `\"more\"` or `\"less\"`, and `user\\'s hover` is  `true` if their device supports hovering, and `false` otherwise.':e.startsWith(\"visit\")?\"The keyword <b>visits</b> or <b>visit</b> equals the number of times the current passage has been visited this game, including the current visit. In `(storylet:)` macros, when Harlowe decides whether this passage is available to `(open-storylets:)`, this will often be 0, but when actually visiting the passage, it will be at least 1.\":\"pos\"===e?'The keyword <b>pos</b> should ONLY be used within a \"where\" or \"via\" lambda clause. It refers to the position of the current data value that this lambda is processing.':\"\",whitespace:\"<b>Whitespace</b> within macro calls is simply used to separate syntax elements. You can use as much or as little as you like to make your code more readable.\",error:(e,[{message:a,explanation:t}])=>a+(t?`<br>${t}`:\"\"),boolean:\"The keywords <b>true</b> or <b>false</b> are the two <b>boolean values</b>. They are produced by comparison operators (`<`, `>`, `is`, etc.) and other macros.\",is:`The <b>\"is\" operator</b> produces the boolean value \\`true\\` if the values on each sides of it are exactly the same.${Ne}`,to:'Use the <b>\"to\" operator</b> only inside a `(set:)` macro call. Place it to the left of the data, and right of the variable to set the data to.',into:'Use the <b>\"into\" operator</b> only inside a `(put:)`, `(move:)` or `(unpack:)` macro call. Place it to the right of the data, and left of the destination to put the data.',where:`${lambdaClause(\"where\")}This lambda will search for input values <i>where</i> the right side, once computed, produces \\`true\\`.`,when:`${lambdaClause(\"when\")}This lambda will cause the macro (if it accepts \"when\" lambdas) to only do something <i>when</i> the right side, once computed, produces \\`true\\`.`,via:`${lambdaClause(\"via\")}This lambda is used to convert input values into new values <i>via</i> computing the expression to the right.`,making:`${lambdaClause(\"making\")}This is used only by the \\`(folded:)\\` macro. The lambda <i>makes</i> the temp variable on the right, which becomes the final value of the \\`(folded:)\\` call.`,each:`${lambdaClause(\"each\")}This causes the macro (if it accepts lambdas) to, for <i>each</i> input value, place that value in the temp variable on the right, before running the other lambda clauses adjacent to this one (if any).`,and:`${producesBooleanTrueIf(\"and\")}the values on each side of it are both \\`true\\`.${Ne}`,or:`${producesBooleanTrueIf(\"or\")}the values on each side of it are both \\`false\\`.${Ne}`,not:'The <b>\"not\" operator</b> inverts the boolean value to its right, turning `true` to `false` and vice-versa.',isNot:`${producesBooleanTrueIf(\"is not\")}the values on each sides of it are NOT exactly the same.${Ne}`,contains:`${producesBooleanTrueIf(\"contains\")}the array, string, or dataset on the left contains the data on the right, or if the datamap on the left has the data name on the right.${Ne}`,doesNotContain:`${producesBooleanTrueIf(\"does not contain\")}the array, string, or dataset on the left does NOT contain the data on the right, or if the datamap on the left does NOT have the data name on the right.${Ne}`,isIn:`${producesBooleanTrueIf(\"is in\")}the data on the left is in the array, string, datamap or dataset on the right.${Ne}`,isA:`${producesBooleanTrueIf(\"is a\")}the data on the left matches the datatype on the right.${Ne}`,isNotA:`${producesBooleanTrueIf(\"is not a\")}the data on the left does NOT match the datatype on the right.${Ne}`,isNotIn:`${producesBooleanTrueIf(\"is not in\")}the data on the left is NOT in the array, string, datamap or dataset on the right.${Ne}`,matches:`${producesBooleanTrueIf(\"matches\")}one side describes the other - that is, if one side is a datatype that describes the other, or both sides are arrays, datamaps, or datasets, with data in positions that matches those in the other, or if both sides are equal.${Ne}`,doesNotMatch:`${producesBooleanTrueIf(\"does not match\")}one side does NOT describe the other.${Ne}`,bind:'The <b>bind</b> or <b>2bind</b> keyword specifies that the variable to the right should be \"bound\" to an interactable element. This is used only by certain command macros, like `(dialog:)` or `(cycling-link:)`.',comma:\"Use <b>commas</b> to separate the values that you give to macro calls.\",spread:\"This is a <b>spreader</b>. These spread out the values in the array, string or dataset to the right of it, as if each value was individually placed in the call and separated with commas.<br><br>Alternatively, if a datatype is to the right of it, that datatype becomes a <b>spread datatype</b> that matches zero or more of itself.\",typeSignature:\"The <b>-type</b> suffix is used to restrict the variable on the right to only holding data that matches the data pattern on the left. Variables restricted in this way are called <b>typed variables</b>.\",addition:\"Use the <b>addition operator</b> to add two numbers together, as well as join two strings or two arrays, and combine two datamaps, two datasets, two changers, or two colours. This operator can also combine two hook names, creating a hook name that applies to both sets of hooks.\",subtraction:\"Use the <b>subtraction operator</b> to subtract two numbers, as well as create a copy of the array or dataset on the left that doesn't contain values of the array or dataset on the right.\",multiplication:\"Use the <b>multiplication operator</b> to multiply two numbers.\",division:({text:e})=>(\"/\"===e?\"Use the <b>division operator</b> to divide\":\"Use the <b>modulo operator</b> to get the remainder (modulo) from dividing\")+\" two numbers. Dividing a number by 0 produces an error.\",macro:({name:e})=>{if(void 0===e)return\"This macro call is incomplete or erroneously written. Macro calls should consist of `(`, the name (which is case-insensitive and dash-insensitive), `:`, zero or more expressions separated by commas, then `)`, in that order.\";if(e.startsWith(\"_\")||e.startsWith(\"$\"))return`This is a <b>call to a custom macro stored in the ${e} variable</b>. Custom macros are created with the \\`(macro:)\\` macro, and must be stored in variables in order to be used.`;const a=j.Macro[insensitiveName(e)];if(!a)return\"This is a call to a nonexistent or misspelled macro. This will cause an error.\";const t=a.returnType.toLowerCase();return`This is a <b>call to the \\`(${a.name}:)\\` macro</b>. ${\"metadata\"===t?\"Metadata macros like this should be placed at the very top of the passage, before all other macros.\":\"instant\"===t||\"command\"===t?'It produces a <span class=\"cm-harlowe-4-macroName-command\">command</span>, so it should appear in passage code without being connected to a hook.':\"changer\"===t?'It produces a <span class=\"cm-harlowe-4-macroName-changer\">changer</span>, which can be placed to the left of a hook or a command (passage links are commands), or combined with other changers.':\"any\"===t||\"string\"===t?\"\":`Since it produces a <span class=\"cm-harlowe-4-macroName-${t}\">${t}</span>, it should be nested inside another macro call that can use ${t} (or any) data, or modified with an operator like \\`is\\` or \\`is in\\`.${\"array\"===t||\"dataset\"===t?\" You may also use it in a macro call which can accept any number of values, and spread its contents out using the spreader `...` syntax.\":\"\"}`}${\"command\"===t||\"changer\"===t?\" You may also put it in a variable to reuse it multiple times, like other kinds of data.\":\"\"}<code class='harlowe-4-tooltipMacroSignature'>${docsURL(a.anchor,`(${a.name}: ${a.sig}) -> ${a.returnType}`)}</code>${a.aka.length?`<div><i>Also known as: ${a.aka.map((e=>`<code>(${e}:)</code>`)).join(\", \")}</i>`:\"\"}</div><div>${a.abstract}</div>`},text:({text:e},a)=>{if(e.trim()&&insideMacro(a))return\"This doesn't seem to be valid code.<br>Note that inside macro calls, only other macro calls, data, operators and whitespace are permitted.\"}},Le=document.createElement(\"div\");Le.className=\"harlowe-4-tooltip\";let Me=0,Pe=0,Ie=4,Ee=0,Re=0,Fe=Object;function tooltipAppear(){Me<1?(Le.style.display=\"\",Pe=10):(Me-=1,requestAnimationFrame(tooltipAppear))}const ze={Up(){updateTooltipMenuCursor(Math.max(0,Ee-1))},Down(){updateTooltipMenuCursor(Math.min(Re-1,Ee+1))},PageUp(){updateTooltipMenuCursor(0)},PageDown(){updateTooltipMenuCursor(Re-1)},Home(){updateTooltipMenuCursor(0)},End(){updateTooltipMenuCursor(Re-1)},Enter(){Fe(Ee)},Tab(){Fe(Ee)}};function tooltipClear(e){e.removeKeyMap(ze),Ee=0,Fe=Object,Le.setAttribute(\"style\",\"display:none\")}const docCursorPlus=(e,a)=>e.posFromIndex(e.indexFromPos(e.getCursor())+a);function positionTooltip(e,a,t=!1){Le.removeAttribute(\"style\");const{width:r}=Le.getBoundingClientRect(),o=e.display.wrapper,{width:n}=o.getBoundingClientRect(),s=e.charCoords(a,\"local\"),i=G?30:0,l=Math.min(n-r,Math.max((0|s.left)+i-(t?r/2:0),i));Le.setAttribute(\"style\",`left:${l}px; top:${(0|s.top)+(t?30:24)-o.querySelector(\".CodeMirror-scroll\").scrollTop}px;`),t&&Le.lastElementChild?.setAttribute(\"style\",`left:${s.right-l+(G?(s.right-s.left)/2+6:-12)}px; top:-24px`),o.addEventListener(\"keydown\",(a=>{\"display:none\"!==Le.getAttribute(\"style\")&&\"Escape\"===a.key&&(tooltipClear(e),a.stopPropagation())}))}function makeHelpTooltip(e,a,t){if(t.display.wrapper.classList.contains(\"harlowe-4-hideHelpTooltip\")||t.doc.somethingSelected())return!1;const[r]=e,o=e.some(((e,a,t)=>{let r=t[a+1]?.children;return\"comment\"===r?.[r?.indexOf(e)-1]?.type}));let n=He[o?\"comment\":r.type];return\"function\"==typeof n&&(n=n(r,e)),!!n&&(n=n.replace(/`([^`]+)`/g,((e,a)=>`<code>${a}</code>`)),Le.innerHTML=n+(Ie>0?(Ie--,`<br><br><i>Use the ${document.querySelector('[aria-label^=\"Coding tooltips\"],[title^=\"Coding tooltips\"]')?.innerHTML||\"tooltip\"} toolbar button to toggle these popups!</i>`):\"\")+\"<div class=harlowe-4-tooltipTail>\",Le.className=\"harlowe-4-tooltip harlowe-4-helpTooltip\",positionTooltip(t,a,!0),Le.style.display=\"none\",Me=50,!0)}const Be=Object.values(j?.Macro||{}).reduce(((e,{name:a,returnType:t,aka:r})=>e.find((e=>e.name===a))?e:e.concat({name:a,returnType:t}).concat(r.map((e=>({name:e,returnType:t}))))),[]);const We=[...\"exit,exits,it,pos,time,turn,turns,visit,visits\".split(\",\").map((e=>({name:e,type:\"identifier\"}))),...\"where,when,each,via,making\".split(\",\").map((e=>({name:e,type:\"lambda\",label:\"lambda keyword\"}))),...\"number,num,string,str,boolean,bool,array,datamap,dm,dataset,ds,command,changer,color,colour,gradient,lambda,macro,datatype,codehook\".split(\",\").map((e=>({name:e,type:\"datatype\"}))),...\"even,odd,integer,int,empty,whitespace,lowercase,uppercase,anycase,alphanumeric,alnum,digit,linebreak,newline,const,any\".split(\",\").map((e=>({name:e,type:\"datatype\",label:\"specific datatype\"}))),...\"red,orange,yellow,lime,green,cyan,aqua,blue,navy,purple,fuchsia,magenta,white,gray,grey,black,transparent\".split(\",\").map((e=>({name:e,type:\"colour\"}))),...\"is,is not,contains,does not contain,is in,is not in,is a,is not a,matches,does not match,and,or,not\".split(\",\").map((e=>({name:e,type:\"boolean\",label:\"boolean operator\"}))),...\"to,into,bind,2bind,-type\".split(\",\").map((e=>({name:e,type:\"operator\"}))),{name:\"true\",type:\"boolean\"},{name:\"false\",type:\"boolean\"}];function updateTooltipMenuCursor(e){Ee=e,Le.querySelector(\".harlowe-4-tooltipItemSelected\")?.classList.remove(\"harlowe-4-tooltipItemSelected\");const a=Le.querySelectorAll(\".harlowe-4-tooltipItem\")[e];a&&(a.classList.add(\"harlowe-4-tooltipItemSelected\"),a.scrollIntoView({block:\"center\"}))}function makeCompletion(e,a,t){const r=e[e.length-1],{doc:o}=t,n=r.text.slice(0,o.indexFromPos(o.getCursor())),s=function macroCompletion(e,a,t){if(!1===getPrefs().completionsForMacros)return;if(t.some((e=>\"string\"===e.type)))return;let[,r]=/\\(([\\w_-]+)$/.exec(a)||[];if(!r)return;const o=insensitiveName(r),n=Be.filter((({name:e})=>insensitiveName(e).startsWith(o))).sort(((e,a)=>e.name.length-a.name.length));return n.length?(Fe=a=>{e.replaceRange(`(${n[a].name}:)`,docCursorPlus(e,-(r.length+1)),e.getCursor()),e.setCursor(docCursorPlus(e,-1))},Ee=0,Re=n.length,n.map(((e,a)=>`<div class='cm-harlowe-4-macro cm-harlowe-4-root harlowe-4-tooltipItem${a?\"\":\" harlowe-4-tooltipItemSelected\"}'>(<span class=\"cm-harlowe-4-macroName-${e.returnType.toLowerCase()}\">${e.name}</span>:)</div>`)).join(\"\")):void 0}(o,n,e)||function keywordCompletion(e,a,t){if(!1===getPrefs().completionsForKeywords)return;if(!t.reduce(((e,a)=>void 0===e?\"macro\"===a.type||\"hook\"!==a.type&&\"string\"!==a.type&&e:e),void 0))return;let[,r]=/[^$\\w?]([-2]?[a-zA-Z ]+)$/.exec(a)||[];if(!r||\"-\"===r||\"\"===r[r.length-1].trim())return;const o=r.trimLeft().toLowerCase(),n=We.filter((({name:e})=>e.startsWith(o))).sort(((e,a)=>e.name.length-a.name.length));return n.length?(Fe=a=>{e.replaceRange(n[a].name,docCursorPlus(e,-r.length),e.getCursor())},Ee=0,Re=n.length,n.map(((e,a)=>`<div style='display:flex;justify-content:space-between' class=\"harlowe-4-tooltipItem${a?\"\":\" harlowe-4-tooltipItemSelected\"}\"><span class='cm-harlowe-4-${e.type} cm-harlowe-4-root'>${e.name}</span><i style=\"display:inline-block;margin-left:2em;\">${e.label||e.type}</i></div>`)).join(\"\")):void 0}(o,n,e);if(s)return Le.innerHTML=s,Le.className=\"harlowe-4-tooltip harlowe-4-completion\",positionTooltip(t,a,!1),Me=0,t.addKeyMap(ze),Ee=0,!0}function Tooltips(e,a){const{tree:t,lastAction:r}=a,{cm:o}=e;tooltipClear(o);const n=o.display.wrapper;Le.parentNode!==n&&(n.append(Le),n.addEventListener(\"mousemove\",(()=>{\"none\"===Le.style.display||n.querySelector(\".harlowe-4-tooltip:hover\")?Me>0&&(Me+=1):(Pe-=1,Pe<=0&&tooltipClear(o))})));const s=e.getCursor(),i=t.pathAt(Math.min(t.text.length-1,e.indexFromPos(s)));if(!i.length)return void(Me=0);const l=Me>0;(\"change\"===r?makeCompletion:makeHelpTooltip)(i,s,o)&&(l||tooltipAppear())}let{lex:qe}=D;const De=Object.entries(j.Macro).reduce(((e,[a,t])=>([a,...t.aka].forEach((a=>e[a]=t)),e)),{}),mode=()=>{let e,a,t;const r=new WeakMap,docData=e=>(r.has(e)||refreshTree(e),r.get(e));function lexTreePostProcess(e,r,o,n){if(\"variable\"!==r.type&&\"tempVariable\"!==r.type&&\"hook\"!==r.type&&\"hookName\"!==r.type||e.referenceTokens[r.type].push(r),\"string\"===r.type&&(r.children=[]),\"comment\"===o?.type)return void(e.cssClasses[r.start]=e.cssClasses[o.start]);let s={},i=\"\";for(let e=-1;e<n.length;e+=1){const{type:o,text:l}=-1===e?r:n[e];\"verbatim\"!==o&&\"htmlComment\"!==o||(i=\"\");let c=`harlowe-4-${o}`;switch(s[c]=(s[c]||0)+1,s[c]>1&&(c+=`-${s[c]}`),o){case\"string\":{const e=l.slice(1,-1);a.has(e)?c+=\" harlowe-4-passageString\":t.has(e)&&(c+=\" harlowe-4-tagString\");break}case\"text\":if(l.trim()){n.slice(e+1).reduce(((e,a)=>void 0===e?\"macro\"===a.type||\"hook\"!==a.type&&e:e),void 0)&&(c+=\" harlowe-4-error\")}break;case\"macroName\":{const e=l[0];if(\"_\"===e||\"$\"===e){c+=` harlowe-4-customMacro harlowe-4-${\"_\"===e?\"tempV\":\"v\"}ariable`;break}const a=insensitiveName(l.slice(0,-1));Object.hasOwn(De,a)?c+=`-${De[a].returnType.toLowerCase()}`:c+=\" harlowe-4-error\";break}}i+=`${c} `}e.cssClasses[r.start]=i,r.children?.length&&(e.cssClasses[r.children[r.children.length-1].end]=i);for(let a=0;a<r.children.length;a+=1)lexTreePostProcess(e,r.children[a],r.children[a-1],[r].concat(n))}function refreshTree(e){let a;r.has(e)?a=r.get(e):(a={tooltipsEnabled:!0,lastAction:\"\"},r.set(e,a)),a.tree=qe(e.getValue()),a.referenceTokens={variable:[],tempVariable:[],hook:[],hookName:[]},a.cssClasses=Object.create(null),a.cursorMarks?.forEach((e=>e.clear())),a.cursorMarks=[];for(let e=0;e<a.tree.children.length;e+=1)lexTreePostProcess(a,a.tree.children[e],a.tree.children[e-1],[a.tree])}let o,n,s=[],i=-1;const l={token(e){const{line:a}=e.lineOracle,t=e.pos;for(let r=0;r<s.length;r+=1){const{start:n,end:i}=s[r];if(!(n.line>a||i.line<a)&&(n.line<=a&&i.line>=a)){if((n.line<a||n.ch<=t)&&(i.line>a||i.ch>t))return i.line>a?e.skipToEnd():e.pos=i.ch,o===r?\"harlowe-4-findResultCurrent\":\"harlowe-4-findResult\";if(n.line===a&&n.ch>t)return void(e.pos=n.ch)}}e.skipToEnd()}};function harlowe4Find(a){if(e.removeOverlay(l),s=[],o=-1,a.matches=void 0,!a.query)return void(n=void 0);n=a;const{doc:t}=e,r=i>-1?i:Math.max(0,t.indexFromPos(t.getCursor())-1);try{a.regExp=new RegExp(a.useRegExp?a.query:a.query.replace(/[-[\\]/{}()*+?.\\\\^$|]/gm,\"\\\\$&\"),a.matchCase?\"g\":\"gi\")}catch(e){return void(n=void 0)}const c=t.getValue(),h=docData(t).tree,{onlyIn:d}=a;let m;e:for(;m=a.regExp.exec(c);){const a=m[0].length;if(!a)break;const{index:n}=m,l=m.slice(1);if(\"Only in prose\"===d||\"Only in code\"===d){let e=h.pathAt(n),t=e[0];for(let r=n;r<n+a;r+=1){let a;for(r>t.end&&(e=h.pathAt(r),t=e[0]),a=0;a<e.length;a+=1){const{type:t}=e[a];if(\"text\"===t||\"string\"===t){if(\"Only in code\"===d)continue e;break}}if(a===e.length&&\"Only in prose\"===d)continue e}}else if(\"Only in selection\"===d){const e=t.listSelections();let r=!1;for(let o=0;o<e.length&&!r;o+=1){const s=t.indexFromPos(e[o].anchor),i=t.indexFromPos(e[o].head);n>=Math.min(s,i)&&n+a<Math.max(s,i)&&(r=!0)}if(!r)continue e}const c=t.posFromIndex(n),p=t.posFromIndex(n+a);s.push({start:c,end:p,groups:l.length?l:void 0}),-1===o&&(n>r&&(o=s.length-1),i||e.scrollIntoView(c,e.display.wrapper.offsetHeight/2))}-1===o&&(o=0),e.addOverlay(l),a.matches=s.length,a.matchIndex=o,a.updateResultsDisplay?.(),i=-1}function harlowe4FindNext(a){o=(o+a)%s.length,o<0&&(o+=s.length),s[o]&&e.scrollIntoView(s[o].start,e.display.wrapper.offsetHeight/2),e.removeOverlay(l),e.addOverlay(l),n.matchIndex=o,n.updateResultsDisplay?.()}function harlowe4Replace(a,t){const{doc:r}=e,l=s[o];if(!t&&l)l.groups?.length&&(a=a.replace(/\\$(\\d+)/g,((e,a)=>l.groups[+a-1]||`$${a}`))),i=r.indexFromPos(l.start)+a.length-1,r.replaceRange(a,l.start,l.end);else if(s.length){const e=s[0].start,t=s[s.length-1].end;r.replaceRange(r.getValue().slice(r.indexFromPos(e),r.indexFromPos(t)).replace(n.regExp,a),e,t)}}const on=(e,a,t)=>(!e._handlers||!(e._handlers[a]||[]).some((e=>e.name===t.name)))&&e.on(a,t);let init=r=>{e||(e=r.cm,window===this&&(e.setOption(\"lineNumbers\",!0),e.setOption(\"lineNumberFormatter\",(()=>\"•\")))),G&&Toolbar?.(e,{foregroundColor:\"#888\"}),(()=>{let e;a=new Set,t=new Set;try{e=localStorage.getItem(\"twine-stories\").split(\",\")}catch(e){return}let r,o=0;for(let a of e)try{const e=JSON.parse(localStorage.getItem(`twine-stories-${a}`)),t=Date.parse(e.lastUpdate);t>o&&document.title.includes(e.name)&&(r=e,o=t)}catch(e){continue}if(r)try{for(let e of localStorage.getItem(\"twine-passages\")?.split(\",\")||[]){let o=JSON.parse(localStorage.getItem(`twine-passages-${e}`));if(o.story===r.id){a.add(o.name);for(let e of o.tags)t.add(e)}}}catch(e){return}})(),setOptionalStyles(getPrefs()),refreshTree(r),on(r,\"beforeChange\",(function harlowe4beforeChange(e,a){if(!r.cm.display.wrapper.parentNode)return;!function forceFullChange(e,a){if(!e.update)return;const t=e.from.line;let r=a.split(\"\\n\").slice(0,e.from.line+1);return r[t]=r[t].slice(0,e.from.ch)+e.text[0],r=r.concat(e.text.slice(1)),e.update({line:0,ch:0},e.to,r),r.join(\"\\n\")}(a,r.getValue())})),on(r,\"change\",(function harlowe4Change(){r.cm.display.wrapper.parentNode&&(docData(r).lastAction=\"changing\",refreshTree(r),n&&s[o]&&(-1===i&&(i=r.indexFromPos(s[o].start)-1),harlowe4Find(n)))})),on(r,\"cursorActivity\",(function harlowe4CursorActivity(){!function cursorMarking(e){const a=docData(e);let{tree:t,cursorMarks:r,referenceTokens:o}=a;r.length&&(r.forEach((e=>e.clear())),r=a.cursorMarks=[]);const n=t.tokenAt(e.indexFromPos(e.getCursor()));n&&(r.push(e.markText(e.posFromIndex(n.start),e.posFromIndex(n.end),{className:\"cm-harlowe-4-cursor\"})),(\"variable\"===n.type||\"tempVariable\"===n.type||\"hookName\"===n.type||\"hook\"===n.type)&&o[\"hook\"===n.type?\"hookName\":n.type].forEach((a=>{a!==n&&\"name\"in a&&a.name===n.name&&r.push(e.markText(e.posFromIndex(a.start),e.posFromIndex(a.end),{className:\"cm-harlowe-4-variableOccurrence\"}))})),\"hookName\"!==n.type&&\"hook\"!==n.type||o.hook.forEach((a=>{if(a!==n&&a.name&&a.name===n.name){const t=\"tagPosition\"in a&&\"appended\"===a.tagPosition?a.end-a.name.length-1:a.start+1;r.push(e.markText(e.posFromIndex(t),e.posFromIndex(t+a.name.length),{className:\"cm-harlowe-4-hookOccurrence\"}))}})))}(r);const e=docData(r);e.lastAction=\"changing\"===e.lastAction?\"change\":\"cursorActivity\",Tooltips?.(r,e)})),on(e,\"renderLine\",(function harlowe4RenderLine(e,a,t){Array.from(t.querySelectorAll(\".cm-harlowe-4-colour\")).forEach((e=>{const{colour:a}=qe(e.textContent,\"\",\"macro\").tokenAt(0);e.setAttribute(\"style\",`background:linear-gradient(to bottom,transparent,transparent 80%,${a} 80.1%,${a})`)}))})),on(e,\"scroll\",(function harlowe4Scroll(){const e=document.querySelector(\".harlowe-4-tooltip\");e?.remove()})),on(e,\"harlowe-4-find\",harlowe4Find),on(e,\"harlowe-4-findNext\",harlowe4FindNext),on(e,\"harlowe-4-replace\",harlowe4Replace),on(e,\"harlowe-4-findDone\",(function harlowe4FindDone(){e.removeOverlay(l)})),init=null};return{startState:()=>({pos:0,disconnected:null,styleBeforeNewline:\"\"}),blankLine(e){e.pos++},token(e,a){const{doc:t}=e.lineOracle;if(null===a.disconnected?a.disconnected=!t.cm.display.wrapper.parentNode:a.disconnected)return a.pos++,e.next(),null;init?.(t);const{cssClasses:r}=docData(t),o=r[a.pos]||a.styleBeforeNewline||null;do{a.pos++,e.next()}while(!(r[a.pos]!==o&&a.pos in r||e.eol()));return e.eol()?(a.styleBeforeNewline=o,a.pos++):a.styleBeforeNewline=\"\",o}}};\"CodeMirror\"in window?window.CodeMirror.defineMode(\"harlowe-4\",mode):this.editorExtensions={twine:{2:{codeMirror:{mode,toolbar:Toolbar,commands:ke}}}};let Ve=document.querySelector(\"style#cm-harlowe-4\");Ve||(Ve=document.createElement(\"style\"),Ve.setAttribute(\"id\",\"cm-harlowe-4\"),document.head.appendChild(Ve)),Ve.innerHTML=\".cm-harlowe-4-cursor:not([class^='cm-harlowe-4-verbatim']):not([class^='cm-harlowe-4-text cm-harlowe-4-root']) { border-bottom: 2px solid darkgray; }.cm-harlowe-4-findResult { background-color: hsla(280,100%,70%,0.4) !important; } .cm-harlowe-4-findResultCurrent { background-color: hsla(320,100%,70%,0.6) !important; }.cm-harlowe-4-root .cm-tab { text-decoration: line-through dotted #888; border-right: dotted 1px #888; }.CodeMirror {padding: 0 !important}.CodeMirror-linenumber {color: hsla(0,0%,80%,1.0);}.CodeMirror-gutters {left: 0px !important;}.cm-harlowe-4-root{box-sizing:border-box;}.cm-harlowe-4-hook{background-color: hsla(40,100%,50%,0.05);}.theme-dark .cm-harlowe-4-hook{background-color: hsla(40,100%,50%,0.05);}[data-app-theme=dark] .cm-harlowe-4-hook{background-color: hsla(40,100%,50%,0.05);}.cm-harlowe-4-hook-2{background-color: hsla(40,100%,50%,0.1);}.theme-dark .cm-harlowe-4-hook-2{background-color: hsla(40,100%,50%,0.1);}[data-app-theme=dark] .cm-harlowe-4-hook-2{background-color: hsla(40,100%,50%,0.1);}.cm-harlowe-4-hook-3{background-color: hsla(40,100%,50%,0.15);}.theme-dark .cm-harlowe-4-hook-3{background-color: hsla(40,100%,50%,0.15);}[data-app-theme=dark] .cm-harlowe-4-hook-3{background-color: hsla(40,100%,50%,0.15);}.cm-harlowe-4-hook-4{background-color: hsla(40,100%,50%,0.2);}.theme-dark .cm-harlowe-4-hook-4{background-color: hsla(40,100%,50%,0.2);}[data-app-theme=dark] .cm-harlowe-4-hook-4{background-color: hsla(40,100%,50%,0.2);}.cm-harlowe-4-hook-5{background-color: hsla(40,100%,50%,0.25);}.theme-dark .cm-harlowe-4-hook-5{background-color: hsla(40,100%,50%,0.25);}[data-app-theme=dark] .cm-harlowe-4-hook-5{background-color: hsla(40,100%,50%,0.25);}.cm-harlowe-4-hook-6{background-color: hsla(40,100%,50%,0.3);}.theme-dark .cm-harlowe-4-hook-6{background-color: hsla(40,100%,50%,0.3);}[data-app-theme=dark] .cm-harlowe-4-hook-6{background-color: hsla(40,100%,50%,0.3);}.cm-harlowe-4-hook-7{background-color: hsla(40,100%,50%,0.35);}.theme-dark .cm-harlowe-4-hook-7{background-color: hsla(40,100%,50%,0.35);}[data-app-theme=dark] .cm-harlowe-4-hook-7{background-color: hsla(40,100%,50%,0.35);}.cm-harlowe-4-hook-8{background-color: hsla(40,100%,50%,0.4);}.theme-dark .cm-harlowe-4-hook-8{background-color: hsla(40,100%,50%,0.4);}[data-app-theme=dark] .cm-harlowe-4-hook-8{background-color: hsla(40,100%,50%,0.4);}[class^='cm-harlowe-4-hook '], [class^='cm-harlowe-4-hook-']{font-weight:bold;}.cm-harlowe-4-unclosedHook{background-color: hsla(40,100%,50%,0.05);font-weight:bold;}.theme-dark .cm-harlowe-4-unclosedHook{background-color: hsla(40,100%,50%,0.05);font-weight:bold;}[data-app-theme=dark] .cm-harlowe-4-unclosedHook{background-color: hsla(40,100%,50%,0.05);font-weight:bold;}.cm-harlowe-4-error:not([class*='cm-harlowe-4-string']){background-color: hsla(17,100%,50%,0.5) !important;}.theme-dark .cm-harlowe-4-error:not([class*='cm-harlowe-4-string']){background-color: hsla(17,100%,50%,0.5) !important;}[data-app-theme=dark] .cm-harlowe-4-error:not([class*='cm-harlowe-4-string']){background-color: hsla(17,100%,50%,0.5) !important;}[class^='cm-harlowe-4-macroName']{font-style:italic;}.cm-harlowe-4-macroName-boolean{color:hsla(0,0%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-boolean{color:hsla(0,0%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-boolean{color:hsla(0,0%,70%,1.0)}.cm-harlowe-4-macroName-array{color:hsla(0,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-array{color:hsla(0,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-array{color:hsla(0,100%,70%,1.0)}.cm-harlowe-4-macroName-dataset{color:hsla(30,100%,40%,1.0)}.theme-dark .cm-harlowe-4-macroName-dataset{color:hsla(30,100%,60%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-dataset{color:hsla(30,100%,60%,1.0)}.cm-harlowe-4-macroName-datatype{color:hsla(220,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-datatype{color:hsla(220,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-datatype{color:hsla(220,100%,70%,1.0)}.cm-harlowe-4-macroName-number{color:hsla(30,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-number{color:hsla(30,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-number{color:hsla(30,100%,70%,1.0)}.cm-harlowe-4-macroName-datamap{color:hsla(60,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-datamap{color:hsla(60,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-datamap{color:hsla(60,100%,70%,1.0)}.cm-harlowe-4-macroName-changer{color:hsla(90,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-changer{color:hsla(90,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-changer{color:hsla(90,100%,70%,1.0)}.cm-harlowe-4-macroName-string{color:hsla(180,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-string{color:hsla(180,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-string{color:hsla(180,100%,70%,1.0)}.cm-harlowe-4-macroName-colour, .cm-harlowe-4-macroName-gradient, .cm-harlowe-4-macroName-image{color:hsla(280,100%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-colour, .theme-dark .cm-harlowe-4-macroName-gradient, .theme-dark .cm-harlowe-4-macroName-image{color:hsla(280,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-colour, [data-app-theme=dark] .cm-harlowe-4-macroName-gradient, [data-app-theme=dark] .cm-harlowe-4-macroName-image{color:hsla(280,100%,70%,1.0)}.cm-harlowe-4-macroName-command, .cm-harlowe-4-macroName-instant, .cm-harlowe-4-macroName-metadata{color:hsla(240,100%,20%,1.0)}.theme-dark .cm-harlowe-4-macroName-command, .theme-dark .cm-harlowe-4-macroName-instant, .theme-dark .cm-harlowe-4-macroName-metadata{color:hsla(240,100%,80%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-command, [data-app-theme=dark] .cm-harlowe-4-macroName-instant, [data-app-theme=dark] .cm-harlowe-4-macroName-metadata{color:hsla(240,100%,80%,1.0)}.cm-harlowe-4-macroName-custommacro, .cm-harlowe-4-macroName-macro, .cm-harlowe-4-macroName-any{color:hsla(320,80%,30%,1.0)}.theme-dark .cm-harlowe-4-macroName-custommacro, .theme-dark .cm-harlowe-4-macroName-macro, .theme-dark .cm-harlowe-4-macroName-any{color:hsla(320,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-macroName-custommacro, [data-app-theme=dark] .cm-harlowe-4-macroName-macro, [data-app-theme=dark] .cm-harlowe-4-macroName-any{color:hsla(320,100%,70%,1.0)}[class^='cm-harlowe-4-macro ']{font-weight:bold;color:hsla(320,80%,30%,1.0)}.theme-dark [class^='cm-harlowe-4-macro ']{font-weight:bold;color:hsla(320,100%,70%,1.0)}[data-app-theme=dark] [class^='cm-harlowe-4-macro ']{font-weight:bold;color:hsla(320,100%,70%,1.0)}.cm-harlowe-4-comma, .cm-harlowe-4-spread{color:hsla(320,80%,30%,1.0)}.theme-dark .cm-harlowe-4-comma, .theme-dark .cm-harlowe-4-spread{color:hsla(320,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-comma, [data-app-theme=dark] .cm-harlowe-4-spread{color:hsla(320,100%,70%,1.0)}.cm-harlowe-4-addition{color:hsla(320,80%,30%,1.0)}.theme-dark .cm-harlowe-4-addition{color:hsla(320,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-addition{color:hsla(320,100%,70%,1.0)}.cm-harlowe-4-subtraction, .cm-harlowe-4-multiplication, .cm-harlowe-4-division{color:hsla(30,100%,30%,1.0)}.theme-dark .cm-harlowe-4-subtraction, .theme-dark .cm-harlowe-4-multiplication, .theme-dark .cm-harlowe-4-division{color:hsla(30,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-subtraction, [data-app-theme=dark] .cm-harlowe-4-multiplication, [data-app-theme=dark] .cm-harlowe-4-division{color:hsla(30,100%,70%,1.0)}.cm-harlowe-4-is, .cm-harlowe-4-and, .cm-harlowe-4-or, .cm-harlowe-4-not, .cm-harlowe-4-isNot, .cm-harlowe-4-contains, .cm-harlowe-4-doesNotContain, .cm-harlowe-4-isIn, .cm-harlowe-4-isA, .cm-harlowe-4-isNotA, .cm-harlowe-4-isNotIn, .cm-harlowe-4-matches, .cm-harlowe-4-doesNotMatch{color:hsla(0,0%,30%,1.0)}.theme-dark .cm-harlowe-4-is, .theme-dark .cm-harlowe-4-and, .theme-dark .cm-harlowe-4-or, .theme-dark .cm-harlowe-4-not, .theme-dark .cm-harlowe-4-isNot, .theme-dark .cm-harlowe-4-contains, .theme-dark .cm-harlowe-4-doesNotContain, .theme-dark .cm-harlowe-4-isIn, .theme-dark .cm-harlowe-4-isA, .theme-dark .cm-harlowe-4-isNotA, .theme-dark .cm-harlowe-4-isNotIn, .theme-dark .cm-harlowe-4-matches, .theme-dark .cm-harlowe-4-doesNotMatch{color:hsla(0,0%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-is, [data-app-theme=dark] .cm-harlowe-4-and, [data-app-theme=dark] .cm-harlowe-4-or, [data-app-theme=dark] .cm-harlowe-4-not, [data-app-theme=dark] .cm-harlowe-4-isNot, [data-app-theme=dark] .cm-harlowe-4-contains, [data-app-theme=dark] .cm-harlowe-4-doesNotContain, [data-app-theme=dark] .cm-harlowe-4-isIn, [data-app-theme=dark] .cm-harlowe-4-isA, [data-app-theme=dark] .cm-harlowe-4-isNotA, [data-app-theme=dark] .cm-harlowe-4-isNotIn, [data-app-theme=dark] .cm-harlowe-4-matches, [data-app-theme=dark] .cm-harlowe-4-doesNotMatch{color:hsla(0,0%,70%,1.0)}.cm-harlowe-4-bold, .cm-harlowe-4-strong{font-weight:bold;}.cm-harlowe-4-italic, .cm-harlowe-4-em{font-style:italic;}.cm-harlowe-4-sup{vertical-align: super;font-size:0.8em;}.cm-harlowe-4-strike{text-decoration: line-through;}.cm-harlowe-4-verbatim{background-color: hsla(0,0%,50%,0.25); font:var(--font-monospaced)}.theme-dark .cm-harlowe-4-verbatim{background-color: hsla(0,0%,50%,0.25); font:var(--font-monospaced)}[data-app-theme=dark] .cm-harlowe-4-verbatim{background-color: hsla(0,0%,50%,0.25); font:var(--font-monospaced)}.cm-harlowe-4-comment{color: hsla(120, 80%, 40%, 1); font-style:italic;}[class^='cm-harlowe-4-bold'], [class^='cm-harlowe-4-strong'], [class^='cm-harlowe-4-italic'], [class^='cm-harlowe-4-em'], [class^='cm-harlowe-4-sup'], [class^='cm-harlowe-4-verbatim'], [class^='cm-harlowe-4-strike']{font-weight:100; color: hsla(0,0%,0%,0.5)}.theme-dark [class^='cm-harlowe-4-bold'], .theme-dark [class^='cm-harlowe-4-strong'], .theme-dark [class^='cm-harlowe-4-italic'], .theme-dark [class^='cm-harlowe-4-em'], .theme-dark [class^='cm-harlowe-4-sup'], .theme-dark [class^='cm-harlowe-4-verbatim'], .theme-dark [class^='cm-harlowe-4-strike']{font-weight:100; color: hsla(0,0%,100%,0.5)}[data-app-theme=dark] [class^='cm-harlowe-4-bold'], [data-app-theme=dark] [class^='cm-harlowe-4-strong'], [data-app-theme=dark] [class^='cm-harlowe-4-italic'], [data-app-theme=dark] [class^='cm-harlowe-4-em'], [data-app-theme=dark] [class^='cm-harlowe-4-sup'], [data-app-theme=dark] [class^='cm-harlowe-4-verbatim'], [data-app-theme=dark] [class^='cm-harlowe-4-strike']{font-weight:100; color: hsla(0,0%,100%,0.5)}[class^='cm-harlowe-4-collapsed']{font-weight:bold; color: hsla(201,100%,30%,1.0);}.theme-dark [class^='cm-harlowe-4-collapsed']{font-weight:bold; color: hsla(201,100%,70%,1.0);}[data-app-theme=dark] [class^='cm-harlowe-4-collapsed']{font-weight:bold; color: hsla(201,100%,70%,1.0);}.cm-harlowe-4-unclosedCollapsed{background-color: hsla(220,100%,50%,0.025);font-weight:bold; color: hsla(201,100%,30%,1.0);}.theme-dark .cm-harlowe-4-unclosedCollapsed{background-color: hsla(220,100%,50%,0.025);font-weight:bold; color: hsla(201,100%,70%,1.0);}[data-app-theme=dark] .cm-harlowe-4-unclosedCollapsed{background-color: hsla(220,100%,50%,0.025);font-weight:bold; color: hsla(201,100%,70%,1.0);}.cm-harlowe-4-collapsed{background-color: hsla(220,100%,50%,0.025);}.theme-dark .cm-harlowe-4-collapsed{background-color: hsla(220,100%,50%,0.025);}[data-app-theme=dark] .cm-harlowe-4-collapsed{background-color: hsla(220,100%,50%,0.025);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook{background-color: hsla(220,100%,50%,0.05);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook{background-color: hsla(220,100%,50%,0.05);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook{background-color: hsla(220,100%,50%,0.05);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-2{background-color: hsla(220,100%,50%,0.1);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-2{background-color: hsla(220,100%,50%,0.1);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-2{background-color: hsla(220,100%,50%,0.1);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-3{background-color: hsla(220,100%,50%,0.15);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-3{background-color: hsla(220,100%,50%,0.15);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-3{background-color: hsla(220,100%,50%,0.15);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-4{background-color: hsla(220,100%,50%,0.2);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-4{background-color: hsla(220,100%,50%,0.2);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-4{background-color: hsla(220,100%,50%,0.2);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-5{background-color: hsla(220,100%,50%,0.25);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-5{background-color: hsla(220,100%,50%,0.25);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-5{background-color: hsla(220,100%,50%,0.25);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-6{background-color: hsla(220,100%,50%,0.3);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-6{background-color: hsla(220,100%,50%,0.3);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-6{background-color: hsla(220,100%,50%,0.3);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-7{background-color: hsla(220,100%,50%,0.35);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-7{background-color: hsla(220,100%,50%,0.35);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-7{background-color: hsla(220,100%,50%,0.35);}.cm-harlowe-4-collapsed.cm-harlowe-4-hook-8{background-color: hsla(220,100%,50%,0.4);}.theme-dark .cm-harlowe-4-collapsed.cm-harlowe-4-hook-8{background-color: hsla(220,100%,50%,0.4);}[data-app-theme=dark] .cm-harlowe-4-collapsed.cm-harlowe-4-hook-8{background-color: hsla(220,100%,50%,0.4);}.cm-harlowe-4-twineLink:not(.cm-harlowe-4-text){color:hsla(240,100%,20%,1.0)}.theme-dark .cm-harlowe-4-twineLink:not(.cm-harlowe-4-text){color:hsla(240,100%,80%,1.0)}[data-app-theme=dark] .cm-harlowe-4-twineLink:not(.cm-harlowe-4-text){color:hsla(240,100%,80%,1.0)}.cm-harlowe-4-tag, .cm-harlowe-4-scriptStyleTag, .cm-harlowe-4-htmlComment{color: hsla(240,34%,25%,1.0);}.theme-dark .cm-harlowe-4-tag, .theme-dark .cm-harlowe-4-scriptStyleTag, .theme-dark .cm-harlowe-4-htmlComment{color: hsla(240,51%,75%,1.0);}[data-app-theme=dark] .cm-harlowe-4-tag, [data-app-theme=dark] .cm-harlowe-4-scriptStyleTag, [data-app-theme=dark] .cm-harlowe-4-htmlComment{color: hsla(240,51%,75%,1.0);}.cm-harlowe-4-boolean{color:hsla(0,0%,30%,1.0)}.theme-dark .cm-harlowe-4-boolean{color:hsla(0,0%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-boolean{color:hsla(0,0%,70%,1.0)}.cm-harlowe-4-string{color:hsla(180,100%,30%,1.0)}.theme-dark .cm-harlowe-4-string{color:hsla(180,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-string{color:hsla(180,100%,70%,1.0)}.cm-harlowe-4-number{color:hsla(30,100%,30%,1.0)}.theme-dark .cm-harlowe-4-number{color:hsla(30,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-number{color:hsla(30,100%,70%,1.0)}.cm-harlowe-4-variable{color:hsla(200,100%,30%,1.0)}.theme-dark .cm-harlowe-4-variable{color:hsla(200,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-variable{color:hsla(200,100%,70%,1.0)}.cm-harlowe-4-tempVariable{color:hsla(200,70%,20%,1.0)}.theme-dark .cm-harlowe-4-tempVariable{color:hsla(200,100%,80%,1.0)}[data-app-theme=dark] .cm-harlowe-4-tempVariable{color:hsla(200,100%,80%,1.0)}.cm-harlowe-4-hookName{color:hsla(160,100%,30%,1.0)}.theme-dark .cm-harlowe-4-hookName{color:hsla(160,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-hookName{color:hsla(160,100%,70%,1.0)}.cm-harlowe-4-datatype{color:hsla(220,100%,30%,1.0)}.theme-dark .cm-harlowe-4-datatype{color:hsla(220,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-datatype{color:hsla(220,100%,70%,1.0)}.cm-harlowe-4-colour{color:hsla(280,100%,30%,1.0)}.theme-dark .cm-harlowe-4-colour{color:hsla(280,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-colour{color:hsla(280,100%,70%,1.0)}.cm-harlowe-4-cssTime{color:hsla(30,100%,30%,1.0)}.theme-dark .cm-harlowe-4-cssTime{color:hsla(30,100%,70%,1.0)}[data-app-theme=dark] .cm-harlowe-4-cssTime{color:hsla(30,100%,70%,1.0)}.cm-harlowe-4-passageString{color:hsla(200,100%,30%,1.0);text-decoration:underline 1px;}.theme-dark .cm-harlowe-4-passageString{color:hsla(200,100%,70%,1.0);text-decoration:underline 1px;}[data-app-theme=dark] .cm-harlowe-4-passageString{color:hsla(200,100%,70%,1.0);text-decoration:underline 1px;}.cm-harlowe-4-tagString{color:hsla(200,100%,30%,1.0);text-decoration:underline 1px dotted;}.theme-dark .cm-harlowe-4-tagString{color:hsla(200,100%,70%,1.0);text-decoration:underline 1px dotted;}[data-app-theme=dark] .cm-harlowe-4-tagString{color:hsla(200,100%,70%,1.0);text-decoration:underline 1px dotted;}.cm-harlowe-4-variableOccurrence, .cm-harlowe-4-hookOccurrence{background: hsla(159,50%,75%,1.0) !important;}.theme-dark .cm-harlowe-4-variableOccurrence, .theme-dark .cm-harlowe-4-hookOccurrence{background: hsla(159,75%,25%,1.0) !important;}[data-app-theme=dark] .cm-harlowe-4-variableOccurrence, [data-app-theme=dark] .cm-harlowe-4-hookOccurrence{background: hsla(159,75%,25%,1.0) !important;}[class^='cm-harlowe-4-where'], [class^='cm-harlowe-4-via'], [class^='cm-harlowe-4-with'], [class^='cm-harlowe-4-making'], [class^='cm-harlowe-4-each'], [class^='cm-harlowe-4-when']{color:hsla(120,100%,40%,1.0); font-style:italic;}.theme-dark [class^='cm-harlowe-4-where'], .theme-dark [class^='cm-harlowe-4-via'], .theme-dark [class^='cm-harlowe-4-with'], .theme-dark [class^='cm-harlowe-4-making'], .theme-dark [class^='cm-harlowe-4-each'], .theme-dark [class^='cm-harlowe-4-when']{color:hsla(120,100%,60%,1.0); font-style:italic;}[data-app-theme=dark] [class^='cm-harlowe-4-where'], [data-app-theme=dark] [class^='cm-harlowe-4-via'], [data-app-theme=dark] [class^='cm-harlowe-4-with'], [data-app-theme=dark] [class^='cm-harlowe-4-making'], [data-app-theme=dark] [class^='cm-harlowe-4-each'], [data-app-theme=dark] [class^='cm-harlowe-4-when']{color:hsla(120,100%,60%,1.0); font-style:italic;}.cm-harlowe-4-heading{font-weight:bold;}.cm-harlowe-4-hr{background-image: linear-gradient(0deg, transparent, transparent 45%, hsla(0,0%,75%,1.0) 45%, transparent 55%, transparent);}.theme-dark .cm-harlowe-4-hr{background-image: linear-gradient(0deg, transparent, transparent 45%, hsla(0,0%,25%,1.0) 45%, transparent 55%, transparent);}[data-app-theme=dark] .cm-harlowe-4-hr{background-image: linear-gradient(0deg, transparent, transparent 45%, hsla(0,0%,25%,1.0) 45%, transparent 55%, transparent);}.cm-harlowe-4-align{color: hsla(14,99%,37%,1.0); background-color: hsla(14,99%,87%,0.1);}.theme-dark .cm-harlowe-4-align{color: hsla(14,100%,63%,1.0); background-color: hsla(14,100%,13%,0.1);}[data-app-theme=dark] .cm-harlowe-4-align{color: hsla(14,100%,63%,1.0); background-color: hsla(14,100%,13%,0.1);}.cm-harlowe-4-column{color: hsla(204,99%,37%,1.0); background-color: hsla(204,99%,87%,0.1);}.theme-dark .cm-harlowe-4-column{color: hsla(204,100%,63%,1.0); background-color: hsla(204,100%,13%,0.1);}[data-app-theme=dark] .cm-harlowe-4-column{color: hsla(204,100%,63%,1.0); background-color: hsla(204,100%,13%,0.1);}.cm-harlowe-4-escapedLine{font-weight:bold; color: hsla(51,100%,30%,1.0);}.theme-dark .cm-harlowe-4-escapedLine{font-weight:bold; color: hsla(51,100%,70%,1.0);}[data-app-theme=dark] .cm-harlowe-4-escapedLine{font-weight:bold; color: hsla(51,100%,70%,1.0);}.cm-harlowe-4-identifier, .cm-harlowe-4-property, .cm-harlowe-4-belongingProperty, .cm-harlowe-4-itsProperty, .cm-harlowe-4-belongingItProperty, .cm-harlowe-4-belongingItOperator, .cm-harlowe-4-possessiveOperator, .cm-harlowe-4-belongingOperator{color:hsla(200,80%,40%,1.0)}.theme-dark .cm-harlowe-4-identifier, .theme-dark .cm-harlowe-4-property, .theme-dark .cm-harlowe-4-belongingProperty, .theme-dark .cm-harlowe-4-itsProperty, .theme-dark .cm-harlowe-4-belongingItProperty, .theme-dark .cm-harlowe-4-belongingItOperator, .theme-dark .cm-harlowe-4-possessiveOperator, .theme-dark .cm-harlowe-4-belongingOperator{color:hsla(200,100%,60%,1.0)}[data-app-theme=dark] .cm-harlowe-4-identifier, [data-app-theme=dark] .cm-harlowe-4-property, [data-app-theme=dark] .cm-harlowe-4-belongingProperty, [data-app-theme=dark] .cm-harlowe-4-itsProperty, [data-app-theme=dark] .cm-harlowe-4-belongingItProperty, [data-app-theme=dark] .cm-harlowe-4-belongingItOperator, [data-app-theme=dark] .cm-harlowe-4-possessiveOperator, [data-app-theme=dark] .cm-harlowe-4-belongingOperator{color:hsla(200,100%,60%,1.0)}@keyframes harlowe-4-appear{0%{opacity:0}to{opacity:1}}@keyframes harlowe-4-fade-in-out{0%,to{opacity:0}50%{opacity:1}}@keyframes harlowe-4-rumble{25%{top:-0.1em}75%{top:.1em}0%,to{top:0px}}@keyframes harlowe-4-shudder{25%{left:.1em}75%{left:-0.1em}0%,to{left:0px}}@keyframes harlowe-4-buoy{25%{top:.25em}75%{top:-0.25em}0%,to{top:0px}}@keyframes harlowe-4-sway{25%{left:.25em}75%{left:-0.25em}0%,to{left:0px}}@keyframes harlowe-4-pulse{0%{transform:scale(0, 0)}20%{transform:scale(1.2, 1.2)}40%{transform:scale(0.9, 0.9)}60%{transform:scale(1.05, 1.05)}80%{transform:scale(0.925, 0.925)}to{transform:scale(1, 1)}}@keyframes harlowe-4-zoom-in{0%{transform:scale(0, 0)}to{transform:scale(1, 1)}}@keyframes harlowe-4-shudder-in{0%,to{transform:translateX(0em)}5%,25%,45%{transform:translateX(-1em)}15%,35%,55%{transform:translateX(1em)}65%{transform:translateX(-0.6em)}75%{transform:translateX(0.6em)}85%{transform:translateX(-0.2em)}95%{transform:translateX(0.2em)}}@keyframes harlowe-4-rumble-in{0%,to{transform:translateY(0em)}5%,25%,45%{transform:translateY(-1em)}15%,35%,55%{transform:translateY(1em)}65%{transform:translateY(-0.6em)}75%{transform:translateY(0.6em)}85%{transform:translateY(-0.2em)}95%{transform:translateY(0.2em)}}@keyframes harlowe-4-fidget{0%,8.1%,82.1%,31.1%,38.1%,44.1%,40.1%,47.1%,74.1%,16.1%,27.1%,72.1%,24.1%,95.1%,6.1%,36.1%,20.1%,4.1%,91.1%,14.1%,87.1%,to{left:0px;top:0px}8%,82%,31%,38%,44%{left:-1px}40%,47%,74%,16%,27%{left:1px}72%,24%,95%,6%,36%{top:-1px}20%,4%,91%,14%,87%{top:1px}}@keyframes harlowe-4-slide-right{0%{transform:translateX(-100vw)}}@keyframes harlowe-4-slide-left{0%{transform:translateX(100vw)}}@keyframes harlowe-4-slide-up{0%{transform:translateY(100vh)}}@keyframes harlowe-4-slide-down{0%{transform:translateY(-100vh)}}@keyframes harlowe-4-fade-right{0%{opacity:0;transform:translateX(-1em)}to{opacity:1}}@keyframes harlowe-4-fade-left{0%{opacity:0;transform:translateX(1em)}to{opacity:1}}@keyframes harlowe-4-fade-up{0%{opacity:0;transform:translateY(1em)}to{opacity:1}}@keyframes harlowe-4-fade-down{0%{opacity:0;transform:translateY(-1em)}to{opacity:1}}@keyframes harlowe-4-flicker{0%,29%,31%,63%,65%,77%,79%,86%,88%,91%,93%{opacity:0}30%{opacity:.2}64%{opacity:.4}78%{opacity:.6}87%{opacity:.8}92%,to{opacity:1}}@keyframes harlowe-4-blur{0%{filter:blur(2rem);opacity:0}25%{opacity:1}to{filter:blur(0rem);opacity:1}}\\n.harlowe-4-toolbarPanel{transition:max-height .8s;overflow-y:auto;margin-bottom:4px}.harlowe-4-minimised .harlowe-4-toolbarPanel>:not(:last-child){display:none}.harlowe-4-toolbarPanel code:not(:empty){font-size:1rem;border:1px dotted hsl(0, 0%, 50%)}.harlowe-4-toolbarPanel [type=radio][disabled]~*{opacity:.5}.harlowe-4-stylePreview{text-align:center;user-select:none;background:black;color:white;font-family:\\\"Georgia\\\",serif;padding:8px;font-size:1.5rem;margin:8px auto;width:60%;position:sticky;top:0;z-index:1}.harlowe-4-stylePreview textarea{background:black;color:white}.harlowe-4-stylePreview>span{display:inline-block}.harlowe-4-stylePreview>span:first-child{position:absolute}.harlowe-4-stylePreview>span:last-child{position:relative}.harlowe-4-toolbarPanel>button{border-radius:.8rem;margin:0px 2px;padding:0px 4px;height:36px;font-size:1.2rem;min-width:28px}.harlowe-4-toolbarPanel>button:not(:active):not(.active):not(:last-child){border:1px solid hsla(0, 0%, 50%, 0.5);border-top:none;border-left:none}.harlowe-4-toolbarCheckboxes{border-bottom:1px solid hsla(0, 0%, 50%, 0.5);position:relative;padding-bottom:8px;margin-bottom:8px}.harlowe-4-toolbarPanel label:not(.harlowe-4-radioRow){white-space:nowrap}.harlowe-4-toolbarCheckboxes>label{min-width:20%;display:inline-block}.harlowe-4-swatch{width:24px;height:24px;display:inline-block;cursor:pointer;border-bottom:1px solid hsla(0, 0%, 50%, 0.5);border-right:1px solid hsla(0, 0%, 50%, 0.5)}.harlowe-4-labeledInput{position:relative;padding-bottom:8px}.harlowe-4-labeledInput>input[type=text]{display:inline-block;font-size:1rem}.harlowe-4-labeledInput>input[type=range]{vertical-align:middle}.harlowe-4-labeledInput>input[type=number]{box-shadow:0 1px 0 hsla(0, 0%, 50%, 0.5);background:transparent;color:inherit;border:none;font-family:\\\"Source Code Pro\\\",monospace;font-family:var(--font-monospaced);width:4rem;margin:0 .5rem;display:inline-block;font-size:1rem}.harlowe-4-radioRow{margin:8px 0px;display:block}.harlowe-4-radioRow .harlowe-4-radioRow{margin-left:2rem}.harlowe-4-toolbarPanel>*>.harlowe-4-radioRow{border-bottom:1px solid hsla(0, 0%, 50%, 0.5);padding-bottom:8px}.harlowe-4-confirmButtons>span{display:inline-block;align-items:center}.harlowe-4-resultCode{max-width:50%;overflow-x:auto;white-space:pre;display:inline-block;padding:1px 0px}.harlowe-4-resultCode *{white-space:nowrap}.harlowe-4-toolbarBullet{padding:0px 2px;color:hsla(0, 0%, 50%, 0.5)}.harlowe-4-toolbarBullet::before{content:\\\"•\\\"}.harlowe-4-bgColourButton{display:inline-block;border-radius:8px;width:16px;height:16px;margin-bottom:-2px;background:linear-gradient(to right, hsla(0, 100%, 50%, 0.5), hsla(30, 100%, 50%, 0.5), hsla(60, 100%, 50%, 0.5), hsla(120, 100%, 50%, 0.5), hsla(180, 100%, 50%, 0.5), hsla(240, 100%, 50%, 0.5), hsla(300, 100%, 50%, 0.5), hsla(320, 100%, 50%, 0.5))}.harlowe-4-gradientBar{display:inline-block;position:relative;width:75%;height:32px;margin:12px 8px 96px 40px;border:1px solid hsla(0, 0%, 50%, 0.5);border-radius:5px}.harlowe-4-gradientBar+button{position:absolute;top:8px;right:8px}.harlowe-4-colourStop{position:absolute;height:48px;width:16px;background:hsla(0, 0%, 50%, 0.5);border-radius:5px;cursor:grab}.harlowe-4-colourStop:active{cursor:grabbing}.harlowe-4-colourStopButtons{display:none;position:relative;top:64px;width:540px;background:hsla(0, 0%, 50%, 0.5);padding:8px;cursor:auto}.harlowe-4-colourStop[selected]{border-bottom-right-radius:0px;border-bottom-left-radius:0px;height:64px}.harlowe-4-colourStop[selected]>.harlowe-4-colourStopButtons{display:block}.harlowe-4-singleColourPicker{display:inline-block}.harlowe-4-singleColourPicker select{position:relative;top:-4px;font-size:1rem;margin-left:8px}.harlowe-4-directionPicker{width:48px;height:48px;border-radius:24px;border:1px solid hsla(0, 0%, 50%, 0.5);display:inline-block}.harlowe-4-hideCode .cm-harlowe-4-root:not(.cm-harlowe-4-text):not(.cm-harlowe-4-string):not(.cm-harlowe-4-verbatim){opacity:.25}.harlowe-4-hideHelpTooltip .harlowe-4-helpTooltip{display:none}.harlowe-4-tooltip{font-family:var(--font-system);max-width:20vw;position:absolute;border:1px solid hsla(0, 0%, 50%, 0.5);padding:8px;display:block;z-index:8}[data-version^=\\\"2.3\\\"] .harlowe-4-tooltip{font-family:\\\"Source Sans Pro\\\",sans-serif}.theme-light .harlowe-4-tooltip,[data-app-theme=light] .harlowe-4-tooltip{background:white}.theme-dark .harlowe-4-tooltip,[data-app-theme=dark] .harlowe-4-tooltip{background:black}.harlowe-4-tooltipMacroSignature{display:block;padding-top:.5em;margin-top:.5em;border-top:1px solid hsla(0, 0%, 50%, 0.5)}.harlowe-4-tooltipTail{position:absolute;height:0;width:0;border:12px solid transparent;border-bottom-color:hsla(0, 0%, 50%, 0.5)}.harlowe-4-tooltipTail::after{content:\\\"\\\";position:absolute;height:0;width:0;left:-12px;top:-10px;border:12px solid transparent}.harlowe-4-completion{max-height:12em;overflow-y:scroll}.harlowe-4-tooltipItemSelected{background-color:#888;background-color:var(--light-gray-translucent)}.theme-light .harlowe-4-tooltipTail::after,[data-app-theme=light] .harlowe-4-tooltipTail::after{border-bottom-color:white}.theme-dark .harlowe-4-tooltipTail::after,[data-app-theme=dark] .harlowe-4-tooltipTail::after{border-bottom-color:black}.harlowe-4-dataEmptyRow:not(:last-child){display:none}.harlowe-4-dataRow .harlowe-4-dropdownRowLabel{font-family:\\\"Source Code Pro\\\",monospace;font-family:var(--font-monospaced)}.harlowe-4-textareaRows{margin-bottom:.5em}.harlowe-4-nonZeroRows>:first-child>.harlowe-4-rowMinus{display:none}.harlowe-4-datavalueRows{margin-left:6px;padding-left:6px;border-left:1px solid hsla(0, 0%, 50%, 0.5)}.harlowe-4-toolbarPanel [invalid]::after{display:block;position:absolute;content:attr(invalid);background-color:hsla(17, 100%, 50%, 0.5);right:0px;bottom:8px}.harlowe-4-datavalueRows .harlowe-4-datavalueRows .harlowe-4-datavalueRowHint{display:none}.story-format-toolbar .icon>img:only-child{margin-right:0px}.harlowe-4-toolbarPanel .harlowe-4-confirmButtons{display:flex;justify-content:end}.passage-edit-dialog.collapsed .harlowe-4-toolbarPanel{display:none}.harlowe-4-scrollWrapper{overflow:hidden auto;max-height:60vh}.harlowe-4-toolbarPanel a[href]{color:var(--dark-blue);font-weight:bold}.harlowe-4-toolbarPanel.card{position:absolute;width:576px;height:auto;top:0px;padding:8px}.story-format-toolbar+.harlowe-4-toolbarPanel .harlowe-4-confirmButtons{justify-content:start;flex-flow:row-reverse}.harlowe-4-toolbarPanel textarea,.harlowe-4-toolbarPanel [type=text]{background:var(--white-translucent);border-radius:var(--corner-round);border:1px solid var(--faint-gray);color:var(--dark-gray)}html:not([data-version^=\\\"2.3\\\"]) .harlowe-4-toolbarPanel [type=checkbox]{background:transparent;border:2px solid var(--dark-gray);width:16px;height:16px;appearance:none;position:relative;border-radius:2px;margin:0px 6px;vertical-align:middle}html:not([data-version^=\\\"2.3\\\"]) .harlowe-4-toolbarPanel [type=checkbox]:checked::before{content:\\\"✔\\\";position:absolute;right:-2px;top:-4px;margin-right:3px}select>option{background-color:var(--light-gray);color:var(--dark-gray) !important}.harlowe-4-radioRow{padding-left:0px;padding-right:0px;user-select:none;position:relative}.harlowe-4-radioRow>:first-child,.harlowe-4-radioRow>:nth-child(2){cursor:pointer}.harlowe-4-radioRow>div{padding:var(--grid-size)}.harlowe-4-toolbarPanel select{padding:var(--grid-size)}.harloweToolbar+.story-format-toolbar button{padding:calc(var(--grid-size) - 1px)}#root>.dialogs>:not(.passag-edit-stack){z-index:-1}\\n\";\n"});