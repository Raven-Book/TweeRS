# 对象数组

import { TweePlayground } from '@/components';
import { ObjectArrayVisualizer } from '@/teaching';

数组存放同类的值，对象描述一个事物的属性。把它们组合起来——**数组里的每个元素是一个对象**——就能表示一组结构相同的事物，比如背包里的物品。

## null 与 undefined

在写对象数组之前，先认识两个特殊值：

| 值 | 含义 | 例子 |
|------|------|------|
| `null` | 故意留空，表示"没有值" | 药水没有耐久：`durability: null` |
| `undefined` | 属性不存在 | 访问对象上没有的键 |

<TweePlayground hideStoryHeader code={`:: StoryData
{
  "ifid": "D674C58C-DEFA-4F70-B7A2-27742230C0FC",
  "format": "SugarCube",
  "format-version": "2.37.3"
}

:: StoryTitle
null与undefined

:: Start
<<set $item = { name: "药水", durability: null }>>
耐久：<<= $item.durability>>
颜色：<<= $item.color>>
`} />

`$item.durability` 是 `null`——我们明确设置了"没有耐久"。`$item.color` 是 `undefined`——这个属性根本不存在。

## 创建对象数组

```twee
<<set $bag = [
  { name: "铁剑", count: 1, durability: 50 },
  { name: "药水", count: 3, durability: null }
]>>
```

每个元素是一个对象，拥有相同的键。药水没有耐久，用 `null` 表示。

<ObjectArrayVisualizer
  variable="$bag"
  steps={[
    {
      code: '<<set $bag = [{ name: "铁剑", count: 1, durability: 50 }, { name: "药水", count: 3, durability: null }]>>',
      description: '创建包含两个物品的背包',
      items: [
        { entries: [{ key: 'name', value: '铁剑' }, { key: 'count', value: '1' }, { key: 'durability', value: '50' }] },
        { entries: [{ key: 'name', value: '药水' }, { key: 'count', value: '3' }, { key: 'durability', value: 'null' }] },
      ],
    },
    {
      code: '$bag[0].name',
      description: '先用索引拿到对象，再用点号拿属性 → "铁剑"',
      items: [
        { entries: [{ key: 'name', value: '铁剑' }, { key: 'count', value: '1' }, { key: 'durability', value: '50' }] },
        { entries: [{ key: 'name', value: '药水' }, { key: 'count', value: '3' }, { key: 'durability', value: 'null' }] },
      ],
      highlightIndex: 0,
      highlightKey: 'name',
    },
    {
      code: '$bag[1].durability',
      description: '药水的耐久是 null——故意留空',
      items: [
        { entries: [{ key: 'name', value: '铁剑' }, { key: 'count', value: '1' }, { key: 'durability', value: '50' }] },
        { entries: [{ key: 'name', value: '药水' }, { key: 'count', value: '3' }, { key: 'durability', value: 'null' }] },
      ],
      highlightIndex: 1,
      highlightKey: 'durability',
    },
  ]}
/>

## 访问元素

先用索引拿到对象，再用点号拿属性：

| 写法 | 结果 |
|------|------|
| `$bag[0]` | 整个铁剑对象 |
| `$bag[0].name` | "铁剑" |
| `$bag[1].count` | 3 |
| `$bag[1].durability` | null |

<TweePlayground hideStoryHeader code={`:: StoryData
{
  "ifid": "D674C58C-DEFA-4F70-B7A2-27742230C0FC",
  "format": "SugarCube",
  "format-version": "2.37.3"
}

:: StoryTitle
访问对象数组

:: Start
<<set $bag = [
  { name: "铁剑", count: 1, durability: 50 },
  { name: "药水", count: 3, durability: null }
]>>
第一件物品：$bag[0].name（耐久：<<= $bag[0].durability>>）
第二件物品：$bag[1].name（数量：$bag[1].count）
`} />

## 添加物品

用 `push` 往背包末尾添加一个新对象：

```twee
<<run $bag.push({ name: "火把", count: 1, durability: 30 })>>
```

<TweePlayground hideStoryHeader code={`:: StoryData
{
  "ifid": "D674C58C-DEFA-4F70-B7A2-27742230C0FC",
  "format": "SugarCube",
  "format-version": "2.37.3"
}

:: StoryTitle
添加物品

:: Start
<<set $bag = [
  { name: "铁剑", count: 1, durability: 50 }
]>>
背包：$bag[0].name
物品数：$bag.length

<<run $bag.push({ name: "药水", count: 3, durability: null })>>
添加药水后：$bag[1].name（数量：$bag[1].count）
物品数：$bag.length
`} />

## 修改物品属性

通过索引找到物品，用点号修改它的属性：

```twee
<<set $bag[0].durability -= 10>>
<<set $bag[1].count -= 1>>
```

<TweePlayground hideStoryHeader code={`:: StoryData
{
  "ifid": "D674C58C-DEFA-4F70-B7A2-27742230C0FC",
  "format": "SugarCube",
  "format-version": "2.37.3"
}

:: StoryTitle
修改属性

:: StoryInit
<<set $bag = [
  { name: "铁剑", count: 1, durability: 50 },
  { name: "药水", count: 3, durability: null }
]>>

:: Start
铁剑耐久：$bag[0].durability
药水数量：$bag[1].count

[[使用铁剑|UseSword]]
[[喝药水|UsePotion]]

:: UseSword
<<set $bag[0].durability -= 10>>
挥了一剑！铁剑耐久：$bag[0].durability
[[返回|Start]]

:: UsePotion
<<set $bag[1].count -= 1>>
喝了一瓶药水！剩余：$bag[1].count
[[返回|Start]]
`} />

## 删除物品

用 `deleteAt` 按索引删除：

```twee
<<run $bag.deleteAt(1)>>
```

删除后，后面的元素索引会自动前移。

<ObjectArrayVisualizer
  variable="$bag"
  steps={[
    {
      code: '$bag — 删除前',
      description: '背包里有三件物品',
      items: [
        { entries: [{ key: 'name', value: '铁剑' }, { key: 'durability', value: '50' }] },
        { entries: [{ key: 'name', value: '药水' }, { key: 'durability', value: 'null' }] },
        { entries: [{ key: 'name', value: '火把' }, { key: 'durability', value: '30' }] },
      ],
    },
    {
      code: '<<run $bag.deleteAt(1)>>',
      description: '删除索引 1 的药水',
      items: [
        { entries: [{ key: 'name', value: '铁剑' }, { key: 'durability', value: '50' }] },
        { entries: [{ key: 'name', value: '药水' }, { key: 'durability', value: 'null' }] },
        { entries: [{ key: 'name', value: '火把' }, { key: 'durability', value: '30' }] },
      ],
      removed: 1,
    },
    {
      code: '$bag — 删除后',
      description: '火把从索引 2 变成了索引 1',
      items: [
        { entries: [{ key: 'name', value: '铁剑' }, { key: 'durability', value: '50' }] },
        { entries: [{ key: 'name', value: '火把' }, { key: 'durability', value: '30' }] },
      ],
    },
  ]}
/>

## 完整示例

一个简单的背包系统：探索房间捡物品，查看背包，使用物品。

<TweePlayground hideStoryHeader code={`:: StoryData
{
  "ifid": "D674C58C-DEFA-4F70-B7A2-27742230C0FC",
  "format": "SugarCube",
  "format-version": "2.37.3"
}

:: StoryTitle
背包系统

:: StoryInit
<<set $bag = []>>
<<set $gold = 50>>

:: Start
金币：$gold　背包：$bag.length 件物品
[[探索|Explore]]
<<if $bag.length > 0>>[[查看背包|Bag]]<</if>>

:: Explore
<<set _roll = random(1,3)>>
<<if _roll == 1>>
你发现了一把铁剑！
<<run $bag.push({ name: "铁剑", count: 1, durability: 50 })>>
<<elseif _roll == 2>>
你捡到了一瓶药水！
<<run $bag.push({ name: "药水", count: 1, durability: null })>>
<<else>>
你找到了一个火把！
<<run $bag.push({ name: "火把", count: 1, durability: 30 })>>
<</if>>
[[返回|Start]]

:: Bag
''背包（$bag.length 件）''
<<if $bag.length >= 1>>
- $bag[0].name<<if $bag[0].durability != null>>（耐久：$bag[0].durability）<</if>>
<</if>>
<<if $bag.length >= 2>>
- $bag[1].name<<if $bag[1].durability != null>>（耐久：$bag[1].durability）<</if>>
<</if>>
<<if $bag.length >= 3>>
- $bag[2].name<<if $bag[2].durability != null>>（耐久：$bag[2].durability）<</if>>
<</if>>
[[返回|Start]]
`} />

## 练习

玩家来到商店，用 `$shop` 存放商品。每个商品有 `name`（名称）、`price`（售价）、`count`（数量）。玩家花金币购买，买完扣金币扣库存，库存为 0 时提示售罄，金币不足时提示买不起。

<TweePlayground hideStoryHeader code={`:: StoryData
{
  "ifid": "D674C58C-DEFA-4F70-B7A2-27742230C0FC",
  "format": "SugarCube",
  "format-version": "2.37.3"
}

:: StoryTitle
商店练习

:: StoryInit
<<set $shop = [
  { name: "苹果", price: 5, count: 3 },
  { name: "面包", price: 8, count: 2 }
]>>
<<set $gold = 20>>

:: Start
金币：$gold

$shop[0].name — 售价 $shop[0].price，数量 $shop[0].count
$shop[1].name — 售价 $shop[1].price，数量 $shop[1].count

/* 用 <<if>> 判断数量和金币：都够时显示购买链接，否则显示"售罄"或"买不起" */
/* 购买片段中：gold -= price，count -= 1，然后返回 Start */
`} />
