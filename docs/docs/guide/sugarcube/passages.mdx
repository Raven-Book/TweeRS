# 片段

import { TweePlayground } from '@/components';
import { PassageVisualizer } from '@/teaching';

一个故事由多个**片段**（Passage）组成。每个片段是一块独立的内容，玩家通过链接在片段之间跳转。

<PassageVisualizer
  nodes={[
    { id: 'start', title: 'Start', content: ['你站在岔路口。', '[[进入森林]]', '[[走进山洞]]'], x: 0, y: 50 },
    { id: 'forest', title: '进入森林', content: ['树林里很安静。', '[[回到岔路口|Start]]'], x: 250, y: 0 },
    { id: 'cave', title: '走进山洞', content: ['山洞里很黑。', '[[回到岔路口|Start]]'], x: 250, y: 120 },
  ]}
  edges={[
    { id: 'e1', source: 'start', target: 'forest', label: '进入森林' },
    { id: 'e2', source: 'start', target: 'cave', label: '走进山洞' },
    { id: 'e3', source: 'forest', target: 'start', label: '回到岔路口' },
    { id: 'e4', source: 'cave', target: 'start', label: '回到岔路口' },
  ]}
  steps={[
    {
      visibleNodes: ['start'],
      visibleEdges: [],
      activeNode: 'start',
      description: '故事从 Start 片段开始，显示岔路口的内容',
    },
    {
      visibleNodes: ['start', 'forest', 'cave'],
      visibleEdges: ['e1', 'e2'],
      activeNode: 'start',
      description: '片段里的链接指向其他片段——点击就能跳转',
    },
    {
      visibleNodes: ['start', 'forest', 'cave'],
      visibleEdges: ['e1', 'e2', 'e3'],
      activeNode: 'forest',
      description: '玩家点击「进入森林」，跳转到森林片段',
    },
    {
      visibleNodes: ['start', 'forest', 'cave'],
      visibleEdges: ['e1', 'e2', 'e3', 'e4'],
      activeNode: 'start',
      description: '片段之间可以互相跳转，形成故事的网状结构',
    },
  ]}
/>

## 片段的写法

在 Twee 代码中，用 `::` 开头来声明一个片段：

```twee
:: 片段名
这里是片段的内容。
```

`::` 和片段名之间有一个空格。片段名之后的所有内容，直到下一个 `::` 之前，都属于这个片段。

## 一个故事可以有多个片段

<TweePlayground hideStoryHeader code={`:: StoryData
{
  "ifid": "D674C58C-DEFA-4F70-B7A2-27742230C0FC",
  "format": "SugarCube",
  "format-version": "2.37.3"
}

:: StoryTitle
片段示例

:: Start
这是第一个片段。

:: 第二个片段
这是第二个片段。
`} />

## 特殊片段

SugarCube 有一些特殊片段名，它们不会作为普通内容显示，而是在特定时机执行或填充左侧栏。

| 片段 | 作用 |
|------|------|
| `StoryData` | 存放故事的元信息（格式、版本等） |
| `StoryTitle` | 故事的标题，用于创建存档 ID，只能是纯文本 |
| `StoryInit` | 故事开始前执行，用于初始化变量 |
| `PassageReady` | 每次跳转，片段渲染**前**执行 |
| `PassageHeader` | 插入到每个片段**开头** |
| `PassageFooter` | 追加到每个片段**末尾** |
| `PassageDone` | 每次跳转，片段显示**后**执行 |
| `StoryBanner` | 填充左侧栏的横幅区域（标题上方） |
| `StoryDisplayTitle` | 页面标题和左侧栏显示标题 |
| `StorySubtitle` | 左侧栏副标题 |
| `StoryAuthor` | 左侧栏作者署名 |
| `StoryCaption` | 左侧栏说明区域，常用于显示额外信息 |
| `StoryMenu` | 左侧栏菜单项（只显示其中的链接） |
| `StoryInterface` | 替换 SugarCube 的默认 UI，内容作为原始 HTML |

这些特殊片段在后续章节中会逐步用到，这里先了解即可。

## 下一步

片段里可以写什么？从 [文本与排版](/guide/sugarcube/markup) 开始学习。
