name: Manual Build - Linux aarch64
on:
  workflow_dispatch:

env:
  CLICOLOR_FORCE: 1

permissions:
  contents: write

jobs:
  build:
    name: Build - Linux-aarch64
    runs-on: ubuntu-24.04-arm
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Rust
        uses: actions-rust-lang/setup-rust-toolchain@v1

      - name: Build binary
        run: cargo build --locked --release

      - name: Build archive
        shell: bash
        run: |
          mkdir archive
          if [ -f "LICENSE" ]; then cp LICENSE archive/; fi
          if [ -f "README.md" ]; then cp README.md archive/; fi
          if [ -d "test/story-format" ]; then cp -r test/story-format archive/; fi
          cp "target/release/tweers" archive/
          cd archive
          if [ -d "story-format" ]; then
            tar -czf "tweers-linux-aarch64.tar.gz" LICENSE README.md story-format tweers
          else
            tar -czf "tweers-linux-aarch64.tar.gz" LICENSE README.md tweers
          fi

      - name: Upload archive
        uses: actions/upload-artifact@v4
        with:
          name: tweers-linux-aarch64.tar.gz
          path: archive/tweers-linux-aarch64.tar.gz
